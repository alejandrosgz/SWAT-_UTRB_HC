#### Hard calibration Tagus ####

library(sf)
library(readr)
library(tidyverse)
library(hydroGOF)
library(lubridate)
library(gt)
library(patchwork)
library(SWATrunR)
#library(SWATplusR)
library(lhs)

# Funtion to calculate coeficient of determination
rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2  




#### SA ####

# Loading required R packages 
library(SWATrunR)
library(dplyr)
library(tibble)
library(purrr)
library(sensitivity)

# Function definitions 
## Set sampled parameter ranges to parameter boundaries
set_par_range <- function(par_tbl, range_tbl) {
  map2_df(par_tbl, range_tbl, ~ (.x * (.y[2] - .y[1]) + .y[1]))
}

# Paths 
# SWAT+ project path
tagus_path  <- './TxtInOut_TAGUS23/'

# Save path for Sobol parameter set
sample_path <- './230414_sobol_sample.rds'

# Sobol sample definition 
# Labels of the different spatial zones, used for splitting parameter table
# into list for the different zones
zones <- c('IMP', 'CRB', 'DTH', 'DTL')

# Sobol base sample size
ns <- 1000

# Analyzed SWAT+ model parameters
par_names <- c('surlag', 'chn', 'esco', 'cn2', 'awc', 'perco', 'latq_co', 'cn3_swf', 'z', 'k', 'bd', 
               'lat_ttime', 'alpha', 'flo_min', 'revap_min', 'revap_co', 'sp_yld')

# Number of parameters
np <- length(par_names)

# Drawing the base Sobol parameter sample
X1 <- data.frame(matrix(runif(np * ns), nrow = ns)) %>% set_names(par_names)
X2 <- data.frame(matrix(runif(np * ns), nrow = ns)) %>% set_names(par_names)

sobol_sample <- sobolSalt(model = NULL, X1, X2, scheme="A", nboot = 100)


######## Creating the parameter sets ######## 

Hard_SA_par_bound_zonal <- tibble(
  
  'surlag.bsn | change = absval' = c(0.05, 10), 
  'chn.rte | change = absval' = c(0, 0.3),
  
  'IMP_esc::esco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.25 , 0.999),    # IMP_esc::esco.hru | change = absval             
  'IMP_cn2::cn2.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-29.999  ,  10),  # IMP_cnn::cn2.hru | change = pctchg     
  'IMP_awc::awc.sol | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-10 , 50),        # IMP_awc::awc.sol | change = pctchg    
  'IMP_per::perco.hru | change = absval | unit =        c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.35 , 0.8),      # IMP_per::perco.hru | change = absval   
  'IMP_latq::latq_co.hru | change = abschg | unit =     c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.3, 0.3),       # IMP_latq::latq_co.hru | change = abschg  
  'IMP_cn3::cn3_swf.hru | change = abschg | unit =      c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.3, 0.3),       # IMP_cn3::cn3_swf.hru | change = abschg        
  'IMP_zso::z.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-20 , 40),        # IMP_zso::z.sol | change = pctchg 
  'IMP_kso::k.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-79.999 , 150),   # IMP_kso::k.sol | change = pctchg 
  'IMP_bd::bd.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-25 , 5),         # IMP_bd::bd.sol | change = pctchg 
  'IMP_lattime::lat_ttime.hru | change = absval| unit = c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.5, 25),         # IMP_lattime::lat_ttime.hru | change = absval
  
  'IMP_alpha::alpha.aqu | change = absval = | unit =      c(1,2,3,5,7,9,11,24,33,37,42,45,47,48,57,60,61,63,68,69,107,108,109,110,113,114,117,118,119,122)' = c(0.001, 0.05),   # IMP_alpha::alpha.aqu | change = absval
  'IMP_flomin::flo_min.aqu | change = absval | unit =     c(1,2,3,5,7,9,11,24,33,37,42,45,47,48,57,60,61,63,68,69,107,108,109,110,113,114,117,118,119,122)' = c(0, 20),         # IMP_flomin::flo_min.aqu | change = absval 
  'IMP_revapmin::revap_min.aqu | change = absval | unit = c(1,2,3,5,7,9,11,24,33,37,42,45,47,48,57,60,61,63,68,69,107,108,109,110,113,114,117,118,119,122)' = c(0, 20),         # IMP_revapmin::revap_min.aqu | change = absval 
  'IMP_revapco::revap_co.aqu | change = absval | unit =   c(1,2,3,5,7,9,11,24,33,37,42,45,47,48,57,60,61,63,68,69,107,108,109,110,113,114,117,118,119,122)' = c(0.02, 0.2),     # IMP_revapco::revap_co.aqu | change = absval 
  'IMP_spyld::sp_yld.aqu | change = absval =| unit =      c(1,2,3,5,7,9,11,24,33,37,42,45,47,48,57,60,61,63,68,69,107,108,109,110,113,114,117,118,119,122)' = c(0.00001, 0.05), # IMP_spyld::sp_yld.aqu | change = absval
  
  
  'CRB_esc::esco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.001 , 0.70),        # CRB_esc::esco.hru | change = absval           
  'CRB_cn2::cn2.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20  ,  10),          # CRB_cnn::cn2.hru | change = pctchg           
  'CRB_awc::awc.sol | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-60 , 10),            # CRB_awc::awc.sol | change = pctchg       
  'CRB_per::perco.hru | change = absval | unit =        c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.85 , 0.98),         # CRB_per::perco.hru | change = absval
  'CRB_latq::latq_co.hru | change = abschg | unit =     c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.3, 0.3),           # CRB_latq::latq_co.hru | change = abschg    
  'CRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.3, 0.3),           # CRB_cn3::cn3_swf.hru | change = abschg         
  'CRB_zso::z.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-49.999 , 10),        # CRB_zso::z.sol | change = pctchg       
  'CRB_kso::k.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-79.999 , 199.999),   # CRB_kso::k.sol | change = pctchg        
  'CRB_bd::bd.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20 , 5),             # CRB_bd::bd.sol | change = pctchg      
  'CRB_lattime::lat_ttime.hru | change = absval| unit = c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.5, 25),             # CRB_lattime::lat_ttime.hru | change = absval
  
  'CRB_alpha::alpha.aqu | change = absval = | unit =      c(6,8,10,17,19,23,25,27,29,30,32,35,36,38,40,41,43,50,51,54,56,62,79,104,120)' = c(0.001, 0.03), # CRB_alpha::alpha.aqu | change = absval
  'CRB_flomin::flo_min.aqu | change = absval | unit =     c(6,8,10,17,19,23,25,27,29,30,32,35,36,38,40,41,43,50,51,54,56,62,79,104,120)' = c(0, 20),       # CRB_flomin::flo_min.aqu | change = absval 
  'CRB_revapmin::revap_min.aqu | change = absval | unit = c(6,8,10,17,19,23,25,27,29,30,32,35,36,38,40,41,43,50,51,54,56,62,79,104,120)' = c(0, 20),       # CRB_revapmin::revap_min.aqu | change = absval 
  'CRB_revapco::revap_co.aqu | change = absval | unit =   c(6,8,10,17,19,23,25,27,29,30,32,35,36,38,40,41,43,50,51,54,56,62,79,104,120)' = c(0.02, 0.2),   # CRB_revapco::revap_co.aqu | change = absval 
  'CRB_spyld::sp_yld.aqu | change = absval =| unit =      c(6,8,10,17,19,23,25,27,29,30,32,35,36,38,40,41,43,50,51,54,56,62,79,104,120)' = c(0.01, 0.35),  # CRB_spyld::sp_yld.aqu | change = absval
  
  
  'DTH_esc::esco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.25 , 0.999),      # DTH_esc::esco.hru | change = absval                         
  'DTH_cn2::cn2.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-29.999  ,  -5),    # DTH_cnn::cn2.hru | change = pctchg             
  'DTH_awc::awc.sol | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(10 , 50),           # DTH_awc::awc.sol | change = pctchg         
  'DTH_per::perco.hru | change = absval | unit =        c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.75 , 0.95),       # DTH_per::perco.hru | change = absval  
  'DTH_latq::latq_co.hru | change = abschg | unit =     c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.3, 0.3),         # DTH_latq::latq_co.hru | change = abschg      
  'DTH_cn3::cn3_swf.hru | change = abschg | unit =      c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.3, 0.3),         # DTH_cn3::cn3_swf.hru | change = abschg           
  'DTH_zso::z.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0 , 49.999),        # DTH_zso::z.sol | change = pctchg         
  'DTH_kso::k.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-79.999 , 100),     # DTH_kso::k.sol | change = pctchg          
  'DTH_bd::bd.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-29.999 , -5),      # DTH_bd::bd.sol | change = pctchg        
  'DTH_lattime::lat_ttime.hru | change = absval| unit = c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.5, 25),           # DTH_lattime::lat_ttime.hru | change = absval
  
  'DTH_alpha::alpha.aqu | change = absval = | unit =      c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.001, 0.04),  # DTH_alpha::alpha.aqu | change = absval
  'DTH_flomin::flo_min.aqu | change = absval | unit =     c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0, 20),        # DTH_flomin::flo_min.aqu | change = absval 
  'DTH_revapmin::revap_min.aqu | change = absval | unit = c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0, 20),        # DTH_revapmin::revap_min.aqu | change = absval 
  'DTH_revapco::revap_co.aqu | change = absval | unit =   c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.02, 0.2),    # DTH_revapco::revap_co.aqu | change = absval 
  'DTH_spyld::sp_yld.aqu | change = absval =| unit =      c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.01, 0.35),    # DTH_spyld::sp_yld.aqu | change = absval
  
  'DTL_esc::esco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.6 , 0.999),      # DTL_esc::esco.hru | change = absval       
  'DTL_cn2::cn2.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999  ,  -10),  # DTL_cnn::cn2.hru | change = pctchg       
  'DTL_awc::awc.sol | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(20 , 59.999),      # DTL_awc::awc.sol | change = pctchg    
  'DTL_per::perco.hru | change = absval | unit =        c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.4 , 0.7),        # DTL_per::perco.hru | change = absval
  'DTL_latq::latq_co.hru | change = abschg | unit =     c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_latq::latq_co.hru | change = abschg    
  'DTL_cn3::cn3_swf.hru | change = abschg | unit =      c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_cn3::cn3_swf.hru | change = abschg        
  'DTL_zso::z.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(12.5 , 49.999),    # DTL_zso::z.sol | change = pctchg 
  'DTL_kso::k.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-79.999 , 50),     # DTL_kso::k.sol | change = pctchg 
  'DTL_bd::bd.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999 , -10),    # DTL_bd::bd.sol | change = pctchg 
  'DTL_lattime::lat_ttime.hru | change = absval| unit = c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.5, 25),          # DTH_lattime::lat_ttime.hru | change = absval
  
  'DTL_alpha::alpha.aqu | change = absval = | unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.001, 0.04),   # DTL_alpha::alpha.aqu | change = absval
  'DTL_flomin::flo_min.aqu | change = absval | unit =     c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0, 20),         # DTL_flomin::flo_min.aqu | change = absval 
  'DTL_revapmin::revap_min.aqu | change = absval | unit = c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0, 20),         # DTL_revapmin::revap_min.aqu | change = absval 
  'DTL_revapco::revap_co.aqu | change = absval | unit =   c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.02, 0.2),     # DTL_revapco::revap_co.aqu | change = absval 
  'DTL_spyld::sp_yld.aqu | change = absval =| unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.00001, 0.3))  # DTL_spyld::sp_yld.aqu | change = absval



# Splitting the parameter boundary table into a list where each element is
# the boundary table for each zone
par_bound_list <- map(zones, ~ select(Hard_SA_par_bound_zonal, starts_with(.x)))

par_sur_bound_list <- map(c("surlag"), ~ Hard_SA_par_bound_zonal[,1])

par_chn_bound_list <- map(c("chn"), ~ Hard_SA_par_bound_zonal[,2])


# Extract the Sobol parameter set from the Sobol parameter object
par_sobol_tbl <- as_tibble(sobol_sample$X, .name_repair = ~ par_names)

# Apply parameter boundaries to the Sobol parameter set for each
# spatial zone individually
par_sobol_reg <- map(par_bound_list, ~ set_par_range(par_sobol_tbl[c(3:17)], .x)) %>%
  map2(., par_bound_list, ~ set_names(.x, names(.y))) %>%
  bind_cols(.)


# Apply parameter boundaries to the Sobol parameter set for the basin parameters

par_surlag_bas <- map(par_sur_bound_list, ~ set_par_range(par_sobol_tbl[c(1)], .x)) %>%
  map2(., par_sur_bound_list, ~ set_names(.x, names(.y))) %>% 
  bind_cols(.)

par_chn_bas <- map(par_chn_bound_list, ~ set_par_range(par_sobol_tbl[c(2)], .x)) %>%
  map2(., par_chn_bound_list, ~ set_names(.x, names(.y))) %>% 
  bind_cols(.)


parset_SA_hc <- bind_cols(par_surlag_bas, par_chn_bas, par_sobol_reg)


# Save Sobol sample
saveRDS(sobol_sample, sample_path)


# Navaluenga (IMP) --> Channel 684
# Peralejo de las Truchas (CRB) --> Channel 480
# Torote (DTH) --> Channel 541
# Villasequilla (DTL/CRB/DTH) --> Channels 1161 + 1141
# Trillo (CRB/DTH/DTL)--> Channel 111


# Running SENSITIVITY ANALYSIS SWAT+ simulations
run_swatplus(project_path = tagus_path,
             output = list(channel_flow = define_output(file  = "channel_sd_day", 
                                                        variable = "flo_out",
                                                        unit = c(559, 480, 541, 1141, 1161, 111, 834, 564)),
                           basin_et = define_output(file = "basin_wb_aa",
                                                    variable = "et",
                                                    unit = 1),
                           basin_surq = define_output(file = "basin_wb_aa",
                                                    variable = "surq_gen",
                                                    unit = 1),
                           basin_latq = define_output(file = "basin_wb_aa",
                                                    variable = "latq",
                                                    unit = 1),
                           basin_wyld = define_output(file = "basin_wb_aa",
                                                    variable = "wateryld",
                                                    unit = 1),
                           basin_perc = define_output(file = "basin_wb_aa",
                                                    variable = "perc",
                                                    unit = 1),
                           basin_gwflo = define_output(file = "basin_aqu_aa",
                                                    variable = "flo",
                                                    unit = 1),
                           basin_rchrg = define_output(file = "basin_aqu_aa",
                                                    variable = "rchrg",
                                                    unit = 1),
                           basin_revap = define_output(file = "basin_aqu_aa",
                                                    variable = "revap",
                                                    unit = 1)),
             parameter = par_sobol,
             #run_index = c(2113, 2114),
             start_date = 20050101,
             end_date = 20181231,
             start_date_print = 20100101,
             n_thread = 45,
             # output_interval = 'y',
             save_file = 'sim_sobol',
             return_output = F,
             keep_folder = F)


###########


library(SWATrunR)
library(tidyverse)

sims <- read_rds("F:/sim_sobol_19000_exp.rds")




tibble(run = colnames(sims$simulation$basin_gwflo)) %>% 
  mutate(run_num = as.numeric(str_remove(run, "run_"))) %>% 
  mutate(okk = run_num == lag(run_num)+1) %>% view








parameters <- sims$parameter$values %>% 
  mutate(run = 1:19000)


simulations <- sims$simulation


channels_sel <- grep("channel", names(simulations), value = TRUE)

channels_list <- simulations[channels_sel]



#### Observed flow: Creating a table with the data of the gauging stations used for the SA ####

obs_flow <- read_delim("D:/Trabajo/Tajo/datos_gestion_CHTajo/afliq.csv", delim = ";") %>% 
  mutate(date = dmy(fecha), obsflow_m3s = caudal) %>% 
  filter(indroea %in% c(3231, 3001, 3193, 3164, 3005, 3045), 
         year(date) %in% c(2010:2015)) %>% 
  select(indroea, date, obsflow_m3s)

# Navaluenga (IMP) (gauging_code 3231) --> Channel 559
# Peralejo de las Truchas (CRB) (gauging_code 3001)--> Channel 480
# Torote (DTH) (gauging_code 3193)--> Channel 541
# Villasequilla (DTL/CRB/DTH)(gauging_code 3164) --> Channels 1161 + 1141
# Trillo (CRB/DTH/DTL) (gauging_code 3005)--> Channel 111  

# Priego Escabas (CRB/DTH) (gauging_code 3045)--> Channel 564  WONT BE USED
# Basin (gauging code 3015 and 3024) --> Channel 834  WONT BE USED


obs_flow <- read_delim("D:/Trabajo/Tajo/datos_gestion_CHTajo/afliq.csv", delim = ";") %>% 
  mutate(date = dmy(fecha), obsflow_m3s = caudal) %>% 
  filter(indroea %in% c(3024, 3015), year(date) %in% 2010:2015) %>% 
  select(date, obsflow_m3s)  %>% mutate(indroea = 3024) %>% 
  rbind(obs_flow, .) %>% 
  mutate(basin = case_when(indroea == 3001 ~ "Peralejos",
                           indroea == 3005 ~ "Trillo",
                           indroea == 3045 ~ "Priego",
                           indroea == 3164 ~ "Villasequilla",
                           indroea == 3193 ~ "Torote",
                           indroea == 3231 ~ "Navaluenga",
                           indroea == 3024 ~ "Talavera"))



write_csv(obs_flow, "D:/Trabajo/Papers/Hard_calibration_Tagus/Tagus_Hardcal_Project/Data/csv_files/observed_flow_SA.csv")



#### Simulated flow ####

# Navaluenga (IMP) (gauging_code 3231) --> Channel 559
# Peralejo de las Truchas (CRB) (gauging_code 3001)--> Channel 480
# Torote (DTH) (gauging_code 3193)--> Channel 541
# Villasequilla (DTL/CRB/DTH)(gauging_code 3164) --> Channels 1161 + 1141
# Trillo (CRB/DTH/DTL) (gauging_code 3005)--> Channel 111

# Priego Escabas (CRB/DTH) (gauging_code 3045)--> Channel 564  WONT BE USED
# Basin (gauging code 3015 and 3024) --> Channel 834  WONT BE USED


# Selecting the streamflow data
simulations <- sims$simulation

channels_sel <- grep("channel", names(simulations), value = TRUE)

channels_list <- simulations[channels_sel]


# Editing the list to have a final list with the simulated data
names(channels_list) <- c("Trillo", "Peralejos", "Torote", "Navaluenga", "Priego", "Talavera", "Vill_1", "Vill_2")

Villasequilla = list(Villasequilla = tibble(date = channels_list$Vill_1$date, channels_list$Vill_1[-1] + channels_list$Vill_2[-1]))

channels_list <- channels_list[1:6]
channels_list[7] <- Villasequilla

names(channels_list) <- c("Trillo", "Peralejos", "Torote", "Navaluenga", "Priego", "Talavera", "Villasequilla")


#### Calculating the performance for each simulation

observed_flow <- read_csv("D:/Trabajo/Papers/Hard_calibration_Tagus/Tagus_Hardcal_Project/Data/csv_files/observed_flow_SA.csv")


rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2  # Function to calculate coefficient of determination


performance_calc <- function(obs_sim, na.rm = TRUE){
  
  basin <- unique(obs_sim$basin)
  nses <- obs_sim %>% summarise(across(starts_with("run"), ~NSE(., obs_sim$obsflow_m3s, na.rm = T))) %>% t(.) 
  r2s <- obs_sim %>% summarise(across(starts_with("run"), ~rsq_r2(., obs_sim$obsflow_m3s, na.rm = T))) %>%  t(.)
  pbiass <- obs_sim %>% summarise(across(starts_with("run"), ~pbias(., obs_sim$obsflow_m3s, na.rm = T)))  %>% t(.)
  rmses <- obs_sim %>% summarise(across(starts_with("run"), ~rmse(., obs_sim$obsflow_m3s, na.rm = T))) %>% t(.) 
  
  tibb_perfo <- tibble(Basin = basin, runs = row.names(nses), NSEs = nses[,1], R2s = r2s[,1], PBIAs = pbiass[,1], RMSEs = rmses[,1])
  
  return(tibb_perfo)
  
}


basins <- c("Trillo", "Peralejos", "Torote", "Navaluenga", "Priego", "Talavera", "Villasequilla")

performance_tib <- c()

for(basin_ev in 1:length(channels_list)){
  
  basin_ <-  basins[basin_ev] 
  
  observed <- filter(observed_flow, basin == basin_) 
  
  simulated <- channels_list[grep(basin_, names(channels_list), value = TRUE)] %>% .[[1]]
  
  
  obs_sim_dat <- observed %>% left_join(., simulated, "date")
  
  
  performance_tib <- rbind(performance_tib, performance_calc(obs_sim_dat))
  
}



#### Joining performance with parameters ####


pars_ev <- parameters 

performance_tib <- performance_tib %>% mutate(run = as.numeric(str_remove(runs, "run_")))



complete_tab <- performance_tib %>% left_join(., pars_ev, "run")


write_csv(complete_tab, "C:/Users/Equipo/Desktop/results_sims19000.csv")


#### SA Calc ####

sa_sims_results <- read_csv("C:/Users/Equipo/Desktop/results_sims19000.csv")


# Tell Sobol sensitivity values if not all simulated values are 0 or NA
tell_if <- function(x, y) {
  if(max(y) > 0 & all(!is.na(y))) {
    tell(x, y)$S$original
  } else {
    c(0)
  }
}

# Set vector with length n and all NA if vector x is not length n
set_na_if <- function(x, n) {
  if(length(x) != n) {
    rep(NA, n)
  } else {
    x
  }}


# Ej. SEnsitivity on NSE

nses <- sa_sims_results[,c("Basin", "runs", "NSEs")] %>% 
  pivot_wider(names_from = "Basin", values_from = "NSEs") %>% 
  select(., -"runs") %>% as.matrix(.)


s_nse <- map(c(1:7), ~tell_if(sobol_sample, nses[,.x]))

par_names <- c('surlag.bsn', 'chn.rte', 'esco.hru', 'cn2.hru', 'awc.sol', 'perco.hru', 'latq_co.hru', 'cn3_swf.hru', 'z.sol',
               'k.sol', 'bd.sol', 'lat_ttime', 'alpha.aqu', 'flo_min.aqu', 'revap_min.aqu', 'revap_co.aqu', 'sp_yld.aqu')


sens_tibs_NSE <- c()
  
  for(bas in 1:length(s_nse)){
    
    basin_ <- unique(sa_sims_results$Basin)[bas]
    
    param <- par_names
    
    sens <- s_nse[[bas]]
    
    ntib <- tibble(basin = basin_,
           parameter = param, 
           sensit = sens)
    
    sens_tibs_NSE <- sens_tibs_NSE %>% rbind(ntib)
  }


parnms <- sa_sims_results %>% 
  select(chn, surlag, starts_with("IMP")) %>% 
  colnames(.) %>% str_remove(., "IMP_")


sens_tibs_NSE %>% 
  mutate(parameter = factor(parameter, levels = unique(sens_tibs_NSE$parameter))) %>% 
  ggplot(., aes(y = sensit,
                x = parameter))+
  geom_point()+
  facet_wrap(facets = "basin", ncol = 3)




sens_tibs %>% 
  ggplot(., aes(x = basin, y = parameter))+
  geom_tile(aes(fill = sensit))



sens_tibs %>% pivot_wider(., names_from = basin, values_from = sensit) %>% view

sa_sims_results %>% 
  filter(Basin == "Navaluenga") %>% 
  select(Basin, NSEs,  paste0("IMP_", c("flomin", "zso", "kso", "awc"))) %>% 
  pivot_longer(., -c(Basin, NSEs)) %>% 
  ggplot(., aes(x = value, y = NSEs, color = NSEs))+
  geom_point()+
  geom_smooth()+
  facet_wrap(facets = "name", scales = "free")+
  theme_bw()
  


sa_sims_results %>% 
  filter(Basin == "Navaluenga") %>% 
  select(Basin, PBIAs,  paste0("IMP_", c("zso", "kso", "awc", "latq"))) %>% 
  pivot_longer(., -c(Basin, PBIAs)) %>% 
  ggplot(., aes(x = value, y = PBIAs, color = PBIAs))+
  geom_point()+
  geom_smooth()+
  facet_wrap(facets = "name", scales = "free")+
  theme_bw()


#######



#### CALIBRATION ####

#### ROUND 1 ####

##### PARAMETERS SETS CREATION #####


######## Parameters for Round_1 ######## 

########  Obtaining geology for aquifers (previously assigned using zonal statistics) ########  

aquifers_shp <- read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/aquifers_r1.shp") 

ggplot()+geom_sf(data = aquifers_shp, aes(fill = region))


aquifers_data <- read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/aquifers_r1.shp") %>% st_drop_geometry()%>% select(Aq_id, region) %>% 
  mutate(region = factor(region, levels=c("IMP", "CRB", "DTH", "DTL")))


reg_aqus <- list()

for(i in 1:length(levels(aquifers_data$region))){
  
  reg_aqu <- aquifers_data %>% filter(., region == levels(aquifers_data$region)[i]) %>% pull(., Aq_id)
  reg_aqus[[i]] <- reg_aqu
  
}

names(reg_aqus) <- c("IMP_aq", "CRB_aq", "DTH_aq", "DTL_aq")

# Vectors to copy-paste in the parameters sets creation
IMP_aqus <- paste(reg_aqus$IMP_aq, collapse = ",")
CRB_aqus <- paste(reg_aqus$CRB_aq, collapse = ",")
DTH_aqus <- paste(reg_aqus$DTH_aq, collapse = ",")
DTL_aqus <- paste(reg_aqus$DTL_aq, collapse = ",")


########  Obtaining geology for HRUs (previously assigned using zonal statistics) ######## 


lsus_conf <-  read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/lsus_lithology_configuration_r1.shp") %>%
  st_drop_geometry(.) %>% arrange(., lsu_id)
# with the geological region for each LSU
lsus_def <-  read_table("Data/GIS/model/ls_unit.def", skip = 2) # File with the hrus within each LSU    

lsus_id_reg <-  select(lsus_conf, lsu_id, region, Area) %>% mutate(id = lsu_id) %>% .[,c(4,2:3)]

hrus_lsus <- select(lsus_def, id, elements, X6) # Elements and X6 columns are the HRUs that each LSU contain (from element to X6)


lsus_hrus_def <- left_join(hrus_lsus, lsus_id_reg, "id") %>% .[,c(1,4,2,3)] %>% 
  mutate(hrus = paste(as.character(hrus_lsus$elements), as.character(hrus_lsus$X6), sep = ":") %>% str_remove(., "-") %>% str_remove(., ":NA")) %>% 
  .[,c(1:2,5)]


#For creating a tibble with the parameterization, a simplification of the hru lists should be done, as the tibble function has a length limit
# For this purpose, the next loop group the hrus of the contiguous lsus


lsus_hrus_def$region <- factor(lsus_hrus_def$region, levels = c("IMP", "CRB", "DTH", "DTL")) #Factor with the different geological groups
hrus_reg <- list()

for(lev in 1:length(levels(lsus_hrus_def$region))){
  
  lsus_order <-  lsus_hrus_def %>% filter(region == levels(lsus_hrus_def$region)[lev]) %>% separate(., hrus, into = c("ini", "end"),sep = ":") %>% 
    mutate(ini = as.numeric(ini), end = as.numeric(end)) %>% arrange(., ini)   #preparing the hru ids for each LSU
  NAS <- is.na(lsus_order$end)     #Some of them only have 1 hru
  lsus_order[NAS,4] <- lsus_order[NAS,3]
  
  # First part : check contiguous lsus at the beggining and end of the list
  r <- 0 # number of contiguous lsus at the beginning
  q <- 0 # number of contiguous lsus at the end
  g <- 1 # compensation if q = 0 (look below) 
  
  for(i in 1:length(lsus_order$id)){
    if(i == 1){
      while(lsus_order$end[i+r]+1 == lsus_order$ini[i+1+r]){
        r <-  r+1}
    }
    if(i == length(lsus_order$id)){
      while(lsus_order$ini[i-q]-1 == lsus_order$end[i-1-q]){
        q <- q+1 
        g <- 0}
    }
    else{}
  }
  # First and last simplificated hrus
  nni <- paste(lsus_order$ini[1], lsus_order$end[1+r], sep = ":")
  nnend <- paste(lsus_order$ini[length(lsus_order$id)-q], lsus_order$end[length(lsus_order$id)], sep = ":")
  # Second part: for the rest of the list of lsus-hrus, excluding the first and last items (with r and q)
  n <- 0
  nns <- c()
  is <- c()
  for(i in (2+r):(length(lsus_order$id)-(1*g+q))){ # If q = 0, g = 1, avoiding an error in next line when i = length(lsus_order$id)
    if(lsus_order$ini[i+1] == (lsus_order$end[i]+1)){
      n <- n+1
      i <- i+1
    }
    else{
      nn <- paste(lsus_order$ini[i-(n)], lsus_order$end[i], sep = ":")
      n <- 0 
      nns <- c(nns, nn)
    }
  }
  
  hrus_reg[[lev]] <- c(nni, nns, nnend)
}
names(hrus_reg) <- levels(lsus_hrus_def$region)


#In the hrus_reg list, a list for each region contains the different hrus grouped


hrus_characters <- list()
for(n in 1:length(hrus_reg)){
  combs <- c()
  for(i in 1:length(hrus_reg[[n]])){
    comb <- paste(hrus_reg[[n]][i])
    combs <- paste(combs, comb, sep = ",")
  }
  hrus_characters[[n]] <- combs
}
names(hrus_characters) <- levels(lsus_hrus_def$region)


# The list "hrus_characters" contains for each geological region all the hrus that are located within it. Easily, 
#its content can be copy-paste into the tibble function to create the different parameters sets

######## Creating the parameter sets ######## 

hc_par_bound_zonal_1 <- tibble(
  
  'surlag.bsn | change = absval' = c(0.05, 24), 
  'chn.rte | change = absval' = c(0, 0.3),
  
  'IMP_esc::esco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.25 , 0.999),    # IMP_esc::esco.hru | change = absval             
  'IMP_epc::epco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.001 , 0.999),   # IMP_epc::epco.hru | change = absval  
  'IMP_cnn::cn2.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-29.999  ,  10),  # IMP_cnn::cn2.hru | change = pctchg     
  'IMP_awc::awc.sol | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-10 , 50),        # IMP_awc::awc.sol | change = pctchg    
  'IMP_per::perco.hru | change = absval | unit =        c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.35 , 0.8),      # IMP_per::perco.hru | change = absval   
  'IMP_latq::latq_co.hru | change = abschg | unit =     c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.3, 0.3),       # IMP_latq::latq_co.hru | change = abschg  
  'IMP_cn3::cn3_swf.hru | change = abschg | unit =      c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.3, 0.3),       # IMP_cn3::cn3_swf.hru | change = abschg        
  'IMP_zso::z.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-20 , 40),        # IMP_zso::z.sol | change = pctchg 
  'IMP_kso::k.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-79.999 , 150),   # IMP_kso::k.sol | change = pctchg 
  'IMP_bd::bd.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-25 , 5),         # IMP_bd::bd.sol | change = pctchg 
  'IMP_ovn::ovn.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-20 , 20),        # IMP_ovn::ovn.hru | change = pctchg
  'IMP_lattime::lat_ttime.hru | change = absval| unit = c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.5, 80),         # IMP_lattime::lat_ttime.hru | change = absval
  
  'IMP_alpha::alpha.aqu | change = absval = | unit =      c(1,2,3,5,7,9,11,24,33,37,42,45,47,48,57,60,61,63,68,69,107,108,109,110,113,114,117,118,119,122)' = c(0.001, 0.05),   # IMP_alpha::alpha.aqu | change = absval
  'IMP_flomin::flo_min.aqu | change = absval | unit =     c(1,2,3,5,7,9,11,24,33,37,42,45,47,48,57,60,61,63,68,69,107,108,109,110,113,114,117,118,119,122)' = c(0, 20),         # IMP_flomin::flo_min.aqu | change = absval 
  'IMP_revapmin::revap_min.aqu | change = absval | unit = c(1,2,3,5,7,9,11,24,33,37,42,45,47,48,57,60,61,63,68,69,107,108,109,110,113,114,117,118,119,122)' = c(0, 20),         # IMP_revapmin::revap_min.aqu | change = absval 
  'IMP_revapco::revap_co.aqu | change = absval | unit =   c(1,2,3,5,7,9,11,24,33,37,42,45,47,48,57,60,61,63,68,69,107,108,109,110,113,114,117,118,119,122)' = c(0.02, 0.2),     # IMP_revapco::revap_co.aqu | change = absval 
  'IMP_spyld::sp_yld.aqu | change = absval =| unit =      c(1,2,3,5,7,9,11,24,33,37,42,45,47,48,57,60,61,63,68,69,107,108,109,110,113,114,117,118,119,122)' = c(0.00001, 0.05), # IMP_spyld::sp_yld.aqu | change = absval
  
  
  'CRB_esc::esco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.001 , 0.70),        # CRB_esc::esco.hru | change = absval           
  'CRB_epc::epco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.001 , 0.999),       # CRB_epc::epco.hru | change = absval   
  'CRB_cnn::cn2.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20  ,  10),          # CRB_cnn::cn2.hru | change = pctchg           
  'CRB_awc::awc.sol | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-60 , 10),            # CRB_awc::awc.sol | change = pctchg       
  'CRB_per::perco.hru | change = absval | unit =        c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.85 , 0.98),         # CRB_per::perco.hru | change = absval
  'CRB_latq::latq_co.hru | change = abschg | unit =     c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.3, 0.3),           # CRB_latq::latq_co.hru | change = abschg    
  'CRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.3, 0.3),           # CRB_cn3::cn3_swf.hru | change = abschg         
  'CRB_zso::z.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-49.999 , 10),        # CRB_zso::z.sol | change = pctchg       
  'CRB_kso::k.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-79.999 , 199.999),   # CRB_kso::k.sol | change = pctchg        
  'CRB_bd::bd.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20 , 5),             # CRB_bd::bd.sol | change = pctchg      
  'CRB_ovn::ovn.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20, 20),             # CRB_ovn::ovn.hru | change = pctchg
  'CRB_lattime::lat_ttime.hru | change = absval| unit = c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.5, 80),             # CRB_lattime::lat_ttime.hru | change = absval
  
  'CRB_alpha::alpha.aqu | change = absval = | unit =      c(6,8,10,17,19,23,25,27,29,30,32,35,36,38,40,41,43,50,51,54,56,62,79,104,120)' = c(0.001, 0.03), # CRB_alpha::alpha.aqu | change = absval
  'CRB_flomin::flo_min.aqu | change = absval | unit =     c(6,8,10,17,19,23,25,27,29,30,32,35,36,38,40,41,43,50,51,54,56,62,79,104,120)' = c(0, 20),       # CRB_flomin::flo_min.aqu | change = absval 
  'CRB_revapmin::revap_min.aqu | change = absval | unit = c(6,8,10,17,19,23,25,27,29,30,32,35,36,38,40,41,43,50,51,54,56,62,79,104,120)' = c(0, 20),       # CRB_revapmin::revap_min.aqu | change = absval 
  'CRB_revapco::revap_co.aqu | change = absval | unit =   c(6,8,10,17,19,23,25,27,29,30,32,35,36,38,40,41,43,50,51,54,56,62,79,104,120)' = c(0.02, 0.2),   # CRB_revapco::revap_co.aqu | change = absval 
  'CRB_spyld::sp_yld.aqu | change = absval =| unit =      c(6,8,10,17,19,23,25,27,29,30,32,35,36,38,40,41,43,50,51,54,56,62,79,104,120)' = c(0.01, 0.35),  # CRB_spyld::sp_yld.aqu | change = absval
  
  
  'DTH_esc::esco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.25 , 0.999),      # DTH_esc::esco.hru | change = absval                         
  'DTH_epc::epco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.001 , 0.999),     # DTH_epc::epco.hru | change = absval     
  'DTH_cnn::cn2.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-29.999  ,  -5),    # DTH_cnn::cn2.hru | change = pctchg             
  'DTH_awc::awc.sol | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(10 , 50),           # DTH_awc::awc.sol | change = pctchg         
  'DTH_per::perco.hru | change = absval | unit =        c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.75 , 0.95),       # DTH_per::perco.hru | change = absval  
  'DTH_latq::latq_co.hru | change = abschg | unit =     c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.3, 0.3),         # DTH_latq::latq_co.hru | change = abschg      
  'DTH_cn3::cn3_swf.hru | change = abschg | unit =      c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.3, 0.3),         # DTH_cn3::cn3_swf.hru | change = abschg           
  'DTH_zso::z.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0 , 49.999),        # DTH_zso::z.sol | change = pctchg         
  'DTH_kso::k.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-79.999 , 100),     # DTH_kso::k.sol | change = pctchg          
  'DTH_bd::bd.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-29.999 , -5),      # DTH_bd::bd.sol | change = pctchg        
  'DTH_ovn::ovn.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-20, 20),           # DTH_ovn::ovn.hru | change = pctchg
  'DTH_lattime::lat_ttime.hru | change = absval| unit = c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.5, 80),           # DTH_lattime::lat_ttime.hru | change = absval
  
  'DTH_alpha::alpha.aqu | change = absval = | unit =      c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.001, 0.04),  # DTH_alpha::alpha.aqu | change = absval
  'DTH_flomin::flo_min.aqu | change = absval | unit =     c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0, 20),        # DTH_flomin::flo_min.aqu | change = absval 
  'DTH_revapmin::revap_min.aqu | change = absval | unit = c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0, 20),        # DTH_revapmin::revap_min.aqu | change = absval 
  'DTH_revapco::revap_co.aqu | change = absval | unit =   c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.02, 0.2),    # DTH_revapco::revap_co.aqu | change = absval 
  'DTH_spyld::sp_yld.aqu | change = absval =| unit =      c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.1, 0.35),    # DTH_spyld::sp_yld.aqu | change = absval

  'DTL_esc::esco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.6 , 0.999),      # DTL_esc::esco.hru | change = absval       
  'DTL_epc::epco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.001 , 0.999),    # DTL_epc::epco.hru | change = absval  
  'DTL_cnn::cn2.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999  ,  -10),  # DTL_cnn::cn2.hru | change = pctchg       
  'DTL_awc::awc.sol | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(20 , 59.999),      # DTL_awc::awc.sol | change = pctchg    
  'DTL_per::perco.hru | change = absval | unit =        c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.4 , 0.7),        # DTL_per::perco.hru | change = absval
  'DTL_latq::latq_co.hru | change = abschg | unit =     c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_latq::latq_co.hru | change = abschg    
  'DTL_cn3::cn3_swf.hru | change = abschg | unit =      c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_cn3::cn3_swf.hru | change = abschg        
  'DTL_zso::z.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(12.5 , 49.999),    # DTL_zso::z.sol | change = pctchg 
  'DTL_kso::k.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-79.999 , 50),     # DTL_kso::k.sol | change = pctchg 
  'DTL_bd::bd.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999 , -10),    # DTL_bd::bd.sol | change = pctchg 
  'DTL_ovn::ovn.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-20, 20),          # DTH_ovn::ovn.hru | change = pctchg
  'DTL_lattime::lat_ttime.hru | change = absval| unit = c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.5, 80),          # DTH_lattime::lat_ttime.hru | change = absval

  'DTL_alpha::alpha.aqu | change = absval = | unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.001, 0.04),   # DTL_alpha::alpha.aqu | change = absval
  'DTL_flomin::flo_min.aqu | change = absval | unit =     c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0, 20),         # DTL_flomin::flo_min.aqu | change = absval 
  'DTL_revapmin::revap_min.aqu | change = absval | unit = c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0, 20),         # DTL_revapmin::revap_min.aqu | change = absval 
  'DTL_revapco::revap_co.aqu | change = absval | unit =   c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.02, 0.2),     # DTL_revapco::revap_co.aqu | change = absval 
  'DTL_spyld::sp_yld.aqu | change = absval =| unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.00001, 0.3))  # DTL_spyld::sp_yld.aqu | change = absval


# Proving that all HRUs and Aquifers are being parameterized

IMP_hrus <- c(53:67,97:229,432:466,493:537,600:606,626:676,697:716,757:770,1277:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2339,2347:2352,2361:2384,3299:3459,5420:5443,5900:5950,5963:5976,5991:6086,7311:7366,7375:7449,7458:7530,8425:8494,8507:8533,8537:8557,9233:9368,9687:9817,10017:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12446,13061:13125,13154:13188,15748:15772,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19239:19254,19574:19588,19593:19638,19794:19853,19876:19918,19975:20043,20073:20191,20344:20666,20850:21100,21168:21202,21313:21322,21338:21353,21390:21441,21462:21479,21925:21955,21989:22001,22006:22044,22069:22089)
CRB_hrus <- c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1217:1276,1429:1445,1653:1714,1745:1749,1905:2007,2042:2058,2413:2442,2553:2623,2662:2691,2716:2900,2917:2936,2970:2999,3019:3054,3077:3078,3217:3263,3880:3934,3977:4080,4164:4256,4402:4433,4538:4634,4662:4747,4773:4786,4793:4832,5795:5845,6164:6238,6441:6453,6460:6504,6531:6566,6584:6647,6680:6706,6733:6779,6846:6895,6916:6976,6998:7008,7035:7039,7133:7136,7190:7310,7854:7862,8118:8192,8248:8258,8273:8424,8683:8713,8730:8777,9058:9232,9369:9461,9469:9488,9493:9504,9509:9539,9556:9603,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10873:10899,10992:11026,11305:11337,11697:11721,11819:11846,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,17437:17454,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)
DTH_hrus <- c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)
DTL_hrus <- c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647) 

length(IMP_hrus)+length(CRB_hrus)+length(DTH_hrus)+length(DTL_hrus) # 22089 ok
  
IMP_aqus <- c(1,2,3,5,7,9,11,24,33,37,42,45,47,48,57,60,61,63,68,69,107,108,109,110,113,114,117,118,119,122)
CRB_aqus <- c(6,8,10,17,19,23,25,27,29,30,32,35,36,38,40,41,43,50,51,54,56,62,79,104,120)
DTH_aqus <- c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)
DTL_aqus <- c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)

length(IMP_aqus)+length(CRB_aqus)+length(DTH_aqus)+length(DTL_aqus) # 126 ok


 # Number of Simulations
    n_sample <- 1000
    #Numer of parameters
    n_par <- ncol(hc_par_bound_zonal_1)
    
    #Random sampling with Latin Hypercube
    par_zonal_tag <- randomLHS(n = n_sample, k = n_par) %>% # Perform sampling
      as_tibble(., .name_repair = 'minimal') %>% # Convert to a tibble
      set_names(names(hc_par_bound_zonal_1)) %>% # Assign the parameter names with purrr
      map2_df(., hc_par_bound_zonal_1, ~ (.x * (.y[2] - .y[1]) + .y[1]))

######## Run simulations ######## 

 sim_tagus_hcr1 <-  run_swatplus(project_path = tagus_path,
                                 output = list(
                                   ls_pcp   = define_output(file = 'lsunit_wb_yr', 
                                                            variable = 'precip', 
                                                            unit = 1:1450),
                                   # ls_et    = define_output(file = 'lsunit_wb_yr', 
                                   #                          variable = 'et', 
                                   #                          unit = used_lsus),
                                   ls_surq_gen   = define_output(file = 'lsunit_wb_yr',   # SURQ_CHA + SURQ_RES = SURQ_GEN - SURQ_LS
                                                                 variable = 'surq_gen', 
                                                                 unit = 1:1450),
                                   ls_surq_ls   = define_output(file = 'lsunit_wb_yr', 
                                                                variable = 'surq_ls', 
                                                                unit  = 1:1450),
                                   # ls_latqgen   = define_output(file = 'lsunit_wb_yr',  # LATQGEN - LATQLS = LATQ_CHA + LATQ_GEN
                                   #                              variable = 'latq', 
                                   #                              unit = used_lsus),
                                   # ls_latqls   = define_output(file = 'lsunit_wb_yr', 
                                   #                             variable = 'latq_ls', 
                                   #                             unit = used_lsus),
                                   ls_latqcha   = define_output(file = 'lsunit_wb_yr',  # LATQ = LATQCHA + LATQRES
                                                                variable = 'latq_cha', 
                                                                unit = 1:1450),
                                   ls_latqres   = define_output(file = 'lsunit_wb_yr', 
                                                                variable = 'latq_res', 
                                                                unit = 1:1450),
                                   #  ls_perc   = define_output(file = 'lsunit_wb_yr', 
                                   #                            variable = 'perc', 
                                   #                            unit = used_lsus),
                                   #  basin_pcp = define_output(file = 'basin_wb_yr',
                                   #                            variable = "precip",
                                   #                            unit = 1), 
                                   #  basin_et = define_output(file = 'basin_wb_yr',
                                   #                           variable = 'et',
                                   #                           unit = 1), 
                                   #  basin_perco = define_output(file = 'basin_wb_yr',
                                   #                              variable = 'perc',
                                   #                              unit = 1),
                                   #  basin_surqgen = define_output(file = 'basin_wb_yr',
                                   #                                variable = 'surq_gen',
                                   #                                unit = 1),
                                   #  basin_surqls = define_output(file = 'basin_wb_yr',
                                   #                               variable = 'surq_ls',
                                   #                               unit = 1),
                                   #  basin_surqcha = define_output(file = 'basin_wb_yr',
                                   #                                variable = 'surq_cha',
                                   #                                unit = 1),
                                   #  basin_surqres = define_output(file = 'basin_wb_yr',
                                   #                                variable = 'surq_res',
                                   #                                unit = 1),
                                   #  basin_latqcha = define_output(file = 'basin_wb_yr',
                                   #                                variable = 'latq_cha',
                                   #                                unit = 1),
                                   #  basin_latqqres = define_output(file = 'basin_wb_yr',
                                   #                                 variable = 'latq_res',
                                   #                                 unit = 1),
                                   #  basin_perco = define_output(file = 'basin_wb_yr',
                                   #                              variable = 'perc',
                                   #                              unit = 1),
                                   #  basin_gwflo = define_output(file = 'basin_aqu_yr',
                                   #                              variable = 'flo',
                                   #                              unit = 1),
                                   aqu_gwflocha = define_output(file = 'aquifer_yr',
                                                                variable = 'flo_cha',
                                                                unit = 1:126),
                                   aqu_gwres = define_output(file = 'aquifer_yr',
                                                             variable = 'flo_res',
                                                             unit =    1:126),
                                   #  aqu_gwtot = define_output(file = 'aquifer_yr',
                                   #                            variable = 'flo',
                                   #                            unit = used_quifers),
                                   # aqu_stor = define_output(file = 'aquifer_yr',
                                   #                          variable = 'stor',
                                   #                          unit = 1:126),
                                   # aqu_rchrg = define_output(file = 'aquifer_yr',
                                   #                           variable = 'rchrg',
                                   #                           unit = 1:126),
                                   # res_in = define_output(file = 'reservoir_yr',          #For round 3
                                   #                        variable = 'flo_in',      #For round 3        
                                   #                        unit = 1:31),             #For round 3 
                                   # res_stor = define_output(file = 'reservoir_yr',        #For round 3      
                                   #                          variable = 'flo_stor',    #For round 3          
                                   #                          unit = 1:31),             #For round 3 
                                   # res_out = define_output(file = 'reservoir_yr',         #For round 3     
                                   #                         variable = 'flo_out',     #For round 3         
                                   #                         unit = 1:31),             #For round 3             
                                   flow_cha = define_output(file = "channel_sd_day", 
                                                            variable = "flo_out",
                                                            unit = c(561, 750, 11, 1218, 567, 825, 564, 630, 532, 962,
                                                                     990, 541, 950, 149, 376, 535, 537, 1141, 1161, 14,
                                                                     947, 184, 525, 573, 208, 111, 949, 581, 452))),#, 444,
                                 #155, 185, 504, 161, 459, 929, 133, 176, 483, 911, 882 ,1076))), #For round 3
                                 parameter = par_zonal_tag,
                                 start_date = 20050101,
                                 end_date = 20141231,
                                 start_date_print = 20100101,
                                 # save_file = "hc_round_2_revap",
                                 n_thread = 60)

##### ROUND 1 RESULTS EXTRACTION #####

    
######## File with observed data creation ######## 
 
 # Basins data file
 basins_file <- read.csv("Data/csv_files/basins_file.csv")
 gauging_codes <- basins_file$indroea
 
 # Streamflow data file
 
 gauging_data_all <- read.csv("D:/Trabajo/Tajo/datos_gestion_CHTajo/afliq_1920.csv", sep = ";") %>% # File with records for all gauging stations of the basin
   mutate(fecha = dmy(fecha)) %>%
   # filter(year(fecha) %in% 2010:2019) %>%
   filter(indroea %in% gauging_codes)
 
 #Checking the available gauging data:
 gauging_data_all %>% 
   group_by(indroea) %>% summarise(min(fecha), max(fecha)) %>%
   left_join(., basins_file ,by =  "indroea") %>% arrange(., Basin_ID) %>% .[,c(4, 5,6, 1, 2, 3)] %>% gt(.)
 
 ini <-  as.Date("2000/01/01")
 end <-  as.Date("2019/12/31")
 ndys <- seq(ini, end, 1) %>% length(.)
 
 # Checking in there are gaps in the s
 complete_data <- gauging_data_all %>% filter(fecha %in% c(ymd(ini):ymd(end))) %>% 
   mutate(gauging_code = indroea) %>% group_by(indroea) %>% summarise( ndays = n()) %>%
   mutate('Complete data (2010-2019)' =  case_when(ndays == ndys ~ "Yes",
                                                   ndays < ndys ~ paste("No, ", ndys-ndays, " days missing", sep = ""))) %>%
   left_join(., basins_file, "indroea") %>%
   .[,c(4, 5, 6, 3)] %>% arrange(., Basin_ID)
 
 gt(complete_data)
 
 
 # Saving observed data for the gauging stations
 
 subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
 
 obs_list <- list()
 
 for(i in 1:length(gauging_codes)){
   
   obs_list[[i]] <- gauging_data_all %>% 
     filter(., indroea == gauging_codes[i]) %>% select(., fecha, indroea, caudal)
   
 }
 
 names(obs_list) <- subbasins_names
 
 write_rds(obs_list, "Data/Simulations/list_observed_data.rds")


######## File with simulated data creation: Streamflow ######## 
 
 basins_file <- read.csv("Data/csv_files/basins_file.csv")
 subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")

 # Some of the gauging stations collect the water from more than one channel and therefore the streamflow has been recalculated 
 # Others only drains part of the subbasin, and has been therefore corrected by the drainaged fraction
 
 chanels <- read_rds("Data/Simulations/Round_1/Round_1_HC_Tagus.rds") # Simulated data

 
 navaluenga <- tibble(date = chanels$simulation$flow_cha_561$date, chanels$simulation$flow_cha_561[,-1]+ chanels$simulation$flow_cha_750[,-1] )
 
 matallana <-  chanels$simulation$flow_cha_11
 
 villarejo <-  chanels$simulation$flow_cha_1218
 
 peralejo <- tibble(date = chanels$simulation$flow_cha_567$date, chanels$simulation$flow_cha_567[,-1]+ chanels$simulation$flow_cha_825[,-1] )
 
 priego_escabas <- tibble(date = chanels$simulation$flow_cha_564$date, chanels$simulation$flow_cha_564[,-1] * (1/1.05)) #  The gauging station it is not at the end of the channel
 
 santa_maria_val <- chanels$simulation$flow_cha_630
 
 javalera <- tibble(date = chanels$simulation$flow_cha_532$date, chanels$simulation$flow_cha_532[,-1]*(1/1.4)) # The gauging station it is not at the end of the channel
 
 huete <- tibble(date = chanels$simulation$flow_cha_962$date, chanels$simulation$flow_cha_962[,-1]+ chanels$simulation$flow_cha_990[,-1] )
 
 torote <- chanels$simulation$flow_cha_541
 
 puebla_nueva <-  chanels$simulation$flow_cha_950
 
 ventosa <- tibble(date = chanels$simulation$flow_cha_149$date, chanels$simulation$flow_cha_149[,-1]+ chanels$simulation$flow_cha_376[,-1] )
 
 peraleja <- tibble(date = chanels$simulation$flow_cha_535$date, chanels$simulation$flow_cha_535[,-1]+ chanels$simulation$flow_cha_537[,-1] )
 
 villasequilla <- tibble(date = chanels$simulation$flow_cha_1141$date, chanels$simulation$flow_cha_1141[,-1]+ chanels$simulation$flow_cha_1161[,-1] ) # The gauging station it is not at the end of the channel
 
 valverde <- tibble(date = chanels$simulation$flow_cha_14$date, chanels$simulation$flow_cha_14[,-1]*(1/1.05))
 
 malpica <- chanels$simulation$flow_cha_947
 
 taravillas <- tibble(date = chanels$simulation$flow_cha_184$date, chanels$simulation$flow_cha_184[,-1]*(1/1.13))
 
 romanones <- chanels$simulation$flow_cha_525
 
 priego_trabraque <- tibble(date = chanels$simulation$flow_cha_573$date, chanels$simulation$flow_cha_573[,-1]*(1/1.05) ) # The gauging station it is not at the end of the channel
 
 aragosa <- tibble(date = chanels$simulation$flow_cha_208$date, chanels$simulation$flow_cha_208[,-1]*(1/1.24) ) # The gauging station it is not at the end of the channel
 
 trillo <- chanels$simulation$flow_cha_111
 
 valdecaba <- chanels$simulation$flow_cha_949
 
 villamantilla <- chanels$simulation$flow_cha_581
 
 
 # A list is created and saved for each subbasin
 sim_cha_list <- list(navaluenga, matallana, villarejo, peralejo, priego_escabas, santa_maria_val, javalera, huete, torote, puebla_nueva,
                      ventosa, peraleja, villasequilla, valverde, malpica, taravillas, romanones,  priego_trabraque, aragosa, trillo,  valdecaba, villamantilla) 
 
 names(sim_cha_list) <- subbasins_names
 
 write_rds(sim_cha_list, "Data/Simulations/Round_1/round_1_simulated_list.rds")
 
 
######## File with simulated data creation: Hydrological variables annual values ######### 
 
 sim_tagus_hcr1_wb <- read_rds("Data/Simulations/Round_1/round_1_HC_Tagus.rds") # Simulated data
 basins_file <- read.csv("Data/csv_files/basins_file.csv")   
 lsus_subbasins_shp <- read_sf("Data/GIS/hardcal_shapes/studied_lsus/lsus_prop_final.shp") # LSUS per regions and per subbasins 
 studied_subb <- read_sf("Data/GIS/hardcal_shapes/subbasins/hardcal_natural_basins.shp") # Subbasins analysed

     ########  Run to extract variables ########  
# LSUS data extraction and aggregation
 
lsus_studied <- lsus_subbasins_shp %>%  st_drop_geometry()
 
 
# List extraction: Precipitation

lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_pcp_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
lsus_pcp <- sim_tagus_hcr1_wb$simulation[grepl("ls_pcp", names(sim_tagus_hcr1_wb$simulation))] #%>% .[lsus_data$namelist]

# Calculating the average pcp for each subbasin in mm
     
     basin_pcps <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       lsus_area_sum <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_area_m")] %>% 
         sum(.)
       
       lsus_basin <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_id_rea", "area_frac")]
       
       basin_lsus_pcp <- lsus_pcp[lsus_basin$lsu_id_rea]
       
       av_pcps <- c(1:1000)
       
       for(f in 1:length(basin_lsus_pcp)){
         
         av_pcp <- basin_lsus_pcp[[f]][,-1] %>% apply(., 2, mean) %>% data.frame(pcp_mm = .) %>% mutate(pcp_mm = pcp_mm* lsus_basin$area_frac[f]) # Calculate the mm generated in each lsu taking into account the entire basin area
         
         av_pcps <- av_pcps %>% cbind(av_pcp) 
         
       }
       
       av_lsu_pcps <- tibble(av_pcp_mm = av_pcps[,-1] ) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_pcp <- av_lsu_pcps %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_pcp <- basin_pcp %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_pcp_mm)
       
       basin_pcps[[i]] = basin_pcp # List with the pcp for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_pcp = paste("pcp_basin", Basin_ID, sep = ""))
     names(basin_pcps) <- namms$names_pcp
     
      
     
     # List extraction: Surface runoff (SURQ = SURQ_GEN - SURQ_LS)
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_gen_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqgen <- sim_tagus_hcr1_wb$simulation[grepl("ls_surq_gen", names(sim_tagus_hcr1_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_ls_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqls <- sim_tagus_hcr1_wb$simulation[grepl("ls_surq_ls", names(sim_tagus_hcr1_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     # Calculating the total surq in mm for each lsu considering their relative area regarding the subbasin
     lsu_surqtot <- list()
     for(i in 1:length(lsus_surqgen)){
     
       lsu_surqtot[[i]] <- ((lsus_surqgen[[i]][,-1] - lsus_surqls[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_surqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_surq_basin", lsus_data$Basin_ID, sep = "")
     
     # Calculating the total surq for each subbasin in mm
     
     basin_surqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_surqtot))
       
       selected_lsus <- lsu_surqtot[bas_select]
       
       av_surqs <- c(1:1000)
       
       for(f in 1:length(selected_lsus)){
         
         av_surq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_surqs <- av_surqs %>% cbind(av_surq) 
         
       }
       
       av_surqs <- tibble(av_surq_mm = av_surqs[,-1]) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_surq <- av_surqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_surq <- basin_surq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_surq_mm)
       
       
       basin_surqs[[i]] = basin_surq # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_surqtot = paste("total_surq_basin", Basin_ID, sep = ""))
     names(basin_surqs) <- namms$names_surqtot
     
     
     # List extraction: Lateral flow (LATQ = LATQ_CHA + LATQ_RES)
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqcha_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqcha <- sim_tagus_hcr1_wb$simulation[grepl("ls_latqcha", names(sim_tagus_hcr1_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqres_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqres <- sim_tagus_hcr1_wb$simulation[grepl("ls_latqres", names(sim_tagus_hcr1_wb$simulation))] %>% .[lsus_data$namelist]
     
     # Calculating the total latq in mm for each lsu considering their relative area regarding the subbasin
     lsu_latqtot <- list()
     for(i in 1:length(lsus_latqcha)){
     
       lsu_latqtot[[i]] <- ((lsus_latqcha[[i]][,-1] + lsus_latqres[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_latqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_latq_basin", lsus_data$Basin_ID, sep = "")
     
     
     # Calculating the total latqq for each subbasin in mm
     
     basin_latqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
     
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_latqtot))
       
       selected_lsus <- lsu_latqtot[bas_select]
       
       av_latqs <- c(1:1000)
       
       for(f in 1:length(selected_lsus)){
         
         av_latq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_latqs <- av_latqs %>% cbind(av_latq) 
         
       }
       
       av_latqs <- tibble(av_latq_mm = av_latqs[,-1]) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_latq <- av_latqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_latq <- basin_latq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_latq_mm)
       
       
       basin_latqs[[i]] = basin_latq # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_latqtot = paste("total_latq_basin", Basin_ID, sep = ""))
     names(basin_latqs) <- namms$names_latqtot
 
 
     
     # Aquifers data: Calculated using flo + flo_res. For some aquifers, the relative drainage area to the gauginG stations has been used 
     # (aquif_data$fact_corr, previously calculated with QGIS)
     
     aquifers_studied <- read_sf("Data/GIS/hardcal_shapes/studied_aquifers/aquifers_selected.shp") %>% arrange(., Basin_ID)
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     
     
     # List extraction: GWFLO_CHA and GWFLO_RES
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwflocha_", Aq_id , sep = ""))
     aquifers_flocha <- sim_tagus_hcr1_wb$simulation[grepl("aqu_gwflocha", names(sim_tagus_hcr1_wb$simulation))] %>% .[aquif_data$namelist]
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwres_", Aq_id , sep = ""))
     aquifers_flores <- sim_tagus_hcr1_wb$simulation[grepl("aqu_gwres", names(sim_tagus_hcr1_wb$simulation))] %>% .[aquif_data$namelist]
     
     
     # Calculating the total gwflo in liters for each aquifer
     aquif_flo_tot_litres <- list()
     for(i in 1:length(aquifers_flocha)){

       aquif_flo_tot_litres[[i]] <- ((aquifers_flocha[[i]][,-1] + aquifers_flores[[i]][,-1]) * ( aquif_data$Area_km[i] * 1000000 * aquif_data$fact_corr[i])) %>% tibble(.)
       
     }
     
     names(aquif_flo_tot_litres) <- paste("aqu_", aquif_data$Aq_id, "totalflo_lit_basin", aquif_data$Basin_ID, sep = "")
     
     
     # Calculating the total flo for each subbasin in mm
     
     basin_gwflos <- list()
     for(i in 1:length(unique(aquif_data$Basin_ID))){
       
       aquifers_area_sum <- aquif_data %>% 
         filter(Basin_ID == unique(aquif_data$Basin_ID)[i]) %>% .[,c("fact_corr","Area_km")] %>% 
         mutate(real_area = fact_corr * Area_km) %>% .[, "real_area" ] %>% 
         sum(.)*1e6
       
       bas_select <- paste("basin",unique(aquif_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(aquif_flo_tot_litres))
       
       selected_aqus <- aquif_flo_tot_litres[bas_select]
       
       av_gwflos <- c(1:1000)
       
       for(f in 1:length(selected_aqus)){
         
         av_gwflo <- selected_aqus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_gwflos <- av_gwflos %>% cbind(av_gwflo) 
         
       }
       
       av_gwflos <- tibble(av_gwflo_mm = av_gwflos[,-1] / aquifers_area_sum) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_gwflo <- av_gwflos %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_gwflo <- basin_gwflo %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_gwflo_mm)

       basin_gwflos[[i]] = basin_gwflo # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_gwtot = paste("total_gwflo_basin", Basin_ID, sep = ""))
     names(basin_gwflos) <- namms$names_gwtot
     
     # Creating a table with all the extracted data
     subb_tables <- list()
     for(i in 1:length(basin_gwflos)){
       pcp <- tibble(basin_pcps[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "pcp")
       latq <- tibble(basin_latqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "latq")
       surq <- tibble(basin_surqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "surq")
       gwflo <- tibble(basin_gwflos[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "gwflo")
       
       subb_table <- pcp %>%  left_join(., latq, "name")%>%  left_join(., surq, "name")%>%  left_join(., gwflo, "name") %>% 
         mutate(water_yield = latq + surq + gwflo) %>% 
         mutate(runoff_coeff = water_yield / pcp,
                gw_cont = gwflo / water_yield) %>% 
         mutate(Basin = basins_file$Basin[i],
                Basin_ID = basins_file$Basin_ID[i], 
                region = basins_file$region[i]) %>% 
         rename(run = name) %>% 
         .[,c("Basin_ID", "Basin", "region", "run",  "pcp",  "water_yield", "latq", "surq", "gwflo",  "runoff_coeff", "gw_cont" )]
       
       subb_tables[[i]] <- subb_table
       
     }
     
     namms <- paste("tab", basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     names(subb_tables) <- namms
     
    # write_rds(subb_tables, "Data/Results/R1/HC_Round1_basinswb.rds")

     table_all <- c()
     for(m in 1:length(subb_tables)){
       
       tab <- subb_tables[[m]]
       table_all <- table_all %>% rbind(., tab)
     }

     ######## Run to save variables ######## 
write_csv(table_all, "Data/Results/R1/HC_Round1_basinswb.csv", quote = "none")
     
######## Calculate streamflow simulation performance ######## 

     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     observed_streamflow <- read_rds("Data/Simulations/list_observed_data.rds")
     simulated_streamflow  <- read_rds("Data/Simulations/Round_1/round_1_simulated_list.rds") # Simulated data (previously saved)
     
     evaluated_period <- c(2010:2014)
     number_simulations <- c(1000)
     
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2  # Function to calculate R2
     
     
     streamflow_metrics <- c()
     streamflo_metrics_list <- list()
     
     for(i in 1:length(observed_streamflow)){
       
       obs <- observed_streamflow[[i]] %>% mutate(fecha = ymd(fecha)) %>% 
         filter(year(fecha) %in% evaluated_period)
       
       sim <- simulated_streamflow[[i]]%>% mutate(date = ymd(date)) %>% 
         filter(., date %in% ymd(min(obs$fecha)):ymd(max(obs$fecha))) # Days without observed data does not compute
       
       nses <-  sim %>% select(-date) %>% 
         map_dbl(., ~NSE( .x, obs$caudal))
       r2s <-  sim %>% select(-date) %>% 
         map_dbl(., ~rsq_r2( .x, obs$caudal))
       pbias <-  sim %>% select(-date) %>% 
         map_dbl(., ~pbias( .x, obs$caudal))
       rmses <-  sim %>% select(-date) %>% 
         map_dbl(., ~rmse( .x, obs$caudal))
       
       tab <-  tibble(Subbasin_ID = basins_file$Basin_ID[i], Subbasin = basins_file$Basin[i] , 
                      region = basins_file$region[i], nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = c(1:number_simulations))
       
       streamflow_metrics <- streamflow_metrics %>% rbind(., tab)
       streamflo_metrics_list[[i]] <- tab
     }
     
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     names(streamflo_metrics_list) <- subbasins_names
     
     
     write.csv(streamflow_metrics, "Data/Results/R1/HC_Round1_streamflow_metrics_allchanel.csv", row.names = F, quote = F)
     # write_rds(streamflo_metrics_list, "Data/Results/R1/HC_Round1_streamflow_metrics_allchanel.rds")
     
######## Combine results and created plots for parameters constrain  ########  
 
# Merge results in one table
     
     streamflow_metrics <- read_csv("Data/Results/R1/HC_Round1_streamflow_metrics_allchanel.csv")
     
     waterbalances <- read_csv("Data/Results/R1/HC_Round1_basinswb.csv") %>% 
     select(Basin_ID, run, runoff_coeff, gw_cont) %>%  mutate(run = as.numeric(str_remove(run, "run_")))
     
     table_constrain <-  streamflow_metrics %>% left_join(., waterbalances, c("Subbasin_ID" = "Basin_ID", "run")) %>% 
       .[,c( "Subbasin_ID",    "Subbasin", "region", "run", "nse","r2","pbias", "rmse", "runoff_coeff", "gw_cont")]

# Extract parameter sets    
     
     parameters_data <- read_rds("Data/Simulations/Round_1/round_1_HC_Tagus.rds") %>% .[1]
     par_values <- parameters_data$parameter$values
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     subbasins <- basins_file$Basin
     region <- basins_file$region
     
     
######## Plots creation ######## 
     
# Plot 1: Distribution of variables for each subbasin
     
     viol_plots <- list()
     
     for(i in 1:length(basins_file$Basin_ID)){
       
       tabb_metrics <- table_constrain %>% filter(Subbasin_ID == basins_file$Basin_ID[i]) %>% 
         rename("NSE" = "nse", "R" = "r2", "PBIAS" = "pbias", RMSE = "rmse", "Runoff coefficient" = "runoff_coeff" , "Goundwater contribution" = "gw_cont")
       
       viol_plot <- tabb_metrics %>% 
         pivot_longer(., -c("Subbasin_ID",  "Subbasin", "region", "run")) %>% 
         mutate(name = factor(name, levels = c("NSE", "R", "PBIAS", "RMSE", "Runoff coefficient", "Goundwater contribution"))) %>% 
         ggplot(aes(x = name, y = value, fill = name))+ geom_violin()+
         facet_wrap(facets = "name", scales = "free")+
         theme_bw()+
         theme( strip.text = element_blank(), legend.position = "nuop", text = element_text(size = 18, face = "bold"), axis.title = element_blank())+
         ggtitle(paste("Basin ",basins_file$Basin_ID[i], ": ", basins_file$Basin[i],  " (",basins_file$region[i] , ")", sep = ""))
       
       viol_plots[[i]] <- viol_plot
       
       ggsave(plot = viol_plot, 
              filename = paste("Data/Figures/R1/results_basins/", basins_file$Basin_ID[i], "_", str_replace_all(basins_file$Basin, " ", "_")[i], ".png", sep = ""),
              device = "png", 
              dpi = 300, width = 16, height = 12) 
     }
 
# Plots 2: Effect of each parameter in the affected subbasins (subbasins with part o a certain lithologhy)
     
     IMP_subbasins <- c(1, 2, 3, 10, 14 ,15, 21, 22) # Subbasins with at least one LSU with impervious geology
     CRB_subbasins <- c(4, 5, 6, 11, 13, 14, 16:20) # Subbasins with at least one LSU with carbonate geology
     DTH_subbasins <- c(5, 7:13,15, 17:20, 22 ) # Subbasins with at least one LSU with high permeability detrital geology
     DTL_subbasins <- c(8, 11:14, 17:20 ) # Subbasins with at least one LSU with low permeability detrital geology
     MET_subbasins <- c(2, 14, 15)
     

     ## IMP Region
     
     subbasins_values <- list(
       "1" = "Navaluenga (IMP)",
       "2" = "Matallana (IMP)",
       "3" = "Villarejo de Montalban (IMP)",
       "10" = "La Pueblanueva (MIX)",
       "14" = "Valverde de los Arroyos (MIX)",
       "15" = "Malpica (MIX)",
       "21" = "Valdecaba (IMP)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_IMP <- par_values %>% select(starts_with("IMP"))#, c(surlag, chn))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(IMP_subbasins, levels = c(1, 2, 3, 10, 14 ,15, 21, 22)))
     
     metrics <- colnames(table_constrain) # 5:10

     for(i in 1:length(parameters_IMP)){
       parameter_name <- colnames(parameters_IMP[i])[1]
       parameter <- tibble(parameter = parameters_IMP[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(1, 2, 3, 10, 14 ,15, 21, 22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 4)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R1/IMP_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## CRB Region
     
     subbasins_values <- list(
       "4"     =   "Peralejo de las Truchas (CRB)",
       "5"     =            "Priego Escabas (CRB)",
       "6"     =       "Santa Maria del Val (CRB)",
       "11"     =                   "Ventosa (DTL)", 
       "13"     =    "Villasequilla de Yepes (DTL)", 
       "14"     =   "Valverde de los Arroyos (MIX)", 
       "16"     =                "Taravillas (MIX)", 
       "17"     =                 "Romanones (MIX)", 
       "18"     =          "Priego Trabraque (MIX)", 
       "19"     =                   "Aragosa (MIX)", 
       "20"     =                    "Trillo (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     
     
     parameters_CRB <- par_values %>% select(starts_with("CRB") )#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(CRB_subbasins, levels = c(4, 5, 6, 11, 13, 14, 16:20)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     
     for(i in 1:length(parameters_CRB)){
       parameter_name <- colnames(parameters_CRB[i])[1]
       parameter <- tibble(parameter = parameters_CRB[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(4, 5, 6, 11, 13, 14, 16:20)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 4)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R1/CRB_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## DTH Region
     
     subbasins_values <- list(
       "5" = "Priego Escabas (CRB)",
       "7" = "Jabalera (DTH)",
       "8" = "Huete (DTH)",
       "9" = "Torote (DTH)",
       "10" = "La Pueblanueva (DTH)",
       "11" = "Ventosa (DTL)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "15" = "Malpica (MIX)",
       "17" = "Romanones (MIX)",
       "18" = "Priego Trabraque (MIX)",
       "19" = "Aragosa (MIX)",
       "20" = "Trillo (MIX)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_DTH <- par_values %>% select(starts_with("DTH"))#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(DTH_subbasins, levels = c(5, 7:13,15, 17:20, 22 )))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_DTH)){
       parameter_name <- colnames(parameters_DTH[i])[1]
       parameter <- tibble(parameter = parameters_DTH[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(5, 7:13,15, 17:20, 22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 5)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R1/DTH_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## DTL Region
     
     subbasins_values <- list(
       "8" = "Huete (DTH)",
       "11" = "Ventosa (DTL)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "14" = "Valverde de los Arroyos (MIX)",
       "17" = "Romanones (MIX)",
       "18" = "Priego Trabraque (MIX)",
       "19" = "Aragosa (MIX)",
       "20" = "Trillo (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_DTL <- par_values %>% select(starts_with("DTL"))#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(DTL_subbasins, levels = c(8, 11:14, 17:20 )))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_DTL)){
       parameter_name <- colnames(parameters_DTL[i])[1]
       parameter <- tibble(parameter = parameters_DTL[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(8, 11:14, 17:20)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 5)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R1/DTL_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width =  16 , height =  12, dpi = 300)
       }
     }

     # Parameters common to all subbasins
     
     subbasins_values <- list(
       "1" = "Navaluenga (IMP)",
       "2" = "Matallana (MET)",
       "3" = "Villarejo de Montalban (IMP)",
       "4"     =   "Peralejo de las Truchas (CRB)",
       "5" = "Priego Escabas (CRB)",
       "6"     =       "Santa Maria del Val (CRB)",
       "7" = "Jabalera (DTH)",
       "8" = "Huete (DTH)",
       "9" = "Torote (DTH)",
       "10" = "La Pueblanueva (DTH)",
       "11" = "Ventosa (DTL)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "14" = "Valverde de los Arroyos (MIX)",
       "15" = "Malpica (MIX)",
       "16" = "Taravillas (MIX)", 
       "17" = "Romanones (MIX)",
       "18" = "Priego Trabraque (MIX)",
       "19" = "Aragosa (MIX)",
       "20" = "Trillo (MIX)",
       "21" = "Valdecaba (IMP)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_com <- par_values %>% select(surlag, chn)
     metric_values <- table_constrain 
     
     metrics <- colnames(table_constrain) # 5:10

     for(i in 1:length(parameters_com)){
       parameter_name <- colnames(parameters_com[i])[1]
       parameter <- tibble(parameter = parameters_com[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(1:22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 6)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R1/Common_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width =  16 , height =  12, dpi = 300)
       }
     }

     # These plots are analyzed in power point to constrain the parameters and continue with the following Round
     
##### Extract results and generate plots for reservoirs inflow #####     

# Reservoirs data
     
reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv")
     
     
# Observed data 
     
 obs_inflow <- read_csv("Data/Reservoirs/Simulation/CHT_obs_inflow_reservoirs.csv")
     
# Simulated data
     
simulation <- read_rds("Data/Simulations/Round_1/Round_1_HC_Tagus.rds")

# Parameters



# Creating and exporting lists with observed-simulated data 

evaluated_period <- c(2010:2019)


res_studied <- reservoirs_data %>% mutate(namelist = paste("res_in_", Lake_id , sep = "")) %>% arrange(., Lake_id)
res_sim_inflow <- simulation$simulation[grepl("res_in_", names(simulation$simulation))] 


res_inflows <- list()

for(i in 1: length(res_sim_inflow)){
  
  res_inflow <- res_sim_inflow[[i]]
  
  res_inflow <- tibble(res_inflow[,1], reservoir = paste("lake_", i, sep = ""), res_inflow[,-1]/86400)
  
  res_inflows[[i]] <- res_inflow
  
}
names(res_inflows) <- str_replace(unique(names(res_sim_inflow)), "res_in_", "lake_")

write_rds(res_inflows, "Data/Reservoirs/Simulation/Round_1_reservoirs_sim.rds")


observed_inflow <- list()
lakes <- c()
for(i in 1:length(unique(obs_inflow$Lake_id))){
  
  res_obs_inflow <- obs_inflow %>% 
    filter(Lake_id == unique(obs_inflow$Lake_id)[i],
           year(date) %in% evaluated_period) %>% 
    select(name, Lake_id, date, obsflow_m3s) %>% 
    mutate(Lake_id = paste("lake_", Lake_id, sep = "")) %>% 
    mutate(obsflow_m3s = as.numeric(obsflow_m3s))
  observed_inflow[[i]] <- res_obs_inflow
  lakes <- c(lakes, unique(res_obs_inflow$Lake_id ))
}

names(observed_inflow) <- lakes

write_rds(observed_inflow, "Data/Reservoirs/Simulation/observed_reservoir_inflow.rds")


# Loading saved data

observed_inflow <- read_rds("Data/Reservoirs/Simulation/observed_reservoir_inflow.rds") 
res_inflows <- read_rds("Data/Reservoirs/Simulation/Round_1_reservoirs_sim.rds")


# Calculating performance for reservoirs inflow

# Function to calculate coeficient of determination
rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2 


evaluated_period <- c(2010:2014)
number_simulations <- 1000


streamflow_metrics_res <- c()

for(i in 1:length(observed_inflow)){
  
  lake <- names(observed_inflow[i])
  
  obs <- observed_inflow[[lake]] %>% 
    filter(year(date) %in% evaluated_period) %>% 
    group_by(year(date), month(date)) %>% 
    summarise(obsflow_m3s = mean(obsflow_m3s)) %>% 
    mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
    ungroup(.) %>% 
    select(., date, obsflow_m3s)
  
  sim <- res_inflows[[lake]] %>% 
    filter(., date %in% ymd(min(obs$date)):ymd(max(obs$date))) %>% # Days without observed data does not compute
    group_by(year(date), month(date)) %>% 
    summarise(across(starts_with("run"), mean)) %>% 
    mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
    ungroup(.) %>% 
    select(., -c(`year(date)`, `month(date)`))
  
  nses <-  sim %>% select(-c(date)) %>% 
    map_dbl(., ~NSE( .x, obs$obsflow_m3s))
  r2s <-  sim %>% select(-c(, date)) %>%
    map_dbl(., ~rsq_r2( .x, obs$obsflow_m3s))
  pbias <-  sim %>% select(-c(date)) %>%
    map_dbl(., ~pbias( .x, obs$obsflow_m3s))
  rmses <-  sim %>% select(-c(date)) %>%
    map_dbl(., ~rmse( .x, obs$obsflow_m3s))
  
  tab <-  tibble(reservoir = unique(observed_inflow[[i]][[2]]), 
                 nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = c(1:number_simulations))
  
  streamflow_metrics_res <- streamflow_metrics_res %>% rbind(., tab)
  
}


write_csv(streamflow_metrics_res, "Data/Reservoirs/Results/reservoir_metrics_R1.csv")


reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv") %>%
  mutate(Lake_id = paste("lake_", Lake_id, sep = "")) %>% 
  mutate(region = region_r1)


# Metrics plots

streamflow_metrics_res <- read_csv("Data/Reservoirs/Results/reservoir_metrics_R1.csv")

for(i in 1:length(unique(streamflow_metrics_res$reservoir))){

  resdat <- streamflow_metrics_res %>% 
    filter(reservoir == unique(streamflow_metrics_res$reservoir)[i]) %>% 
    pivot_longer(., -c(reservoir, run), names_to = "metric", values_to = "metric_value") %>% 
    left_join(., reservoirs_data[, c("Nombre", "Lake_id", "region")], c("reservoir" = "Lake_id")) 
  
  perf_plot <- resdat %>% 
    ggplot(., aes(x = reservoir, y = metric_value, fill = metric))+
    geom_violin()+
    facet_wrap(facets = "metric", scales = "free")+
    ggtitle(paste(unique(resdat$reservoir), ", ", unique(resdat$Nombre), " (", unique(resdat$region), ")" ,sep = ""))+
    theme_bw()+
    theme(axis.title = element_blank(), legend.position = "nuop")

  ggsave(plot = perf_plot,filename =  paste("Data/Reservoirs/Figures/R1/Reservoir_perf/", 
  unique(resdat$reservoir), ".png", sep = ""),device = "png", dpi = 600, height = 10, width = 10)
  
}

# Parameters effect plot --> compared with the parameters effects on subbasins


int_reservoirs <- c(2, 6, 10, 11, 12, 15, 16, 17, 19, 21, 26, 28, 31) # Focus on reservoirs with no upstream reservoirs and in PBIAS


streamflow_metrics_res <- streamflow_metrics_res %>% 
  filter(reservoir %in% paste("lake_", int_reservoirs, sep = "")) %>% 
  select(-c(nse, r2 ,  rmse))

for(i in 1:length(unique(streamflow_metrics_res$reservoir))){
  
  resdat <- streamflow_metrics_res %>% 
    filter(reservoir == unique(streamflow_metrics_res$reservoir)[i]) %>% 
    pivot_longer(., -c(reservoir, run), names_to = "metric", values_to = "metric_value") %>% 
    left_join(., reservoirs_data[, c("Nombre", "Lake_id", "region")], c("reservoir" = "Lake_id")) 

  regions <- unique(resdat$region) %>% str_split(., ", ") %>% unlist(.)
  
  pars <- parameters %>% select(starts_with(regions)) %>% mutate(run = seq(1, length(unique(resdat$run)), 1))
  
  for_res_pars_plot <- resdat %>% 
    left_join(., pars, "run") %>% 
    pivot_longer(., -c(reservoir, run, metric, metric_value, Nombre, region), names_to = "parameter", values_to = "parameter_value") 
  
        for(metric in 1:length(unique(for_res_pars_plot$metric))){
          
          meetric <- unique(for_res_pars_plot$metric)[metric]
          
          tab_pars_res <-  for_res_pars_plot %>% filter(metric == meetric)
          
          pars_eff_plot <- ggplot(tab_pars_res, aes(x = parameter_value, y = metric_value))+
            geom_point()+
            geom_smooth()+
            facet_wrap(facets = "parameter", scales = "free_x")+
            ggtitle(paste(meetric, unique(resdat$reservoir), ", ", unique(resdat$Nombre), " (", unique(resdat$region), ")" ,sep = ""))+
            theme_bw()+
            theme(axis.title = element_blank())
          
          ggsave(plot = pars_eff_plot,filename =  paste("Data/Reservoirs/Figures/R1/Reservoir_pars/", unique(resdat$reservoir), meetric, ".png", sep = ""),device = "png", dpi = 600, height = 10, width = 10)

        }
}

#### ROUND 2 ####
     
     ##### PARAMETERS SETS CREATION #####
     
     
     ######## Parameters for Round_2 ######## 
     
     ########  Obtaining geology for aquifers (previously assigned using zonal statistics) ########  
     
     aquifers_shp <- read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/aquifers_r2.shp") 
     
     ggplot()+geom_sf(data = aquifers_shp, aes(fill = region))
     
     
     aquifers_data <- read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/aquifers_r2.shp") %>% st_drop_geometry()%>% select(Aq_id, region) %>% 
       mutate(region = factor(region, levels=c("IMP", "MET", "CRB", "SCRB", "DTH", "DTL")))
     
     
     reg_aqus <- list()
     
     for(i in 1:length(levels(aquifers_data$region))){
       
       reg_aqu <- aquifers_data %>% filter(., region == levels(aquifers_data$region)[i]) %>% pull(., Aq_id)
       reg_aqus[[i]] <- reg_aqu
       
     }
     
     names(reg_aqus) <- c("IMP_aq", "MET_aq", "CRB_aq", "SCRB_aq", "DTH_aq", "DTL_aq")
     
     # Vectors to copy-paste in the parameters sets creation
     IMP_aqus <- paste(reg_aqus$IMP_aq, collapse = ",")
     MET_aqus <- paste(reg_aqus$MET_aq, collapse = ",")
     CRB_aqus <- paste(reg_aqus$CRB_aq, collapse = ",")
     SCRB_aqus <- paste(reg_aqus$SCRB_aq, collapse = ",")
     DTH_aqus <- paste(reg_aqus$DTH_aq, collapse = ",")
     DTL_aqus <- paste(reg_aqus$DTL_aq, collapse = ",")
     
  
     ########  Obtaining geology for HRUs (previously assigned using zonal statistics) ######## 

     lsus_conf <-  read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/lsus_lithology_configuration_r2.shp") %>%
       st_drop_geometry(.) %>% arrange(., lsu_id)
     # with the geological region for each LSU
     lsus_def <-  read_table("Data/GIS/model/ls_unit.def", skip = 2) # File with the hrus within each LSU    
     
     lsus_id_reg <-  select(lsus_conf, lsu_id, region, Area) %>% mutate(id = lsu_id) %>% .[,c(4,2:3)]
     
     hrus_lsus <- select(lsus_def, id, elements, X6) # Elements and X6 columns are the HRUs that each LSU contain (from element to X6)
     
     
     lsus_hrus_def <- left_join(hrus_lsus, lsus_id_reg, "id") %>% .[,c(1,4,2,3)] %>% 
       mutate(hrus = paste(as.character(hrus_lsus$elements), as.character(hrus_lsus$X6), sep = ":") %>% str_remove(., "-") %>% str_remove(., ":NA")) %>% 
       .[,c(1:2,5)]
     
     
     #For creating a tibble with the parameterization, a simplification of the hru lists should be done, as the tibble function has a length limit
     # For this purpose, the next loop group the hrus of the contiguous lsus
     
     
     lsus_hrus_def$region <- factor(lsus_hrus_def$region, levels = c("IMP", "MET", "CRB", "SCRB", "DTH", "DTL")) #Factor with the different geological groups
     hrus_reg <- list()
     
     for(lev in 1:length(levels(lsus_hrus_def$region))){
       
       lsus_order <-  lsus_hrus_def %>% filter(region == levels(lsus_hrus_def$region)[lev]) %>% separate(., hrus, into = c("ini", "end"),sep = ":") %>% 
         mutate(ini = as.numeric(ini), end = as.numeric(end)) %>% arrange(., ini)   #preparing the hru ids for each LSU
       NAS <- is.na(lsus_order$end)     #Some of them only have 1 hru
       lsus_order[NAS,4] <- lsus_order[NAS,3]
       
       # First part : check contiguous lsus at the beggining and end of the list
       r <- 0 # number of contiguous lsus at the beginning
       q <- 0 # number of contiguous lsus at the end
       g <- 1 # compensation if q = 0 (look below) 
       
       for(i in 1:length(lsus_order$id)){
         if(i == 1){
           while(lsus_order$end[i+r]+1 == lsus_order$ini[i+1+r]){
             r <-  r+1}
         }
         if(i == length(lsus_order$id)){
           while(lsus_order$ini[i-q]-1 == lsus_order$end[i-1-q]){
             q <- q+1 
             g <- 0}
         }
         else{}
       }
       # First and last simplificated hrus
       nni <- paste(lsus_order$ini[1], lsus_order$end[1+r], sep = ":")
       nnend <- paste(lsus_order$ini[length(lsus_order$id)-q], lsus_order$end[length(lsus_order$id)], sep = ":")
       # Second part: for the rest of the list of lsus-hrus, excluding the first and last items (with r and q)
       n <- 0
       nns <- c()
       is <- c()
       for(i in (2+r):(length(lsus_order$id)-(1*g+q))){ # If q = 0, g = 1, avoiding an error in next line when i = length(lsus_order$id)
         if(lsus_order$ini[i+1] == (lsus_order$end[i]+1)){
           n <- n+1
           i <- i+1
         }
         else{
           nn <- paste(lsus_order$ini[i-(n)], lsus_order$end[i], sep = ":")
           n <- 0 
           nns <- c(nns, nn)
         }
       }
       
       hrus_reg[[lev]] <- c(nni, nns, nnend)
     }
     names(hrus_reg) <- levels(lsus_hrus_def$region)
     
     
     #In the hrus_reg list, a list for each region contains the different hrus grouped
     
     
     hrus_characters <- list()
     for(n in 1:length(hrus_reg)){
       combs <- c()
       for(i in 1:length(hrus_reg[[n]])){
         comb <- paste(hrus_reg[[n]][i])
         combs <- paste(combs, comb, sep = ",")
       }
       hrus_characters[[n]] <- combs
     }
     names(hrus_characters) <- levels(lsus_hrus_def$region)
     
     
     # The list "hrus_characters" contains for each geological region all the hrus that are located within it. Easily, 
     #its content can be copy-paste into the tibble function to create the different parameters sets

     ######## Creating the parameter sets ######## 

     
     hc_par_bound_zonal_2 <- tibble(
       
       'surlag.bsn | change = absval' = c(0.05, 5), 
       'chn.rte | change = absval' = c(0, 0.1),
       
       'IMP_esc::esco.hru | change = absval | unit =         c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.5 , 0.999),     # IMP_esc::esco.hru | change = absval             
       'IMP_epc::epco.hru | change = absval | unit =         c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.001 , 0.999),   # IMP_epc::epco.hru | change = absval  
       'IMP_cnn::cn2.hru | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-29.999  ,  0),   # IMP_cnn::cn2.hru | change = pctchg     
       'IMP_awc::awc.sol | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(10 , 50),         # IMP_awc::awc.sol | change = pctchg    
       'IMP_per::perco.hru | change = absval | unit =        c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.5 , 0.8),       # IMP_per::perco.hru | change = absval   
       'IMP_latq::latq_co.hru | change = abschg | unit =     c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.3, 0.1),       # IMP_latq::latq_co.hru | change = abschg  
       'IMP_cn3::cn3_swf.hru | change = abschg | unit =      c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.3, 0.3),       # IMP_cn3::cn3_swf.hru | change = abschg        
       'IMP_zso::z.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(  0 , 40),        # IMP_zso::z.sol | change = pctchg 
       'IMP_kso::k.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-79.999 , 75 ),   # IMP_kso::k.sol | change = pctchg 
       'IMP_bd::bd.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-25 , -5),        # IMP_bd::bd.sol | change = pctchg 
       'IMP_ovn::ovn.hru | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-20 , 20),        # IMP_ovn::ovn.hru | change = pctchg
       'IMP_lattime::lat_ttime.hru | change = absval| unit = c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639,19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.5, 20),         # IMP_lattime::lat_ttime.hru | change = absval
       
       'IMP_alpha::alpha.aqu | change = absval = | unit =      c(24,33,37,42,45,47,48,57,60,61,63,68,69,107,109,110,114,117,118)' = c(0.001, 0.05),   # IMP_alpha::alpha.aqu | change = absval
       'IMP_flomin::flo_min.aqu | change = absval | unit =     c(24,33,37,42,45,47,48,57,60,61,63,68,69,107,109,110,114,117,118)' = c(10, 20),        # IMP_flomin::flo_min.aqu | change = absval 
       'IMP_revapmin::revap_min.aqu | change = absval | unit = c(24,33,37,42,45,47,48,57,60,61,63,68,69,107,109,110,114,117,118)' = c(0, 10),         # IMP_revapmin::revap_min.aqu | change = absval 
       'IMP_revapco::revap_co.aqu | change = absval | unit =   c(24,33,37,42,45,47,48,57,60,61,63,68,69,107,109,110,114,117,118)' = c(0.02, 0.2),     # IMP_revapco::revap_co.aqu | change = absval 
       'IMP_spyld::sp_yld.aqu | change = absval =| unit =      c(24,33,37,42,45,47,48,57,60,61,63,68,69,107,109,110,114,117,118)' = c(0.00001, 0.05), # IMP_spyld::sp_yld.aqu | change = absval
       
       
       'MET_esc::esco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(0 , 0.999),       # MET_esc::esco.hru | change = absval             
       'MET_epc::epco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(0.001 , 0.999),   # MET_epc::epco.hru | change = absval  
       'MET_cnn::cn2.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(-20  ,  20),      # MET_cnn::cn2.hru | change = pctchg     
       'MET_awc::awc.sol | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(-20 , 20),        # MET_awc::awc.sol | change = pctchg    
       'MET_per::perco.hru | change = absval | unit =        c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(0.5 , 0.8),       # MET_per::perco.hru | change = absval   
       'MET_latq::latq_co.hru | change = abschg | unit =     c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(-0.1, 0.3),       # MET_latq::latq_co.hru | change = abschg  
       'MET_cn3::cn3_swf.hru | change = abschg | unit =      c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(-0.3, 0.3),       # MET_cn3::cn3_swf.hru | change = abschg        
       'MET_zso::z.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(-40 , 20),        # MET_zso::z.sol | change = pctchg 
       'MET_kso::k.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(-50 , 150),       # MET_kso::k.sol | change = pctchg 
       'MET_bd::bd.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(-15 , 5),         # MET_bd::bd.sol | change = pctchg 
       'MET_ovn::ovn.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(-20 , 20),        # MET_ovn::ovn.hru | change = pctchg
       'MET_lattime::lat_ttime.hru | change = absval| unit = c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19239:19254,19794:19827,19876:19918,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185,21313:21322,21338:21353,21366:21479)' = c(0.5, 30),         # MET_lattime::lat_ttime.hru | change = absval
       
       'MET_alpha::alpha.aqu | change = absval = | unit =      c(1,2,3,5,7,9,11,108,113,119,122)' = c(0.001, 0.05),   # MET_alpha::alpha.aqu | change = absval
       'MET_flomin::flo_min.aqu | change = absval | unit =     c(1,2,3,5,7,9,11,108,113,119,122)' = c(10, 20),        # MET_flomin::flo_min.aqu | change = absval 
       'MET_revapmin::revap_min.aqu | change = absval | unit = c(1,2,3,5,7,9,11,108,113,119,122)' = c(0, 10),         # MET_revapmin::revap_min.aqu | change = absval 
       'MET_revapco::revap_co.aqu | change = absval | unit =   c(1,2,3,5,7,9,11,108,113,119,122)' = c(0.02, 0.2),     # MET_revapco::revap_co.aqu | change = absval 
       'MET_spyld::sp_yld.aqu | change = absval =| unit =      c(1,2,3,5,7,9,11,108,113,119,122)' = c(0.00001, 0.05), # MET_spyld::sp_yld.aqu | change = absval
       
       
       'CRB_esc::esco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.001 , 0.70),        # CRB_esc::esco.hru | change = absval           
       'CRB_epc::epco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.001 , 0.999),       # CRB_epc::epco.hru | change = absval   
       'CRB_cnn::cn2.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-20  ,   0),          # CRB_cnn::cn2.hru | change = pctchg           
       'CRB_awc::awc.sol | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-50 , 10),            # CRB_awc::awc.sol | change = pctchg       
       'CRB_per::perco.hru | change = absval | unit =        c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.90 , 0.99),         # CRB_per::perco.hru | change = absval
       'CRB_latq::latq_co.hru | change = abschg | unit =     c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-0.3, 0.1),           # CRB_latq::latq_co.hru | change = abschg    
       'CRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-0.2, 0.3),           # CRB_cn3::cn3_swf.hru | change = abschg         
       'CRB_zso::z.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-40 , 0),             # CRB_zso::z.sol | change = pctchg       
       'CRB_kso::k.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-79.999 , 199.999),   # CRB_kso::k.sol | change = pctchg        
       'CRB_bd::bd.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-20 , -5),            # CRB_bd::bd.sol | change = pctchg      
       'CRB_ovn::ovn.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-20, 20),             # CRB_ovn::ovn.hru | change = pctchg
       'CRB_lattime::lat_ttime.hru | change = absval| unit = c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.5, 50),             # CRB_lattime::lat_ttime.hru | change = absval
       
       'CRB_alpha::alpha.aqu | change = absval = | unit =      c(8,25,30,38,41,43,54,56,62,120)' = c(0.001, 0.03), # CRB_alpha::alpha.aqu | change = absval
       'CRB_flomin::flo_min.aqu | change = absval | unit =     c(8,25,30,38,41,43,54,56,62,120)' = c(10, 20),      # CRB_flomin::flo_min.aqu | change = absval 
       'CRB_revapmin::revap_min.aqu | change = absval | unit = c(8,25,30,38,41,43,54,56,62,120)' = c(0, 10),       # CRB_revapmin::revap_min.aqu | change = absval 
       'CRB_revapco::revap_co.aqu | change = absval | unit =   c(8,25,30,38,41,43,54,56,62,120)' = c(0.02, 0.2),   # CRB_revapco::revap_co.aqu | change = absval 
       'CRB_spyld::sp_yld.aqu | change = absval =| unit =      c(8,25,30,38,41,43,54,56,62,120)' = c(0.01, 0.35),  # CRB_spyld::sp_yld.aqu | change = absval
       
       
       'SCRB_esc::esco.hru | change = absval | unit =         c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.200 , 0.90),        # SCRB_esc::esco.hru | change = absval           
       'SCRB_epc::epco.hru | change = absval | unit =         c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.001 , 0.999),       # SCRB_epc::epco.hru | change = absval   
       'SCRB_cnn::cn2.hru | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20  ,   0),          # SCRB_cnn::cn2.hru | change = pctchg           
       'SCRB_awc::awc.sol | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-30 , 30),            # SCRB_awc::awc.sol | change = pctchg       
       'SCRB_per::perco.hru | change = absval | unit =        c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.88 , 0.98),         # SCRB_per::perco.hru | change = absval
       'SCRB_latq::latq_co.hru | change = abschg | unit =     c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.3, 0.3),           # SCRB_latq::latq_co.hru | change = abschg    
       'SCRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.2, 0.3),           # SCRB_cn3::cn3_swf.hru | change = abschg         
       'SCRB_zso::z.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-30 , 30),            # SCRB_zso::z.sol | change = pctchg       
       'SCRB_kso::k.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-79.999 , 199.999),   # SCRB_kso::k.sol | change = pctchg        
       'SCRB_bd::bd.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20 , 5),             # SCRB_bd::bd.sol | change = pctchg      
       'SCRB_ovn::ovn.hru | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20, 20),             # SCRB_ovn::ovn.hru | change = pctchg
       'SCRB_lattime::lat_ttime.hru | change = absval| unit = c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220,17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.5, 50),             # SCRB_lattime::lat_ttime.hru | change = absval
       
       'SCRB_alpha::alpha.aqu | change = absval = | unit =      c(6,10,17,19,23,27,29,32,35,36,40,50,51,79,104)' = c(0.001, 0.03), # SCRB_alpha::alpha.aqu | change = absval
       'SCRB_flomin::flo_min.aqu | change = absval | unit =     c(6,10,17,19,23,27,29,32,35,36,40,50,51,79,104)' = c(8, 20),       # SCRB_flomin::flo_min.aqu | change = absval 
       'SCRB_revapmin::revap_min.aqu | change = absval | unit = c(6,10,17,19,23,27,29,32,35,36,40,50,51,79,104)' = c(0, 10),       # SCRB_revapmin::revap_min.aqu | change = absval 
       'SCRB_revapco::revap_co.aqu | change = absval | unit =   c(6,10,17,19,23,27,29,32,35,36,40,50,51,79,104)' = c(0.02, 0.2),   # SCRB_revapco::revap_co.aqu | change = absval 
       'SCRB_spyld::sp_yld.aqu | change = absval =| unit =      c(6,10,17,19,23,27,29,32,35,36,40,50,51,79,104)' = c(0.01, 0.35),  # SCRB_spyld::sp_yld.aqu | change = absval
       
       'DTH_esc::esco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.40 , 0.999),      # DTH_esc::esco.hru | change = absval                         
       'DTH_epc::epco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.001 , 0.999),     # DTH_epc::epco.hru | change = absval     
       'DTH_cnn::cn2.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-29.999  ,  -10),   # DTH_cnn::cn2.hru | change = pctchg             
       'DTH_awc::awc.sol | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(20 , 50),           # DTH_awc::awc.sol | change = pctchg         
       'DTH_per::perco.hru | change = absval | unit =        c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.75 , 0.95),       # DTH_per::perco.hru | change = absval  
       'DTH_latq::latq_co.hru | change = abschg | unit =     c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.3, 0.2),         # DTH_latq::latq_co.hru | change = abschg      
       'DTH_cn3::cn3_swf.hru | change = abschg | unit =      c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.1, 0.3),         # DTH_cn3::cn3_swf.hru | change = abschg           
       'DTH_zso::z.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(10, 40),            # DTH_zso::z.sol | change = pctchg         
       'DTH_kso::k.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-79.999 , 25),      # DTH_kso::k.sol | change = pctchg          
       'DTH_bd::bd.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-29.999 , -10),     # DTH_bd::bd.sol | change = pctchg        
       'DTH_ovn::ovn.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-20, 20),           # DTH_ovn::ovn.hru | change = pctchg
       'DTH_lattime::lat_ttime.hru | change = absval| unit = c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21389,21442:21461,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.5, 30),           # DTH_lattime::lat_ttime.hru | change = absval
       
       'DTH_alpha::alpha.aqu | change = absval = | unit =      c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.001, 0.04),  # DTH_alpha::alpha.aqu | change = absval
       'DTH_flomin::flo_min.aqu | change = absval | unit =     c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(10, 20),        # DTH_flomin::flo_min.aqu | change = absval 
       'DTH_revapmin::revap_min.aqu | change = absval | unit = c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0, 12),        # DTH_revapmin::revap_min.aqu | change = absval 
       'DTH_revapco::revap_co.aqu | change = absval | unit =   c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.02, 0.2),    # DTH_revapco::revap_co.aqu | change = absval 
       'DTH_spyld::sp_yld.aqu | change = absval =| unit =      c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.1, 0.35),    # DTH_spyld::sp_yld.aqu | change = absval
       
       'DTL_esc::esco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.6 , 0.999),      # DTL_esc::esco.hru | change = absval       
       'DTL_epc::epco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.001 , 0.999),    # DTL_epc::epco.hru | change = absval  
       'DTL_cnn::cn2.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999  ,  -10),  # DTL_cnn::cn2.hru | change = pctchg       
       'DTL_awc::awc.sol | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(20 , 59.999),      # DTL_awc::awc.sol | change = pctchg    
       'DTL_per::perco.hru | change = absval | unit =        c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.4 , 0.7),        # DTL_per::perco.hru | change = absval
       'DTL_latq::latq_co.hru | change = abschg | unit =     c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_latq::latq_co.hru | change = abschg    
       'DTL_cn3::cn3_swf.hru | change = abschg | unit =      c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_cn3::cn3_swf.hru | change = abschg        
       'DTL_zso::z.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(30 , 49.999),      # DTL_zso::z.sol | change = pctchg 
       'DTL_kso::k.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-79.999 , 50),     # DTL_kso::k.sol | change = pctchg 
       'DTL_bd::bd.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999 , -10),    # DTL_bd::bd.sol | change = pctchg 
       'DTL_ovn::ovn.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-20, 20),          # DTH_ovn::ovn.hru | change = pctchg
       'DTL_lattime::lat_ttime.hru | change = absval| unit = c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6648:6679,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.5, 80),          # DTH_lattime::lat_ttime.hru | change = absval
       
       'DTL_alpha::alpha.aqu | change = absval = | unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.001, 0.04),   # DTL_alpha::alpha.aqu | change = absval
       'DTL_flomin::flo_min.aqu | change = absval | unit =     c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(5, 20),         # DTL_flomin::flo_min.aqu | change = absval 
       'DTL_revapmin::revap_min.aqu | change = absval | unit = c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0, 10),         # DTL_revapmin::revap_min.aqu | change = absval 
       'DTL_revapco::revap_co.aqu | change = absval | unit =   c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.02, 0.2),     # DTL_revapco::revap_co.aqu | change = absval 
       'DTL_spyld::sp_yld.aqu | change = absval =| unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.00001, 0.3))  # DTL_spyld::sp_yld.aqu | change = absval
     
    
     # Number of Simulations
     n_sample <- 1000
     #Numer of parameters
     n_par <- ncol(hc_par_bound_zonal_2)
     
     #Random sampling with Latin Hypercube
     par_zonal_tag <- randomLHS(n = n_sample, k = n_par) %>% # Perform sampling
       as_tibble(., .name_repair = 'minimal') %>% # Convert to a tibble
       set_names(names(hc_par_bound_zonal_2)) %>% # Assign the parameter names with purrr
       map2_df(., hc_par_bound_zonal_2, ~ (.x * (.y[2] - .y[1]) + .y[1]))
     
     
     ######## Run simulations ######## 
     
     sim_tagus_hcr2 <-  run_swatplus(project_path = tagus_path,
                                     output = list(
                                       ls_pcp   = define_output(file = 'lsunit_wb_yr', 
                                                                variable = 'precip', 
                                                                unit = 1:1450),
                                       # ls_et    = define_output(file = 'lsunit_wb_yr', 
                                       #                          variable = 'et', 
                                       #                          unit = used_lsus),
                                       ls_surq_gen   = define_output(file = 'lsunit_wb_yr',   # SURQ_CHA + SURQ_RES = SURQ_GEN - SURQ_LS
                                                                     variable = 'surq_gen', 
                                                                     unit = 1:1450),
                                       ls_surq_ls   = define_output(file = 'lsunit_wb_yr', 
                                                                    variable = 'surq_ls', 
                                                                    unit  = 1:1450),
                                       # ls_latqgen   = define_output(file = 'lsunit_wb_yr',  # LATQGEN - LATQLS = LATQ_CHA + LATQ_GEN
                                       #                              variable = 'latq', 
                                       #                              unit = used_lsus),
                                       # ls_latqls   = define_output(file = 'lsunit_wb_yr', 
                                       #                             variable = 'latq_ls', 
                                       #                             unit = used_lsus),
                                       ls_latqcha   = define_output(file = 'lsunit_wb_yr',  # LATQ = LATQCHA + LATQRES
                                                                    variable = 'latq_cha', 
                                                                    unit = 1:1450),
                                       ls_latqres   = define_output(file = 'lsunit_wb_yr', 
                                                                    variable = 'latq_res', 
                                                                    unit = 1:1450),
                                       #  ls_perc   = define_output(file = 'lsunit_wb_yr', 
                                       #                            variable = 'perc', 
                                       #                            unit = used_lsus),
                                       #  basin_pcp = define_output(file = 'basin_wb_yr',
                                       #                            variable = "precip",
                                       #                            unit = 1), 
                                       #  basin_et = define_output(file = 'basin_wb_yr',
                                       #                           variable = 'et',
                                       #                           unit = 1), 
                                       #  basin_perco = define_output(file = 'basin_wb_yr',
                                       #                              variable = 'perc',
                                       #                              unit = 1),
                                       #  basin_surqgen = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'surq_gen',
                                       #                                unit = 1),
                                       #  basin_surqls = define_output(file = 'basin_wb_yr',
                                       #                               variable = 'surq_ls',
                                       #                               unit = 1),
                                       #  basin_surqcha = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'surq_cha',
                                       #                                unit = 1),
                                       #  basin_surqres = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'surq_res',
                                       #                                unit = 1),
                                       #  basin_latqcha = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'latq_cha',
                                       #                                unit = 1),
                                       #  basin_latqqres = define_output(file = 'basin_wb_yr',
                                       #                                 variable = 'latq_res',
                                       #                                 unit = 1),
                                       #  basin_perco = define_output(file = 'basin_wb_yr',
                                       #                              variable = 'perc',
                                       #                              unit = 1),
                                       #  basin_gwflo = define_output(file = 'basin_aqu_yr',
                                       #                              variable = 'flo',
                                       #                              unit = 1),
                                       aqu_gwflocha = define_output(file = 'aquifer_yr',
                                                                    variable = 'flo_cha',
                                                                    unit = 1:126),
                                       aqu_gwres = define_output(file = 'aquifer_yr',
                                                                 variable = 'flo_res',
                                                                 unit =    1:126),
                                       #  aqu_gwtot = define_output(file = 'aquifer_yr',
                                       #                            variable = 'flo',
                                       #                            unit = used_quifers),
                                       # aqu_stor = define_output(file = 'aquifer_yr',
                                       #                          variable = 'stor',
                                       #                          unit = 1:126),
                                       # aqu_rchrg = define_output(file = 'aquifer_yr',
                                       #                           variable = 'rchrg',
                                       #                           unit = 1:126),
                                       # res_in = define_output(file = 'reservoir_yr',          #For round 3
                                       #                        variable = 'flo_in',      #For round 3        
                                       #                        unit = 1:31),             #For round 3 
                                       # res_stor = define_output(file = 'reservoir_yr',        #For round 3      
                                       #                          variable = 'flo_stor',    #For round 3          
                                       #                          unit = 1:31),             #For round 3 
                                       # res_out = define_output(file = 'reservoir_yr',         #For round 3     
                                       #                         variable = 'flo_out',     #For round 3         
                                       #                         unit = 1:31),             #For round 3             
                                       flow_cha = define_output(file = "channel_sd_day", 
                                                                variable = "flo_out",
                                                                unit = c(561, 750, 11, 1218, 567, 825, 564, 630, 532, 962,
                                                                         990, 541, 950, 149, 376, 535, 537, 1141, 1161, 14,
                                                                         947, 184, 525, 573, 208, 111, 949, 581, 452))),#, 444,
                                     #155, 185, 504, 161, 459, 929, 133, 176, 483, 911, 882 ,1076))), #For round 3
                                     parameter = par_zonal_tag,
                                     start_date = 20050101,
                                     end_date = 20141231,
                                     start_date_print = 20100101,
                                     n_thread = 60)

     
     
     ##### ROUND 2 RESULTS EXTRACTION #####
     
     

     ######## File with simulated data creation: Streamflow ######## 
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     # Some of the gauging stations collect the water from more than one channel and therefore the streamflow has been recalculated 
     # Others only drains part of the subbasin, and has been therefore corrected by the drainaged fraction
     
     chanels <- read_rds("Data/Simulations/Round_2/Round_2_HC_Tagus.rds") # Simulated data
     
     
     navaluenga <- tibble(date = chanels$simulation$flow_cha_561$date, chanels$simulation$flow_cha_561[,-1]+ chanels$simulation$flow_cha_750[,-1] )
     
     matallana <-  chanels$simulation$flow_cha_11
     
     villarejo <-  chanels$simulation$flow_cha_1218
     
     peralejo <- tibble(date = chanels$simulation$flow_cha_567$date, chanels$simulation$flow_cha_567[,-1]+ chanels$simulation$flow_cha_825[,-1] )
     
     priego_escabas <- tibble(date = chanels$simulation$flow_cha_564$date, chanels$simulation$flow_cha_564[,-1] * (1/1.05)) #  The gauging station it is not at the end of the channel
     
     santa_maria_val <- chanels$simulation$flow_cha_630
     
     javalera <- tibble(date = chanels$simulation$flow_cha_532$date, chanels$simulation$flow_cha_532[,-1]*(1/1.4)) # The gauging station it is not at the end of the channel
     
     huete <- tibble(date = chanels$simulation$flow_cha_962$date, chanels$simulation$flow_cha_962[,-1]+ chanels$simulation$flow_cha_990[,-1] )
     
     torote <- chanels$simulation$flow_cha_541
     
     puebla_nueva <-  chanels$simulation$flow_cha_950
     
     ventosa <- tibble(date = chanels$simulation$flow_cha_149$date, chanels$simulation$flow_cha_149[,-1]+ chanels$simulation$flow_cha_376[,-1] )
     
     peraleja <- tibble(date = chanels$simulation$flow_cha_535$date, chanels$simulation$flow_cha_535[,-1]+ chanels$simulation$flow_cha_537[,-1] )
     
     villasequilla <- tibble(date = chanels$simulation$flow_cha_1141$date, chanels$simulation$flow_cha_1141[,-1]+ chanels$simulation$flow_cha_1161[,-1] ) # The gauging station it is not at the end of the channel
     
     valverde <- tibble(date = chanels$simulation$flow_cha_14$date, chanels$simulation$flow_cha_14[,-1]*(1/1.05))
     
     malpica <- chanels$simulation$flow_cha_947
     
     taravillas <- tibble(date = chanels$simulation$flow_cha_184$date, chanels$simulation$flow_cha_184[,-1]*(1/1.13))
     
     romanones <- chanels$simulation$flow_cha_525
     
     priego_trabraque <- tibble(date = chanels$simulation$flow_cha_573$date, chanels$simulation$flow_cha_573[,-1]*(1/1.05) ) # The gauging station it is not at the end of the channel
     
     aragosa <- tibble(date = chanels$simulation$flow_cha_208$date, chanels$simulation$flow_cha_208[,-1]*(1/1.24) ) # The gauging station it is not at the end of the channel
     
     trillo <- chanels$simulation$flow_cha_111
     
     valdecaba <- chanels$simulation$flow_cha_949
     
     villamantilla <- chanels$simulation$flow_cha_581
     
     
     # A list is created and saved for each subbasin
     sim_cha_list <- list(navaluenga, matallana, villarejo, peralejo, priego_escabas, santa_maria_val, javalera, huete, torote, puebla_nueva,
                          ventosa, peraleja, villasequilla, valverde, malpica, taravillas, romanones,  priego_trabraque, aragosa, trillo,  valdecaba, villamantilla) 
     
     names(sim_cha_list) <- subbasins_names
     
     write_rds(sim_cha_list, "Data/Simulations/Round_2/round_2_simulated_list.rds")
     
  
     ######## File with simulated data creation: Hydrological variables annual values ######### 
     
     sim_tagus_hcr2_wb <- chanels # Simulated data
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     lsus_subbasins_shp <- read_sf("Data/GIS/hardcal_shapes/studied_lsus/lsus_prop_final.shp") # LSUS per regions and per subbasins 
     studied_subb <- read_sf("Data/GIS/hardcal_shapes/subbasins/hardcal_natural_basins.shp") # Subbasins analysed
     
     ########  Run to extract variables ########  
     # LSUS data extraction and aggregation
     
     lsus_studied <- lsus_subbasins_shp %>%  st_drop_geometry()

     # List extraction: Precipitation
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_pcp_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_pcp <- sim_tagus_hcr2_wb$simulation[grepl("ls_pcp", names(sim_tagus_hcr2_wb$simulation))] #%>% .[lsus_data$namelist]
     
     # Calculating the average pcp for each subbasin in mm
     
     basin_pcps <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       lsus_area_sum <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_area_m")] %>% 
         sum(.)
       
       lsus_basin <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_id_rea", "area_frac")]
       
       basin_lsus_pcp <- lsus_pcp[lsus_basin$lsu_id_rea]
       
       av_pcps <- c(1:1000)
       
       for(f in 1:length(basin_lsus_pcp)){
         
         av_pcp <- basin_lsus_pcp[[f]][,-1] %>% apply(., 2, mean) %>% data.frame(pcp_mm = .) %>% mutate(pcp_mm = pcp_mm* lsus_basin$area_frac[f]) # Calculate the mm generated in each lsu taking into account the entire basin area
         
         av_pcps <- av_pcps %>% cbind(av_pcp) 
         
       }
       
       av_lsu_pcps <- tibble(av_pcp_mm = av_pcps[,-1] ) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_pcp <- av_lsu_pcps %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_pcp <- basin_pcp %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_pcp_mm)
       
       basin_pcps[[i]] = basin_pcp # List with the pcp for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_pcp = paste("pcp_basin", Basin_ID, sep = ""))
     names(basin_pcps) <- namms$names_pcp
     
     
     
     # List extraction: Surface runoff (SURQ = SURQ_GEN - SURQ_LS)
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_gen_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqgen <- sim_tagus_hcr2_wb$simulation[grepl("ls_surq_gen", names(sim_tagus_hcr2_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_ls_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqls <- sim_tagus_hcr2_wb$simulation[grepl("ls_surq_ls", names(sim_tagus_hcr2_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     # Calculating the total surq in mm for each lsu considering their relative area regarding the subbasin
     lsu_surqtot <- list()
     for(i in 1:length(lsus_surqgen)){
       
       lsu_surqtot[[i]] <- ((lsus_surqgen[[i]][,-1] - lsus_surqls[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_surqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_surq_basin", lsus_data$Basin_ID, sep = "")
     
     # Calculating the total surq for each subbasin in mm
     
     basin_surqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_surqtot))
       
       selected_lsus <- lsu_surqtot[bas_select]
       
       av_surqs <- c(1:1000)
       
       for(f in 1:length(selected_lsus)){
         
         av_surq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_surqs <- av_surqs %>% cbind(av_surq) 
         
       }
       
       av_surqs <- tibble(av_surq_mm = av_surqs[,-1]) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_surq <- av_surqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_surq <- basin_surq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_surq_mm)
       
       
       basin_surqs[[i]] = basin_surq # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_surqtot = paste("total_surq_basin", Basin_ID, sep = ""))
     names(basin_surqs) <- namms$names_surqtot
     
     
     # List extraction: Lateral flow (LATQ = LATQ_CHA + LATQ_RES)
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqcha_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqcha <- sim_tagus_hcr2_wb$simulation[grepl("ls_latqcha", names(sim_tagus_hcr2_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqres_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqres <- sim_tagus_hcr2_wb$simulation[grepl("ls_latqres", names(sim_tagus_hcr2_wb$simulation))] %>% .[lsus_data$namelist]
     
     # Calculating the total latq in mm for each lsu considering their relative area regarding the subbasin
     lsu_latqtot <- list()
     for(i in 1:length(lsus_latqcha)){
       
       lsu_latqtot[[i]] <- ((lsus_latqcha[[i]][,-1] + lsus_latqres[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_latqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_latq_basin", lsus_data$Basin_ID, sep = "")
     
     # Calculating the total latqq for each subbasin in mm
     
     basin_latqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_latqtot))
       
       selected_lsus <- lsu_latqtot[bas_select]
       
       av_latqs <- c(1:1000)
       
       for(f in 1:length(selected_lsus)){
         
         av_latq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_latqs <- av_latqs %>% cbind(av_latq) 
         
       }
       
       av_latqs <- tibble(av_latq_mm = av_latqs[,-1]) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_latq <- av_latqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_latq <- basin_latq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_latq_mm)
       
       
       basin_latqs[[i]] = basin_latq # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_latqtot = paste("total_latq_basin", Basin_ID, sep = ""))
     names(basin_latqs) <- namms$names_latqtot
     
     
     
     # Aquifers data: Calculated using flo + flo_res. For some aquifers, the relative drainage area to the gauginG stations has been used 
     # (aquif_data$fact_corr, previously calculated with QGIS)
     
     aquifers_studied <- read_sf("Data/GIS/hardcal_shapes/studied_aquifers/aquifers_selected.shp") %>% arrange(., Basin_ID)
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     
     # List extraction: GWFLO_CHA and GWFLO_RES
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwflocha_", Aq_id , sep = ""))
     aquifers_flocha <- sim_tagus_hcr2_wb$simulation[grepl("aqu_gwflocha", names(sim_tagus_hcr2_wb$simulation))] %>% .[aquif_data$namelist]
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwres_", Aq_id , sep = ""))
     aquifers_flores <- sim_tagus_hcr2_wb$simulation[grepl("aqu_gwres", names(sim_tagus_hcr2_wb$simulation))] %>% .[aquif_data$namelist]
     
     
     # Calculating the total gwflo in liters for each aquifer
     aquif_flo_tot_litres <- list()
     for(i in 1:length(aquifers_flocha)){
       
       aquif_flo_tot_litres[[i]] <- ((aquifers_flocha[[i]][,-1] + aquifers_flores[[i]][,-1]) * ( aquif_data$Area_km[i] * 1000000 * aquif_data$fact_corr[i])) %>% tibble(.)
       
     }
     
     names(aquif_flo_tot_litres) <- paste("aqu_", aquif_data$Aq_id, "totalflo_lit_basin", aquif_data$Basin_ID, sep = "")
     
     
     # Calculating the total flo for each subbasin in mm
     
     basin_gwflos <- list()
     for(i in 1:length(unique(aquif_data$Basin_ID))){
       
       aquifers_area_sum <- aquif_data %>% 
         filter(Basin_ID == unique(aquif_data$Basin_ID)[i]) %>% .[,c("fact_corr","Area_km")] %>% 
         mutate(real_area = fact_corr * Area_km) %>% .[, "real_area" ] %>% 
         sum(.)*1e6
       
       bas_select <- paste("basin",unique(aquif_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(aquif_flo_tot_litres))
       
       selected_aqus <- aquif_flo_tot_litres[bas_select]
       
       av_gwflos <- c(1:1000)
       
       for(f in 1:length(selected_aqus)){
         
         av_gwflo <- selected_aqus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_gwflos <- av_gwflos %>% cbind(av_gwflo) 
         
       }
       
       av_gwflos <- tibble(av_gwflo_mm = av_gwflos[,-1] / aquifers_area_sum) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_gwflo <- av_gwflos %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_gwflo <- basin_gwflo %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_gwflo_mm)
       
       basin_gwflos[[i]] = basin_gwflo # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_gwtot = paste("total_gwflo_basin", Basin_ID, sep = ""))
     names(basin_gwflos) <- namms$names_gwtot
     
     # Creating a table with all the extracted data
     subb_tables <- list()
     for(i in 1:length(basin_gwflos)){
       pcp <- tibble(basin_pcps[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "pcp")
       latq <- tibble(basin_latqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "latq")
       surq <- tibble(basin_surqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "surq")
       gwflo <- tibble(basin_gwflos[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "gwflo")
       
       subb_table <- pcp %>%  left_join(., latq, "name")%>%  left_join(., surq, "name")%>%  left_join(., gwflo, "name") %>% 
         mutate(water_yield = latq + surq + gwflo) %>% 
         mutate(runoff_coeff = water_yield / pcp,
                gw_cont = gwflo / water_yield) %>% 
         mutate(Basin = basins_file$Basin[i],
                Basin_ID = basins_file$Basin_ID[i], 
                region = basins_file$region[i]) %>% 
         rename(run = name) %>% 
         .[,c("Basin_ID", "Basin", "region", "run",  "pcp",  "water_yield", "latq", "surq", "gwflo",  "runoff_coeff", "gw_cont" )]
       
       subb_tables[[i]] <- subb_table
       
     }
     
     namms <- paste("tab", basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     names(subb_tables) <- namms
     
     # write_rds(subb_tables, "Data/Results/R2/HC_Round1_basinswb.rds")
     
     table_all <- c()
     for(m in 1:length(subb_tables)){
       
       tab <- subb_tables[[m]]
       table_all <- table_all %>% rbind(., tab)
     }
     
     ######## Run to save variables ######## 
     write_csv(table_all, "Data/Results/R2/HC_Round2_basinswb.csv", quote = "none")
     
     ######## Calculate streamflow simulation performance ######## 
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     observed_streamflow <- read_rds("Data/Simulations/list_observed_data.rds")
     simulated_streamflow  <- read_rds("Data/Simulations/Round_2/round_2_simulated_list.rds") # Simulated data (previously saved)
     
     evaluated_period <- c(2010:2014)
     number_simulations <- c(1000)
     
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2  # Function to calculate R2
     
     
     streamflow_metrics <- c()
     streamflo_metrics_list <- list()
     
     for(i in 1:length(observed_streamflow)){
       
       obs <- observed_streamflow[[i]] %>% mutate(fecha = ymd(fecha)) %>% 
         filter(year(fecha) %in% evaluated_period)
       
       sim <- simulated_streamflow[[i]]%>% mutate(date = ymd(date)) %>% 
         filter(., date %in% ymd(min(obs$fecha)):ymd(max(obs$fecha))) # Days without observed data does not compute
       
       nses <-  sim %>% select(-date) %>% 
         map_dbl(., ~NSE( .x, obs$caudal))
       r2s <-  sim %>% select(-date) %>% 
         map_dbl(., ~rsq_r2( .x, obs$caudal))
       pbias <-  sim %>% select(-date) %>% 
         map_dbl(., ~pbias( .x, obs$caudal))
       rmses <-  sim %>% select(-date) %>% 
         map_dbl(., ~rmse( .x, obs$caudal))
       
       tab <-  tibble(Subbasin_ID = basins_file$Basin_ID[i], Subbasin = basins_file$Basin[i] , 
                      region = basins_file$region[i], nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = c(1:number_simulations))
       
       streamflow_metrics <- streamflow_metrics %>% rbind(., tab)
       streamflo_metrics_list[[i]] <- tab
     }
     
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     names(streamflo_metrics_list) <- subbasins_names
     
     
     write.csv(streamflow_metrics, "Data/Results/R2/HC_Round2_streamflow_metrics_allchanel.csv", row.names = F, quote = F)
     # write_rds(streamflo_metrics_list, "Data/Results/R2/HC_Round1_streamflow_metrics_allchanel.rds")
     
     ######## Combine results and created plots for parameters constrain  ########  
     
     # Merge results in one table
     
     streamflow_metrics <- read_csv("Data/Results/R2/HC_Round2_streamflow_metrics_allchanel.csv")
     
     waterbalances <- read_csv("Data/Results/R2/HC_Round2_basinswb.csv") %>% 
       select(Basin_ID, run, runoff_coeff, gw_cont) %>%  mutate(run = as.numeric(str_remove(run, "run_")))
     
     table_constrain <-  streamflow_metrics %>% left_join(., waterbalances, c("Subbasin_ID" = "Basin_ID", "run")) %>% 
       .[,c( "Subbasin_ID",    "Subbasin", "region", "run", "nse","r2","pbias", "rmse", "runoff_coeff", "gw_cont")]
     
     # Extract parameter sets    
     
     parameters_data <- read_rds("Data/Simulations/Round_2/round_2_HC_Tagus.rds") %>% .[1]
     par_values <- parameters_data$parameter$values
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     subbasins <- basins_file$Basin
     region <- basins_file$region
     
     
     ######## Plots creation ######## 
     
     # Plot 1: Distribution of variables for each subbasin
     
     viol_plots <- list()
     
     for(i in 1:length(basins_file$Basin_ID)){
       
       tabb_metrics <- table_constrain %>% filter(Subbasin_ID == basins_file$Basin_ID[i]) %>% 
         rename("NSE" = "nse", "R" = "r2", "PBIAS" = "pbias", RMSE = "rmse", "Runoff coefficient" = "runoff_coeff" , "Goundwater contribution" = "gw_cont")
       
       viol_plot <- tabb_metrics %>% 
         pivot_longer(., -c("Subbasin_ID",  "Subbasin", "region", "run")) %>% 
         mutate(name = factor(name, levels = c("NSE", "R", "PBIAS", "RMSE", "Runoff coefficient", "Goundwater contribution"))) %>% 
         ggplot(aes(x = name, y = value, fill = name))+ geom_violin()+
         facet_wrap(facets = "name", scales = "free")+
         theme_bw()+
         theme( strip.text = element_blank(), legend.position = "nuop", text = element_text(size = 18, face = "bold"), axis.title = element_blank())+
         ggtitle(paste("Basin ",basins_file$Basin_ID[i], ": ", basins_file$Basin[i],  " (",basins_file$region[i] , ")", sep = ""))
       
       viol_plots[[i]] <- viol_plot
       
       ggsave(plot = viol_plot, 
              filename = paste("Data/Figures/R2/results_basins/", basins_file$Basin_ID[i], "_", str_replace_all(basins_file$Basin, " ", "_")[i], ".png", sep = ""),
              device = "png", 
              dpi = 300, width = 16, height = 12) 
     }
     
     # Plots 2: Effect of each parameter in the affected subbasins (subbasins with part o a certain lithologhy)
     
    
     IMP_subbasins <- c(1, 21, 22) # Subbasins with at least one LSU with impervious geology
     MET_subbasins <- c(2, 3, 10, 14, 15)
     CRB_subbasins <- c(4, 5, 6, 14, 19, 20) # Subbasins with at least one LSU with carbonate geology
     SCRB_subbasins <- c(11, 13, 16, 17, 20) # Subbasins with at least one LSU with carbonate geology
     DTH_subbasins <- c(5, 7, 8, 9, 10, 12, 13, 15, 18, 22) # Subbasins with at least one LSU with high permeability detrital geology
     DTL_subbasins <- c(8, 11:14, 17:20 ) # Subbasins with at least one LSU with low permeability detrital geology
     
     

     
     ## IMP Region
     
     subbasins_values <- list(
       "1" = "Navaluenga (IMP)",
       "21" = "Valdecaba (IMP)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_IMP <- par_values %>% select(starts_with("IMP"))#, c(surlag, chn))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(IMP_subbasins, levels = c(1, 21, 22)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_IMP)){
       parameter_name <- colnames(parameters_IMP[i])[1]
       parameter <- tibble(parameter = parameters_IMP[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(1, 21, 22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 3)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R2/IMP_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     ## MET Region
     
     subbasins_values <- list(
       "2" = "Matallana (MET)",
       "3" = "Villarejo de Montalban (IMP)",
       "10" = "La Pueblanueva (MIX)",
       "14" = "Valverde de los Arroyos (MIX)",
       "15" = "Malpica (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_MET <- par_values %>% select(starts_with("MET"))#, c(surlag, chn))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(MET_subbasins, levels = c(2, 3, 10, 14 ,15)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_MET)){
       parameter_name <- colnames(parameters_MET[i])[1]
       parameter <- tibble(parameter = parameters_MET[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(2, 3, 10, 14 ,15)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 3)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R2/MET_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     ## CRB Region
     
     subbasins_values <- list(
       "4"     =   "Peralejo de las Truchas (CRB)",
       "5"     =            "Priego Escabas (CRB)",
       "6"     =       "Santa Maria del Val (CRB)",
       "14"     =   "Valverde de los Arroyos (MIX)", 
       "19"     =                   "Aragosa (MIX)", 
       "20"     =                    "Trillo (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     
     
     parameters_CRB <- par_values %>% select(starts_with("CRB") )#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(CRB_subbasins, levels = c(4, 5, 6,  14, 19:20)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     
     for(i in 1:length(parameters_CRB)){
       parameter_name <- colnames(parameters_CRB[i])[1]
       parameter <- tibble(parameter = parameters_CRB[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(4, 5, 6,  14, 19:20)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 3)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R2/CRB_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
 
         ## SCRB Region
     
     subbasins_values <- list(
       "11"     =                   "Ventosa (DTL)", 
       "13"     =    "Villasequilla de Yepes (DTL)", 
       "16"     =                "Taravillas (MIX)", 
       "17"     =                 "Romanones (MIX)", 
       "18"     =          "Priego Trabraque (MIX)", 
       "20"     =                    "Trillo (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     
     
     parameters_SCRB <- par_values %>% select(starts_with("SCRB") )#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(SCRB_subbasins, levels = c(11, 13,  16:18, 20)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     
     for(i in 1:length(parameters_SCRB)){
       parameter_name <- colnames(parameters_SCRB[i])[1]
       parameter <- tibble(parameter = parameters_SCRB[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(11, 13,  16:18, 20)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 3)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R2/SCRB_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## DTH Region
     
     subbasins_values <- list(
       "5" = "Priego Escabas (CRB)",
       "7" = "Jabalera (DTH)",
       "8" = "Huete (DTH)",
       "9" = "Torote (DTH)",
       "10" = "La Pueblanueva (DTH)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "15" = "Malpica (MIX)",
       "18" = "Priego Trabraque (MIX)",
       "20" = "Trillo (MIX)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_DTH <- par_values %>% select(starts_with("DTH"))#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(DTH_subbasins, levels = c(5, 7, 8, 9, 10, 12, 13, 15, 18, 22)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_DTH)){
       parameter_name <- colnames(parameters_DTH[i])[1]
       parameter <- tibble(parameter = parameters_DTH[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(5, 7, 8, 9, 10, 12, 13, 15, 18, 22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 5)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R2/DTH_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## DTL Region
     
     subbasins_values <- list(
       "8" = "Huete (DTH)",
       "11" = "Ventosa (DTL)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "14" = "Valverde de los Arroyos (MIX)",
       "17" = "Romanones (MIX)",
       "18" = "Priego Trabraque (MIX)",
       "19" = "Aragosa (MIX)",
       "20" = "Trillo (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_DTL <- par_values %>% select(starts_with("DTL"))#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(DTL_subbasins, levels = c(8, 11:14, 17:20 )))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_DTL)){
       parameter_name <- colnames(parameters_DTL[i])[1]
       parameter <- tibble(parameter = parameters_DTL[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(8, 11:14, 17:20)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 5)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R2/DTL_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width =  16 , height =  12, dpi = 300)
       }
     }
     
     # Parameters common to all subbasins
     
     subbasins_values <- list(
       "1" = "Navaluenga (IMP)",
       "2" = "Matallana (MET)",
       "3" = "Villarejo de Montalban (IMP)",
       "4"     =   "Peralejo de las Truchas (CRB)",
       "5" = "Priego Escabas (CRB)",
       "6"     =       "Santa Maria del Val (CRB)",
       "7" = "Jabalera (DTH)",
       "8" = "Huete (DTH)",
       "9" = "Torote (DTH)",
       "10" = "La Pueblanueva (DTH)",
       "11" = "Ventosa (DTL)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "14" = "Valverde de los Arroyos (MIX)",
       "15" = "Malpica (MIX)",
       "16" = "Taravillas (MIX)", 
       "17" = "Romanones (MIX)",
       "18" = "Priego Trabraque (MIX)",
       "19" = "Aragosa (MIX)",
       "20" = "Trillo (MIX)",
       "21" = "Valdecaba (IMP)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_com <- par_values %>% select(surlag, chn)
     metric_values <- table_constrain 
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_com)){
       parameter_name <- colnames(parameters_com[i])[1]
       parameter <- tibble(parameter = parameters_com[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(1:22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 6)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R2/Common_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width =  16 , height =  12, dpi = 300)
       }
     }
     
     # These plots are analyzed in power point to constrain the parameters and continue with the following Round
     
     ##### Extract results and generate plots for reservoirs inflow #####     
     
     # Reservoirs data
     
     reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv")
     
     
     # Observed data 
     
     obs_inflow <- read_csv("Data/Reservoirs/Simulation/CHT_obs_inflow_reservoirs.csv")
     
     # Simulated data
     
     simulation <- read_rds("Data/Simulations/Round_2/Round_2_HC_Tagus.rds")
     
     # Parameters
     
     
     
     # Creating and exporting lists with observed-simulated data 
     
     evaluated_period <- c(2010:2019)
     
     
     res_studied <- reservoirs_data %>% mutate(namelist = paste("res_in_", Lake_id , sep = "")) %>% arrange(., Lake_id)
     res_sim_inflow <- simulation$simulation[grepl("res_in_", names(simulation$simulation))] 
     
     
     res_inflows <- list()
     
     for(i in 1: length(res_sim_inflow)){
       
       res_inflow <- res_sim_inflow[[i]]
       
       res_inflow <- tibble(res_inflow[,1], reservoir = paste("lake_", i, sep = ""), res_inflow[,-1]/86400)
       
       res_inflows[[i]] <- res_inflow
       
     }
     names(res_inflows) <- str_replace(unique(names(res_sim_inflow)), "res_in_", "lake_")
     
     write_rds(res_inflows, "Data/Reservoirs/Simulation/Round_2_reservoirs_sim.rds")
     
     
     observed_inflow <- list()
     lakes <- c()
     for(i in 1:length(unique(obs_inflow$Lake_id))){
       
       res_obs_inflow <- obs_inflow %>% 
         filter(Lake_id == unique(obs_inflow$Lake_id)[i],
                year(date) %in% evaluated_period) %>% 
         select(name, Lake_id, date, obsflow_m3s) %>% 
         mutate(Lake_id = paste("lake_", Lake_id, sep = "")) %>% 
         mutate(obsflow_m3s = as.numeric(obsflow_m3s))
       observed_inflow[[i]] <- res_obs_inflow
       lakes <- c(lakes, unique(res_obs_inflow$Lake_id ))
     }
     
     names(observed_inflow) <- lakes
     
     write_rds(observed_inflow, "Data/Reservoirs/Simulation/observed_reservoir_inflow.rds")
     
     
     # Loading saved data
     
     observed_inflow <- read_rds("Data/Reservoirs/Simulation/observed_reservoir_inflow.rds") 
     res_inflows <- read_rds("Data/Reservoirs/Simulation/Round_2_reservoirs_sim.rds")
     
     
     # Calculating performance for reservoirs inflow
     
     # Funtion to calculate coeficient of determination
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2 
     
     
     evaluated_period <- c(2010:2014)
     number_simulations <- 1000
     

     streamflow_metrics_res <- c()
     
     for(i in 1:length(observed_inflow)){
       
       lake <- names(observed_inflow[i])
       
       obs <- observed_inflow[[lake]] %>% 
         filter(year(date) %in% evaluated_period) %>% 
         group_by(year(date), month(date)) %>% 
         summarise(obsflow_m3s = mean(obsflow_m3s)) %>% 
         mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
         ungroup(.) %>% 
         select(., date, obsflow_m3s)
       
       sim <- res_inflows[[lake]] %>% 
         filter(., date %in% ymd(min(obs$date)):ymd(max(obs$date))) %>% # Days without observed data does not compute
         group_by(year(date), month(date)) %>% 
         summarise(across(starts_with("run"), mean)) %>% 
         mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
         ungroup(.) %>% 
         select(., -c(`year(date)`, `month(date)`))
       
       nses <-  sim %>% select(-c(date)) %>% 
         map_dbl(., ~NSE( .x, obs$obsflow_m3s))
       r2s <-  sim %>% select(-c(, date)) %>%
         map_dbl(., ~rsq_r2( .x, obs$obsflow_m3s))
       pbias <-  sim %>% select(-c(date)) %>%
         map_dbl(., ~pbias( .x, obs$obsflow_m3s))
       rmses <-  sim %>% select(-c(date)) %>%
         map_dbl(., ~rmse( .x, obs$obsflow_m3s))
       
       tab <-  tibble(reservoir = unique(observed_inflow[[i]][[2]]), 
                      nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = c(1:number_simulations))
       
       streamflow_metrics_res <- streamflow_metrics_res %>% rbind(., tab)
       
     }
     
     write_csv(streamflow_metrics_res, "Data/Reservoirs/Results/reservoir_metrics_R2.csv")
     
     
     reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv") %>%
       mutate(Lake_id = paste("lake_", Lake_id, sep = "")) %>% 
       mutate(region = region_r2)
     
     
     # Metrics plots
     
     streamflow_metrics_res <- read_csv("Data/Reservoirs/Results/reservoir_metrics_R2.csv")
     
     streamflow_metrics_res <- streamflow_metrics_res %>% filter(reservoir %in% paste("lake_", int_reservoirs, sep = ""))
     
     for(i in 1:length(unique(streamflow_metrics_res$reservoir))){
       
       resdat <- streamflow_metrics_res %>% 
         filter(reservoir == unique(streamflow_metrics_res$reservoir)[i]) %>% 
         pivot_longer(., -c(reservoir, run), names_to = "metric", values_to = "metric_value") %>% 
         left_join(., reservoirs_data[, c("Nombre", "Lake_id", "region")], c("reservoir" = "Lake_id")) 
       
       perf_plot <- resdat %>% 
         ggplot(., aes(x = reservoir, y = metric_value, fill = metric))+
         geom_violin()+
         facet_wrap(facets = "metric", scales = "free")+
         ggtitle(paste(unique(resdat$reservoir), ", ", unique(resdat$Nombre), " (", unique(resdat$region), ")" ,sep = ""))+
         theme_bw()+
         theme(axis.title = element_blank(), legend.position = "nuop")
       
       ggsave(plot = perf_plot,filename =  paste("Data/Reservoirs/Figures/R2/Reservoir_perf/", 
                                                 unique(resdat$reservoir), ".png", sep = ""),device = "png", dpi = 600, height = 10, width = 10)
       
     }
     
     # Parameters effect plot --> compared with the parameters effects on subbasins
    
      parameters <- simulation$parameter$values
     
       streamflow_metrics_res <- read_csv("Data/Reservoirs/Results/reservoir_metrics_R2.csv")
       
       int_reservoirs <- c(2, 6, 10, 11, 12, 15, 16, 17, 19, 21, 26, 28, 31) # Focus on reservoirs with no upstream reservoirs and in PBIAS
       
      
      streamflow_metrics_res <- streamflow_metrics_res %>% 
        filter(reservoir %in% paste("lake_", int_reservoirs, sep = "")) %>% 
               select(-c(nse, r2 ,  rmse))
     
     for(i in 1:length(unique(streamflow_metrics_res$reservoir))){
       
       resdat <- streamflow_metrics_res %>% 
         filter(reservoir == unique(streamflow_metrics_res$reservoir)[i]) %>% 
         pivot_longer(., -c(reservoir, run), names_to = "metric", values_to = "metric_value") %>% 
         left_join(., reservoirs_data[, c("Nombre", "Lake_id", "region")], c("reservoir" = "Lake_id")) 
       
       regions <- unique(resdat$region) %>% str_split(., ", ") %>% unlist(.)
       
       pars <- parameters %>% select(starts_with(regions)) %>% mutate(run = seq(1, length(unique(resdat$run)), 1))
       
       for_res_pars_plot <- resdat %>% 
         left_join(., pars, "run") %>% 
         pivot_longer(., -c(reservoir, run, metric, metric_value, Nombre, region), names_to = "parameter", values_to = "parameter_value") 
       
       for(metric in 1:length(unique(for_res_pars_plot$metric))){
         
         meetric <- unique(for_res_pars_plot$metric)[metric]
         
         tab_pars_res <-  for_res_pars_plot %>% filter(metric == meetric)
         
         pars_eff_plot <- ggplot(tab_pars_res, aes(x = parameter_value, y = metric_value))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "parameter", scales = "free_x")+
           ggtitle(paste(meetric, unique(resdat$reservoir), ", ", unique(resdat$Nombre), " (", unique(resdat$region), ")" ,sep = ""))+
           theme_bw()+
           theme(axis.title = element_blank())
         
         ggsave(plot = pars_eff_plot,filename =  paste("Data/Reservoirs/Figures/R2/Reservoir_pars/", unique(resdat$reservoir), meetric, ".png", sep = ""),device = "png", dpi = 600, height = 10, width = 10)
         
       }
     }
     
     
     
     
     
     
  
     
     
#### ROUND 3 ####
     
     ##### PARAMETERS SETS CREATION #####
     
     
     ######## Parameters for Round_3 ######## 
     
     ########  Obtaining geology for aquifers (previously assigned using zonal statistics) ########  
     
     aquifers_shp <- read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/aquifers_r3.shp") 
     
     ggplot()+geom_sf(data = aquifers_shp, aes(fill = region))
     
     
     aquifers_data <- read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/aquifers_r3.shp") %>% st_drop_geometry()%>% select(Aq_id, region) %>% 
       mutate(region = factor(region, levels=c("IMP", "SIMP", "MET", "SMET", "CRB", "SCRB", "S2CRB", "DTH", "DTL")))
     
     
     reg_aqus <- list()
     
     for(i in 1:length(levels(aquifers_data$region))){
       
       reg_aqu <- aquifers_data %>% filter(., region == levels(aquifers_data$region)[i]) %>% pull(., Aq_id)
       reg_aqus[[i]] <- reg_aqu
       
     }
     
     names(reg_aqus) <- c("IMP_aq", "SIMP_aq", "MET_aq", "SMET_aq", "CRB_aq", "SCRB_aq", "S2CRB_aq", "DTH_aq", "DTL_aq")
     
     # Vectors to copy-paste in the parameters sets creation
     IMP_aqus <- paste(reg_aqus$IMP_aq, collapse = ",")
     SIMP_aqus <- paste(reg_aqus$SIMP_aq, collapse = ",")
     MET_aqus <- paste(reg_aqus$MET_aq, collapse = ",")
     SMET_aqus <- paste(reg_aqus$SMET_aq, collapse = ",")
     CRB_aqus <- paste(reg_aqus$CRB_aq, collapse = ",")
     SCRB_aqus <- paste(reg_aqus$SCRB_aq, collapse = ",")
     S2CRB_aqus <- paste(reg_aqus$S2CRB_aq, collapse = ",")
     DTH_aqus <- paste(reg_aqus$DTH_aq, collapse = ",")
     DTL_aqus <- paste(reg_aqus$DTL_aq, collapse = ",")
     
     
     ########  Obtaining geology for HRUs (previously assigned using zonal statistics) ######## 
     
     lsus_conf <-  read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/lsus_lithology_configuration_r3.shp") %>%
       st_drop_geometry(.) %>% arrange(., lsu_id)
     # with the geological region for each LSU
     lsus_def <-  read_table("Data/GIS/model/ls_unit.def", skip = 2) # File with the hrus within each LSU    
     
     lsus_id_reg <-  select(lsus_conf, lsu_id, region, Area) %>% mutate(id = lsu_id) %>% .[,c(4,2:3)]
     
     hrus_lsus <- select(lsus_def, id, elements, X6) # Elements and X6 columns are the HRUs that each LSU contain (from element to X6)
     
     
     lsus_hrus_def <- left_join(hrus_lsus, lsus_id_reg, "id") %>% .[,c(1,4,2,3)] %>% 
       mutate(hrus = paste(as.character(hrus_lsus$elements), as.character(hrus_lsus$X6), sep = ":") %>% str_remove(., "-") %>% str_remove(., ":NA")) %>% 
       .[,c(1:2,5)]
     
     
     #For creating a tibble with the parameterization, a simplification of the hru lists should be done, as the tibble function has a length limit
     # For this purpose, the next loop group the hrus of the contiguous lsus
     
     
     lsus_hrus_def$region <- factor(lsus_hrus_def$region, levels = c("IMP", "SIMP", "MET", "SMET", "CRB", "SCRB", "S2CRB", "DTH", "DTL")) #Factor with the different geological groups
     hrus_reg <- list()
     
     for(lev in 1:length(levels(lsus_hrus_def$region))){
       
       lsus_order <-  lsus_hrus_def %>% filter(region == levels(lsus_hrus_def$region)[lev]) %>% separate(., hrus, into = c("ini", "end"),sep = ":") %>% 
         mutate(ini = as.numeric(ini), end = as.numeric(end)) %>% arrange(., ini)   #preparing the hru ids for each LSU
       NAS <- is.na(lsus_order$end)     #Some of them only have 1 hru
       lsus_order[NAS,4] <- lsus_order[NAS,3]
       
       # First part : check contiguous lsus at the beggining and end of the list
       r <- 0 # number of contiguous lsus at the beginning
       q <- 0 # number of contiguous lsus at the end
       g <- 1 # compensation if q = 0 (look below) 
       
       for(i in 1:length(lsus_order$id)){
         if(i == 1){
           while(lsus_order$end[i+r]+1 == lsus_order$ini[i+1+r]){
             r <-  r+1}
         }
         if(i == length(lsus_order$id)){
           while(lsus_order$ini[i-q]-1 == lsus_order$end[i-1-q]){
             q <- q+1 
             g <- 0}
         }
         else{}
       }
       # First and last simplificated hrus
       nni <- paste(lsus_order$ini[1], lsus_order$end[1+r], sep = ":")
       nnend <- paste(lsus_order$ini[length(lsus_order$id)-q], lsus_order$end[length(lsus_order$id)], sep = ":")
       # Second part: for the rest of the list of lsus-hrus, excluding the first and last items (with r and q)
       n <- 0
       nns <- c()
       is <- c()
       for(i in (2+r):(length(lsus_order$id)-(1*g+q))){ # If q = 0, g = 1, avoiding an error in next line when i = length(lsus_order$id)
         if(lsus_order$ini[i+1] == (lsus_order$end[i]+1)){
           n <- n+1
           i <- i+1
         }
         else{
           nn <- paste(lsus_order$ini[i-(n)], lsus_order$end[i], sep = ":")
           n <- 0 
           nns <- c(nns, nn)
         }
       }
       
       hrus_reg[[lev]] <- c(nni, nns, nnend)
     }
     names(hrus_reg) <- levels(lsus_hrus_def$region)
     
     
     #In the hrus_reg list, a list for each region contains the different hrus grouped
     
     
     hrus_characters <- list()
     for(n in 1:length(hrus_reg)){
       combs <- c()
       for(i in 1:length(hrus_reg[[n]])){
         comb <- paste(hrus_reg[[n]][i])
         combs <- paste(combs, comb, sep = ",")
       }
       hrus_characters[[n]] <- combs
     }
     names(hrus_characters) <- levels(lsus_hrus_def$region)
     
     
     # The list "hrus_characters" contains for each geological region all the hrus that are located within it. Easily, 
     #its content can be copy-paste into the tibble function to create the different parameters sets
     
     ######## Creating the parameter sets ######## 
     
     
     hc_par_bound_zonal_3 <- tibble(
       
       'surlag.bsn | change = absval' = c(1, 6), 
       'chn.rte | change = absval' = c(0, 0.05),
       
       'IMP_esc::esco.hru | change = absval | unit =         c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.7 , 0.999),     # IMP_esc::esco.hru | change = absval             
       'IMP_epc::epco.hru | change = absval | unit =         c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.001 , 0.999),   # IMP_epc::epco.hru | change = absval  
       'IMP_cnn::cn2.hru | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-29.999  ,  0),   # IMP_cnn::cn2.hru | change = pctchg     
       'IMP_awc::awc.sol | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(25 , 50),         # IMP_awc::awc.sol | change = pctchg    
       'IMP_per::perco.hru | change = absval | unit =        c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.65 , 0.8),      # IMP_per::perco.hru | change = absval   
       'IMP_latq::latq_co.hru | change = abschg | unit =     c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-0.05, 0),        # IMP_latq::latq_co.hru | change = abschg  
       'IMP_cn3::cn3_swf.hru | change = abschg | unit =      c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-0.3, 0),         # IMP_cn3::cn3_swf.hru | change = abschg        
       'IMP_zso::z.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c( 15 , 40),        # IMP_zso::z.sol | change = pctchg 
       'IMP_kso::k.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-79.999 , 50 ),   # IMP_kso::k.sol | change = pctchg 
       'IMP_bd::bd.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-25 , -15),       # IMP_bd::bd.sol | change = pctchg 
       'IMP_ovn::ovn.hru | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-20 , 20),        # IMP_ovn::ovn.hru | change = pctchg
       'IMP_lattime::lat_ttime.hru | change = absval| unit = c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.5, 8),          # IMP_lattime::lat_ttime.hru | change = absval
       
       'IMP_alpha::alpha.aqu | change = absval = | unit =      c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.001, 0.04),   # IMP_alpha::alpha.aqu | change = absval
       'IMP_flomin::flo_min.aqu | change = absval | unit =     c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(10, 20),        # IMP_flomin::flo_min.aqu | change = absval 
       'IMP_revapmin::revap_min.aqu | change = absval | unit = c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0, 10),         # IMP_revapmin::revap_min.aqu | change = absval 
       'IMP_revapco::revap_co.aqu | change = absval | unit =   c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.02, 0.2),     # IMP_revapco::revap_co.aqu | change = absval 
       'IMP_spyld::sp_yld.aqu | change = absval =| unit =      c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.00001, 0.05), # IMP_spyld::sp_yld.aqu | change = absval
       
       'SANT_awc::awc.sol | change = pctchg | unit =          c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(-25 , 20),       # SANT_awc::awc.sol | change = pctchg    
       'SANT_zso::z.sol | change = pctchg | unit =            c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(-30 , 20),       # SANT_zso::z.sol | change = pctchg 
       'SANT_kso::k.sol | change = pctchg | unit =            c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(-25 , 150 ),     # SANT_kso::k.sol | change = pctchg 
       
       
       'SIMP_esc::esco.hru | change = absval | unit =         c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.8 , 0.999),     # SIMP_esc::esco.hru | change = absval             
       'SIMP_epc::epco.hru | change = absval | unit =         c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.001 , 0.999),   # SIMP_epc::epco.hru | change = absval  
       'SIMP_cnn::cn2.hru | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-29.999 , -10),   # SIMP_cnn::cn2.hru | change = pctchg     
       'SIMP_awc::awc.sol | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(35 , 50),         # SIMP_awc::awc.sol | change = pctchg    
       'SIMP_per::perco.hru | change = absval | unit =        c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.4 , 0.6),       # SIMP_per::perco.hru | change = absval   
       'SIMP_latq::latq_co.hru | change = abschg | unit =     c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.3, 0.1),       # SIMP_latq::latq_co.hru | change = abschg  
       'SIMP_cn3::cn3_swf.hru | change = abschg | unit =      c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.3, 0.1),       # SIMP_cn3::cn3_swf.hru | change = abschg        
       'SIMP_zso::z.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c( 25 , 50),        # SIMP_zso::z.sol | change = pctchg 
       'SIMP_kso::k.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-79.999 , -25),   # SIMP_kso::k.sol | change = pctchg 
       'SIMP_bd::bd.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-25 , -15),       # SIMP_bd::bd.sol | change = pctchg 
       'SIMP_ovn::ovn.hru | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-20 , 20),        # SIMP_ovn::ovn.hru | change = pctchg
       'SIMP_lattime::lat_ttime.hru | change = absval| unit = c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.5, 15),         # SIMP_lattime::lat_ttime.hru | change = absval
       
       'SIMP_alpha::alpha.aqu | change = absval = | unit =      c(107,109,110,114,117,118)' = c(0.001, 0.025),  # SIMP_alpha::alpha.aqu | change = absval
       'SIMP_flomin::flo_min.aqu | change = absval | unit =     c(107,109,110,114,117,118)' = c(10, 20),        # SIMP_flomin::flo_min.aqu | change = absval 
       'SIMP_revapmin::revap_min.aqu | change = absval | unit = c(107,109,110,114,117,118)' = c(0, 10),         # SIMP_revapmin::revap_min.aqu | change = absval 
       'SIMP_revapco::revap_co.aqu | change = absval | unit =   c(107,109,110,114,117,118)' = c(0.02, 0.2),     # SIMP_revapco::revap_co.aqu | change = absval 
       'SIMP_spyld::sp_yld.aqu | change = absval =| unit =      c(107,109,110,114,117,118)' = c(0.00001, 0.05), # SIMP_spyld::sp_yld.aqu | change = absval
       
       
       'MET_esc::esco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.4 , 0.999),      # MET_esc::esco.hru | change = absval             
       'MET_epc::epco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.001 , 0.999),    # MET_epc::epco.hru | change = absval  
       'MET_cnn::cn2.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-20  ,  20),       # MET_cnn::cn2.hru | change = pctchg     
       'MET_awc::awc.sol | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-5 , 25),          # MET_awc::awc.sol | change = pctchg    
       'MET_per::perco.hru | change = absval | unit =        c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.6 , 0.8),        # MET_per::perco.hru | change = absval   
       'MET_latq::latq_co.hru | change = abschg | unit =     c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-0.1, 0.3),        # MET_latq::latq_co.hru | change = abschg  
       'MET_cn3::cn3_swf.hru | change = abschg | unit =      c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-0.3, 0),          # MET_cn3::cn3_swf.hru | change = abschg        
       'MET_zso::z.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-10 , 25),         # MET_zso::z.sol | change = pctchg 
       'MET_kso::k.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-50 , 75),         # MET_kso::k.sol | change = pctchg 
       'MET_bd::bd.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-15 , 0),          # MET_bd::bd.sol | change = pctchg 
       'MET_ovn::ovn.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-20 , 20),         # MET_ovn::ovn.hru | change = pctchg
       'MET_lattime::lat_ttime.hru | change = absval| unit = c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.5, 10),          # MET_lattime::lat_ttime.hru | change = absval
       
       'MET_alpha::alpha.aqu | change = absval = | unit =      c(1,2,3,5,7,9,11,108,122)' = c(0.001, 0.05),    # MET_alpha::alpha.aqu | change = absval
       'MET_flomin::flo_min.aqu | change = absval | unit =     c(1,2,3,5,7,9,11,108,122)' = c(10, 20),         # MET_flomin::flo_min.aqu | change = absval 
       'MET_revapmin::revap_min.aqu | change = absval | unit = c(1,2,3,5,7,9,11,108,122)' = c(0, 10),          # MET_revapmin::revap_min.aqu | change = absval 
       'MET_revapco::revap_co.aqu | change = absval | unit =   c(1,2,3,5,7,9,11,108,122)' = c(0.02, 0.2),      # MET_revapco::revap_co.aqu | change = absval 
       'MET_spyld::sp_yld.aqu | change = absval =| unit =      c(1,2,3,5,7,9,11,108,122)' = c(0.00001, 0.05),  # MET_spyld::sp_yld.aqu | change = absval


       'SMET_esc::esco.hru | change = absval | unit =         c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.7 , 0.999),     # SMET_esc::esco.hru | change = absval             
       'SMET_epc::epco.hru | change = absval | unit =         c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.001 , 0.999),   # SMET_epc::epco.hru | change = absval  
       'SMET_cnn::cn2.hru | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-20  ,  0),       # SMET_cnn::cn2.hru | change = pctchg     
       'SMET_awc::awc.sol | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-5 , 40),         # SMET_awc::awc.sol | change = pctchg    
       'SMET_per::perco.hru | change = absval | unit =        c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.5 , 0.8),       # SMET_per::perco.hru | change = absval   
       'SMET_latq::latq_co.hru | change = abschg | unit =     c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-0.1, 0.3),       # SMET_latq::latq_co.hru | change = abschg  
       'SMET_cn3::cn3_swf.hru | change = abschg | unit =      c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-0.3, 0),         # SMET_cn3::cn3_swf.hru | change = abschg        
       'SMET_zso::z.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0 , 40),          # SMET_zso::z.sol | change = pctchg 
       'SMET_kso::k.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-50 , 75),        # SMET_kso::k.sol | change = pctchg 
       'SMET_bd::bd.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-15 , 0),         # SMET_bd::bd.sol | change = pctchg 
       'SMET_ovn::ovn.hru | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-20 , 20),        # SMET_ovn::ovn.hru | change = pctchg
       'SMET_lattime::lat_ttime.hru | change = absval| unit = c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.5, 10),         # SMET_lattime::lat_ttime.hru | change = absval
       
       'SMET_alpha::alpha.aqu | change = absval = | unit =      c(113, 119)' = c(0.001, 0.05),   # SMET_alpha::alpha.aqu | change = absval
       'SMET_flomin::flo_min.aqu | change = absval | unit =     c(113, 119)' = c(10, 20),        # SMET_flomin::flo_min.aqu | change = absval 
       'SMET_revapmin::revap_min.aqu | change = absval | unit = c(113, 119)' = c(0, 10),         # SMET_revapmin::revap_min.aqu | change = absval 
       'SMET_revapco::revap_co.aqu | change = absval | unit =   c(113, 119)' = c(0.02, 0.2),     # SMET_revapco::revap_co.aqu | change = absval 
       'SMET_spyld::sp_yld.aqu | change = absval =| unit =      c(113, 119)' = c(0.00001, 0.05), # SMET_spyld::sp_yld.aqu | change = absval
       
       'CRB_esc::esco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.001 , 0.90),        # CRB_esc::esco.hru | change = absval           
       'CRB_epc::epco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.001 , 0.999),       # CRB_epc::epco.hru | change = absval   
       'CRB_cnn::cn2.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-15  ,   0),          # CRB_cnn::cn2.hru | change = pctchg           
       'CRB_awc::awc.sol | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-25 , 20),            # CRB_awc::awc.sol | change = pctchg       
       'CRB_per::perco.hru | change = absval | unit =        c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.925 , 0.975),       # CRB_per::perco.hru | change = absval
       'CRB_latq::latq_co.hru | change = abschg | unit =     c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-0.3, 0.1),           # CRB_latq::latq_co.hru | change = abschg    
       'CRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-0.05, 0.3),          # CRB_cn3::cn3_swf.hru | change = abschg         
       'CRB_zso::z.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-25 , 10),            # CRB_zso::z.sol | change = pctchg       
       'CRB_kso::k.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-79.999 , 100),       # CRB_kso::k.sol | change = pctchg        
       'CRB_bd::bd.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-20 , -5),            # CRB_bd::bd.sol | change = pctchg      
       'CRB_ovn::ovn.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-20, 20),             # CRB_ovn::ovn.hru | change = pctchg
       'CRB_lattime::lat_ttime.hru | change = absval| unit = c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.5, 50),             # CRB_lattime::lat_ttime.hru | change = absval
       
       'CRB_alpha::alpha.aqu | change = absval = | unit =      c(8,25,30,38,41,43,54,56,62)' = c(0.001, 0.02), # CRB_alpha::alpha.aqu | change = absval
       'CRB_flomin::flo_min.aqu | change = absval | unit =     c(8,25,30,38,41,43,54,56,62)' = c(10, 20),      # CRB_flomin::flo_min.aqu | change = absval 
       'CRB_revapmin::revap_min.aqu | change = absval | unit = c(8,25,30,38,41,43,54,56,62)' = c(0, 10),       # CRB_revapmin::revap_min.aqu | change = absval 
       'CRB_revapco::revap_co.aqu | change = absval | unit =   c(8,25,30,38,41,43,54,56,62)' = c(0.02, 0.2),   # CRB_revapco::revap_co.aqu | change = absval 
       'CRB_spyld::sp_yld.aqu | change = absval =| unit =      c(8,25,30,38,41,43,54,56,62)' = c(0.01, 0.35),  # CRB_spyld::sp_yld.aqu | change = absval
       
       
       'SCRB_esc::esco.hru | change = absval | unit =         c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.60 , 0.999),        # SCRB_esc::esco.hru | change = absval           
       'SCRB_epc::epco.hru | change = absval | unit =         c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.001 , 0.999),       # SCRB_epc::epco.hru | change = absval   
       'SCRB_cnn::cn2.hru | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20  ,   0),          # SCRB_cnn::cn2.hru | change = pctchg           
       'SCRB_awc::awc.sol | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(10 , 40),             # SCRB_awc::awc.sol | change = pctchg       
       'SCRB_per::perco.hru | change = absval | unit =        c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.88 , 0.95),         # SCRB_per::perco.hru | change = absval
       'SCRB_latq::latq_co.hru | change = abschg | unit =     c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-0.3, 0.3),           # SCRB_latq::latq_co.hru | change = abschg    
       'SCRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-0.2, 0.3),           # SCRB_cn3::cn3_swf.hru | change = abschg         
       'SCRB_zso::z.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0 , 40),              # SCRB_zso::z.sol | change = pctchg       
       'SCRB_kso::k.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-79.999 , 100),       # SCRB_kso::k.sol | change = pctchg        
       'SCRB_bd::bd.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20 , -5),            # SCRB_bd::bd.sol | change = pctchg      
       'SCRB_ovn::ovn.hru | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20, 20),             # SCRB_ovn::ovn.hru | change = pctchg
       'SCRB_lattime::lat_ttime.hru | change = absval| unit = c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.5, 20),             # SCRB_lattime::lat_ttime.hru | change = absval
       
       'SCRB_alpha::alpha.aqu | change = absval = | unit =      c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.001, 0.01), # SCRB_alpha::alpha.aqu | change = absval
       'SCRB_flomin::flo_min.aqu | change = absval | unit =     c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(8, 20),       # SCRB_flomin::flo_min.aqu | change = absval 
       'SCRB_revapmin::revap_min.aqu | change = absval | unit = c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0, 10),       # SCRB_revapmin::revap_min.aqu | change = absval 
       'SCRB_revapco::revap_co.aqu | change = absval | unit =   c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.02, 0.2),   # SCRB_revapco::revap_co.aqu | change = absval 
       'SCRB_spyld::sp_yld.aqu | change = absval =| unit =      c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.01, 0.35),  # SCRB_spyld::sp_yld.aqu | change = absval
       
       
       'S2CRB_esc::esco.hru | change = absval | unit =         c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.200 , 0.90),        # S2CRB_esc::esco.hru | change = absval           
       'S2CRB_epc::epco.hru | change = absval | unit =         c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.001 , 0.999),       # S2CRB_epc::epco.hru | change = absval   
       'S2CRB_cnn::cn2.hru | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20  ,   0),          # S2CRB_cnn::cn2.hru | change = pctchg           
       'S2CRB_awc::awc.sol | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-30 , -10),           # S2CRB_awc::awc.sol | change = pctchg       
       'S2CRB_per::perco.hru | change = absval | unit =        c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.925 , 0.99),        # S2CRB_per::perco.hru | change = absval
       'S2CRB_latq::latq_co.hru | change = abschg | unit =     c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.3, 0.3),           # S2CRB_latq::latq_co.hru | change = abschg    
       'S2CRB_cn3::cn3_swf.hru | change = abschg | unit =      c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.2, 0.3),           # S2CRB_cn3::cn3_swf.hru | change = abschg         
       'S2CRB_zso::z.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-30 , -10),           # S2CRB_zso::z.sol | change = pctchg       
       'S2CRB_kso::k.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0 , 150),             # S2CRB_kso::k.sol | change = pctchg        
       'S2CRB_bd::bd.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20 , -5),            # S2CRB_bd::bd.sol | change = pctchg      
       'S2CRB_ovn::ovn.hru | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20, 20),             # S2CRB_ovn::ovn.hru | change = pctchg
       'S2CRB_lattime::lat_ttime.hru | change = absval| unit = c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.5, 20),             # S2CRB_lattime::lat_ttime.hru | change = absval
       
       'S2CRB_alpha::alpha.aqu | change = absval = | unit =      c(104, 120)' = c(0.001, 0.01), # S2CRB_alpha::alpha.aqu | change = absval
       'S2CRB_flomin::flo_min.aqu | change = absval | unit =     c(104, 120)' = c(8, 20),       # S2CRB_flomin::flo_min.aqu | change = absval 
       'S2CRB_revapmin::revap_min.aqu | change = absval | unit = c(104, 120)' = c(0, 10),       # S2CRB_revapmin::revap_min.aqu | change = absval 
       'S2CRB_revapco::revap_co.aqu | change = absval | unit =   c(104, 120)' = c(0.02, 0.2),   # S2CRB_revapco::revap_co.aqu | change = absval 
       'S2CRB_spyld::sp_yld.aqu | change = absval =| unit =      c(104, 120)' = c(0.01, 0.35),  # SCRB_spyld::sp_yld.aqu | change = absval
       
       
       'DTH_esc::esco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.60 , 0.999),      # DTH_esc::esco.hru | change = absval                         
       'DTH_epc::epco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.001 , 0.999),     # DTH_epc::epco.hru | change = absval     
       'DTH_cnn::cn2.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-25  ,  -10),       # DTH_cnn::cn2.hru | change = pctchg             
       'DTH_awc::awc.sol | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(20 , 40),           # DTH_awc::awc.sol | change = pctchg         
       'DTH_per::perco.hru | change = absval | unit =        c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.8 , 0.925),       # DTH_per::perco.hru | change = absval  
       'DTH_latq::latq_co.hru | change = abschg | unit =     c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.15, 0.2),        # DTH_latq::latq_co.hru | change = abschg      
       'DTH_cn3::cn3_swf.hru | change = abschg | unit =      c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.05, 0.25),       # DTH_cn3::cn3_swf.hru | change = abschg           
       'DTH_zso::z.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(10, 30),            # DTH_zso::z.sol | change = pctchg         
       'DTH_kso::k.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-60 , 30),          # DTH_kso::k.sol | change = pctchg          
       'DTH_bd::bd.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-25 , -15),         # DTH_bd::bd.sol | change = pctchg        
       'DTH_ovn::ovn.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-20, 20),           # DTH_ovn::ovn.hru | change = pctchg
       'DTH_lattime::lat_ttime.hru | change = absval| unit = c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.5, 15),           # DTH_lattime::lat_ttime.hru | change = absval
       
       'DTH_alpha::alpha.aqu | change = absval = | unit =      c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.001, 0.03),  # DTH_alpha::alpha.aqu | change = absval
       'DTH_flomin::flo_min.aqu | change = absval | unit =     c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(10, 20),        # DTH_flomin::flo_min.aqu | change = absval 
       'DTH_revapmin::revap_min.aqu | change = absval | unit = c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0, 12),        # DTH_revapmin::revap_min.aqu | change = absval 
       'DTH_revapco::revap_co.aqu | change = absval | unit =   c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.02, 0.2),    # DTH_revapco::revap_co.aqu | change = absval 
       'DTH_spyld::sp_yld.aqu | change = absval =| unit =      c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.1, 0.35),    # DTH_spyld::sp_yld.aqu | change = absval
       
       
       'DTL_esc::esco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.6 , 0.999),      # DTL_esc::esco.hru | change = absval       
       'DTL_epc::epco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.001 , 0.999),    # DTL_epc::epco.hru | change = absval  
       'DTL_cnn::cn2.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999  ,  -10),  # DTL_cnn::cn2.hru | change = pctchg       
       'DTL_awc::awc.sol | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(20 , 59.999),      # DTL_awc::awc.sol | change = pctchg    
       'DTL_per::perco.hru | change = absval | unit =        c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.4 , 0.7),        # DTL_per::perco.hru | change = absval
       'DTL_latq::latq_co.hru | change = abschg | unit =     c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_latq::latq_co.hru | change = abschg    
       'DTL_cn3::cn3_swf.hru | change = abschg | unit =      c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_cn3::cn3_swf.hru | change = abschg        
       'DTL_zso::z.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(30 , 49.999),      # DTL_zso::z.sol | change = pctchg 
       'DTL_kso::k.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-79.999 , 50),     # DTL_kso::k.sol | change = pctchg 
       'DTL_bd::bd.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999 , -10),    # DTL_bd::bd.sol | change = pctchg 
       'DTL_ovn::ovn.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-20, 20),          # DTH_ovn::ovn.hru | change = pctchg
       'DTL_lattime::lat_ttime.hru | change = absval| unit = c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.5, 80),          # DTH_lattime::lat_ttime.hru | change = absval
       
       'DTL_alpha::alpha.aqu | change = absval = | unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.001, 0.04),   # DTL_alpha::alpha.aqu | change = absval
       'DTL_flomin::flo_min.aqu | change = absval | unit =     c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(5, 20),         # DTL_flomin::flo_min.aqu | change = absval 
       'DTL_revapmin::revap_min.aqu | change = absval | unit = c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0, 10),         # DTL_revapmin::revap_min.aqu | change = absval 
       'DTL_revapco::revap_co.aqu | change = absval | unit =   c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.02, 0.2),     # DTL_revapco::revap_co.aqu | change = absval 
       'DTL_spyld::sp_yld.aqu | change = absval =| unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.00001, 0.3))  # DTL_spyld::sp_yld.aqu | change = absval
     
     
     
     # Proving that all HRUs and Aquifers are being parameterized
     
     IMP_hrus <- c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)
     SIMP_hrus <- c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)
     MET_hrus <- c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)
     SMET_hrus <- c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)
     CRB_hrus <- c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)
     SCRB_hrus <- c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)
     S2CRB_hrus <- c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)
     DTH_hrus <- c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)
     DTL_hrus <- c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)
     length(IMP_hrus)+length(SIMP_hrus)+length(MET_hrus)+length(SMET_hrus)+length(CRB_hrus)+length(SCRB_hrus)+length(S2CRB_hrus)+length(DTH_hrus)+length(DTL_hrus) # 22089 ok
     
     IMP_aqus <- c(24,33,37,42,45,47,48,57,60,61,63,68,69)
     SIMP_aqus <- c(107,109,110,114,117,118)
     MET_aqus <- c(1,2,3,5,7,9,11,108,122)
     SMET_aqus <- c(113, 119)
     CRB_aqus <- c(8,25,30,38,41,43,54,56,62)
     SCRB_aqus <- c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)
     S2CRB_aqus <- c(104, 120)
     DTH_aqus <- c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)
     DTL_aqus <- c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)
     
     length(IMP_aqus)+length(SIMP_aqus)+length(MET_aqus)+length(SMET_aqus)+length(CRB_aqus)+length(SCRB_aqus)+length(S2CRB_aqus)+length(DTH_aqus)+length(DTL_aqus) # 126 ok
     
    
     # Number of Simulations
     n_sample <- 1000
     #Numer of parameters
     n_par <- ncol(hc_par_bound_zonal_3)
     
     #Random sampling with Latin Hypercube
     par_zonal_tag <- randomLHS(n = n_sample, k = n_par) %>% # Perform sampling
       as_tibble(., .name_repair = 'minimal') %>% # Convert to a tibble
       set_names(names(hc_par_bound_zonal_2)) %>% # Assign the parameter names with purrr
       map2_df(., hc_par_bound_zonal_2, ~ (.x * (.y[2] - .y[1]) + .y[1]))
     
     
     ######## Run simulations ######## 
     
     sim_tagus_hcr3 <-  run_swatplus(project_path = tagus_path,
                                     output = list(
                                       ls_pcp   = define_output(file = 'lsunit_wb_yr', 
                                                                variable = 'precip', 
                                                                unit = 1:1450),
                                       # ls_et    = define_output(file = 'lsunit_wb_yr', 
                                       #                          variable = 'et', 
                                       #                          unit = used_lsus),
                                       ls_surq_gen   = define_output(file = 'lsunit_wb_yr',   # SURQ_CHA + SURQ_RES = SURQ_GEN - SURQ_LS
                                                                     variable = 'surq_gen', 
                                                                     unit = 1:1450),
                                       ls_surq_ls   = define_output(file = 'lsunit_wb_yr', 
                                                                    variable = 'surq_ls', 
                                                                    unit  = 1:1450),
                                       # ls_latqgen   = define_output(file = 'lsunit_wb_yr',  # LATQGEN - LATQLS = LATQ_CHA + LATQ_GEN
                                       #                              variable = 'latq', 
                                       #                              unit = used_lsus),
                                       # ls_latqls   = define_output(file = 'lsunit_wb_yr', 
                                       #                             variable = 'latq_ls', 
                                       #                             unit = used_lsus),
                                       ls_latqcha   = define_output(file = 'lsunit_wb_yr',  # LATQ = LATQCHA + LATQRES
                                                                    variable = 'latq_cha', 
                                                                    unit = 1:1450),
                                       ls_latqres   = define_output(file = 'lsunit_wb_yr', 
                                                                    variable = 'latq_res', 
                                                                    unit = 1:1450),
                                       #  ls_perc   = define_output(file = 'lsunit_wb_yr', 
                                       #                            variable = 'perc', 
                                       #                            unit = used_lsus),
                                       #  basin_pcp = define_output(file = 'basin_wb_yr',
                                       #                            variable = "precip",
                                       #                            unit = 1), 
                                       #  basin_et = define_output(file = 'basin_wb_yr',
                                       #                           variable = 'et',
                                       #                           unit = 1), 
                                       #  basin_perco = define_output(file = 'basin_wb_yr',
                                       #                              variable = 'perc',
                                       #                              unit = 1),
                                       #  basin_surqgen = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'surq_gen',
                                       #                                unit = 1),
                                       #  basin_surqls = define_output(file = 'basin_wb_yr',
                                       #                               variable = 'surq_ls',
                                       #                               unit = 1),
                                       #  basin_surqcha = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'surq_cha',
                                       #                                unit = 1),
                                       #  basin_surqres = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'surq_res',
                                       #                                unit = 1),
                                       #  basin_latqcha = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'latq_cha',
                                       #                                unit = 1),
                                       #  basin_latqqres = define_output(file = 'basin_wb_yr',
                                       #                                 variable = 'latq_res',
                                       #                                 unit = 1),
                                       #  basin_perco = define_output(file = 'basin_wb_yr',
                                       #                              variable = 'perc',
                                       #                              unit = 1),
                                       #  basin_gwflo = define_output(file = 'basin_aqu_yr',
                                       #                              variable = 'flo',
                                       #                              unit = 1),
                                       aqu_gwflocha = define_output(file = 'aquifer_yr',
                                                                    variable = 'flo_cha',
                                                                    unit = 1:126),
                                       aqu_gwres = define_output(file = 'aquifer_yr',
                                                                 variable = 'flo_res',
                                                                 unit =    1:126),
                                       #  aqu_gwtot = define_output(file = 'aquifer_yr',
                                       #                            variable = 'flo',
                                       #                            unit = used_quifers),
                                       # aqu_stor = define_output(file = 'aquifer_yr',
                                       #                          variable = 'stor',
                                       #                          unit = 1:126),
                                       # aqu_rchrg = define_output(file = 'aquifer_yr',
                                       #                           variable = 'rchrg',
                                       #                           unit = 1:126),
                                       # res_in = define_output(file = 'reservoir_yr',          #For round 3
                                       #                        variable = 'flo_in',      #For round 3        
                                       #                        unit = 1:31),             #For round 3 
                                       # res_stor = define_output(file = 'reservoir_yr',        #For round 3      
                                       #                          variable = 'flo_stor',    #For round 3          
                                       #                          unit = 1:31),             #For round 3 
                                       # res_out = define_output(file = 'reservoir_yr',         #For round 3     
                                       #                         variable = 'flo_out',     #For round 3         
                                       #                         unit = 1:31),             #For round 3             
                                       flow_cha = define_output(file = "channel_sd_day", 
                                                                variable = "flo_out",
                                                                unit = c(561, 750, 11, 1218, 567, 825, 564, 630, 532, 962,
                                                                         990, 541, 950, 149, 376, 535, 537, 1141, 1161, 14,
                                                                         947, 184, 525, 573, 208, 111, 949, 581, 452))),#, 444,
                                     #155, 185, 504, 161, 459, 929, 133, 176, 483, 911, 882 ,1076))), #For round 3
                                     parameter = par_zonal_tag,
                                     start_date = 20050101,
                                     end_date = 20141231,
                                     start_date_print = 20100101,
                                     n_thread = 60)
     
     
     
     ##### ROUND 3 RESULTS EXTRACTION #####
     
     
     ######## File with observed data creation ######## 
     
     # Basins data file
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     gauging_codes <- basins_file$indroea
     
     
     ######## File with simulated data creation: Streamflow ######## 
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     # Some of the gauging stations collect the water from more than one channel and therefore the streamflow has been recalculated 
     # Others only drains part of the subbasin, and has been therefore corrected by the drainaged fraction
     
     chanels <- read_rds("Data/Simulations/Round_3/Round_3_HC_Tagus.rds") # Simulated data
     
     
     navaluenga <- tibble(date = chanels$simulation$flow_cha_561$date, chanels$simulation$flow_cha_561[,-1]+ chanels$simulation$flow_cha_750[,-1] )
     
     matallana <-  chanels$simulation$flow_cha_11
     
     villarejo <-  chanels$simulation$flow_cha_1218
     
     peralejo <- tibble(date = chanels$simulation$flow_cha_567$date, chanels$simulation$flow_cha_567[,-1]+ chanels$simulation$flow_cha_825[,-1] )
     
     priego_escabas <- tibble(date = chanels$simulation$flow_cha_564$date, chanels$simulation$flow_cha_564[,-1] * (1/1.05)) #  The gauging station it is not at the end of the channel
     
     santa_maria_val <- chanels$simulation$flow_cha_630
     
     javalera <- tibble(date = chanels$simulation$flow_cha_532$date, chanels$simulation$flow_cha_532[,-1]*(1/1.4)) # The gauging station it is not at the end of the channel
     
     huete <- tibble(date = chanels$simulation$flow_cha_962$date, chanels$simulation$flow_cha_962[,-1]+ chanels$simulation$flow_cha_990[,-1] )
     
     torote <- chanels$simulation$flow_cha_541
     
     puebla_nueva <-  chanels$simulation$flow_cha_950
     
     ventosa <- tibble(date = chanels$simulation$flow_cha_149$date, chanels$simulation$flow_cha_149[,-1]+ chanels$simulation$flow_cha_376[,-1] )
     
     peraleja <- tibble(date = chanels$simulation$flow_cha_535$date, chanels$simulation$flow_cha_535[,-1]+ chanels$simulation$flow_cha_537[,-1] )
     
     villasequilla <- tibble(date = chanels$simulation$flow_cha_1141$date, chanels$simulation$flow_cha_1141[,-1]+ chanels$simulation$flow_cha_1161[,-1] ) # The gauging station it is not at the end of the channel
     
     valverde <- tibble(date = chanels$simulation$flow_cha_14$date, chanels$simulation$flow_cha_14[,-1]*(1/1.05))
     
     malpica <- chanels$simulation$flow_cha_947
     
     taravillas <- tibble(date = chanels$simulation$flow_cha_184$date, chanels$simulation$flow_cha_184[,-1]*(1/1.13))
     
     romanones <- chanels$simulation$flow_cha_525
     
     priego_trabraque <- tibble(date = chanels$simulation$flow_cha_573$date, chanels$simulation$flow_cha_573[,-1]*(1/1.05) ) # The gauging station it is not at the end of the channel
     
     aragosa <- tibble(date = chanels$simulation$flow_cha_208$date, chanels$simulation$flow_cha_208[,-1]*(1/1.24) ) # The gauging station it is not at the end of the channel
     
     trillo <- chanels$simulation$flow_cha_111
     
     valdecaba <- chanels$simulation$flow_cha_949
     
     villamantilla <- chanels$simulation$flow_cha_581
     
     
     # A list is created and saved for each subbasin
     sim_cha_list <- list(navaluenga, matallana, villarejo, peralejo, priego_escabas, santa_maria_val, javalera, huete, torote, puebla_nueva,
                          ventosa, peraleja, villasequilla, valverde, malpica, taravillas, romanones,  priego_trabraque, aragosa, trillo,  valdecaba, villamantilla) 
     
     names(sim_cha_list) <- subbasins_names
     
     write_rds(sim_cha_list, "Data/Simulations/Round_3/round_3_simulated_list.rds")
     
     
     ######## File with simulated data creation: Hydrological variables annual values ######### 
     
     sim_tagus_hcr3_wb <- read_rds("Data/Simulations/Round_3/Round_3_HC_Tagus.rds") # Simulated data
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     lsus_subbasins_shp <- read_sf("Data/GIS/hardcal_shapes/studied_lsus/lsus_prop_final.shp") # LSUS per regions and per subbasins 
     studied_subb <- read_sf("Data/GIS/hardcal_shapes/subbasins/hardcal_natural_basins.shp") # Subbasins analysed
     
     ########  Run to extract variables ########  
     # LSUS data extraction and aggregation
     
     lsus_studied <- lsus_subbasins_shp %>%  st_drop_geometry()
     
     # List extraction: Precipitation
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_pcp_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_pcp <- sim_tagus_hcr3_wb$simulation[grepl("ls_pcp", names(sim_tagus_hcr3_wb$simulation))] #%>% .[lsus_data$namelist]
     
     # Calculating the average pcp for each subbasin in mm
     
     basin_pcps <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       lsus_area_sum <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_area_m")] %>% 
         sum(.)
       
       lsus_basin <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_id_rea", "area_frac")]
       
       basin_lsus_pcp <- lsus_pcp[lsus_basin$lsu_id_rea]
       
       av_pcps <- c(1:1000)
       
       for(f in 1:length(basin_lsus_pcp)){
         
         av_pcp <- basin_lsus_pcp[[f]][,-1] %>% apply(., 2, mean) %>% data.frame(pcp_mm = .) %>% mutate(pcp_mm = pcp_mm* lsus_basin$area_frac[f]) # Calculate the mm generated in each lsu taking into account the entire basin area
         
         av_pcps <- av_pcps %>% cbind(av_pcp) 
         
       }
       
       av_lsu_pcps <- tibble(av_pcp_mm = av_pcps[,-1] ) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_pcp <- av_lsu_pcps %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_pcp <- basin_pcp %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_pcp_mm)
       
       basin_pcps[[i]] = basin_pcp # List with the pcp for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_pcp = paste("pcp_basin", Basin_ID, sep = ""))
     names(basin_pcps) <- namms$names_pcp
     
     
     
     # List extraction: Surface runoff (SURQ = SURQ_GEN - SURQ_LS)
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_gen_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqgen <- sim_tagus_hcr3_wb$simulation[grepl("ls_surq_gen", names(sim_tagus_hcr3_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_ls_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqls <- sim_tagus_hcr3_wb$simulation[grepl("ls_surq_ls", names(sim_tagus_hcr3_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     # Calculating the total surq in mm for each lsu considering their relative area regarding the subbasin
     lsu_surqtot <- list()
     for(i in 1:length(lsus_surqgen)){
       
       lsu_surqtot[[i]] <- ((lsus_surqgen[[i]][,-1] - lsus_surqls[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_surqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_surq_basin", lsus_data$Basin_ID, sep = "")
     
     # Calculating the total surq for each subbasin in mm
     
     basin_surqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_surqtot))
       
       selected_lsus <- lsu_surqtot[bas_select]
       
       av_surqs <- c(1:1000)
       
       for(f in 1:length(selected_lsus)){
         
         av_surq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_surqs <- av_surqs %>% cbind(av_surq) 
         
       }
       
       av_surqs <- tibble(av_surq_mm = av_surqs[,-1]) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_surq <- av_surqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_surq <- basin_surq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_surq_mm)
       
       
       basin_surqs[[i]] = basin_surq # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_surqtot = paste("total_surq_basin", Basin_ID, sep = ""))
     names(basin_surqs) <- namms$names_surqtot
     
     
     # List extraction: Lateral flow (LATQ = LATQ_CHA + LATQ_RES)
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqcha_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqcha <- sim_tagus_hcr3_wb$simulation[grepl("ls_latqcha", names(sim_tagus_hcr3_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqres_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqres <- sim_tagus_hcr3_wb$simulation[grepl("ls_latqres", names(sim_tagus_hcr3_wb$simulation))] %>% .[lsus_data$namelist]
     
     # Calculating the total latq in mm for each lsu considering their relative area regarding the subbasin
     lsu_latqtot <- list()
     for(i in 1:length(lsus_latqcha)){
       
       lsu_latqtot[[i]] <- ((lsus_latqcha[[i]][,-1] + lsus_latqres[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_latqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_latq_basin", lsus_data$Basin_ID, sep = "")
     
     # Calculating the total latqq for each subbasin in mm
     
     basin_latqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_latqtot))
       
       selected_lsus <- lsu_latqtot[bas_select]
       
       av_latqs <- c(1:1000)
       
       for(f in 1:length(selected_lsus)){
         
         av_latq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_latqs <- av_latqs %>% cbind(av_latq) 
         
       }
       
       av_latqs <- tibble(av_latq_mm = av_latqs[,-1]) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_latq <- av_latqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_latq <- basin_latq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_latq_mm)
       
       
       basin_latqs[[i]] = basin_latq # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_latqtot = paste("total_latq_basin", Basin_ID, sep = ""))
     names(basin_latqs) <- namms$names_latqtot
     
     
     
     # Aquifers data: Calculated using flo + flo_res. For some aquifers, the relative drainage area to the gauginG stations has been used 
     # (aquif_data$fact_corr, previously calculated with QGIS)
     
     aquifers_studied <- read_sf("Data/GIS/hardcal_shapes/studied_aquifers/aquifers_selected.shp") %>% arrange(., Basin_ID)
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     
     # List extraction: GWFLO_CHA and GWFLO_RES
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwflocha_", Aq_id , sep = ""))
     aquifers_flocha <- sim_tagus_hcr3_wb$simulation[grepl("aqu_gwflocha", names(sim_tagus_hcr3_wb$simulation))] %>% .[aquif_data$namelist]
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwres_", Aq_id , sep = ""))
     aquifers_flores <- sim_tagus_hcr3_wb$simulation[grepl("aqu_gwres", names(sim_tagus_hcr3_wb$simulation))] %>% .[aquif_data$namelist]
     
     
     # Calculating the total gwflo in liters for each aquifer
     aquif_flo_tot_litres <- list()
     for(i in 1:length(aquifers_flocha)){
       
       aquif_flo_tot_litres[[i]] <- ((aquifers_flocha[[i]][,-1] + aquifers_flores[[i]][,-1]) * ( aquif_data$Area_km[i] * 1000000 * aquif_data$fact_corr[i])) %>% tibble(.)
       
     }
     
     names(aquif_flo_tot_litres) <- paste("aqu_", aquif_data$Aq_id, "totalflo_lit_basin", aquif_data$Basin_ID, sep = "")
     
     
     # Calculating the total flo for each subbasin in mm
     
     basin_gwflos <- list()
     for(i in 1:length(unique(aquif_data$Basin_ID))){
       
       aquifers_area_sum <- aquif_data %>% 
         filter(Basin_ID == unique(aquif_data$Basin_ID)[i]) %>% .[,c("fact_corr","Area_km")] %>% 
         mutate(real_area = fact_corr * Area_km) %>% .[, "real_area" ] %>% 
         sum(.)*1e6
       
       bas_select <- paste("basin",unique(aquif_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(aquif_flo_tot_litres))
       
       selected_aqus <- aquif_flo_tot_litres[bas_select]
       
       av_gwflos <- c(1:1000)
       
       for(f in 1:length(selected_aqus)){
         
         av_gwflo <- selected_aqus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_gwflos <- av_gwflos %>% cbind(av_gwflo) 
         
       }
       
       av_gwflos <- tibble(av_gwflo_mm = av_gwflos[,-1] / aquifers_area_sum) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_gwflo <- av_gwflos %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_gwflo <- basin_gwflo %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_gwflo_mm)
       
       basin_gwflos[[i]] = basin_gwflo # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_gwtot = paste("total_gwflo_basin", Basin_ID, sep = ""))
     names(basin_gwflos) <- namms$names_gwtot
     
     # Creating a table with all the extracted data
     subb_tables <- list()
     for(i in 1:length(basin_gwflos)){
       pcp <- tibble(basin_pcps[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "pcp")
       latq <- tibble(basin_latqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "latq")
       surq <- tibble(basin_surqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "surq")
       gwflo <- tibble(basin_gwflos[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "gwflo")
       
       subb_table <- pcp %>%  left_join(., latq, "name")%>%  left_join(., surq, "name")%>%  left_join(., gwflo, "name") %>% 
         mutate(water_yield = latq + surq + gwflo) %>% 
         mutate(runoff_coeff = water_yield / pcp,
                gw_cont = gwflo / water_yield) %>% 
         mutate(Basin = basins_file$Basin[i],
                Basin_ID = basins_file$Basin_ID[i], 
                region = basins_file$region[i]) %>% 
         rename(run = name) %>% 
         .[,c("Basin_ID", "Basin", "region", "run",  "pcp",  "water_yield", "latq", "surq", "gwflo",  "runoff_coeff", "gw_cont" )]
       
       subb_tables[[i]] <- subb_table
       
     }
     
     namms <- paste("tab", basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     names(subb_tables) <- namms
     
     # write_rds(subb_tables, "Data/Results/R3/HC_Round1_basinswb.rds")
     
     table_all <- c()
     for(m in 1:length(subb_tables)){
       
       tab <- subb_tables[[m]]
       table_all <- table_all %>% rbind(., tab)
     }
     
     ######## Run to save variables ######## 
     write_csv(table_all, "Data/Results/R3/HC_Round3_basinswb.csv", quote = "none")
     
     ######## Calculate streamflow simulation performance ######## 
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     observed_streamflow <- read_rds("Data/Simulations/list_observed_data.rds")
     simulated_streamflow  <- read_rds("Data/Simulations/Round_3/round_3_simulated_list.rds") # Simulated data (previously saved)
     
     evaluated_period <- c(2010:2014)
     number_simulations <- c(1000)
     
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2  # Function to calculate R3
     
     
     streamflow_metrics <- c()
     streamflo_metrics_list <- list()
     
     for(i in 1:length(observed_streamflow)){
       
       obs <- observed_streamflow[[i]] %>% mutate(fecha = ymd(fecha)) %>% 
         filter(year(fecha) %in% evaluated_period)
       
       sim <- simulated_streamflow[[i]]%>% mutate(date = ymd(date)) %>% 
         filter(., date %in% ymd(min(obs$fecha)):ymd(max(obs$fecha))) # Days without observed data does not compute
       
       nses <-  sim %>% select(-date) %>% 
         map_dbl(., ~NSE( .x, obs$caudal))
       r2s <-  sim %>% select(-date) %>% 
         map_dbl(., ~rsq_r2( .x, obs$caudal))
       pbias <-  sim %>% select(-date) %>% 
         map_dbl(., ~pbias( .x, obs$caudal))
       rmses <-  sim %>% select(-date) %>% 
         map_dbl(., ~rmse( .x, obs$caudal))
       
       tab <-  tibble(Subbasin_ID = basins_file$Basin_ID[i], Subbasin = basins_file$Basin[i] , 
                      region = basins_file$region[i], nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = c(1:number_simulations))
       
       streamflow_metrics <- streamflow_metrics %>% rbind(., tab)
       streamflo_metrics_list[[i]] <- tab
     }
     
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     names(streamflo_metrics_list) <- subbasins_names
     
     
     write.csv(streamflow_metrics, "Data/Results/R3/HC_Round3_streamflow_metrics_allchanel.csv", row.names = F, quote = F)
     # write_rds(streamflo_metrics_list, "Data/Results/R3/HC_Round3_streamflow_metrics_allchanel.rds")
     
     ######## Combine results and create plots for parameters constrain  ########  
     
     # Merge results in one table
     
     streamflow_metrics <- read_csv("Data/Results/R3/HC_Round3_streamflow_metrics_allchanel.csv")
     
     waterbalances <- read_csv("Data/Results/R3/HC_Round3_basinswb.csv") %>% 
       select(Basin_ID, run, runoff_coeff, gw_cont) %>%  mutate(run = as.numeric(str_remove(run, "run_")))
     
     table_constrain <-  streamflow_metrics %>% left_join(., waterbalances, c("Subbasin_ID" = "Basin_ID", "run")) %>% 
       .[,c( "Subbasin_ID",    "Subbasin", "region", "run", "nse","r2","pbias", "rmse", "runoff_coeff", "gw_cont")]
     
     # Extract parameter sets    
     
     parameters_data <- read_rds("Data/Simulations/Round_3/round_3_HC_Tagus.rds") %>% .[1]
     par_values <- parameters_data$parameter$values
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     subbasins <- basins_file$Basin
     region <- basins_file$region
     
     
     ######## Plots creation ######## 
     
     # Plot 1: Distribution of variables for each subbasin
     
     viol_plots <- list()
     
     for(i in 1:length(basins_file$Basin_ID)){
       
       tabb_metrics <- table_constrain %>% filter(Subbasin_ID == basins_file$Basin_ID[i]) %>% 
         rename("NSE" = "nse", "R" = "r2", "PBIAS" = "pbias", RMSE = "rmse", "Runoff coefficient" = "runoff_coeff" , "Goundwater contribution" = "gw_cont")
       
       viol_plot <- tabb_metrics %>% 
         pivot_longer(., -c("Subbasin_ID",  "Subbasin", "region", "run", "round")) %>% 
         mutate(name = factor(name, levels = c("NSE", "R", "PBIAS", "RMSE", "Runoff coefficient", "Goundwater contribution"))) %>% 
         ggplot(aes(x = name, y = value, fill = name))+ geom_violin()+
         facet_wrap(facets = "name", scales = "free")+
         theme_bw()+
         theme( strip.text = element_blank(), legend.position = "nuop", text = element_text(size = 18, face = "bold"), axis.title = element_blank())+
         ggtitle(paste("Basin ",basins_file$Basin_ID[i], ": ", basins_file$Basin[i],  " (",basins_file$region[i] , ")", sep = ""))
       
       viol_plots[[i]] <- viol_plot
       
       ggsave(plot = viol_plot, 
              filename = paste("Data/Figures/R3/results_basins/", basins_file$Basin_ID[i], "_", str_replace_all(basins_file$Basin, " ", "_")[i], ".png", sep = ""),
              device = "png", 
              dpi = 300, width = 16, height = 12) 
     }
     
     # Plots 2: Effect of each parameter in the affected subbasins (subbasins with part o a certain lithologhy)
     
     IMP_subbasins <- c(1, 22) 
     SIMP_subbasins <- c(21) 
     MET_subbasins <- c(2, 14, 15)
     SMET_subbasins <- c(3, 10, 15)
     CRB_subbasins <- c(4, 5, 6, 14, 19, 20)
     SCRB_subbasins <- c(11, 16, 17, 20) 
     S2CRB_subbasins <- c(13) 
     DTH_subbasins <- c(5, 7:13,15, 17:20, 22 ) 
     DTL_subbasins <- c(8, 11:14, 17:20 ) 

     
     ## IMP Region
     
     subbasins_values <- list(
       "1" = "Navaluenga (IMP)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_IMP <- par_values %>% select(starts_with("IMP"))#, c(surlag, chn))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(IMP_subbasins, levels = c(1, 22)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_IMP)){
       parameter_name <- colnames(parameters_IMP[i])[1]
       parameter <- tibble(parameter = parameters_IMP[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(1, 22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 2)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/IMP_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     ## SIMP Region
     
     subbasins_values <- list(
       "3" = "Villarejo de Montalban (IMP)",
       "21" = "Valdecaba (IMP)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_SIMP <- par_values %>% select(starts_with("SIMP"))#, c(surlag, chn))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(SIMP_subbasins, levels = c(3, 21)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_SIMP)){
       parameter_name <- colnames(parameters_SIMP[i])[1]
       parameter <- tibble(parameter = parameters_SIMP[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(3, 21)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 2)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/SIMP_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     ## MET Region
     
     subbasins_values <- list(
       "2" = "Matallana (MET)",
       "14" = "Valverde de los Arroyos (MIX)",
       "15" = "Malpica (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_MET <- par_values %>% select(starts_with("MET"))#, c(surlag, chn))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(MET_subbasins, levels = c(2, 14 ,15)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_MET)){
       parameter_name <- colnames(parameters_MET[i])[1]
       parameter <- tibble(parameter = parameters_MET[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(2, 14 ,15)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 3)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/MET_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     ## SMET Region
     
     subbasins_values <- list(
       "3" = "Villarejo de Montalban (IMP)",
       "10" = "La Pueblanueva (MIX)",
       "15" = "Malpica (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_SMET <- par_values %>% select(starts_with("SMET"))#, c(surlag, chn))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(SMET_subbasins, levels = c(3, 10, 15)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_SMET)){
       parameter_name <- colnames(parameters_SMET[i])[1]
       parameter <- tibble(parameter = parameters_SMET[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(3, 10, 15)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 3)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/SMET_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## CRB Region
     
     subbasins_values <- list(
       "4"     =   "Peralejo de las Truchas (CRB)",
       "5"     =            "Priego Escabas (CRB)",
       "6"     =       "Santa Maria del Val (CRB)",
       "14"     =   "Valverde de los Arroyos (MIX)", 
       "19"     =                   "Aragosa (MIX)", 
       "20"     =                    "Trillo (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     
     
     parameters_CRB <- par_values %>% select(starts_with("CRB") )#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(CRB_subbasins, levels = c(4, 5, 6, 14, 19, 20)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     
     for(i in 1:length(parameters_CRB)){
       parameter_name <- colnames(parameters_CRB[i])[1]
       parameter <- tibble(parameter = parameters_CRB[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(4, 5, 6, 14, 19, 20)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 3)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/CRB_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## SCRB Region
     
     subbasins_values <- list(
       "11"     =                   "Ventosa (DTL)", 
       "16"     =                "Taravillas (MIX)", 
       "17"     =                 "Romanones (MIX)", 
       "20"     =                    "Trillo (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     
     
     parameters_SCRB <- par_values %>% select(starts_with("SCRB") )#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(SCRB_subbasins, levels = c(11, 16, 17, 20)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     
     for(i in 1:length(parameters_SCRB)){
       parameter_name <- colnames(parameters_SCRB[i])[1]
       parameter <- tibble(parameter = parameters_SCRB[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(11, 16, 17, 20)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 2)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/SCRB_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## S2CRB Region
     
     subbasins_values <- list(
       "13"     =    "Villasequilla de Yepes (DTL)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     
     
     parameters_S2CRB <- par_values %>% select(starts_with("S2CRB") )#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(S2CRB_subbasins, levels = c(13)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     
     for(i in 1:length(parameters_S2CRB)){
       parameter_name <- colnames(parameters_S2CRB[i])[1]
       parameter <- tibble(parameter = parameters_S2CRB[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(13)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 1)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/S2CRB_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     ## DTH Region
     
     subbasins_values <- list(
       "5" = "Priego Escabas (CRB)",
       "7" = "Jabalera (DTH)",
       "8" = "Huete (DTH)",
       "9" = "Torote (DTH)",
       "10" = "La Pueblanueva (DTH)",
       "11" = "Ventosa (DTL)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "15" = "Malpica (MIX)",
       "17" = "Romanones (MIX)",
       "18" = "Priego Trabraque (MIX)",
       "19" = "Aragosa (MIX)",
       "20" = "Trillo (MIX)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_DTH <- par_values %>% select(starts_with("DTH"))#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(DTH_subbasins, levels = c(5, 7:13,15, 17:20, 22 )))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_DTH)){
       parameter_name <- colnames(parameters_DTH[i])[1]
       parameter <- tibble(parameter = parameters_DTH[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(5, 7:13,15, 17:20, 22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 5)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/DTH_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## DTL Region
     
     subbasins_values <- list(
       "8" = "Huete (DTH)",
       "11" = "Ventosa (DTL)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "14" = "Valverde de los Arroyos (MIX)",
       "17" = "Romanones (MIX)",
       "18" = "Priego Trabraque (MIX)",
       "19" = "Aragosa (MIX)",
       "20" = "Trillo (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_DTL <- par_values %>% select(starts_with("DTL"))#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(DTL_subbasins, levels = c(8, 11:14, 17:20 )))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_DTL)){
       parameter_name <- colnames(parameters_DTL[i])[1]
       parameter <- tibble(parameter = parameters_DTL[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(8, 11:14, 17:20)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 5)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/DTL_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width =  16 , height =  12, dpi = 300)
       }
     }
     
     # Parameters common to all subbasins
     
     subbasins_values <- list(
       "1" = "Navaluenga (IMP)",
       "2" = "Matallana (MET)",
       "3" = "Villarejo de Montalban (IMP)",
       "4"     =   "Peralejo de las Truchas (CRB)",
       "5" = "Priego Escabas (CRB)",
       "6"     =       "Santa Maria del Val (CRB)",
       "7" = "Jabalera (DTH)",
       "8" = "Huete (DTH)",
       "9" = "Torote (DTH)",
       "10" = "La Pueblanueva (DTH)",
       "11" = "Ventosa (DTL)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "14" = "Valverde de los Arroyos (MIX)",
       "15" = "Malpica (MIX)",
       "16" = "Taravillas (MIX)", 
       "17" = "Romanones (MIX)",
       "18" = "Priego Trabraque (MIX)",
       "19" = "Aragosa (MIX)",
       "20" = "Trillo (MIX)",
       "21" = "Valdecaba (IMP)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_com <- par_values %>% select(surlag, chn)
     metric_values <- table_constrain 
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_com)){
       parameter_name <- colnames(parameters_com[i])[1]
       parameter <- tibble(parameter = parameters_com[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(1:22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 6)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/Common_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width =  16 , height =  12, dpi = 300)
       }
     }
     
     # These plots are analyzed in power point to constrain the parameters and continue with the following Round
     
     
     
     ##### Extract results and generate plots for reservoirs inflow #####     
     
     # Reservoirs data
     
     reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv")
     
     
     # Observed data 
     
     obs_inflow <- read_csv("Data/Reservoirs/Simulation/CHT_obs_inflow_reservoirs.csv")
     
     # Simulated data
     
     simulation <- read_rds("Data/Simulations/Round_3/Round_3_HC_Tagus.rds")
     
     # Parameters
     
     
     
     # Creating and exporting lists with observed-simulated data 
     
     evaluated_period <- c(2010:2019)
     
     
     res_studied <- reservoirs_data %>% mutate(namelist = paste("res_in_", Lake_id , sep = "")) %>% arrange(., Lake_id)
     res_sim_inflow <- simulation$simulation[grepl("res_in_", names(simulation$simulation))] 
     
     
     res_inflows <- list()
     
     for(i in 1: length(res_sim_inflow)){
       
       res_inflow <- res_sim_inflow[[i]]
       
       res_inflow <- tibble(res_inflow[,1], reservoir = paste("lake_", i, sep = ""), res_inflow[,-1]/86400)
       
       res_inflows[[i]] <- res_inflow
       
     }
     names(res_inflows) <- str_replace(unique(names(res_sim_inflow)), "res_in_", "lake_")
     
     write_rds(res_inflows, "Data/Reservoirs/Simulation/Round_3_reservoirs_sim.rds")
     
     
     observed_inflow <- list()
     lakes <- c()
     for(i in 1:length(unique(obs_inflow$Lake_id))){
       
       res_obs_inflow <- obs_inflow %>% 
         filter(Lake_id == unique(obs_inflow$Lake_id)[i],
                year(date) %in% evaluated_period) %>% 
         select(name, Lake_id, date, obsflow_m3s) %>% 
         mutate(Lake_id = paste("lake_", Lake_id, sep = "")) %>% 
         mutate(obsflow_m3s = as.numeric(obsflow_m3s))
       observed_inflow[[i]] <- res_obs_inflow
       lakes <- c(lakes, unique(res_obs_inflow$Lake_id ))
     }
     
     names(observed_inflow) <- lakes
     
     write_rds(observed_inflow, "Data/Reservoirs/Simulation/observed_reservoir_inflow.rds")
     
     
     # Loading saved data
     
     observed_inflow <- read_rds("Data/Reservoirs/Simulation/observed_reservoir_inflow.rds") 
     res_inflows <- read_rds("Data/Reservoirs/Simulation/Round_3_reservoirs_sim.rds")
     
     
     # Calculating performance for reservoirs inflow
     
     # Funtion to calculate coeficient of determination
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2 
     
     
     evaluated_period <- c(2010:2014)
     number_simulations <- 1000
     
     
     streamflow_metrics_res <- c()
     
     for(i in 1:length(observed_inflow)){
       
       lake <- names(observed_inflow[i])
       
       obs <- observed_inflow[[lake]] %>% 
         filter(year(date) %in% evaluated_period) %>% 
         group_by(year(date), month(date)) %>% 
         summarise(obsflow_m3s = mean(obsflow_m3s)) %>% 
         mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
         ungroup(.) %>% 
         select(., date, obsflow_m3s)
       
       sim <- res_inflows[[lake]] %>% 
         filter(., date %in% ymd(min(obs$date)):ymd(max(obs$date))) %>% # Days without observed data does not compute
         group_by(year(date), month(date)) %>% 
         summarise(across(starts_with("run"), mean)) %>% 
         mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
         ungroup(.) %>% 
         select(., -c(`year(date)`, `month(date)`))
       
       nses <-  sim %>% select(-c(date)) %>% 
         map_dbl(., ~NSE( .x, obs$obsflow_m3s))
       r2s <-  sim %>% select(-c(, date)) %>%
         map_dbl(., ~rsq_r2( .x, obs$obsflow_m3s))
       pbias <-  sim %>% select(-c(date)) %>%
         map_dbl(., ~pbias( .x, obs$obsflow_m3s))
       rmses <-  sim %>% select(-c(date)) %>%
         map_dbl(., ~rmse( .x, obs$obsflow_m3s))
       
       tab <-  tibble(reservoir = unique(observed_inflow[[i]][[2]]), 
                      nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = c(1:number_simulations))
       
       streamflow_metrics_res <- streamflow_metrics_res %>% rbind(., tab)
       
     }
     
     write_csv(streamflow_metrics_res, "Data/Reservoirs/Results/reservoir_metrics_R3.csv")
     
     
     reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv") %>%
       mutate(Lake_id = paste("lake_", Lake_id, sep = "")) %>% 
       mutate(region = region_r3)
     
     
     # Metrics plots
     
     streamflow_metrics_res <- read_csv("Data/Reservoirs/Results/reservoir_metrics_R3.csv")
     
     int_reservoirs <- c(2, 6, 10, 11, 12, 15, 16, 17, 19, 21, 26, 28, 31) # Focus on reservoirs with no upstream reservoirs and in PBIAS
     
     streamflow_metrics_res <- streamflow_metrics_res %>% 
       filter(reservoir %in% paste("lake_", int_reservoirs, sep = ""))
     
     for(i in 1:length(unique(streamflow_metrics_res$reservoir))){
       
       resdat <- streamflow_metrics_res %>% 
         filter(reservoir == unique(streamflow_metrics_res$reservoir)[i]) %>% 
         pivot_longer(., -c(reservoir, run), names_to = "metric", values_to = "metric_value") %>% 
         left_join(., reservoirs_data[, c("Nombre", "Lake_id", "region")], c("reservoir" = "Lake_id")) 
       
       perf_plot <- resdat %>% 
         ggplot(., aes(x = reservoir, y = metric_value, fill = metric))+
         geom_violin()+
         facet_wrap(facets = "metric", scales = "free")+
         ggtitle(paste(unique(resdat$reservoir), ", ", unique(resdat$Nombre), " (", unique(resdat$region), ")" ,sep = ""))+
         theme_bw()+
         theme(axis.title = element_blank(), legend.position = "nuop")
       
       ggsave(plot = perf_plot,filename =  paste("Data/Reservoirs/Figures/R3/Reservoir_perf/", 
                                                 unique(resdat$reservoir), ".png", sep = ""),device = "png", dpi = 600, height = 10, width = 10)
       
     }
     
     # Parameters effect plot --> compared with the parameters effects on subbasins
     
     parameters <- simulation$parameter$values
     
     streamflow_metrics_res <- read_csv("Data/Reservoirs/Results/reservoir_metrics_R3.csv")
     
     int_reservoirs <- c(2, 6, 10, 11, 12, 15, 16, 17, 19, 21, 26, 28, 31) # Focus on reservoirs with no upstream reservoirs and in PBIAS
     
     
     streamflow_metrics_res <- streamflow_metrics_res %>% 
       filter(reservoir %in% paste("lake_", int_reservoirs, sep = "")) %>% 
       select(-c(nse, r2 ,  rmse))
     
     for(i in 1:length(unique(streamflow_metrics_res$reservoir))){
       
       resdat <- streamflow_metrics_res %>% 
         filter(reservoir == unique(streamflow_metrics_res$reservoir)[i]) %>% 
         pivot_longer(., -c(reservoir, run), names_to = "metric", values_to = "metric_value") %>% 
         left_join(., reservoirs_data[, c("Nombre", "Lake_id", "region")], c("reservoir" = "Lake_id")) 
       
       regions <- unique(resdat$region) %>% str_split(., ", ") %>% unlist(.)
       
       pars <- parameters %>% select(starts_with(regions)) %>% mutate(run = seq(1, length(unique(resdat$run)), 1))
       
       for_res_pars_plot <- resdat %>% 
         left_join(., pars, "run") %>% 
         pivot_longer(., -c(reservoir, run, metric, metric_value, Nombre, region), names_to = "parameter", values_to = "parameter_value") 
       
       for(metric in 1:length(unique(for_res_pars_plot$metric))){
         
         meetric <- unique(for_res_pars_plot$metric)[metric]
         
         tab_pars_res <-  for_res_pars_plot %>% filter(metric == meetric)
         
         pars_eff_plot <- ggplot(tab_pars_res, aes(x = parameter_value, y = metric_value))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "parameter", scales = "free_x")+
           ggtitle(paste(meetric, unique(resdat$reservoir), ", ", unique(resdat$Nombre), " (", unique(resdat$region), ")" ,sep = ""))+
           theme_bw()+
           theme(axis.title = element_blank())
         
         ggsave(plot = pars_eff_plot,filename =  paste("Data/Reservoirs/Figures/R3/Reservoir_pars/",
                                                       unique(resdat$reservoir), meetric, ".png", sep = ""),device = "png", dpi = 600, height = 10, width = 10)
         
       }
     }
     
     
     
     
     
     
     
     
     
     
#### ROUND 4 ####
     
     ##### PARAMETERS SETS CREATION #####
     
     
     ######## Parameters for Round_4 ######## 
     
     ########  Obtaining geology for aquifers (previously assigned using zonal statistics) ########  
     
     aquifers_shp <- read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/aquifers_r4.shp") 
     
     ggplot()+geom_sf(data = aquifers_shp, aes(fill = region))
     
     
     aquifers_data <- read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/aquifers_r4.shp") %>% st_drop_geometry()%>% select(Aq_id, region) %>% 
       mutate(region = factor(region, levels=c("IMP", "SIMP", "MET", "SMET", "CRB", "SCRB", "S2CRB", "DTH", "SDTH", "DTL")))
     
     
     reg_aqus <- list()
     
     for(i in 1:length(levels(aquifers_data$region))){
       
       reg_aqu <- aquifers_data %>% filter(., region == levels(aquifers_data$region)[i]) %>% pull(., Aq_id)
       reg_aqus[[i]] <- reg_aqu
       
     }
     
     names(reg_aqus) <- c("IMP_aq", "SIMP_aq", "MET_aq", "SMET_aqus", "CRB_aq", "SCRB_aq", "S2CRB_aq","DTH_aq", "SDTH_aq", "DTL_aq")
     
     # Vectors to copy-paste in the parameters sets creation
     IMP_aqus <- paste(reg_aqus$IMP_aq, collapse = ",")
     SIMP_aqus <- paste(reg_aqus$SIMP_aq, collapse = ",")
     MET_aqus <- paste(reg_aqus$MET_aq, collapse = ",")
     SMET_aqus <- paste(reg_aqus$SMET_aq, collapse = ",")
     CRB_aqus <- paste(reg_aqus$CRB_aq, collapse = ",")
     SCRB_aqus <- paste(reg_aqus$SCRB_aq, collapse = ",")
     S2CRB_aqus <- paste(reg_aqus$S2CRB_aq, collapse = ",")
     DTH_aqus <- paste(reg_aqus$DTH_aq, collapse = ",")
     SDTH_aqus <- paste(reg_aqus$SDTH_aq, collapse = ",")
     DTL_aqus <- paste(reg_aqus$DTL_aq, collapse = ",")
     
     
     ########  Obtaining geology for HRUs (previously assigned using zonal statistics) ######## 
     
     lsus_conf <-  read_sf("Data/GIS/hardcal_shapes/lsus_aqus_configuration/lsus_lithology_configuration_r4.shp") %>%
       st_drop_geometry(.) %>% arrange(., lsu_id)
     # with the geological region for each LSU
     lsus_def <-  read_table("Data/GIS/model/ls_unit.def", skip = 2) # File with the hrus within each LSU    
     
     lsus_id_reg <-  select(lsus_conf, lsu_id, region, Area) %>% mutate(id = lsu_id) %>% .[,c(4,2:3)]
     
     hrus_lsus <- select(lsus_def, id, elements, X6) # Elements and X6 columns are the HRUs that each LSU contain (from element to X6)
     
     
     lsus_hrus_def <- left_join(hrus_lsus, lsus_id_reg, "id") %>% .[,c(1,4,2,3)] %>% 
       mutate(hrus = paste(as.character(hrus_lsus$elements), as.character(hrus_lsus$X6), sep = ":") %>% str_remove(., "-") %>% str_remove(., ":NA")) %>% 
       .[,c(1:2,5)]
     
     
     #For creating a tibble with the parameterization, a simplification of the hru lists should be done, as the tibble function has a length limit
     # For this purpose, the next loop group the hrus of the contiguous lsus
     
     
     lsus_hrus_def$region <- factor(lsus_hrus_def$region, levels = c("IMP", "SIMP", "MET", "SMET", "CRB", "SCRB", "S2CRB", "DTH", "SDTH", "DTL")) #Factor with the different geological groups
     hrus_reg <- list()
     
     for(lev in 1:length(levels(lsus_hrus_def$region))){
       
       lsus_order <-  lsus_hrus_def %>% filter(region == levels(lsus_hrus_def$region)[lev]) %>% separate(., hrus, into = c("ini", "end"),sep = ":") %>% 
         mutate(ini = as.numeric(ini), end = as.numeric(end)) %>% arrange(., ini)   #preparing the hru ids for each LSU
       NAS <- is.na(lsus_order$end)     #Some of them only have 1 hru
       lsus_order[NAS,4] <- lsus_order[NAS,3]
       
       # First part : check contiguous lsus at the beggining and end of the list
       r <- 0 # number of contiguous lsus at the beginning
       q <- 0 # number of contiguous lsus at the end
       g <- 1 # compensation if q = 0 (look below) 
       
       for(i in 1:length(lsus_order$id)){
         if(i == 1){
           while(lsus_order$end[i+r]+1 == lsus_order$ini[i+1+r]){
             r <-  r+1}
         }
         if(i == length(lsus_order$id)){
           while(lsus_order$ini[i-q]-1 == lsus_order$end[i-1-q]){
             q <- q+1 
             g <- 0}
         }
         else{}
       }
       # First and last simplificated hrus
       nni <- paste(lsus_order$ini[1], lsus_order$end[1+r], sep = ":")
       nnend <- paste(lsus_order$ini[length(lsus_order$id)-q], lsus_order$end[length(lsus_order$id)], sep = ":")
       # Second part: for the rest of the list of lsus-hrus, excluding the first and last items (with r and q)
       n <- 0
       nns <- c()
       is <- c()
       for(i in (2+r):(length(lsus_order$id)-(1*g+q))){ # If q = 0, g = 1, avoiding an error in next line when i = length(lsus_order$id)
         if(lsus_order$ini[i+1] == (lsus_order$end[i]+1)){
           n <- n+1
           i <- i+1
         }
         else{
           nn <- paste(lsus_order$ini[i-(n)], lsus_order$end[i], sep = ":")
           n <- 0 
           nns <- c(nns, nn)
         }
       }
       
       hrus_reg[[lev]] <- c(nni, nns, nnend)
     }
     names(hrus_reg) <- levels(lsus_hrus_def$region)
     
     
     #In the hrus_reg list, a list for each region contains the different hrus grouped
     
     
     hrus_characters <- list()
     for(n in 1:length(hrus_reg)){
       combs <- c()
       for(i in 1:length(hrus_reg[[n]])){
         comb <- paste(hrus_reg[[n]][i])
         combs <- paste(combs, comb, sep = ",")
       }
       hrus_characters[[n]] <- combs
     }
     names(hrus_characters) <- levels(lsus_hrus_def$region)
     
     
     # The list "hrus_characters" contains for each geological region all the hrus that are located within it. Easily, 
     #its content can be copy-paste into the tibble function to create the different parameters sets
     
     ######## Creating the parameter sets ######## 
     
     hc_par_bound_zonal_Z4 <- tibble(
       
       
       'surlag.bsn | change = absval' = c(1, 6), 
       'chn.rte | change = absval' = c(0, 0.05),
       
       'IMP_esc::esco.hru | change = absval | unit =         c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.7 , 0.999),     # IMP_esc::esco.hru | change = absval             
       'IMP_epc::epco.hru | change = absval | unit =         c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.001 , 0.999),   # IMP_epc::epco.hru | change = absval  
       'IMP_cnn::cn2.hru | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-29.999  ,  -10), # IMP_cnn::cn2.hru | change = pctchg     
       'IMP_awc::awc.sol | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(35 , 50),         # IMP_awc::awc.sol | change = pctchg    
       'IMP_per::perco.hru | change = absval | unit =        c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.675 , 0.775),   # IMP_per::perco.hru | change = absval   
       'IMP_latq::latq_co.hru | change = abschg | unit =     c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-0.05, 0),        # IMP_latq::latq_co.hru | change = abschg  
       'IMP_cn3::cn3_swf.hru | change = abschg | unit =      c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-0.3, 0),         # IMP_cn3::cn3_swf.hru | change = abschg        
       'IMP_zso::z.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c( 25 , 50),        # IMP_zso::z.sol | change = pctchg 
       'IMP_kso::k.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-65 , 30 ),   # IMP_kso::k.sol | change = pctchg 
       'IMP_bd::bd.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-25 , -15),       # IMP_bd::bd.sol | change = pctchg 
       'IMP_ovn::ovn.hru | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-20 , 20),        # IMP_ovn::ovn.hru | change = pctchg
       'IMP_lattime::lat_ttime.hru | change = absval| unit = c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.5, 5),          # IMP_lattime::lat_ttime.hru | change = absval
       
       'IMP_alpha::alpha.aqu | change = absval = | unit =      c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.001, 0.04),   # IMP_alpha::alpha.aqu | change = absval
       'IMP_flomin::flo_min.aqu | change = absval | unit =     c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(10, 20),        # IMP_flomin::flo_min.aqu | change = absval 
       'IMP_revapmin::revap_min.aqu | change = absval | unit = c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0, 10),         # IMP_revapmin::revap_min.aqu | change = absval 
       'IMP_revapco::revap_co.aqu | change = absval | unit =   c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.02, 0.2),     # IMP_revapco::revap_co.aqu | change = absval 
       'IMP_spyld::sp_yld.aqu | change = absval =| unit =      c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.00001, 0.05), # IMP_spyld::sp_yld.aqu | change = absval
       
       'SANT_awc::awc.sol | change = pctchg | unit =          c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(-40 , 0),       # SANT_awc::awc.sol | change = pctchg    
       'SANT_zso::z.sol | change = pctchg | unit =            c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(-40 , -10),     # SANT_zso::z.sol | change = pctchg 
       'SANT_kso::k.sol | change = pctchg | unit =            c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(50 , 150 ),     # SANT_kso::k.sol | change = pctchg 
       
       
       'SIMP_esc::esco.hru | change = absval | unit =         c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.8 , 0.999),     # SIMP_esc::esco.hru | change = absval             
       'SIMP_epc::epco.hru | change = absval | unit =         c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.001 , 0.999),   # SIMP_epc::epco.hru | change = absval  
       'SIMP_cnn::cn2.hru | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-29.999 , -15),   # SIMP_cnn::cn2.hru | change = pctchg     
       'SIMP_awc::awc.sol | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(35 , 45),         # SIMP_awc::awc.sol | change = pctchg    
       'SIMP_per::perco.hru | change = absval | unit =        c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.4 , 0.55),      # SIMP_per::perco.hru | change = absval   
       'SIMP_latq::latq_co.hru | change = abschg | unit =     c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.25, 0.1),      # SIMP_latq::latq_co.hru | change = abschg  
       'SIMP_cn3::cn3_swf.hru | change = abschg | unit =      c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.3, 0),         # SIMP_cn3::cn3_swf.hru | change = abschg        
       'SIMP_zso::z.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c( 30 , 45),        # SIMP_zso::z.sol | change = pctchg 
       'SIMP_kso::k.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-70 , -50),       # SIMP_kso::k.sol | change = pctchg 
       'SIMP_bd::bd.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-25 , -15),       # SIMP_bd::bd.sol | change = pctchg 
       'SIMP_ovn::ovn.hru | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-20 , 20),        # SIMP_ovn::ovn.hru | change = pctchg
       'SIMP_lattime::lat_ttime.hru | change = absval| unit = c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.5, 15),         # SIMP_lattime::lat_ttime.hru | change = absval
       
       'SIMP_alpha::alpha.aqu | change = absval = | unit =      c(107,109,110,114,117,118)' = c(0.003, 0.015),  # SIMP_alpha::alpha.aqu | change = absval
       'SIMP_flomin::flo_min.aqu | change = absval | unit =     c(107,109,110,114,117,118)' = c(10, 20),        # SIMP_flomin::flo_min.aqu | change = absval 
       'SIMP_revapmin::revap_min.aqu | change = absval | unit = c(107,109,110,114,117,118)' = c(0, 10),         # SIMP_revapmin::revap_min.aqu | change = absval 
       'SIMP_revapco::revap_co.aqu | change = absval | unit =   c(107,109,110,114,117,118)' = c(0.02, 0.2),     # SIMP_revapco::revap_co.aqu | change = absval 
       'SIMP_spyld::sp_yld.aqu | change = absval =| unit =      c(107,109,110,114,117,118)' = c(0.00001, 0.05), # SIMP_spyld::sp_yld.aqu | change = absval
       
       
       'MET_esc::esco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.6 , 0.999),      # MET_esc::esco.hru | change = absval             
       'MET_epc::epco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.001 , 0.999),    # MET_epc::epco.hru | change = absval  
       'MET_cnn::cn2.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-15  ,  10),       # MET_cnn::cn2.hru | change = pctchg     
       'MET_awc::awc.sol | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0 , 20),           # MET_awc::awc.sol | change = pctchg    
       'MET_per::perco.hru | change = absval | unit =        c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.7 , 0.8),        # MET_per::perco.hru | change = absval   
       'MET_latq::latq_co.hru | change = abschg | unit =     c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-0.1, 0.2),        # MET_latq::latq_co.hru | change = abschg  
       'MET_cn3::cn3_swf.hru | change = abschg | unit =      c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-0.3, 0),          # MET_cn3::cn3_swf.hru | change = abschg        
       'MET_zso::z.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0 , 20),           # MET_zso::z.sol | change = pctchg 
       'MET_kso::k.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-50 , 50),         # MET_kso::k.sol | change = pctchg 
       'MET_bd::bd.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-15 , 0),          # MET_bd::bd.sol | change = pctchg 
       'MET_ovn::ovn.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-20 , 20),         # MET_ovn::ovn.hru | change = pctchg
       'MET_lattime::lat_ttime.hru | change = absval| unit = c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.5, 5),           # MET_lattime::lat_ttime.hru | change = absval
       
       'MET_alpha::alpha.aqu | change = absval = | unit =      c(1,2,3,5,7,9,11,108,122)' = c(0.001, 0.05),    # MET_alpha::alpha.aqu | change = absval
       'MET_flomin::flo_min.aqu | change = absval | unit =     c(1,2,3,5,7,9,11,108,122)' = c(10, 20),         # MET_flomin::flo_min.aqu | change = absval 
       'MET_revapmin::revap_min.aqu | change = absval | unit = c(1,2,3,5,7,9,11,108,122)' = c(0, 10),          # MET_revapmin::revap_min.aqu | change = absval 
       'MET_revapco::revap_co.aqu | change = absval | unit =   c(1,2,3,5,7,9,11,108,122)' = c(0.02, 0.2),      # MET_revapco::revap_co.aqu | change = absval 
       'MET_spyld::sp_yld.aqu | change = absval =| unit =      c(1,2,3,5,7,9,11,108,122)' = c(0.00001, 0.05),  # MET_spyld::sp_yld.aqu | change = absval
       
       
       'SMET_esc::esco.hru | change = absval | unit =         c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.7 , 0.999),     # SMET_esc::esco.hru | change = absval             
       'SMET_epc::epco.hru | change = absval | unit =         c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.001 , 0.999),   # SMET_epc::epco.hru | change = absval  
       'SMET_cnn::cn2.hru | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-10  ,  0),       # SMET_cnn::cn2.hru | change = pctchg     
       'SMET_awc::awc.sol | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(25 , 50),         # SMET_awc::awc.sol | change = pctchg    
       'SMET_per::perco.hru | change = absval | unit =        c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.5 , 0.8),       # SMET_per::perco.hru | change = absval   
       'SMET_latq::latq_co.hru | change = abschg | unit =     c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-0.2, 0.1),       # SMET_latq::latq_co.hru | change = abschg  
       'SMET_cn3::cn3_swf.hru | change = abschg | unit =      c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-0.3, 150),       # SMET_cn3::cn3_swf.hru | change = abschg        
       'SMET_zso::z.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(25 , 50),         # SMET_zso::z.sol | change = pctchg 
       'SMET_kso::k.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-80 , 0),         # SMET_kso::k.sol | change = pctchg 
       'SMET_bd::bd.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-20 , -10),       # SMET_bd::bd.sol | change = pctchg 
       'SMET_ovn::ovn.hru | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-20 , 20),        # SMET_ovn::ovn.hru | change = pctchg
       'SMET_lattime::lat_ttime.hru | change = absval| unit = c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.5, 5),         # SMET_lattime::lat_ttime.hru | change = absval
       
       'SMET_alpha::alpha.aqu | change = absval = | unit =      c(113, 119)' = c(0.001, 0.05),   # SMET_alpha::alpha.aqu | change = absval
       'SMET_flomin::flo_min.aqu | change = absval | unit =     c(113, 119)' = c(10, 20),        # SMET_flomin::flo_min.aqu | change = absval 
       'SMET_revapmin::revap_min.aqu | change = absval | unit = c(113, 119)' = c(0, 10),         # SMET_revapmin::revap_min.aqu | change = absval 
       'SMET_revapco::revap_co.aqu | change = absval | unit =   c(113, 119)' = c(0.02, 0.2),     # SMET_revapco::revap_co.aqu | change = absval 
       'SMET_spyld::sp_yld.aqu | change = absval =| unit =      c(113, 119)' = c(0.00001, 0.03), # SMET_spyld::sp_yld.aqu | change = absval
       
       'CRB_esc::esco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.001 , 0.90),        # CRB_esc::esco.hru | change = absval           
       'CRB_epc::epco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.001 , 0.999),       # CRB_epc::epco.hru | change = absval   
       'CRB_cnn::cn2.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-10  ,   0),          # CRB_cnn::cn2.hru | change = pctchg           
       'CRB_awc::awc.sol | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-10 , 30),            # CRB_awc::awc.sol | change = pctchg       
       'CRB_per::perco.hru | change = absval | unit =        c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.93 , 0.965),        # CRB_per::perco.hru | change = absval
       'CRB_latq::latq_co.hru | change = abschg | unit =     c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-0.3, -0.1),          # CRB_latq::latq_co.hru | change = abschg    
       'CRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-0.05, 0.3),          # CRB_cn3::cn3_swf.hru | change = abschg         
       'CRB_zso::z.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-25 , 15),            # CRB_zso::z.sol | change = pctchg       
       'CRB_kso::k.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-79.999 , 50),        # CRB_kso::k.sol | change = pctchg        
       'CRB_bd::bd.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-20 , -5),            # CRB_bd::bd.sol | change = pctchg      
       'CRB_ovn::ovn.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-20, 20),             # CRB_ovn::ovn.hru | change = pctchg
       'CRB_lattime::lat_ttime.hru | change = absval| unit = c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.5, 15),             # CRB_lattime::lat_ttime.hru | change = absval
       
       'CRB_alpha::alpha.aqu | change = absval = | unit =      c(8,25,30,38,41,43,54,56,62)' = c(0.001, 0.01), # CRB_alpha::alpha.aqu | change = absval
       'CRB_flomin::flo_min.aqu | change = absval | unit =     c(8,25,30,38,41,43,54,56,62)' = c(10, 20),      # CRB_flomin::flo_min.aqu | change = absval 
       'CRB_revapmin::revap_min.aqu | change = absval | unit = c(8,25,30,38,41,43,54,56,62)' = c(0, 10),       # CRB_revapmin::revap_min.aqu | change = absval 
       'CRB_revapco::revap_co.aqu | change = absval | unit =   c(8,25,30,38,41,43,54,56,62)' = c(0.02, 0.2),   # CRB_revapco::revap_co.aqu | change = absval 
       'CRB_spyld::sp_yld.aqu | change = absval =| unit =      c(8,25,30,38,41,43,54,56,62)' = c(0.01, 0.35),  # CRB_spyld::sp_yld.aqu | change = absval
       
       
       'SCRB_esc::esco.hru | change = absval | unit =         c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.60 , 0.999),        # SCRB_esc::esco.hru | change = absval           
       'SCRB_epc::epco.hru | change = absval | unit =         c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.001 , 0.999),       # SCRB_epc::epco.hru | change = absval   
       'SCRB_cnn::cn2.hru | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20  ,   0),          # SCRB_cnn::cn2.hru | change = pctchg           
       'SCRB_awc::awc.sol | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(20 , 40),             # SCRB_awc::awc.sol | change = pctchg       
       'SCRB_per::perco.hru | change = absval | unit =        c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.88 , 0.95),         # SCRB_per::perco.hru | change = absval
       'SCRB_latq::latq_co.hru | change = abschg | unit =     c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-0.3, 0.1),           # SCRB_latq::latq_co.hru | change = abschg    
       'SCRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0, 0.3),              # SCRB_cn3::cn3_swf.hru | change = abschg         
       'SCRB_zso::z.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(10 , 35),             # SCRB_zso::z.sol | change = pctchg       
       'SCRB_kso::k.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-70 , 0),             # SCRB_kso::k.sol | change = pctchg        
       'SCRB_bd::bd.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20 , -10),           # SCRB_bd::bd.sol | change = pctchg      
       'SCRB_ovn::ovn.hru | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20, 20),             # SCRB_ovn::ovn.hru | change = pctchg
       'SCRB_lattime::lat_ttime.hru | change = absval| unit = c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.5, 20),             # SCRB_lattime::lat_ttime.hru | change = absval
       
       'SCRB_alpha::alpha.aqu | change = absval = | unit =      c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.001, 0.005), # SCRB_alpha::alpha.aqu | change = absval
       'SCRB_flomin::flo_min.aqu | change = absval | unit =     c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(8, 20),       # SCRB_flomin::flo_min.aqu | change = absval 
       'SCRB_revapmin::revap_min.aqu | change = absval | unit = c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0, 10),       # SCRB_revapmin::revap_min.aqu | change = absval 
       'SCRB_revapco::revap_co.aqu | change = absval | unit =   c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.02, 0.2),   # SCRB_revapco::revap_co.aqu | change = absval 
       'SCRB_spyld::sp_yld.aqu | change = absval =| unit =      c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.01, 0.35),  # SCRB_spyld::sp_yld.aqu | change = absval
       
       
       'S2CRB_esc::esco.hru | change = absval | unit =         c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.500 , 0.999),       # S2CRB_esc::esco.hru | change = absval           
       'S2CRB_epc::epco.hru | change = absval | unit =         c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.001 , 0.999),       # S2CRB_epc::epco.hru | change = absval   
       'S2CRB_cnn::cn2.hru | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20  ,   0),          # S2CRB_cnn::cn2.hru | change = pctchg           
       'S2CRB_awc::awc.sol | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-15 , 20),            # S2CRB_awc::awc.sol | change = pctchg       
       'S2CRB_per::perco.hru | change = absval | unit =        c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.85 , 0.95),         # S2CRB_per::perco.hru | change = absval
       'S2CRB_latq::latq_co.hru | change = abschg | unit =     c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.3, 0.3),           # S2CRB_latq::latq_co.hru | change = abschg    
       'S2CRB_cn3::cn3_swf.hru | change = abschg | unit =      c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.2, 0.3),           # S2CRB_cn3::cn3_swf.hru | change = abschg         
       'S2CRB_zso::z.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20 , 10),            # S2CRB_zso::z.sol | change = pctchg       
       'S2CRB_kso::k.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0 , 150),             # S2CRB_kso::k.sol | change = pctchg        
       'S2CRB_bd::bd.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20 , -5),            # S2CRB_bd::bd.sol | change = pctchg      
       'S2CRB_ovn::ovn.hru | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20, 20),             # S2CRB_ovn::ovn.hru | change = pctchg
       'S2CRB_lattime::lat_ttime.hru | change = absval| unit = c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.5, 20),             # S2CRB_lattime::lat_ttime.hru | change = absval
       
       'S2CRB_alpha::alpha.aqu | change = absval = | unit =      c(104, 120)' = c(0.001, 0.005), # S2CRB_alpha::alpha.aqu | change = absval
       'S2CRB_flomin::flo_min.aqu | change = absval | unit =     c(104, 120)' = c(8, 20),       # S2CRB_flomin::flo_min.aqu | change = absval 
       'S2CRB_revapmin::revap_min.aqu | change = absval | unit = c(104, 120)' = c(0, 10),       # S2CRB_revapmin::revap_min.aqu | change = absval 
       'S2CRB_revapco::revap_co.aqu | change = absval | unit =   c(104, 120)' = c(0.02, 0.2),   # S2CRB_revapco::revap_co.aqu | change = absval 
       'S2CRB_spyld::sp_yld.aqu | change = absval =| unit =      c(104, 120)' = c(0.01, 0.35),  # SCRB_spyld::sp_yld.aqu | change = absval
       
       
       'DTH_esc::esco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.60 , 0.999),      # DTH_esc::esco.hru | change = absval                         
       'DTH_epc::epco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.001 , 0.999),     # DTH_epc::epco.hru | change = absval     
       'DTH_cnn::cn2.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-30  ,  -15),       # DTH_cnn::cn2.hru | change = pctchg             
       'DTH_awc::awc.sol | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(30 , 50),           # DTH_awc::awc.sol | change = pctchg         
       'DTH_per::perco.hru | change = absval | unit =        c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.8 , 0.88),        # DTH_per::perco.hru | change = absval  
       'DTH_latq::latq_co.hru | change = abschg | unit =     c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.05, 0.2),        # DTH_latq::latq_co.hru | change = abschg      
       'DTH_cn3::cn3_swf.hru | change = abschg | unit =      c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.1, 0.25),         # DTH_cn3::cn3_swf.hru | change = abschg           
       'DTH_zso::z.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(15, 27.5),          # DTH_zso::z.sol | change = pctchg         
       'DTH_kso::k.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-60 , -10),         # DTH_kso::k.sol | change = pctchg          
       'DTH_bd::bd.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-25 , -17.5),       # DTH_bd::bd.sol | change = pctchg        
       'DTH_ovn::ovn.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-20, 20),           # DTH_ovn::ovn.hru | change = pctchg
       'DTH_lattime::lat_ttime.hru | change = absval| unit = c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,2901:2916,2937:2969,3000:3018,3055:3076,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6414:6440,6454:6459,6505:6530,6825:6845,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7367:7374,7450:7457,7531:7553,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8495:8506,8534:8536,8558:8682,8714:8729,8778:9057,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10315:10327,10668:10694,10766:10872,10900:10919,10942:10965,11070:11084,11101:11114,11123:11134,11142:11304,11484:11511,11561:11616,11629:11635,11659:11696,11722:11794,12123:12196,12211:12262,12447:12480,12484:12503,12511:12534,12572:13033,13054:13060,13126:13153,13238:13281,13292:13362,13373:13493,13502:13536,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14102:14111,14208:14224,14250:14255,14325:14328,14353:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15060:15100,15172:15172,15221:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,16661:16687,16717:16774,17039:17075,17101:17141,17239:17245,17280:17286,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21577:21589,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.5, 10),           # DTH_lattime::lat_ttime.hru | change = absval
       
       'DTH_alpha::alpha.aqu | change = absval = | unit =      c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.001, 0.01),  # DTH_alpha::alpha.aqu | change = absval
       'DTH_flomin::flo_min.aqu | change = absval | unit =     c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(10, 20),        # DTH_flomin::flo_min.aqu | change = absval 
       'DTH_revapmin::revap_min.aqu | change = absval | unit = c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0, 12),        # DTH_revapmin::revap_min.aqu | change = absval 
       'DTH_revapco::revap_co.aqu | change = absval | unit =   c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.02, 0.2),    # DTH_revapco::revap_co.aqu | change = absval 
       'DTH_spyld::sp_yld.aqu | change = absval =| unit =      c(12,13,15,20,21,22,26,28,31,34,39,44,46,49,52,55,59,64,66,67,70,71,72,74,77,78,80,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.1, 0.35),    # DTH_spyld::sp_yld.aqu | change = absval
       
       
       'DTL_esc::esco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.6 , 0.999),      # DTL_esc::esco.hru | change = absval       
       'DTL_epc::epco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.001 , 0.999),    # DTL_epc::epco.hru | change = absval  
       'DTL_cnn::cn2.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999  ,  -10),  # DTL_cnn::cn2.hru | change = pctchg       
       'DTL_awc::awc.sol | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(30 , 59.999),      # DTL_awc::awc.sol | change = pctchg    
       'DTL_per::perco.hru | change = absval | unit =        c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.4 , 0.7),        # DTL_per::perco.hru | change = absval
       'DTL_latq::latq_co.hru | change = abschg | unit =     c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_latq::latq_co.hru | change = abschg    
       'DTL_cn3::cn3_swf.hru | change = abschg | unit =      c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_cn3::cn3_swf.hru | change = abschg        
       'DTL_zso::z.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(30 , 49.999),      # DTL_zso::z.sol | change = pctchg 
       'DTL_kso::k.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-79.999 , 0),     # DTL_kso::k.sol | change = pctchg 
       'DTL_bd::bd.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999 , -10),    # DTL_bd::bd.sol | change = pctchg 
       'DTL_ovn::ovn.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-20, 20),          # DTH_ovn::ovn.hru | change = pctchg
       'DTL_lattime::lat_ttime.hru | change = absval| unit = c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.5, 80),          # DTH_lattime::lat_ttime.hru | change = absval
       
       'DTL_alpha::alpha.aqu | change = absval = | unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.001, 0.02),   # DTL_alpha::alpha.aqu | change = absval
       'DTL_flomin::flo_min.aqu | change = absval | unit =     c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(5, 20),         # DTL_flomin::flo_min.aqu | change = absval 
       'DTL_revapmin::revap_min.aqu | change = absval | unit = c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0, 10),         # DTL_revapmin::revap_min.aqu | change = absval 
       'DTL_revapco::revap_co.aqu | change = absval | unit =   c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.02, 0.2),     # DTL_revapco::revap_co.aqu | change = absval 
       'DTL_spyld::sp_yld.aqu | change = absval =| unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.00001, 0.3))  # DTL_spyld::sp_yld.aqu | change = absval
     
     
     hc_par_bound_zonal_4 <- tibble(
       
       
       'surlag.bsn | change = absval' = c(1, 6), 
       'chn.rte | change = absval' = c(0, 0.05),
       
       'IMP_esc::esco.hru | change = absval | unit =         c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.7 , 0.999),     # IMP_esc::esco.hru | change = absval             
       'IMP_epc::epco.hru | change = absval | unit =         c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.001 , 0.999),   # IMP_epc::epco.hru | change = absval  
       'IMP_cnn::cn2.hru | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-29.999  ,  -10), # IMP_cnn::cn2.hru | change = pctchg     
       'IMP_awc::awc.sol | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(35 , 50),         # IMP_awc::awc.sol | change = pctchg    
       'IMP_per::perco.hru | change = absval | unit =        c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.675 , 0.775),   # IMP_per::perco.hru | change = absval   
       'IMP_latq::latq_co.hru | change = abschg | unit =     c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-0.05, 0),        # IMP_latq::latq_co.hru | change = abschg  
       'IMP_cn3::cn3_swf.hru | change = abschg | unit =      c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-0.3, 0),         # IMP_cn3::cn3_swf.hru | change = abschg        
       'IMP_zso::z.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c( 25 , 50),        # IMP_zso::z.sol | change = pctchg 
       'IMP_kso::k.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-65 , 30 ),   # IMP_kso::k.sol | change = pctchg 
       'IMP_bd::bd.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-25 , -15),       # IMP_bd::bd.sol | change = pctchg 
       'IMP_ovn::ovn.hru | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-20 , 20),        # IMP_ovn::ovn.hru | change = pctchg
       'IMP_lattime::lat_ttime.hru | change = absval| unit = c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.5, 5),          # IMP_lattime::lat_ttime.hru | change = absval
       
       'IMP_alpha::alpha.aqu | change = absval = | unit =      c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.001, 0.04),   # IMP_alpha::alpha.aqu | change = absval
       'IMP_flomin::flo_min.aqu | change = absval | unit =     c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(10, 20),        # IMP_flomin::flo_min.aqu | change = absval 
       'IMP_revapmin::revap_min.aqu | change = absval | unit = c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0, 10),         # IMP_revapmin::revap_min.aqu | change = absval 
       'IMP_revapco::revap_co.aqu | change = absval | unit =   c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.02, 0.2),     # IMP_revapco::revap_co.aqu | change = absval 
       'IMP_spyld::sp_yld.aqu | change = absval =| unit =      c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.00001, 0.05), # IMP_spyld::sp_yld.aqu | change = absval
       
       'SANT_awc::awc.sol | change = pctchg | unit =          c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(-40 , 0),       # SANT_awc::awc.sol | change = pctchg    
       'SANT_zso::z.sol | change = pctchg | unit =            c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(-40 , -10),     # SANT_zso::z.sol | change = pctchg 
       'SANT_kso::k.sol | change = pctchg | unit =            c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(50 , 150 ),     # SANT_kso::k.sol | change = pctchg 
       
       
       'SIMP_esc::esco.hru | change = absval | unit =         c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.8 , 0.999),     # SIMP_esc::esco.hru | change = absval             
       'SIMP_epc::epco.hru | change = absval | unit =         c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.001 , 0.999),   # SIMP_epc::epco.hru | change = absval  
       'SIMP_cnn::cn2.hru | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-29.999 , -15),   # SIMP_cnn::cn2.hru | change = pctchg     
       'SIMP_awc::awc.sol | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(35 , 45),         # SIMP_awc::awc.sol | change = pctchg    
       'SIMP_per::perco.hru | change = absval | unit =        c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.4 , 0.55),      # SIMP_per::perco.hru | change = absval   
       'SIMP_latq::latq_co.hru | change = abschg | unit =     c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.25, 0.1),      # SIMP_latq::latq_co.hru | change = abschg  
       'SIMP_cn3::cn3_swf.hru | change = abschg | unit =      c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.3, 0),         # SIMP_cn3::cn3_swf.hru | change = abschg        
       'SIMP_zso::z.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c( 30 , 45),        # SIMP_zso::z.sol | change = pctchg 
       'SIMP_kso::k.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-70 , -50),       # SIMP_kso::k.sol | change = pctchg 
       'SIMP_bd::bd.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-25 , -15),       # SIMP_bd::bd.sol | change = pctchg 
       'SIMP_ovn::ovn.hru | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-20 , 20),        # SIMP_ovn::ovn.hru | change = pctchg
       'SIMP_lattime::lat_ttime.hru | change = absval| unit = c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.5, 15),         # SIMP_lattime::lat_ttime.hru | change = absval
       
       'SIMP_alpha::alpha.aqu | change = absval = | unit =      c(107,109,110,114,117,118)' = c(0.003, 0.015),  # SIMP_alpha::alpha.aqu | change = absval
       'SIMP_flomin::flo_min.aqu | change = absval | unit =     c(107,109,110,114,117,118)' = c(10, 20),        # SIMP_flomin::flo_min.aqu | change = absval 
       'SIMP_revapmin::revap_min.aqu | change = absval | unit = c(107,109,110,114,117,118)' = c(0, 10),         # SIMP_revapmin::revap_min.aqu | change = absval 
       'SIMP_revapco::revap_co.aqu | change = absval | unit =   c(107,109,110,114,117,118)' = c(0.02, 0.2),     # SIMP_revapco::revap_co.aqu | change = absval 
       'SIMP_spyld::sp_yld.aqu | change = absval =| unit =      c(107,109,110,114,117,118)' = c(0.00001, 0.05), # SIMP_spyld::sp_yld.aqu | change = absval
       
       
       'MET_esc::esco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.6 , 0.999),      # MET_esc::esco.hru | change = absval             
       'MET_epc::epco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.001 , 0.999),    # MET_epc::epco.hru | change = absval  
       'MET_cnn::cn2.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-15  ,  10),       # MET_cnn::cn2.hru | change = pctchg     
       'MET_awc::awc.sol | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0 , 20),           # MET_awc::awc.sol | change = pctchg    
       'MET_per::perco.hru | change = absval | unit =        c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.7 , 0.8),        # MET_per::perco.hru | change = absval   
       'MET_latq::latq_co.hru | change = abschg | unit =     c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-0.1, 0.2),        # MET_latq::latq_co.hru | change = abschg  
       'MET_cn3::cn3_swf.hru | change = abschg | unit =      c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-0.3, 0),          # MET_cn3::cn3_swf.hru | change = abschg        
       'MET_zso::z.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0 , 20),           # MET_zso::z.sol | change = pctchg 
       'MET_kso::k.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-50 , 50),         # MET_kso::k.sol | change = pctchg 
       'MET_bd::bd.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-15 , 0),          # MET_bd::bd.sol | change = pctchg 
       'MET_ovn::ovn.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-20 , 20),         # MET_ovn::ovn.hru | change = pctchg
       'MET_lattime::lat_ttime.hru | change = absval| unit = c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.5, 5),           # MET_lattime::lat_ttime.hru | change = absval
       
       'MET_alpha::alpha.aqu | change = absval = | unit =      c(1,2,3,5,7,9,11,108,122)' = c(0.001, 0.05),    # MET_alpha::alpha.aqu | change = absval
       'MET_flomin::flo_min.aqu | change = absval | unit =     c(1,2,3,5,7,9,11,108,122)' = c(10, 20),         # MET_flomin::flo_min.aqu | change = absval 
       'MET_revapmin::revap_min.aqu | change = absval | unit = c(1,2,3,5,7,9,11,108,122)' = c(0, 10),          # MET_revapmin::revap_min.aqu | change = absval 
       'MET_revapco::revap_co.aqu | change = absval | unit =   c(1,2,3,5,7,9,11,108,122)' = c(0.02, 0.2),      # MET_revapco::revap_co.aqu | change = absval 
       'MET_spyld::sp_yld.aqu | change = absval =| unit =      c(1,2,3,5,7,9,11,108,122)' = c(0.00001, 0.05),  # MET_spyld::sp_yld.aqu | change = absval
       
       
       'SMET_esc::esco.hru | change = absval | unit =         c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.7 , 0.999),     # SMET_esc::esco.hru | change = absval             
       'SMET_epc::epco.hru | change = absval | unit =         c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.001 , 0.999),   # SMET_epc::epco.hru | change = absval  
       'SMET_cnn::cn2.hru | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-10  ,  0),       # SMET_cnn::cn2.hru | change = pctchg     
       'SMET_awc::awc.sol | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(25 , 50),         # SMET_awc::awc.sol | change = pctchg    
       'SMET_per::perco.hru | change = absval | unit =        c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.5 , 0.8),       # SMET_per::perco.hru | change = absval   
       'SMET_latq::latq_co.hru | change = abschg | unit =     c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-0.2, 0.1),       # SMET_latq::latq_co.hru | change = abschg  
       'SMET_cn3::cn3_swf.hru | change = abschg | unit =      c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-0.3, 150),       # SMET_cn3::cn3_swf.hru | change = abschg        
       'SMET_zso::z.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(25 , 50),         # SMET_zso::z.sol | change = pctchg 
       'SMET_kso::k.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-80 , 0),         # SMET_kso::k.sol | change = pctchg 
       'SMET_bd::bd.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-20 , -10),       # SMET_bd::bd.sol | change = pctchg 
       'SMET_ovn::ovn.hru | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-20 , 20),        # SMET_ovn::ovn.hru | change = pctchg
       'SMET_lattime::lat_ttime.hru | change = absval| unit = c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.5, 5),         # SMET_lattime::lat_ttime.hru | change = absval
       
       'SMET_alpha::alpha.aqu | change = absval = | unit =      c(113, 119)' = c(0.001, 0.05),   # SMET_alpha::alpha.aqu | change = absval
       'SMET_flomin::flo_min.aqu | change = absval | unit =     c(113, 119)' = c(10, 20),        # SMET_flomin::flo_min.aqu | change = absval 
       'SMET_revapmin::revap_min.aqu | change = absval | unit = c(113, 119)' = c(0, 10),         # SMET_revapmin::revap_min.aqu | change = absval 
       'SMET_revapco::revap_co.aqu | change = absval | unit =   c(113, 119)' = c(0.02, 0.2),     # SMET_revapco::revap_co.aqu | change = absval 
       'SMET_spyld::sp_yld.aqu | change = absval =| unit =      c(113, 119)' = c(0.00001, 0.03), # SMET_spyld::sp_yld.aqu | change = absval
       
       'CRB_esc::esco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.001 , 0.90),        # CRB_esc::esco.hru | change = absval           
       'CRB_epc::epco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.001 , 0.999),       # CRB_epc::epco.hru | change = absval   
       'CRB_cnn::cn2.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-10  ,   0),          # CRB_cnn::cn2.hru | change = pctchg           
       'CRB_awc::awc.sol | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-10 , 30),            # CRB_awc::awc.sol | change = pctchg       
       'CRB_per::perco.hru | change = absval | unit =        c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.93 , 0.965),        # CRB_per::perco.hru | change = absval
       'CRB_latq::latq_co.hru | change = abschg | unit =     c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-0.3, -0.1),          # CRB_latq::latq_co.hru | change = abschg    
       'CRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-0.05, 0.3),          # CRB_cn3::cn3_swf.hru | change = abschg         
       'CRB_zso::z.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-25 , 15),            # CRB_zso::z.sol | change = pctchg       
       'CRB_kso::k.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-79.999 , 50),        # CRB_kso::k.sol | change = pctchg        
       'CRB_bd::bd.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-20 , -5),            # CRB_bd::bd.sol | change = pctchg      
       'CRB_ovn::ovn.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-20, 20),             # CRB_ovn::ovn.hru | change = pctchg
       'CRB_lattime::lat_ttime.hru | change = absval| unit = c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.5, 15),             # CRB_lattime::lat_ttime.hru | change = absval
       
       'CRB_alpha::alpha.aqu | change = absval = | unit =      c(8,25,30,38,41,43,54,56,62)' = c(0.001, 0.01), # CRB_alpha::alpha.aqu | change = absval
       'CRB_flomin::flo_min.aqu | change = absval | unit =     c(8,25,30,38,41,43,54,56,62)' = c(10, 20),      # CRB_flomin::flo_min.aqu | change = absval 
       'CRB_revapmin::revap_min.aqu | change = absval | unit = c(8,25,30,38,41,43,54,56,62)' = c(0, 10),       # CRB_revapmin::revap_min.aqu | change = absval 
       'CRB_revapco::revap_co.aqu | change = absval | unit =   c(8,25,30,38,41,43,54,56,62)' = c(0.02, 0.2),   # CRB_revapco::revap_co.aqu | change = absval 
       'CRB_spyld::sp_yld.aqu | change = absval =| unit =      c(8,25,30,38,41,43,54,56,62)' = c(0.01, 0.35),  # CRB_spyld::sp_yld.aqu | change = absval
       
       
       'SCRB_esc::esco.hru | change = absval | unit =         c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.60 , 0.999),        # SCRB_esc::esco.hru | change = absval           
       'SCRB_epc::epco.hru | change = absval | unit =         c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.001 , 0.999),       # SCRB_epc::epco.hru | change = absval   
       'SCRB_cnn::cn2.hru | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20  ,   0),          # SCRB_cnn::cn2.hru | change = pctchg           
       'SCRB_awc::awc.sol | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(20 , 40),             # SCRB_awc::awc.sol | change = pctchg       
       'SCRB_per::perco.hru | change = absval | unit =        c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.88 , 0.95),         # SCRB_per::perco.hru | change = absval
       'SCRB_latq::latq_co.hru | change = abschg | unit =     c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-0.3, 0.1),           # SCRB_latq::latq_co.hru | change = abschg    
       'SCRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0, 0.3),              # SCRB_cn3::cn3_swf.hru | change = abschg         
       'SCRB_zso::z.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(10 , 35),             # SCRB_zso::z.sol | change = pctchg       
       'SCRB_kso::k.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-70 , 0),             # SCRB_kso::k.sol | change = pctchg        
       'SCRB_bd::bd.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20 , -10),           # SCRB_bd::bd.sol | change = pctchg      
       'SCRB_ovn::ovn.hru | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20, 20),             # SCRB_ovn::ovn.hru | change = pctchg
       'SCRB_lattime::lat_ttime.hru | change = absval| unit = c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.5, 20),             # SCRB_lattime::lat_ttime.hru | change = absval
       
       'SCRB_alpha::alpha.aqu | change = absval = | unit =      c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.001, 0.005), # SCRB_alpha::alpha.aqu | change = absval
       'SCRB_flomin::flo_min.aqu | change = absval | unit =     c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(8, 20),       # SCRB_flomin::flo_min.aqu | change = absval 
       'SCRB_revapmin::revap_min.aqu | change = absval | unit = c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0, 10),       # SCRB_revapmin::revap_min.aqu | change = absval 
       'SCRB_revapco::revap_co.aqu | change = absval | unit =   c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.02, 0.2),   # SCRB_revapco::revap_co.aqu | change = absval 
       'SCRB_spyld::sp_yld.aqu | change = absval =| unit =      c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.01, 0.35),  # SCRB_spyld::sp_yld.aqu | change = absval
       
       
       'S2CRB_esc::esco.hru | change = absval | unit =         c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.500 , 0.999),       # S2CRB_esc::esco.hru | change = absval           
       'S2CRB_epc::epco.hru | change = absval | unit =         c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.001 , 0.999),       # S2CRB_epc::epco.hru | change = absval   
       'S2CRB_cnn::cn2.hru | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20  ,   0),          # S2CRB_cnn::cn2.hru | change = pctchg           
       'S2CRB_awc::awc.sol | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-15 , 20),            # S2CRB_awc::awc.sol | change = pctchg       
       'S2CRB_per::perco.hru | change = absval | unit =        c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.85 , 0.95),         # S2CRB_per::perco.hru | change = absval
       'S2CRB_latq::latq_co.hru | change = abschg | unit =     c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.3, 0.3),           # S2CRB_latq::latq_co.hru | change = abschg    
       'S2CRB_cn3::cn3_swf.hru | change = abschg | unit =      c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.2, 0.3),           # S2CRB_cn3::cn3_swf.hru | change = abschg         
       'S2CRB_zso::z.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20 , 10),            # S2CRB_zso::z.sol | change = pctchg       
       'S2CRB_kso::k.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0 , 150),             # S2CRB_kso::k.sol | change = pctchg        
       'S2CRB_bd::bd.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20 , -5),            # S2CRB_bd::bd.sol | change = pctchg      
       'S2CRB_ovn::ovn.hru | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20, 20),             # S2CRB_ovn::ovn.hru | change = pctchg
       'S2CRB_lattime::lat_ttime.hru | change = absval| unit = c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.5, 20),             # S2CRB_lattime::lat_ttime.hru | change = absval
       
       'S2CRB_alpha::alpha.aqu | change = absval = | unit =      c(104, 120)' = c(0.001, 0.005), # S2CRB_alpha::alpha.aqu | change = absval
       'S2CRB_flomin::flo_min.aqu | change = absval | unit =     c(104, 120)' = c(8, 20),       # S2CRB_flomin::flo_min.aqu | change = absval 
       'S2CRB_revapmin::revap_min.aqu | change = absval | unit = c(104, 120)' = c(0, 10),       # S2CRB_revapmin::revap_min.aqu | change = absval 
       'S2CRB_revapco::revap_co.aqu | change = absval | unit =   c(104, 120)' = c(0.02, 0.2),   # S2CRB_revapco::revap_co.aqu | change = absval 
       'S2CRB_spyld::sp_yld.aqu | change = absval =| unit =      c(104, 120)' = c(0.01, 0.35),  # SCRB_spyld::sp_yld.aqu | change = absval
       
       
       'DTH_esc::esco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.60 , 0.999),      # DTH_esc::esco.hru | change = absval                         
       'DTH_epc::epco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.001 , 0.999),     # DTH_epc::epco.hru | change = absval     
       'DTH_cnn::cn2.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-25  ,  -10),       # DTH_cnn::cn2.hru | change = pctchg             
       'DTH_awc::awc.sol | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(30 , 50),           # DTH_awc::awc.sol | change = pctchg         
       'DTH_per::perco.hru | change = absval | unit =        c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.7 , 0.85),        # DTH_per::perco.hru | change = absval  
       'DTH_latq::latq_co.hru | change = abschg | unit =     c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.05, 0.2),        # DTH_latq::latq_co.hru | change = abschg      
       'DTH_cn3::cn3_swf.hru | change = abschg | unit =      c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.2, 0.05),        # DTH_cn3::cn3_swf.hru | change = abschg           
       'DTH_zso::z.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(15, 40),            # DTH_zso::z.sol | change = pctchg         
       'DTH_kso::k.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-80 , -20),         # DTH_kso::k.sol | change = pctchg          
       'DTH_bd::bd.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-25 , -15),         # DTH_bd::bd.sol | change = pctchg        
       'DTH_ovn::ovn.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-20, 20),           # DTH_ovn::ovn.hru | change = pctchg
       'DTH_lattime::lat_ttime.hru | change = absval| unit = c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.5, 7),           # DTH_lattime::lat_ttime.hru | change = absval
       
       'DTH_alpha::alpha.aqu | change = absval = | unit =      c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.0015, 0.01), # DTH_alpha::alpha.aqu | change = absval
       'DTH_flomin::flo_min.aqu | change = absval | unit =     c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(10, 20),       # DTH_flomin::flo_min.aqu | change = absval 
       'DTH_revapmin::revap_min.aqu | change = absval | unit = c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0, 12),        # DTH_revapmin::revap_min.aqu | change = absval 
       'DTH_revapco::revap_co.aqu | change = absval | unit =   c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.02, 0.2),    # DTH_revapco::revap_co.aqu | change = absval 
       'DTH_spyld::sp_yld.aqu | change = absval =| unit =      c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.1, 0.35),    # DTH_spyld::sp_yld.aqu | change = absval
       
       'SDTH_esc::esco.hru | change = absval | unit =         c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(0.60 , 0.999),      # SDTH_esc::esco.hru | change = absval                         
       'SDTH_epc::epco.hru | change = absval | unit =         c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(0.001 , 0.999),     # SDTH_epc::epco.hru | change = absval     
       'SDTH_cnn::cn2.hru | change = pctchg | unit =          c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(-30  ,  -20),       # SDTH_cnn::cn2.hru | change = pctchg             
       'SDTH_awc::awc.sol | change = pctchg | unit =          c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(10 , 30),           # SDTH_awc::awc.sol | change = pctchg         
       'SDTH_per::perco.hru | change = absval | unit =        c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(0.82 , 0.95),       # SDTH_per::perco.hru | change = absval  
       'SDTH_latq::latq_co.hru | change = abschg | unit =     c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(-0.15, 0.05),       # SDTH_latq::latq_co.hru | change = abschg      
       'SDTH_cn3::cn3_swf.hru | change = abschg | unit =      c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(0.05, 0.25),        # SDTH_cn3::cn3_swf.hru | change = abschg           
       'SDTH_zso::z.sol | change = pctchg | unit =            c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(15, 25),            # SDTH_zso::z.sol | change = pctchg         
       'SDTH_kso::k.sol | change = pctchg | unit =            c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(-40 , 10),          # SDTH_kso::k.sol | change = pctchg          
       'SDTH_bd::bd.sol | change = pctchg | unit =            c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(-25 , -20),         # SDTH_bd::bd.sol | change = pctchg        
       'SDTH_ovn::ovn.hru | change = pctchg | unit =          c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(-20, 20),           # SDTH_ovn::ovn.hru | change = pctchg
       'SDTH_lattime::lat_ttime.hru | change = absval| unit = c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(0.5, 10),           # SDTH_lattime::lat_ttime.hru | change = absval
       
       'SDTH_alpha::alpha.aqu | change = absval = | unit =      c(31,34,44,64,70,71,74,78,80)' = c(0.001, 0.008),  # SDTH_alpha::alpha.aqu | change = absval
       'SDTH_flomin::flo_min.aqu | change = absval | unit =     c(31,34,44,64,70,71,74,78,80)' = c(10, 20),        # SDTH_flomin::flo_min.aqu | change = absval 
       'SDTH_revapmin::revap_min.aqu | change = absval | unit = c(31,34,44,64,70,71,74,78,80)' = c(0, 12),        # SDTH_revapmin::revap_min.aqu | change = absval 
       'SDTH_revapco::revap_co.aqu | change = absval | unit =   c(31,34,44,64,70,71,74,78,80)' = c(0.02, 0.2),    # SDTH_revapco::revap_co.aqu | change = absval 
       'SDTH_spyld::sp_yld.aqu | change = absval =| unit =      c(31,34,44,64,70,71,74,78,80)' = c(0.1, 0.35),    # SDTH_spyld::sp_yld.aqu | change = absval
       
       
       'DTL_esc::esco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.6 , 0.999),      # DTL_esc::esco.hru | change = absval       
       'DTL_epc::epco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.001 , 0.999),    # DTL_epc::epco.hru | change = absval  
       'DTL_cnn::cn2.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999  ,  -10),  # DTL_cnn::cn2.hru | change = pctchg       
       'DTL_awc::awc.sol | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(30 , 59.999),      # DTL_awc::awc.sol | change = pctchg    
       'DTL_per::perco.hru | change = absval | unit =        c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.4 , 0.7),        # DTL_per::perco.hru | change = absval
       'DTL_latq::latq_co.hru | change = abschg | unit =     c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_latq::latq_co.hru | change = abschg    
       'DTL_cn3::cn3_swf.hru | change = abschg | unit =      c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_cn3::cn3_swf.hru | change = abschg        
       'DTL_zso::z.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(30 , 49.999),      # DTL_zso::z.sol | change = pctchg 
       'DTL_kso::k.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-79.999 , 0),     # DTL_kso::k.sol | change = pctchg 
       'DTL_bd::bd.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999 , -10),    # DTL_bd::bd.sol | change = pctchg 
       'DTL_ovn::ovn.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-20, 20),          # DTH_ovn::ovn.hru | change = pctchg
       'DTL_lattime::lat_ttime.hru | change = absval| unit = c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.5, 80),          # DTH_lattime::lat_ttime.hru | change = absval
       
       'DTL_alpha::alpha.aqu | change = absval = | unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.001, 0.02),   # DTL_alpha::alpha.aqu | change = absval
       'DTL_flomin::flo_min.aqu | change = absval | unit =     c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(5, 20),         # DTL_flomin::flo_min.aqu | change = absval 
       'DTL_revapmin::revap_min.aqu | change = absval | unit = c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0, 10),         # DTL_revapmin::revap_min.aqu | change = absval 
       'DTL_revapco::revap_co.aqu | change = absval | unit =   c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.02, 0.2),     # DTL_revapco::revap_co.aqu | change = absval 
       'DTL_spyld::sp_yld.aqu | change = absval =| unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.00001, 0.3))  # DTL_spyld::sp_yld.aqu | change = absval
     
     
     # Proving that all HRUs and Aquifers are being parameterized
     
     IMP_hrus <- c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)
     SIMP_hrus <- c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)
     MET_hrus <- c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)
     SMET_hrus <- c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)
     CRB_hrus <- c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)
     SCRB_hrus <- c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)
     S2CRB_hrus <- c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)
     DTH_hrus <- c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)
     SDTH_hrus <- c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)
     DTL_hrus <- c(7:42,336:363,383:431,467:492,607:614,777:857,888:944,983:1051,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)
     length(IMP_hrus)+length(SIMP_hrus)+length(MET_hrus)+length(SMET_hrus)+length(CRB_hrus)+length(SCRB_hrus)+length(S2CRB_hrus)+length(DTH_hrus)+length(SDTH_hrus)+length(DTL_hrus) # 22089 ok
     
     IMP_aqus <- c(24,33,37,42,45,47,48,57,60,61,63,68,69)
     SIMP_aqus <- c(107,109,110,114,117,118)
     MET_aqus <- c(1,2,3,5,7,9,11,108,122)
     SMET_aqus <- c(113, 119)
     CRB_aqus <- c(8,25,30,38,41,43,54,56,62)
     SCRB_aqus <- c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)
     S2CRB_aqus <- c(104, 120)
     DTH_aqus <- c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)
     SDTH_aqus <- c(31,34,44,64,70,71,74,78,80)
     DTL_aqus <- c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)
     
     length(IMP_aqus)+length(SIMP_aqus)+length(MET_aqus)+length(SMET_aqus)+length(CRB_aqus)+length(SCRB_aqus)+length(S2CRB_aqus)+length(DTH_aqus)+length(SDTH_aqus)+length(DTL_aqus) # 126 ok
     
     
     
     
     # Number of Simulations
     n_sample <- 1000
     #Numer of parameters
     n_par <- ncol(hc_par_bound_zonal_4)
     
     #Random sampling with Latin Hypercube
     par_zonal_tag <- randomLHS(n = n_sample, k = n_par) %>% # Perform sampling
       as_tibble(., .name_repair = 'minimal') %>% # Convert to a tibble
       set_names(names(hc_par_bound_zonal_2)) %>% # Assign the parameter names with purrr
       map2_df(., hc_par_bound_zonal_2, ~ (.x * (.y[2] - .y[1]) + .y[1]))
     
     
     ######## Run simulations ######## 
     
     sim_tagus_hcr3 <-  run_swatplus(project_path = tagus_path,
                                     output = list(
                                       ls_pcp   = define_output(file = 'lsunit_wb_yr', 
                                                                variable = 'precip', 
                                                                unit = 1:1450),
                                       # ls_et    = define_output(file = 'lsunit_wb_yr', 
                                       #                          variable = 'et', 
                                       #                          unit = used_lsus),
                                       ls_surq_gen   = define_output(file = 'lsunit_wb_yr',   # SURQ_CHA + SURQ_RES = SURQ_GEN - SURQ_LS
                                                                     variable = 'surq_gen', 
                                                                     unit = 1:1450),
                                       ls_surq_ls   = define_output(file = 'lsunit_wb_yr', 
                                                                    variable = 'surq_ls', 
                                                                    unit  = 1:1450),
                                       # ls_latqgen   = define_output(file = 'lsunit_wb_yr',  # LATQGEN - LATQLS = LATQ_CHA + LATQ_GEN
                                       #                              variable = 'latq', 
                                       #                              unit = used_lsus),
                                       # ls_latqls   = define_output(file = 'lsunit_wb_yr', 
                                       #                             variable = 'latq_ls', 
                                       #                             unit = used_lsus),
                                       ls_latqcha   = define_output(file = 'lsunit_wb_yr',  # LATQ = LATQCHA + LATQRES
                                                                    variable = 'latq_cha', 
                                                                    unit = 1:1450),
                                       ls_latqres   = define_output(file = 'lsunit_wb_yr', 
                                                                    variable = 'latq_res', 
                                                                    unit = 1:1450),
                                       #  ls_perc   = define_output(file = 'lsunit_wb_yr', 
                                       #                            variable = 'perc', 
                                       #                            unit = used_lsus),
                                       #  basin_pcp = define_output(file = 'basin_wb_yr',
                                       #                            variable = "precip",
                                       #                            unit = 1), 
                                       #  basin_et = define_output(file = 'basin_wb_yr',
                                       #                           variable = 'et',
                                       #                           unit = 1), 
                                       #  basin_perco = define_output(file = 'basin_wb_yr',
                                       #                              variable = 'perc',
                                       #                              unit = 1),
                                       #  basin_surqgen = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'surq_gen',
                                       #                                unit = 1),
                                       #  basin_surqls = define_output(file = 'basin_wb_yr',
                                       #                               variable = 'surq_ls',
                                       #                               unit = 1),
                                       #  basin_surqcha = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'surq_cha',
                                       #                                unit = 1),
                                       #  basin_surqres = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'surq_res',
                                       #                                unit = 1),
                                       #  basin_latqcha = define_output(file = 'basin_wb_yr',
                                       #                                variable = 'latq_cha',
                                       #                                unit = 1),
                                       #  basin_latqqres = define_output(file = 'basin_wb_yr',
                                       #                                 variable = 'latq_res',
                                       #                                 unit = 1),
                                       #  basin_perco = define_output(file = 'basin_wb_yr',
                                       #                              variable = 'perc',
                                       #                              unit = 1),
                                       #  basin_gwflo = define_output(file = 'basin_aqu_yr',
                                       #                              variable = 'flo',
                                       #                              unit = 1),
                                       aqu_gwflocha = define_output(file = 'aquifer_yr',
                                                                    variable = 'flo_cha',
                                                                    unit = 1:126),
                                       aqu_gwres = define_output(file = 'aquifer_yr',
                                                                 variable = 'flo_res',
                                                                 unit =    1:126),
                                       #  aqu_gwtot = define_output(file = 'aquifer_yr',
                                       #                            variable = 'flo',
                                       #                            unit = used_quifers),
                                       # aqu_stor = define_output(file = 'aquifer_yr',
                                       #                          variable = 'stor',
                                       #                          unit = 1:126),
                                       # aqu_rchrg = define_output(file = 'aquifer_yr',
                                       #                           variable = 'rchrg',
                                       #                           unit = 1:126),
                                       # res_in = define_output(file = 'reservoir_yr',          #For round 3
                                       #                        variable = 'flo_in',      #For round 3        
                                       #                        unit = 1:31),             #For round 3 
                                       # res_stor = define_output(file = 'reservoir_yr',        #For round 3      
                                       #                          variable = 'flo_stor',    #For round 3          
                                       #                          unit = 1:31),             #For round 3 
                                       # res_out = define_output(file = 'reservoir_yr',         #For round 3     
                                       #                         variable = 'flo_out',     #For round 3         
                                       #                         unit = 1:31),             #For round 3             
                                       flow_cha = define_output(file = "channel_sd_day", 
                                                                variable = "flo_out",
                                                                unit = c(561, 750, 11, 1218, 567, 825, 564, 630, 532, 962,
                                                                         990, 541, 950, 149, 376, 535, 537, 1141, 1161, 14,
                                                                         947, 184, 525, 573, 208, 111, 949, 581, 452))),#, 444,
                                     #155, 185, 504, 161, 459, 929, 133, 176, 483, 911, 882 ,1076))), #For round 3
                                     parameter = par_zonal_tag,
                                     start_date = 20050101,
                                     end_date = 20141231,
                                     start_date_print = 20100101,
                                     n_thread = 60)
     
     
     
     ##### ROUND 4 RESULTS EXTRACTION #####
     
     
     ######## File with observed data creation ######## 
     
     # Basins data file
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     gauging_codes <- basins_file$indroea
     
     
     ######## File with simulated data creation: Streamflow ######## 
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     # Some of the gauging stations collect the water from more than one channel and therefore the streamflow has been recalculated 
     # Others only drains part of the subbasin, and has been therefore corrected by the drainaged fraction
     
     chanels <- read_rds("Data/Simulations/Round_4/round_4_HC_Tagus.rds") # Simulated data
     
     
     navaluenga <- tibble(date = chanels$simulation$flow_cha_561$date, chanels$simulation$flow_cha_561[,-1]+ chanels$simulation$flow_cha_750[,-1] )
     
     matallana <-  chanels$simulation$flow_cha_11
     
     villarejo <-  chanels$simulation$flow_cha_1218
     
     peralejo <- tibble(date = chanels$simulation$flow_cha_567$date, chanels$simulation$flow_cha_567[,-1]+ chanels$simulation$flow_cha_825[,-1] )
     
     priego_escabas <- tibble(date = chanels$simulation$flow_cha_564$date, chanels$simulation$flow_cha_564[,-1] * (1/1.05)) #  The gauging station it is not at the end of the channel
     
     santa_maria_val <- chanels$simulation$flow_cha_630
     
     javalera <- tibble(date = chanels$simulation$flow_cha_532$date, chanels$simulation$flow_cha_532[,-1]*(1/1.4)) # The gauging station it is not at the end of the channel
     
     huete <- tibble(date = chanels$simulation$flow_cha_962$date, chanels$simulation$flow_cha_962[,-1]+ chanels$simulation$flow_cha_990[,-1] )
     
     torote <- chanels$simulation$flow_cha_541
     
     puebla_nueva <-  chanels$simulation$flow_cha_950
     
     ventosa <- tibble(date = chanels$simulation$flow_cha_149$date, chanels$simulation$flow_cha_149[,-1]+ chanels$simulation$flow_cha_376[,-1] )
     
     peraleja <- tibble(date = chanels$simulation$flow_cha_535$date, chanels$simulation$flow_cha_535[,-1]+ chanels$simulation$flow_cha_537[,-1] )
     
     villasequilla <- tibble(date = chanels$simulation$flow_cha_1141$date, chanels$simulation$flow_cha_1141[,-1]+ chanels$simulation$flow_cha_1161[,-1] ) # The gauging station it is not at the end of the channel
     
     valverde <- tibble(date = chanels$simulation$flow_cha_14$date, chanels$simulation$flow_cha_14[,-1]*(1/1.05))
     
     malpica <- chanels$simulation$flow_cha_947
     
     taravillas <- tibble(date = chanels$simulation$flow_cha_184$date, chanels$simulation$flow_cha_184[,-1]*(1/1.13))
     
     romanones <- chanels$simulation$flow_cha_525
     
     priego_trabraque <- tibble(date = chanels$simulation$flow_cha_573$date, chanels$simulation$flow_cha_573[,-1]*(1/1.05) ) # The gauging station it is not at the end of the channel
     
     aragosa <- tibble(date = chanels$simulation$flow_cha_208$date, chanels$simulation$flow_cha_208[,-1]*(1/1.24) ) # The gauging station it is not at the end of the channel
     
     trillo <- chanels$simulation$flow_cha_111
     
     valdecaba <- chanels$simulation$flow_cha_949
     
     villamantilla <- chanels$simulation$flow_cha_581
     
     
     # A list is created and saved for each subbasin
     sim_cha_list <- list(navaluenga, matallana, villarejo, peralejo, priego_escabas, santa_maria_val, javalera, huete, torote, puebla_nueva,
                          ventosa, peraleja, villasequilla, valverde, malpica, taravillas, romanones,  priego_trabraque, aragosa, trillo,  valdecaba, villamantilla) 
     
     names(sim_cha_list) <- subbasins_names
     
     write_rds(sim_cha_list, "Data/Simulations/Round_4/round_4_simulated_list.rds")
     
     
     ######## File with simulated data creation: Hydrological variables annual values ######### 
     
     sim_tagus_hcr4_wb <- read_rds("Data/Simulations/Round_4/round_4_HC_Tagus.rds") # Simulated data
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     lsus_subbasins_shp <- read_sf("Data/GIS/hardcal_shapes/studied_lsus/lsus_prop_final.shp") # LSUS per regions and per subbasins 
     studied_subb <- read_sf("Data/GIS/hardcal_shapes/subbasins/hardcal_natural_basins.shp") # Subbasins analysed
     
     ########  Run to extract variables ########  
     # LSUS data extraction and aggregation
     
     lsus_studied <- lsus_subbasins_shp %>%  st_drop_geometry()
     
     # List extraction: Precipitation
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_pcp_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_pcp <- sim_tagus_hcr4_wb$simulation[grepl("ls_pcp", names(sim_tagus_hcr4_wb$simulation))] #%>% .[lsus_data$namelist]
     
     # Calculating the average pcp for each subbasin in mm
     
     basin_pcps <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       lsus_area_sum <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_area_m")] %>% 
         sum(.)
       
       lsus_basin <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_id_rea", "area_frac")]
       
       basin_lsus_pcp <- lsus_pcp[lsus_basin$lsu_id_rea]
       
       av_pcps <- c(1:1000)
       
       for(f in 1:length(basin_lsus_pcp)){
         
         av_pcp <- basin_lsus_pcp[[f]][,-1] %>% apply(., 2, mean) %>% data.frame(pcp_mm = .) %>% mutate(pcp_mm = pcp_mm* lsus_basin$area_frac[f]) # Calculate the mm generated in each lsu taking into account the entire basin area
         
         av_pcps <- av_pcps %>% cbind(av_pcp) 
         
       }
       
       av_lsu_pcps <- tibble(av_pcp_mm = av_pcps[,-1] ) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_pcp <- av_lsu_pcps %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_pcp <- basin_pcp %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_pcp_mm)
       
       basin_pcps[[i]] = basin_pcp # List with the pcp for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_pcp = paste("pcp_basin", Basin_ID, sep = ""))
     names(basin_pcps) <- namms$names_pcp
     
     
     
     # List extraction: Surface runoff (SURQ = SURQ_GEN - SURQ_LS)
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_gen_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqgen <- sim_tagus_hcr4_wb$simulation[grepl("ls_surq_gen", names(sim_tagus_hcr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_ls_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqls <- sim_tagus_hcr4_wb$simulation[grepl("ls_surq_ls", names(sim_tagus_hcr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     # Calculating the total surq in mm for each lsu considering their relative area regarding the subbasin
     lsu_surqtot <- list()
     for(i in 1:length(lsus_surqgen)){
       
       lsu_surqtot[[i]] <- ((lsus_surqgen[[i]][,-1] - lsus_surqls[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_surqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_surq_basin", lsus_data$Basin_ID, sep = "")
     
     # Calculating the total surq for each subbasin in mm
     
     basin_surqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_surqtot))
       
       selected_lsus <- lsu_surqtot[bas_select]
       
       av_surqs <- c(1:1000)
       
       for(f in 1:length(selected_lsus)){
         
         av_surq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_surqs <- av_surqs %>% cbind(av_surq) 
         
       }
       
       av_surqs <- tibble(av_surq_mm = av_surqs[,-1]) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_surq <- av_surqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_surq <- basin_surq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_surq_mm)
       
       
       basin_surqs[[i]] = basin_surq # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_surqtot = paste("total_surq_basin", Basin_ID, sep = ""))
     names(basin_surqs) <- namms$names_surqtot
     
     
     # List extraction: Lateral flow (LATQ = LATQ_CHA + LATQ_RES)
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqcha_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqcha <- sim_tagus_hcr4_wb$simulation[grepl("ls_latqcha", names(sim_tagus_hcr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqres_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqres <- sim_tagus_hcr4_wb$simulation[grepl("ls_latqres", names(sim_tagus_hcr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     # Calculating the total latq in mm for each lsu considering their relative area regarding the subbasin
     lsu_latqtot <- list()
     for(i in 1:length(lsus_latqcha)){
       
       lsu_latqtot[[i]] <- ((lsus_latqcha[[i]][,-1] + lsus_latqres[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_latqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_latq_basin", lsus_data$Basin_ID, sep = "")
     
     # Calculating the total latqq for each subbasin in mm
     
     basin_latqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_latqtot))
       
       selected_lsus <- lsu_latqtot[bas_select]
       
       av_latqs <- c(1:1000)
       
       for(f in 1:length(selected_lsus)){
         
         av_latq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_latqs <- av_latqs %>% cbind(av_latq) 
         
       }
       
       av_latqs <- tibble(av_latq_mm = av_latqs[,-1]) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_latq <- av_latqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_latq <- basin_latq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_latq_mm)
       
       
       basin_latqs[[i]] = basin_latq # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_latqtot = paste("total_latq_basin", Basin_ID, sep = ""))
     names(basin_latqs) <- namms$names_latqtot
     
     
     
     # Aquifers data: Calculated using flo + flo_res. For some aquifers, the relative drainage area to the gauginG stations has been used 
     # (aquif_data$fact_corr, previously calculated with QGIS)
     
     aquifers_studied <- read_sf("Data/GIS/hardcal_shapes/studied_aquifers/aquifers_selected.shp") %>% arrange(., Basin_ID)
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     
     # List extraction: GWFLO_CHA and GWFLO_RES
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwflocha_", Aq_id , sep = ""))
     aquifers_flocha <- sim_tagus_hcr4_wb$simulation[grepl("aqu_gwflocha", names(sim_tagus_hcr4_wb$simulation))] %>% .[aquif_data$namelist]
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwres_", Aq_id , sep = ""))
     aquifers_flores <- sim_tagus_hcr4_wb$simulation[grepl("aqu_gwres", names(sim_tagus_hcr4_wb$simulation))] %>% .[aquif_data$namelist]
     
     
     # Calculating the total gwflo in liters for each aquifer
     aquif_flo_tot_litres <- list()
     for(i in 1:length(aquifers_flocha)){
       
       aquif_flo_tot_litres[[i]] <- ((aquifers_flocha[[i]][,-1] + aquifers_flores[[i]][,-1]) * ( aquif_data$Area_km[i] * 1000000 * aquif_data$fact_corr[i])) %>% tibble(.)
       
     }
     
     names(aquif_flo_tot_litres) <- paste("aqu_", aquif_data$Aq_id, "totalflo_lit_basin", aquif_data$Basin_ID, sep = "")
     
     
     # Calculating the total flo for each subbasin in mm
     
     basin_gwflos <- list()
     for(i in 1:length(unique(aquif_data$Basin_ID))){
       
       aquifers_area_sum <- aquif_data %>% 
         filter(Basin_ID == unique(aquif_data$Basin_ID)[i]) %>% .[,c("fact_corr","Area_km")] %>% 
         mutate(real_area = fact_corr * Area_km) %>% .[, "real_area" ] %>% 
         sum(.)*1e6
       
       bas_select <- paste("basin",unique(aquif_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(aquif_flo_tot_litres))
       
       selected_aqus <- aquif_flo_tot_litres[bas_select]
       
       av_gwflos <- c(1:1000)
       
       for(f in 1:length(selected_aqus)){
         
         av_gwflo <- selected_aqus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_gwflos <- av_gwflos %>% cbind(av_gwflo) 
         
       }
       
       av_gwflos <- tibble(av_gwflo_mm = av_gwflos[,-1] / aquifers_area_sum) %>% cbind(run = c(1:1000))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_gwflo <- av_gwflos %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_gwflo <- basin_gwflo %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_gwflo_mm)
       
       basin_gwflos[[i]] = basin_gwflo # List with the gwflo for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_gwtot = paste("total_gwflo_basin", Basin_ID, sep = ""))
     names(basin_gwflos) <- namms$names_gwtot
     
     # Creating a table with all the extracted data
     subb_tables <- list()
     for(i in 1:length(basin_gwflos)){
       pcp <- tibble(basin_pcps[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "pcp")
       latq <- tibble(basin_latqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "latq")
       surq <- tibble(basin_surqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "surq")
       gwflo <- tibble(basin_gwflos[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "gwflo")
       
       subb_table <- pcp %>%  left_join(., latq, "name")%>%  left_join(., surq, "name")%>%  left_join(., gwflo, "name") %>% 
         mutate(water_yield = latq + surq + gwflo) %>% 
         mutate(runoff_coeff = water_yield / pcp,
                gw_cont = gwflo / water_yield) %>% 
         mutate(Basin = basins_file$Basin[i],
                Basin_ID = basins_file$Basin_ID[i], 
                region = basins_file$region[i]) %>% 
         rename(run = name) %>% 
         .[,c("Basin_ID", "Basin", "region", "run",  "pcp",  "water_yield", "latq", "surq", "gwflo",  "runoff_coeff", "gw_cont" )]
       
       subb_tables[[i]] <- subb_table
       
     }
     
     namms <- paste("tab", basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     names(subb_tables) <- namms
     
     # write_rds(subb_tables, "Data/Results/R3/HC_Round1_basinswb.rds")
     
     table_all <- c()
     for(m in 1:length(subb_tables)){
       
       tab <- subb_tables[[m]]
       table_all <- table_all %>% rbind(., tab)
     }
     
     ######## Run to save variables ######## 
     write_csv(table_all, "Data/Results/R4/HC_Round4_basinswb.csv", quote = "none")
     
     ######## Calculate streamflow simulation performance ######## 
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     observed_streamflow <- read_rds("Data/Simulations/list_observed_data.rds")
     simulated_streamflow  <- read_rds("Data/Simulations/Round_4/round_4_simulated_list.rds") # Simulated data (previously saved)
     
     evaluated_period <- c(2010:2014)
     number_simulations <- c(1000)
     
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2  # Function to calculate R3
     
     
     streamflow_metrics <- c()
     streamflo_metrics_list <- list()
     
     for(i in 1:length(observed_streamflow)){
       
       obs <- observed_streamflow[[i]] %>% mutate(fecha = ymd(fecha)) %>% 
         filter(year(fecha) %in% evaluated_period)
       
       sim <- simulated_streamflow[[i]]%>% mutate(date = ymd(date)) %>% 
         filter(., date %in% ymd(min(obs$fecha)):ymd(max(obs$fecha))) # Days without observed data does not compute
       
       nses <-  sim %>% select(-date) %>% 
         map_dbl(., ~NSE( .x, obs$caudal))
       r2s <-  sim %>% select(-date) %>% 
         map_dbl(., ~rsq_r2( .x, obs$caudal))
       pbias <-  sim %>% select(-date) %>% 
         map_dbl(., ~pbias( .x, obs$caudal))
       rmses <-  sim %>% select(-date) %>% 
         map_dbl(., ~rmse( .x, obs$caudal))
       
       tab <-  tibble(Subbasin_ID = basins_file$Basin_ID[i], Subbasin = basins_file$Basin[i] , 
                      region = basins_file$region[i], nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = c(1:number_simulations))
       
       streamflow_metrics <- streamflow_metrics %>% rbind(., tab)
       streamflo_metrics_list[[i]] <- tab
     }
     
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     names(streamflo_metrics_list) <- subbasins_names
     
     
     write.csv(streamflow_metrics, "Data/Results/R4/HC_Round4_streamflow_metrics_allchanel.csv", row.names = F, quote = F)
     # write_rds(streamflo_metrics_list, "Data/Results/R3/HC_Round3_streamflow_metrics_allchanel.rds")
     
     ######## Combine results and created plots for parameters constrain  ########  
     
     # Merge results in one table
     
     streamflow_metrics <- read_csv("Data/Results/R4/HC_Round4_streamflow_metrics_allchanel.csv")
     
     waterbalances <- read_csv("Data/Results/R4/HC_Round4_basinswb.csv") %>% 
       select(Basin_ID, run, runoff_coeff, gw_cont) %>%  mutate(run = as.numeric(str_remove(run, "run_")))
     
     table_constrain <-  streamflow_metrics %>% left_join(., waterbalances, c("Subbasin_ID" = "Basin_ID", "run")) %>% 
       .[,c( "Subbasin_ID",    "Subbasin", "region", "run", "nse","r2","pbias", "rmse", "runoff_coeff", "gw_cont")]
     
     # Extract parameter sets    
     
     parameters_data <- read_rds("Data/Simulations/Round_4/round_4_HC_Tagus.rds") %>% .[1]
     par_values <- parameters_data$parameter$values
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     subbasins <- basins_file$Basin
     region <- basins_file$region
     
     
     ######## Plots creation ######## 
     
     # Plot 1: Distribution of variables for each subbasin
     
     viol_plots <- list()
     
     for(i in 1:length(basins_file$Basin_ID)){
       
       tabb_metrics <- table_constrain %>% filter(Subbasin_ID == basins_file$Basin_ID[i]) %>% 
         rename("NSE" = "nse", "R?" = "r2", "PBIAS" = "pbias", RMSE = "rmse", "Runoff coefficient" = "runoff_coeff" , "Goundwater contribution" = "gw_cont")
       
       viol_plot <- tabb_metrics %>% 
         pivot_longer(., -c("Subbasin_ID",  "Subbasin", "region", "run")) %>% 
         mutate(name = factor(name, levels = c("NSE", "R2", "PBIAS", "RMSE", "Runoff coefficient", "Goundwater contribution"))) %>% 
         ggplot(aes(x = name, y = value, fill = name))+ geom_violin()+
         facet_wrap(facets = "name", scales = "free")+
         theme_bw()+
         theme( strip.text = element_blank(), legend.position = "nuop", text = element_text(size = 18, face = "bold"), axis.title = element_blank())+
         ggtitle(paste("Basin ",basins_file$Basin_ID[i], ": ", basins_file$Basin[i],  " (",basins_file$region[i] , ")", sep = ""))
       
       viol_plots[[i]] <- viol_plot
       
       ggsave(plot = viol_plot, 
              filename = paste("Data/Figures/R4/results_basins/", basins_file$Basin_ID[i], "_", str_replace_all(basins_file$Basin, " ", "_")[i], ".png", sep = ""),
              device = "png", 
              dpi = 300, width = 16, height = 12) 
     }
     
     # Plots 2: Effect of each parameter in the affected subbasins (subbasins with part o a certain lithologhy)
     
     IMP_subbasins <- c(1, 21, 22) # Subbasins with at least one LSU with impervious geology
     MET_subbasins <- c(2, 3, 10, 14, 15)
     CRB_subbasins <- c(4, 5, 6, 14, 19, 20) # Subbasins with at least one LSU with carbonate geology
     SCRB_subbasins <- c(11, 13, 16, 17, 20) # Subbasins with at least one LSU with carbonate geology
     DTH_subbasins <- c(9, 10, 15, 22) # Subbasins with at least one LSU with high permeability detrital geology
     SDTH_subbasins <- c(5, 7, 8, 12, 13, 18) # Subbasins with at least one LSU with high permeability detrital geology
     DTL_subbasins <- c(8, 11:14, 17:20 ) # Subbasins with at least one LSU with low permeability detrital geology
     
     
     ## IMP Region
     
     subbasins_values <- list(
       "1" = "Navaluenga (IMP)",
       "21" = "Valdecaba (IMP)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_IMP <- par_values %>% select(starts_with("IMP"))#, c(surlag, chn))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(IMP_subbasins, levels = c(1, 21, 22)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_IMP)){
       parameter_name <- colnames(parameters_IMP[i])[1]
       parameter <- tibble(parameter = parameters_IMP[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(1, 3, 21, 22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 4)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R4/IMP_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     ## MET Region
     
     subbasins_values <- list(
       "2" = "Matallana (MET)",
       "3" = "Villarejo de Montalban (MET)",
       "10" = "La Pueblanueva (MIX)",
       "14" = "Valverde de los Arroyos (MIX)",
       "15" = "Malpica (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_MET <- par_values %>% select(starts_with("MET"))#, c(surlag, chn))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(MET_subbasins, levels = c(2, 3, 10, 14 ,15)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_MET)){
       parameter_name <- colnames(parameters_MET[i])[1]
       parameter <- tibble(parameter = parameters_MET[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(2, 3, 10, 14 ,15)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 3)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R4/MET_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## CRB Region
     
     subbasins_values <- list(
       "4"     =   "Peralejo de las Truchas (CRB)",
       "5"     =            "Priego Escabas (CRB)",
       "6"     =       "Santa Maria del Val (CRB)",
       "14"     =   "Valverde de los Arroyos (MIX)", 
       "19"     =                   "Aragosa (MIX)", 
       "20"     =                    "Trillo (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     
     
     parameters_CRB <- par_values %>% select(starts_with("CRB") )#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(CRB_subbasins, levels = c(4, 5, 6, 14, 19, 20)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     
     for(i in 1:length(parameters_CRB)){
       parameter_name <- colnames(parameters_CRB[i])[1]
       parameter <- tibble(parameter = parameters_CRB[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(4, 5, 6, 14, 19, 20)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 3)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R4/CRB_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## SCRB Region
     
     subbasins_values <- list(
       "11"     =                   "Ventosa (DTL)", 
       "13"     =    "Villasequilla de Yepes (DTL)", 
       "16"     =                "Taravillas (MIX)", 
       "17"     =                 "Romanones (MIX)", 
       "20"     =                    "Trillo (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     
     
     parameters_SCRB <- par_values %>% select(starts_with("SCRB") )#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(SCRB_subbasins, levels = c(11, 13, 16, 17, 20)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     
     for(i in 1:length(parameters_SCRB)){
       parameter_name <- colnames(parameters_SCRB[i])[1]
       parameter <- tibble(parameter = parameters_SCRB[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(11, 13, 16, 17, 20)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 3)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R4/SCRB_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## DTH Region
     
     subbasins_values <- list(
       "9" = "Torote (DTH)",
       "10" = "La Pueblanueva (DTH)",
       "15" = "Malpica (MIX)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_DTH <- par_values %>% select(starts_with("DTH"))#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(DTH_subbasins, levels = c(9, 10, 15, 22)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_DTH)){
       parameter_name <- colnames(parameters_DTH[i])[1]
       parameter <- tibble(parameter = parameters_DTH[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(9, 10, 15, 22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 5)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R4/DTH_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## SDTH Region
     
     subbasins_values <- list(
       "5" = "Priego Escabas (CRB)",
       "7" = "Jabalera (DTH)",
       "8" = "Huete (DTH)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "18" = "Priego Trabraque (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_SDTH <- par_values %>% select(starts_with("SDTH"))#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(SDTH_subbasins, levels = c(5, 7, 8, 12, 13, 18)))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_SDTH)){
       parameter_name <- colnames(parameters_SDTH[i])[1]
       parameter <- tibble(parameter = parameters_SDTH[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(5, 7, 8, 12, 13, 18)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 3)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R4/SDTH_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width = 16 , height =  12, dpi = 300)
       }
     }
     
     
     ## DTL Region
     
     subbasins_values <- list(
       "8" = "Huete (DTH)",
       "11" = "Ventosa (DTL)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "14" = "Valverde de los Arroyos (MIX)",
       "17" = "Romanones (MIX)",
       "18" = "Priego Trabraque (MIX)",
       "19" = "Aragosa (MIX)",
       "20" = "Trillo (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_DTL <- par_values %>% select(starts_with("DTL"))#, c(surlag, chn)))
     metric_values <- table_constrain %>% filter(Subbasin_ID %in% factor(DTL_subbasins, levels = c(8, 11:14, 17:20 )))
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_DTL)){
       parameter_name <- colnames(parameters_DTL[i])[1]
       parameter <- tibble(parameter = parameters_DTL[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(8, 11:14, 17:20)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 5)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/DTL_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width =  16 , height =  12, dpi = 300)
       }
     }
     
     # Parameters common to all subbasins
     
     subbasins_values <- list(
       "1" = "Navaluenga (IMP)",
       "2" = "Matallana (MET)",
       "3" = "Villarejo de Montalban (IMP)",
       "4"     =   "Peralejo de las Truchas (CRB)",
       "5" = "Priego Escabas (CRB)",
       "6"     =       "Santa Maria del Val (CRB)",
       "7" = "Jabalera (DTH)",
       "8" = "Huete (DTH)",
       "9" = "Torote (DTH)",
       "10" = "La Pueblanueva (DTH)",
       "11" = "Ventosa (DTL)",
       "12" = "La Peraleja (DTL)",
       "13" = "Villasequilla de Yepes (DTL)",
       "14" = "Valverde de los Arroyos (MIX)",
       "15" = "Malpica (MIX)",
       "16" = "Taravillas (MIX)", 
       "17" = "Romanones (MIX)",
       "18" = "Priego Trabraque (MIX)",
       "19" = "Aragosa (MIX)",
       "20" = "Trillo (MIX)",
       "21" = "Valdecaba (IMP)",
       "22" = "Villamantilla (MIX)")
     subbasin_labeller <- function(variable,value){
       return(subbasins_values[value])
     }
     
     parameters_com <- par_values %>% select(surlag, chn)
     metric_values <- table_constrain 
     
     metrics <- colnames(table_constrain) # 5:10
     
     for(i in 1:length(parameters_com)){
       parameter_name <- colnames(parameters_com[i])[1]
       parameter <- tibble(parameter = parameters_com[[i]], run = c(1:1000))
       for(n in 5:10){
         tab <-  metric_values %>% left_join(., parameter, "run") %>%
           select(Subbasin, metrics[n], parameter, Subbasin_ID) %>%
           mutate(Subbasin_ID= factor(Subbasin_ID, levels = c(1:22)))
         colnames(tab) <-  c("Subbasin", "metric", "parameter", "Subbasin_ID")
         plot_eff <-  tab %>%
           ggplot(., aes(x = parameter, y = metric))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "Subbasin_ID", scales = "free", labeller = subbasin_labeller, ncol = 6)+ theme_bw()+
           ggtitle("")+ labs(y = toupper(metrics[n]), x = paste("Parameter change : ", parameter_name))+
           ggtitle(parameter_name)+ theme(text = element_text(size = 15), title = element_text(size = 18, face = "bold"))
         ggsave(plot = plot_eff, filename = paste("Data/Figures/R3/Common_constrain/", i, "_", parameter_name, "_", metrics[n],  ".png", sep = ""),
                device = "png", width =  16 , height =  12, dpi = 300)
       }
     }
     
     # These plots are analyzed in power point to constrain the parameters and continue with the following Round
     
     
     ##### Extract results and generate plots for reservoirs inflow #####     
     
     # Reservoirs data
     
     reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv")
     
     # Simulated data
     
     simulation <- chanels
     
     # Parameters
     
     
     
     # Creating and exporting lists with observed-simulated data 
     
     evaluated_period <- c(2010:2019)
     
     
     res_studied <- reservoirs_data %>% mutate(namelist = paste("res_in_", Lake_id , sep = "")) %>% arrange(., Lake_id)
     res_sim_inflow <- simulation$simulation[grepl("res_in_", names(simulation$simulation))] 
     
     
     res_inflows <- list()
     
     for(i in 1: length(res_sim_inflow)){
       
       res_inflow <- res_sim_inflow[[i]]
       
       res_inflow <- tibble(res_inflow[,1], reservoir = paste("lake_", i, sep = ""), res_inflow[,-1]/86400)
       
       res_inflows[[i]] <- res_inflow
       
     }
     names(res_inflows) <- str_replace(unique(names(res_sim_inflow)), "res_in_", "lake_")
     
     write_rds(res_inflows, "Data/Reservoirs/Simulation/Round_4_reservoirs_sim.rds")
     
    
     
     
     # Loading saved data
     
     observed_inflow <- read_rds("Data/Reservoirs/Simulation/observed_reservoir_inflow.rds") 
     res_inflows <- read_rds("Data/Reservoirs/Simulation/Round_4_reservoirs_sim.rds")
     
     
     # Calculating performance for reservoirs inflow
     
     # Funtion to calculate coeficient of determination
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2 
     
     
     evaluated_period <- c(2010:2014)
     number_simulations <- 1000
     
     
     streamflow_metrics_res <- c()
     
     for(i in 1:length(observed_inflow)){
       
       lake <- names(observed_inflow[i])
       
       obs <- observed_inflow[[lake]] %>% 
         filter(year(date) %in% evaluated_period) %>% 
         group_by(year(date), month(date)) %>% 
         summarise(obsflow_m3s = mean(obsflow_m3s)) %>% 
         mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
         ungroup(.) %>% 
         select(., date, obsflow_m3s)
       
       sim <- res_inflows[[lake]] %>% 
         filter(., date %in% ymd(min(obs$date)):ymd(max(obs$date))) %>% # Days without observed data does not compute
         group_by(year(date), month(date)) %>% 
         summarise(across(starts_with("run"), mean)) %>% 
         mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
         ungroup(.) %>% 
         select(., -c(`year(date)`, `month(date)`))
       
       nses <-  sim %>% select(-c(date)) %>% 
         map_dbl(., ~NSE( .x, obs$obsflow_m3s))
       r2s <-  sim %>% select(-c(, date)) %>%
         map_dbl(., ~rsq_r2( .x, obs$obsflow_m3s))
       pbias <-  sim %>% select(-c(date)) %>%
         map_dbl(., ~pbias( .x, obs$obsflow_m3s))
       rmses <-  sim %>% select(-c(date)) %>%
         map_dbl(., ~rmse( .x, obs$obsflow_m3s))
       
       tab <-  tibble(reservoir = unique(observed_inflow[[i]][[2]]), 
                      nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = c(1:number_simulations))
       
       streamflow_metrics_res <- streamflow_metrics_res %>% rbind(., tab)
       
     }
     
     write_csv(streamflow_metrics_res, "Data/Reservoirs/Results/reservoir_metrics_R4.csv")
     
     
     reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv") %>%
       mutate(Lake_id = paste("lake_", Lake_id, sep = "")) %>% 
       mutate(region = region_r3)
     
     
     # Metrics plots
     
     streamflow_metrics_res <- read_csv("Data/Reservoirs/Results/reservoir_metrics_R4.csv")
     
     int_reservoirs <- c(2, 6, 10, 11, 12, 15, 16, 17, 19, 21, 26, 28, 31) # Focus on reservoirs with no upstream reservoirs and in PBIAS
     
     streamflow_metrics_res <- streamflow_metrics_res %>% 
       filter(reservoir %in% paste("lake_", int_reservoirs, sep = ""))
     
     for(i in 1:length(unique(streamflow_metrics_res$reservoir))){
       
       resdat <- streamflow_metrics_res %>% 
         filter(reservoir == unique(streamflow_metrics_res$reservoir)[i]) %>% 
         pivot_longer(., -c(reservoir, run), names_to = "metric", values_to = "metric_value") %>% 
         left_join(., reservoirs_data[, c("Nombre", "Lake_id", "region")], c("reservoir" = "Lake_id")) 
       
       perf_plot <- resdat %>% 
         ggplot(., aes(x = reservoir, y = metric_value, fill = metric))+
         geom_violin()+
         facet_wrap(facets = "metric", scales = "free")+
         ggtitle(paste(unique(resdat$reservoir), ", ", unique(resdat$Nombre), " (", unique(resdat$region), ")" ,sep = ""))+
         theme_bw()+
         theme(axis.title = element_blank(), legend.position = "nuop")
       
       ggsave(plot = perf_plot,filename =  paste("Data/Reservoirs/Figures/R4/Reservoir_perf/", 
                                                 unique(resdat$reservoir), ".png", sep = ""),device = "png", dpi = 600, height = 10, width = 10)
       
     }
     
     # Parameters effect plot --> compared with the parameters effects on subbasins
     
     parameters <- simulation$parameter$values
     
     streamflow_metrics_res <- read_csv("Data/Reservoirs/Results/reservoir_metrics_R4.csv")
     
     int_reservoirs <- c(2, 6, 10, 11, 12, 15, 16, 17, 19, 21, 26, 28, 31) # Focus on reservoirs with no upstream reservoirs and in PBIAS
     
     
     streamflow_metrics_res <- streamflow_metrics_res %>% 
       filter(reservoir %in% paste("lake_", int_reservoirs, sep = "")) %>% 
       select(-c(nse, r2 ,  rmse))
     
     for(i in 1:length(unique(streamflow_metrics_res$reservoir))){
       
       resdat <- streamflow_metrics_res %>% 
         filter(reservoir == unique(streamflow_metrics_res$reservoir)[i]) %>% 
         pivot_longer(., -c(reservoir, run), names_to = "metric", values_to = "metric_value") %>% 
         left_join(., reservoirs_data[, c("Nombre", "Lake_id", "region")], c("reservoir" = "Lake_id")) 
       
       regions <- unique(resdat$region) %>% str_split(., ", ") %>% unlist(.)
       
       pars <- parameters %>% select(starts_with(regions)) %>% mutate(run = seq(1, length(unique(resdat$run)), 1))
       
       for_res_pars_plot <- resdat %>% 
         left_join(., pars, "run") %>% 
         pivot_longer(., -c(reservoir, run, metric, metric_value, Nombre, region), names_to = "parameter", values_to = "parameter_value") 
       
       for(metric in 1:length(unique(for_res_pars_plot$metric))){
         
         meetric <- unique(for_res_pars_plot$metric)[metric]
         
         tab_pars_res <-  for_res_pars_plot %>% filter(metric == meetric)
         
         pars_eff_plot <- ggplot(tab_pars_res, aes(x = parameter_value, y = metric_value))+
           geom_point()+
           geom_smooth()+
           facet_wrap(facets = "parameter", scales = "free_x")+
           ggtitle(paste(meetric, unique(resdat$reservoir), ", ", unique(resdat$Nombre), " (", unique(resdat$region), ")" ,sep = ""))+
           theme_bw()+
           theme(axis.title = element_blank())
         
         ggsave(plot = pars_eff_plot,filename =  paste("Data/Reservoirs/Figures/R4/Reservoir_pars/",
                                                       unique(resdat$reservoir), meetric, ".png", sep = ""),device = "png", dpi = 600, height = 10, width = 10)
         
       }
     }
     
     
     
#### HARD CAL METRICS AND SOFT VARIABLES EVOLUTION THROUGH CALIBRATION ROUNDS ####
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins <- basins_file$Basin
     region <- basins_file$region
     
     
     rounds_comp <- 4
     table_constrain_all <- c()
     
     for(r in 1:rounds_comp){
       
       metrics_table <- read_csv(paste("Data/Results/R", r, "/HC_Round", r, "_streamflow_metrics_allchanel.csv", sep = ""))
       
       wb_table <- read.csv(paste("Data/Results/R", r, "/HC_Round", r, "_basinswb.csv", sep = "")) %>% 
         select(Basin_ID, run, runoff_coeff, gw_cont) %>%  mutate(run = as.numeric(str_remove(run, "run_")))
       
       table_constrain <-   metrics_table %>% left_join(., wb_table, c("Subbasin_ID" = "Basin_ID", "run")) %>% 
         .[,c( "Subbasin_ID",    "Subbasin", "region", "run", "nse","r2","pbias", "rmse", "runoff_coeff", "gw_cont")] %>% 
         mutate(round = paste("Round_", r, sep = ""))
       
       table_constrain_all <- table_constrain_all %>% rbind(table_constrain)
     }
     
  
     longer_constrain <- table_constrain_all %>% pivot_longer(., -c(Subbasin_ID, Subbasin, region, run, round))
     
     
     
     for(i in 1:length(unique(longer_constrain$Subbasin))){
       
       
       viol_plot <-   filter(longer_constrain, Subbasin_ID == i) %>%
         mutate(round = factor(round)) %>% 
         ggplot(., aes(x = round, y = value, fill = name))+ 
         geom_violin()+facet_wrap(facets = "name", scales = "free")+
         theme_bw()+
         theme( legend.position = "nuop", text = element_text(size = 18, face = "bold"), axis.title.y =  element_blank())+
         ggtitle(paste("Basin ",basins_file$Basin_ID[i], ": ", basins_file$Basin[i],  " (",basins_file$region[i] , ")", sep = ""))
       
       ggsave(plot = viol_plot, 
              filename = paste("Data/Figures/Evolution/", basins_file$Basin_ID[i], "_", str_replace_all(basins_file$Basin, " ", "_")[i], ".png", sep = ""),
              device = "png", 
              dpi = 300, width = 16, height = 12) 
       
     }
     
     
     
     
     # Reservoirs evolution
     
     reservoirs_data <- read_csv("Data/csv_files/reservoirs_data.csv")
     
     reservoirs_obs_data <- read_rds("Data/Reservoirs/Simulation/observed_reservoir_inflow.rds") %>% names(.)
     
     reservoirs_data <- reservoirs_data %>% mutate(Lake_id = paste("lake_", Lake_id, sep = "")) %>%
       filter(., Lake_id %in% reservoirs_obs_data)
     
     
                                 rounds_comp <- 4
                                 table_constrain_all <- c()
                                 
                                 for(r in 1:rounds_comp){
                                   
                                   metrics_table <- read_csv(paste("Data/Reservoirs/Results/reservoir_metrics_R", r, ".csv", sep = "")) %>% 
                                     left_join(reservoirs_data[,c("Lake_id", "Nombre", "region_r2")], c("reservoir" = "Lake_id")) %>% 
                                     mutate(round = r)
                                   
                                   table_constrain_all <- table_constrain_all %>% rbind(metrics_table)
                                 }
                                 
                                 
                                 longer_constrain <- table_constrain_all %>% pivot_longer(., -c(reservoir, Nombre, region_r2, run, round))
                                 
                                 
                                 
                                 for(i in 1:length(unique(longer_constrain$reservoir))){
                                   
                                   resdatt <- tibble(reservoir = unique(longer_constrain$reservoir)[i], 
                                                     name = unique(longer_constrain$Nombre)[i]) %>% 
                                     left_join(., reservoirs_data, c("reservoir" = "Lake_id"))
                                   
                                   viol_plot <-   filter(longer_constrain, reservoir == unique(longer_constrain$reservoir)[i]) %>%
                                     mutate(round = factor(round)) %>% 
                                     ggplot(., aes(x = round, y = value, fill = name))+ 
                                     geom_violin()+facet_wrap(facets = "name", scales = "free")+
                                     theme_bw()+
                                     theme( legend.position = "nuop", text = element_text(size = 18, face = "bold"), axis.title.y =  element_blank())+
                                     ggtitle(paste(resdatt$reservoir, ": ", resdatt$name, " (", resdatt$region_r2, ")", sep = ""))
                                   
                                   ggsave(plot = viol_plot, 
                                          filename = paste("Data/Reservoirs/Figures/Evolution/", resdatt$reservoir, "_", 
                                                           str_remove(str_remove(resdatt$name, pattern = ","), " "),".png", sep = ""),
                                          device = "png", 
                                          dpi = 300, width = 16, height = 12) 
                                   
                                 }
                                 
       
                                 
# FINAL PARSET REGIONS 
                                 
 hc_par_bound_zonal_4 <- tibble(
   
   
   'surlag.bsn | change = absval' = c(1, 6), 
   'chn.rte | change = absval' = c(0, 0.05),
   
   'IMP_esc::esco.hru | change = absval | unit =         c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.7 , 0.999),     # IMP_esc::esco.hru | change = absval             
   'IMP_epc::epco.hru | change = absval | unit =         c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.001 , 0.999),   # IMP_epc::epco.hru | change = absval  
   'IMP_cnn::cn2.hru | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-29.999  ,  -10), # IMP_cnn::cn2.hru | change = pctchg     
   'IMP_awc::awc.sol | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(35 , 50),         # IMP_awc::awc.sol | change = pctchg    
   'IMP_per::perco.hru | change = absval | unit =        c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.675 , 0.775),   # IMP_per::perco.hru | change = absval   
   'IMP_latq::latq_co.hru | change = abschg | unit =     c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-0.05, 0),        # IMP_latq::latq_co.hru | change = abschg  
   'IMP_cn3::cn3_swf.hru | change = abschg | unit =      c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-0.3, 0),         # IMP_cn3::cn3_swf.hru | change = abschg        
   'IMP_zso::z.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c( 25 , 50),        # IMP_zso::z.sol | change = pctchg 
   'IMP_kso::k.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7505:7530,8537:8541,8548:8557,9718:9733,9757:9770,9785:9805,10017:10065,10101:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-65 , 30 ),   # IMP_kso::k.sol | change = pctchg 
   'IMP_bd::bd.sol | change = pctchg | unit =            c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-25 , -15),       # IMP_bd::bd.sol | change = pctchg 
   'IMP_ovn::ovn.hru | change = pctchg | unit =          c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(-20 , 20),        # IMP_ovn::ovn.hru | change = pctchg
   'IMP_lattime::lat_ttime.hru | change = absval| unit = c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)' = c(0.5, 5),          # IMP_lattime::lat_ttime.hru | change = absval
   
   'IMP_alpha::alpha.aqu | change = absval = | unit =      c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.001, 0.04),   # IMP_alpha::alpha.aqu | change = absval
   'IMP_flomin::flo_min.aqu | change = absval | unit =     c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(10, 20),        # IMP_flomin::flo_min.aqu | change = absval 
   'IMP_revapmin::revap_min.aqu | change = absval | unit = c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0, 10),         # IMP_revapmin::revap_min.aqu | change = absval 
   'IMP_revapco::revap_co.aqu | change = absval | unit =   c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.02, 0.2),     # IMP_revapco::revap_co.aqu | change = absval 
   'IMP_spyld::sp_yld.aqu | change = absval =| unit =      c(24,33,37,42,45,47,48,57,60,61,63,68,69)' = c(0.00001, 0.05), # IMP_spyld::sp_yld.aqu | change = absval
   
   'SANT_awc::awc.sol | change = pctchg | unit =          c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(-40 , 0),       # SANT_awc::awc.sol | change = pctchg    
   'SANT_zso::z.sol | change = pctchg | unit =            c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(-40 , -10),     # SANT_zso::z.sol | change = pctchg 
   'SANT_kso::k.sol | change = pctchg | unit =            c(7338:7366,7375:7449,7458:7504,8425:8494,8507:8512,8519:8533,8542:8547,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9717,9734:9750,9771:9784,9813:9817,10066:10079,10095:10100)' = c(50 , 150 ),     # SANT_kso::k.sol | change = pctchg 
   
   
   'SIMP_esc::esco.hru | change = absval | unit =         c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.8 , 0.999),     # SIMP_esc::esco.hru | change = absval             
   'SIMP_epc::epco.hru | change = absval | unit =         c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.001 , 0.999),   # SIMP_epc::epco.hru | change = absval  
   'SIMP_cnn::cn2.hru | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-29.999 , -15),   # SIMP_cnn::cn2.hru | change = pctchg     
   'SIMP_awc::awc.sol | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(35 , 45),         # SIMP_awc::awc.sol | change = pctchg    
   'SIMP_per::perco.hru | change = absval | unit =        c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.4 , 0.55),      # SIMP_per::perco.hru | change = absval   
   'SIMP_latq::latq_co.hru | change = abschg | unit =     c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.25, 0.1),      # SIMP_latq::latq_co.hru | change = abschg  
   'SIMP_cn3::cn3_swf.hru | change = abschg | unit =      c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-0.3, 0),         # SIMP_cn3::cn3_swf.hru | change = abschg        
   'SIMP_zso::z.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c( 30 , 45),        # SIMP_zso::z.sol | change = pctchg 
   'SIMP_kso::k.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-70 , -50),       # SIMP_kso::k.sol | change = pctchg 
   'SIMP_bd::bd.sol | change = pctchg | unit =            c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-25 , -15),       # SIMP_bd::bd.sol | change = pctchg 
   'SIMP_ovn::ovn.hru | change = pctchg | unit =          c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(-20 , 20),        # SIMP_ovn::ovn.hru | change = pctchg
   'SIMP_lattime::lat_ttime.hru | change = absval| unit = c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)' = c(0.5, 15),         # SIMP_lattime::lat_ttime.hru | change = absval
   
   'SIMP_alpha::alpha.aqu | change = absval = | unit =      c(107,109,110,114,117,118)' = c(0.003, 0.015),  # SIMP_alpha::alpha.aqu | change = absval
   'SIMP_flomin::flo_min.aqu | change = absval | unit =     c(107,109,110,114,117,118)' = c(10, 20),        # SIMP_flomin::flo_min.aqu | change = absval 
   'SIMP_revapmin::revap_min.aqu | change = absval | unit = c(107,109,110,114,117,118)' = c(0, 10),         # SIMP_revapmin::revap_min.aqu | change = absval 
   'SIMP_revapco::revap_co.aqu | change = absval | unit =   c(107,109,110,114,117,118)' = c(0.02, 0.2),     # SIMP_revapco::revap_co.aqu | change = absval 
   'SIMP_spyld::sp_yld.aqu | change = absval =| unit =      c(107,109,110,114,117,118)' = c(0.00001, 0.05), # SIMP_spyld::sp_yld.aqu | change = absval
   
   
   'MET_esc::esco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.6 , 0.999),      # MET_esc::esco.hru | change = absval             
   'MET_epc::epco.hru | change = absval | unit =         c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.001 , 0.999),    # MET_epc::epco.hru | change = absval  
   'MET_cnn::cn2.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-15  ,  10),       # MET_cnn::cn2.hru | change = pctchg     
   'MET_awc::awc.sol | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0 , 20),           # MET_awc::awc.sol | change = pctchg    
   'MET_per::perco.hru | change = absval | unit =        c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.7 , 0.8),        # MET_per::perco.hru | change = absval   
   'MET_latq::latq_co.hru | change = abschg | unit =     c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-0.1, 0.2),        # MET_latq::latq_co.hru | change = abschg  
   'MET_cn3::cn3_swf.hru | change = abschg | unit =      c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-0.3, 0),          # MET_cn3::cn3_swf.hru | change = abschg        
   'MET_zso::z.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0 , 20),           # MET_zso::z.sol | change = pctchg 
   'MET_kso::k.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-50 , 50),         # MET_kso::k.sol | change = pctchg 
   'MET_bd::bd.sol | change = pctchg | unit =            c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-15 , 0),          # MET_bd::bd.sol | change = pctchg 
   'MET_ovn::ovn.hru | change = pctchg | unit =          c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(-20 , 20),         # MET_ovn::ovn.hru | change = pctchg
   'MET_lattime::lat_ttime.hru | change = absval| unit = c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)' = c(0.5, 5),           # MET_lattime::lat_ttime.hru | change = absval
   
   'MET_alpha::alpha.aqu | change = absval = | unit =      c(1,2,3,5,7,9,11,108,122)' = c(0.001, 0.05),    # MET_alpha::alpha.aqu | change = absval
   'MET_flomin::flo_min.aqu | change = absval | unit =     c(1,2,3,5,7,9,11,108,122)' = c(10, 20),         # MET_flomin::flo_min.aqu | change = absval 
   'MET_revapmin::revap_min.aqu | change = absval | unit = c(1,2,3,5,7,9,11,108,122)' = c(0, 10),          # MET_revapmin::revap_min.aqu | change = absval 
   'MET_revapco::revap_co.aqu | change = absval | unit =   c(1,2,3,5,7,9,11,108,122)' = c(0.02, 0.2),      # MET_revapco::revap_co.aqu | change = absval 
   'MET_spyld::sp_yld.aqu | change = absval =| unit =      c(1,2,3,5,7,9,11,108,122)' = c(0.00001, 0.05),  # MET_spyld::sp_yld.aqu | change = absval
   
   
   'SMET_esc::esco.hru | change = absval | unit =         c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.7 , 0.999),     # SMET_esc::esco.hru | change = absval             
   'SMET_epc::epco.hru | change = absval | unit =         c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.001 , 0.999),   # SMET_epc::epco.hru | change = absval  
   'SMET_cnn::cn2.hru | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-10  ,  0),       # SMET_cnn::cn2.hru | change = pctchg     
   'SMET_awc::awc.sol | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(25 , 50),         # SMET_awc::awc.sol | change = pctchg    
   'SMET_per::perco.hru | change = absval | unit =        c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.5 , 0.8),       # SMET_per::perco.hru | change = absval   
   'SMET_latq::latq_co.hru | change = abschg | unit =     c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-0.2, 0.1),       # SMET_latq::latq_co.hru | change = abschg  
   'SMET_cn3::cn3_swf.hru | change = abschg | unit =      c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-0.3, 150),       # SMET_cn3::cn3_swf.hru | change = abschg        
   'SMET_zso::z.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(25 , 50),         # SMET_zso::z.sol | change = pctchg 
   'SMET_kso::k.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-80 , 0),         # SMET_kso::k.sol | change = pctchg 
   'SMET_bd::bd.sol | change = pctchg | unit =            c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-20 , -10),       # SMET_bd::bd.sol | change = pctchg 
   'SMET_ovn::ovn.hru | change = pctchg | unit =          c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(-20 , 20),        # SMET_ovn::ovn.hru | change = pctchg
   'SMET_lattime::lat_ttime.hru | change = absval| unit = c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)' = c(0.5, 5),         # SMET_lattime::lat_ttime.hru | change = absval
   
   'SMET_alpha::alpha.aqu | change = absval = | unit =      c(113, 119)' = c(0.001, 0.05),   # SMET_alpha::alpha.aqu | change = absval
   'SMET_flomin::flo_min.aqu | change = absval | unit =     c(113, 119)' = c(10, 20),        # SMET_flomin::flo_min.aqu | change = absval 
   'SMET_revapmin::revap_min.aqu | change = absval | unit = c(113, 119)' = c(0, 10),         # SMET_revapmin::revap_min.aqu | change = absval 
   'SMET_revapco::revap_co.aqu | change = absval | unit =   c(113, 119)' = c(0.02, 0.2),     # SMET_revapco::revap_co.aqu | change = absval 
   'SMET_spyld::sp_yld.aqu | change = absval =| unit =      c(113, 119)' = c(0.00001, 0.03), # SMET_spyld::sp_yld.aqu | change = absval
   
   'CRB_esc::esco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.001 , 0.90),        # CRB_esc::esco.hru | change = absval           
   'CRB_epc::epco.hru | change = absval | unit =         c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.001 , 0.999),       # CRB_epc::epco.hru | change = absval   
   'CRB_cnn::cn2.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-10  ,   0),          # CRB_cnn::cn2.hru | change = pctchg           
   'CRB_awc::awc.sol | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-10 , 30),            # CRB_awc::awc.sol | change = pctchg       
   'CRB_per::perco.hru | change = absval | unit =        c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.93 , 0.965),        # CRB_per::perco.hru | change = absval
   'CRB_latq::latq_co.hru | change = abschg | unit =     c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-0.3, -0.1),          # CRB_latq::latq_co.hru | change = abschg    
   'CRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-0.05, 0.3),          # CRB_cn3::cn3_swf.hru | change = abschg         
   'CRB_zso::z.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-25 , 15),            # CRB_zso::z.sol | change = pctchg       
   'CRB_kso::k.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-79.999 , 50),        # CRB_kso::k.sol | change = pctchg        
   'CRB_bd::bd.sol | change = pctchg | unit =            c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-20 , -5),            # CRB_bd::bd.sol | change = pctchg      
   'CRB_ovn::ovn.hru | change = pctchg | unit =          c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(-20, 20),             # CRB_ovn::ovn.hru | change = pctchg
   'CRB_lattime::lat_ttime.hru | change = absval| unit = c(1:6,43:52,68:96,364:382,615:625,771:806,821:887,983:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)' = c(0.5, 15),             # CRB_lattime::lat_ttime.hru | change = absval
   
   'CRB_alpha::alpha.aqu | change = absval = | unit =      c(8,25,30,38,41,43,54,56,62)' = c(0.001, 0.01), # CRB_alpha::alpha.aqu | change = absval
   'CRB_flomin::flo_min.aqu | change = absval | unit =     c(8,25,30,38,41,43,54,56,62)' = c(10, 20),      # CRB_flomin::flo_min.aqu | change = absval 
   'CRB_revapmin::revap_min.aqu | change = absval | unit = c(8,25,30,38,41,43,54,56,62)' = c(0, 10),       # CRB_revapmin::revap_min.aqu | change = absval 
   'CRB_revapco::revap_co.aqu | change = absval | unit =   c(8,25,30,38,41,43,54,56,62)' = c(0.02, 0.2),   # CRB_revapco::revap_co.aqu | change = absval 
   'CRB_spyld::sp_yld.aqu | change = absval =| unit =      c(8,25,30,38,41,43,54,56,62)' = c(0.01, 0.35),  # CRB_spyld::sp_yld.aqu | change = absval
   
   
   'SCRB_esc::esco.hru | change = absval | unit =         c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.60 , 0.999),        # SCRB_esc::esco.hru | change = absval           
   'SCRB_epc::epco.hru | change = absval | unit =         c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.001 , 0.999),       # SCRB_epc::epco.hru | change = absval   
   'SCRB_cnn::cn2.hru | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20  ,   0),          # SCRB_cnn::cn2.hru | change = pctchg           
   'SCRB_awc::awc.sol | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(20 , 40),             # SCRB_awc::awc.sol | change = pctchg       
   'SCRB_per::perco.hru | change = absval | unit =        c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.88 , 0.95),         # SCRB_per::perco.hru | change = absval
   'SCRB_latq::latq_co.hru | change = abschg | unit =     c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-0.3, 0.1),           # SCRB_latq::latq_co.hru | change = abschg    
   'SCRB_cn3::cn3_swf.hru | change = abschg | unit =      c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0, 0.3),              # SCRB_cn3::cn3_swf.hru | change = abschg         
   'SCRB_zso::z.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(10 , 35),             # SCRB_zso::z.sol | change = pctchg       
   'SCRB_kso::k.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-70 , 0),             # SCRB_kso::k.sol | change = pctchg        
   'SCRB_bd::bd.sol | change = pctchg | unit =            c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20 , -10),           # SCRB_bd::bd.sol | change = pctchg      
   'SCRB_ovn::ovn.hru | change = pctchg | unit =          c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(-20, 20),             # SCRB_ovn::ovn.hru | change = pctchg
   'SCRB_lattime::lat_ttime.hru | change = absval| unit = c(1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)' = c(0.5, 20),             # SCRB_lattime::lat_ttime.hru | change = absval
   
   'SCRB_alpha::alpha.aqu | change = absval = | unit =      c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.001, 0.005), # SCRB_alpha::alpha.aqu | change = absval
   'SCRB_flomin::flo_min.aqu | change = absval | unit =     c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(8, 20),       # SCRB_flomin::flo_min.aqu | change = absval 
   'SCRB_revapmin::revap_min.aqu | change = absval | unit = c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0, 10),       # SCRB_revapmin::revap_min.aqu | change = absval 
   'SCRB_revapco::revap_co.aqu | change = absval | unit =   c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.02, 0.2),   # SCRB_revapco::revap_co.aqu | change = absval 
   'SCRB_spyld::sp_yld.aqu | change = absval =| unit =      c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)' = c(0.01, 0.35),  # SCRB_spyld::sp_yld.aqu | change = absval
   
   
   'S2CRB_esc::esco.hru | change = absval | unit =         c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.500 , 0.999),       # S2CRB_esc::esco.hru | change = absval           
   'S2CRB_epc::epco.hru | change = absval | unit =         c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.001 , 0.999),       # S2CRB_epc::epco.hru | change = absval   
   'S2CRB_cnn::cn2.hru | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20  ,   0),          # S2CRB_cnn::cn2.hru | change = pctchg           
   'S2CRB_awc::awc.sol | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-15 , 20),            # S2CRB_awc::awc.sol | change = pctchg       
   'S2CRB_per::perco.hru | change = absval | unit =        c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.85 , 0.95),         # S2CRB_per::perco.hru | change = absval
   'S2CRB_latq::latq_co.hru | change = abschg | unit =     c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.3, 0.3),           # S2CRB_latq::latq_co.hru | change = abschg    
   'S2CRB_cn3::cn3_swf.hru | change = abschg | unit =      c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-0.2, 0.3),           # S2CRB_cn3::cn3_swf.hru | change = abschg         
   'S2CRB_zso::z.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20 , 10),            # S2CRB_zso::z.sol | change = pctchg       
   'S2CRB_kso::k.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0 , 150),             # S2CRB_kso::k.sol | change = pctchg        
   'S2CRB_bd::bd.sol | change = pctchg | unit =            c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20 , -5),            # S2CRB_bd::bd.sol | change = pctchg      
   'S2CRB_ovn::ovn.hru | change = pctchg | unit =          c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(-20, 20),             # S2CRB_ovn::ovn.hru | change = pctchg
   'S2CRB_lattime::lat_ttime.hru | change = absval| unit = c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)' = c(0.5, 20),             # S2CRB_lattime::lat_ttime.hru | change = absval
   
   'S2CRB_alpha::alpha.aqu | change = absval = | unit =      c(104, 120)' = c(0.001, 0.005), # S2CRB_alpha::alpha.aqu | change = absval
   'S2CRB_flomin::flo_min.aqu | change = absval | unit =     c(104, 120)' = c(8, 20),       # S2CRB_flomin::flo_min.aqu | change = absval 
   'S2CRB_revapmin::revap_min.aqu | change = absval | unit = c(104, 120)' = c(0, 10),       # S2CRB_revapmin::revap_min.aqu | change = absval 
   'S2CRB_revapco::revap_co.aqu | change = absval | unit =   c(104, 120)' = c(0.02, 0.2),   # S2CRB_revapco::revap_co.aqu | change = absval 
   'S2CRB_spyld::sp_yld.aqu | change = absval =| unit =      c(104, 120)' = c(0.01, 0.35),  # SCRB_spyld::sp_yld.aqu | change = absval
   
   
   'DTH_esc::esco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.60 , 0.999),      # DTH_esc::esco.hru | change = absval                         
   'DTH_epc::epco.hru | change = absval | unit =         c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.001 , 0.999),     # DTH_epc::epco.hru | change = absval     
   'DTH_cnn::cn2.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-25  ,  -10),       # DTH_cnn::cn2.hru | change = pctchg             
   'DTH_awc::awc.sol | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(30 , 50),           # DTH_awc::awc.sol | change = pctchg         
   'DTH_per::perco.hru | change = absval | unit =        c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.7 , 0.85),        # DTH_per::perco.hru | change = absval  
   'DTH_latq::latq_co.hru | change = abschg | unit =     c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.05, 0.2),        # DTH_latq::latq_co.hru | change = abschg      
   'DTH_cn3::cn3_swf.hru | change = abschg | unit =      c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-0.2, 0.05),        # DTH_cn3::cn3_swf.hru | change = abschg           
   'DTH_zso::z.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(15, 40),            # DTH_zso::z.sol | change = pctchg         
   'DTH_kso::k.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-80 , -20),         # DTH_kso::k.sol | change = pctchg          
   'DTH_bd::bd.sol | change = pctchg | unit =            c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-25 , -15),         # DTH_bd::bd.sol | change = pctchg        
   'DTH_ovn::ovn.hru | change = pctchg | unit =          c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(-20, 20),           # DTH_ovn::ovn.hru | change = pctchg
   'DTH_lattime::lat_ttime.hru | change = absval| unit = c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)' = c(0.5, 7),           # DTH_lattime::lat_ttime.hru | change = absval
   
   'DTH_alpha::alpha.aqu | change = absval = | unit =      c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.0015, 0.01), # DTH_alpha::alpha.aqu | change = absval
   'DTH_flomin::flo_min.aqu | change = absval | unit =     c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(10, 20),       # DTH_flomin::flo_min.aqu | change = absval 
   'DTH_revapmin::revap_min.aqu | change = absval | unit = c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0, 12),        # DTH_revapmin::revap_min.aqu | change = absval 
   'DTH_revapco::revap_co.aqu | change = absval | unit =   c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.02, 0.2),    # DTH_revapco::revap_co.aqu | change = absval 
   'DTH_spyld::sp_yld.aqu | change = absval =| unit =      c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)' = c(0.1, 0.35),    # DTH_spyld::sp_yld.aqu | change = absval
   
   'SDTH_esc::esco.hru | change = absval | unit =         c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(0.60 , 0.999),      # SDTH_esc::esco.hru | change = absval                         
   'SDTH_epc::epco.hru | change = absval | unit =         c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(0.001 , 0.999),     # SDTH_epc::epco.hru | change = absval     
   'SDTH_cnn::cn2.hru | change = pctchg | unit =          c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(-30  ,  -20),       # SDTH_cnn::cn2.hru | change = pctchg             
   'SDTH_awc::awc.sol | change = pctchg | unit =          c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(10 , 30),           # SDTH_awc::awc.sol | change = pctchg         
   'SDTH_per::perco.hru | change = absval | unit =        c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(0.82 , 0.95),       # SDTH_per::perco.hru | change = absval  
   'SDTH_latq::latq_co.hru | change = abschg | unit =     c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(-0.15, 0.05),       # SDTH_latq::latq_co.hru | change = abschg      
   'SDTH_cn3::cn3_swf.hru | change = abschg | unit =      c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(0.05, 0.25),        # SDTH_cn3::cn3_swf.hru | change = abschg           
   'SDTH_zso::z.sol | change = pctchg | unit =            c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(15, 25),            # SDTH_zso::z.sol | change = pctchg         
   'SDTH_kso::k.sol | change = pctchg | unit =            c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(-40 , 10),          # SDTH_kso::k.sol | change = pctchg          
   'SDTH_bd::bd.sol | change = pctchg | unit =            c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(-25 , -20),         # SDTH_bd::bd.sol | change = pctchg        
   'SDTH_ovn::ovn.hru | change = pctchg | unit =          c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(-20, 20),           # SDTH_ovn::ovn.hru | change = pctchg
   'SDTH_lattime::lat_ttime.hru | change = absval| unit = c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)' = c(0.5, 10),           # SDTH_lattime::lat_ttime.hru | change = absval
   
   'SDTH_alpha::alpha.aqu | change = absval = | unit =      c(31,34,44,64,70,71,74,78,80)' = c(0.001, 0.008),  # SDTH_alpha::alpha.aqu | change = absval
   'SDTH_flomin::flo_min.aqu | change = absval | unit =     c(31,34,44,64,70,71,74,78,80)' = c(10, 20),        # SDTH_flomin::flo_min.aqu | change = absval 
   'SDTH_revapmin::revap_min.aqu | change = absval | unit = c(31,34,44,64,70,71,74,78,80)' = c(0, 12),        # SDTH_revapmin::revap_min.aqu | change = absval 
   'SDTH_revapco::revap_co.aqu | change = absval | unit =   c(31,34,44,64,70,71,74,78,80)' = c(0.02, 0.2),    # SDTH_revapco::revap_co.aqu | change = absval 
   'SDTH_spyld::sp_yld.aqu | change = absval =| unit =      c(31,34,44,64,70,71,74,78,80)' = c(0.1, 0.35),    # SDTH_spyld::sp_yld.aqu | change = absval
   
   
   'DTL_esc::esco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.6 , 0.999),      # DTL_esc::esco.hru | change = absval       
   'DTL_epc::epco.hru | change = absval | unit =         c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.001 , 0.999),    # DTL_epc::epco.hru | change = absval  
   'DTL_cnn::cn2.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999  ,  -10),  # DTL_cnn::cn2.hru | change = pctchg       
   'DTL_awc::awc.sol | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(30 , 59.999),      # DTL_awc::awc.sol | change = pctchg    
   'DTL_per::perco.hru | change = absval | unit =        c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.4 , 0.7),        # DTL_per::perco.hru | change = absval
   'DTL_latq::latq_co.hru | change = abschg | unit =     c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_latq::latq_co.hru | change = abschg    
   'DTL_cn3::cn3_swf.hru | change = abschg | unit =      c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-0.3, 0.3),        # DTL_cn3::cn3_swf.hru | change = abschg        
   'DTL_zso::z.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(30 , 49.999),      # DTL_zso::z.sol | change = pctchg 
   'DTL_kso::k.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-79.999 , 0),     # DTL_kso::k.sol | change = pctchg 
   'DTL_bd::bd.sol | change = pctchg | unit =            c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-29.999 , -10),    # DTL_bd::bd.sol | change = pctchg 
   'DTL_ovn::ovn.hru | change = pctchg | unit =          c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(-20, 20),          # DTH_ovn::ovn.hru | change = pctchg
   'DTL_lattime::lat_ttime.hru | change = absval| unit = c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)' = c(0.5, 80),          # DTH_lattime::lat_ttime.hru | change = absval
   
   'DTL_alpha::alpha.aqu | change = absval = | unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.001, 0.02),   # DTL_alpha::alpha.aqu | change = absval
   'DTL_flomin::flo_min.aqu | change = absval | unit =     c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(5, 20),         # DTL_flomin::flo_min.aqu | change = absval 
   'DTL_revapmin::revap_min.aqu | change = absval | unit = c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0, 10),         # DTL_revapmin::revap_min.aqu | change = absval 
   'DTL_revapco::revap_co.aqu | change = absval | unit =   c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.02, 0.2),     # DTL_revapco::revap_co.aqu | change = absval 
   'DTL_spyld::sp_yld.aqu | change = absval =| unit =      c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)' = c(0.00001, 0.3))  # DTL_spyld::sp_yld.aqu | change = absval
         
         
         # Proving that all HRUs and Aquifers are being parameterized
         
         IMP_hrus <- c(697:702,1393:1400,2166:2177,2194:2200,2284:2299,2306:2308,2372:2376,3335:3345,3382:3459,5420:5443,5900:5928,6040:6052,7338:7366,7375:7449,7458:7530,8425:8494,8507:8512,8519:8533,8537:8557,9233:9280,9301:9326,9343:9348,9356:9368,9687:9697,9706:9750,9757:9805,9813:9817,10017:10079,10095:10147,11027:11069,11085:11100,11115:11122,11135:11141,11338:11483,11847:12117,12275:12288,12297:12350,12370:12377,12387:12446,13069:13075,13081:13125,13154:13188,15748:15764,15795:15818,15835:15847,15877:15913,15962:15972,16484:16514,17368:17399,17523:17629,17693:17721,18613:18639)
         SIMP_hrus <- c(19574:19588,19593:19638,19828:19853,19975:20043,20073:20101,20122:20191,20435:20493,20499:20522,20545:20574,20585:20666,20850:21073,21186:21202,21925:21955,21989:22001,22006:22044,22069:22089)
         MET_hrus <- c(53:67,97:229,432:466,493:537,600:606,626:676,703:716,757:770,1277:1392,1401:1414,1421:1428,1446:1454,1459:1478,1529:1532,1789:1876,2059:2165,2178:2193,2201:2283,2300:2305,2309:2339,2347:2352,2361:2371,2377:2384,3299:3334,3346:3381,5929:5950,5963:5976,5991:6039,6053:6086,7311:7337,8513:8518,9281:9300,9327:9342,9349:9355,9698:9705,9751:9756,9806:9812,10080:10094,12289:12296,12351:12369,12378:12386,13061:13068,13076:13080,15765:15772,19876:19918,21313:21322,21338:21353,21366:21479)
         SMET_hrus <- c(19239:19254,19794:19827,20102:20121,20344:20434,20494:20498,20523:20544,20575:20584,21074:21100,21168:21185)
         CRB_hrus <- c(1:6,43:52,68:96,364:382,615:625,771:776,858:887,1052:1059,1092:1099,1120:1136,1181:1199,1429:1445,1653:1714,1745:1749,1905:2007,2413:2442,2553:2600,2662:2691,2716:2719,3019:3040,3077:3078,3880:3934,3977:4080,4164:4183,4583:4608,4701:4747,4808:4818,6164:6183,6214:6219,6224:6238,6460:6477,6733:6744,6931:6970,6998:7002,7035:7039,7133:7136,7854:7862,8118:8192,8248:8258,8405:8424,8683:8713,8730:8777,9128:9232,9419:9444,9475:9488,9493:9498,9509:9514,9526:9527,9534:9539,9556:9603,10873:10899,11002:11026,11305:11313,11332:11337,12118:12122,12197:12210,12263:12274,12481:12483,12504:12510,13189:13208,13223:13237,13494:13501,13655:13667,13971:13985,17437:17454)
         SCRB_hrus <- c(777:806,821:857,983:1051,1217:1276,2042:2058,2601:2623,2720:2900,2917:2936,2970:2999,3041:3054,3217:3263,4184:4256,4402:4433,4538:4582,4609:4634,4662:4700,4773:4786,4793:4807,4819:4832,5795:5845,6184:6213,6220:6223,6441:6453,6478:6504,6531:6566,6584:6706,6745:6779,6846:6895,6916:6930,6971:6976,7003:7008,7190:7310,8273:8404,9058:9127,9369:9418,9445:9461,9469:9474,9499:9504,9515:9525,9528:9533,10193:10275,10302:10314,10328:10353,10368:10392,10405:10496,10511:10653,10733:10765,10992:11001,11314:11331,11697:11721,11819:11846,14329:14346,14709:14722,14743:14769,14810:14826,14888:14901,14953:14991,15007:15059,15136:15142,15202:15220)
         S2CRB_hrus <- c(17246:17279,17310:17343,18123:18142,18218:18233,18514:18535,18896:18910,19255:19276,19395:19405,20218:20245,20749:20758,20840:20849,21209:21213,21226:21235)
         DTH_hrus <- c(230:335,538:599,677:696,717:756,945:982,1060:1091,1200:1216,1415:1420,1455:1458,1479:1528,1533:1652,1750:1788,2008:2041,2340:2346,2353:2360,3289:3298,3460:3610,3623:3651,3674:3701,3718:3814,4081:4108,4661:4661,4833:5419,5444:5794,5846:5871,5951:5962,5977:5990,6087:6163,6239:6379,6825:6845,7367:7374,7450:7457,7531:7553,8495:8506,8534:8536,8558:8678,8778:9057,9818:9921,9939:9961,9976:10016,10148:10192,10276:10301,10766:10872,11070:11084,11101:11114,11123:11134,11142:11304,11629:11635,11659:11696,11722:11794,12484:12486,12572:13033,13054:13060,13126:13153,13502:13536,14102:14111,14325:14328,14353:14416,15060:15100,15172:15172,15286:15298,15773:15794,15819:15834,15848:15876,15914:15961,15973:16103,16112:16209,16215:16245,16288:16419,16431:16440,16453:16483,16515:16610,17239:17245,17400:17436,17630:17692,17722:17980,18029:18080,18143:18217,18234:18254,18292:18406,18417:18427,18435:18466,18492:18498,18536:18612,18640:18750,18756:18825,18975:19238,19315:19394,19406:19573,19589:19592,19639:19793,19854:19875,19919:19974,20044:20072,20192:20217,20271:20343,20682:20696,20737:20748,20764:20773,21101:21167,21203:21208,21214:21225,21236:21312,21323:21337,21354:21365,21480:21505,21648:21924,21956:21988,22002:22005,22045:22068)
         SDTH_hrus <- c(2901:2916,2937:2969,3000:3018,3055:3076,6414:6440,6454:6459,6505:6530,6896:6915,6977:6997,7009:7034,7040:7132,7137:7189,7688:7717,7746:7753,7768:7853,7863:8037,8052:8068,8088:8117,8193:8247,8259:8272,8679:8682,8714:8729,9462:9468,9489:9492,9505:9508,9540:9555,9604:9669,9683:9686,10315:10327,10668:10694,10900:10919,10942:10965,11484:11511,11561:11616,12123:12196,12211:12262,12447:12480,12487:12503,12511:12534,13238:13281,13292:13362,13373:13493,13704:13723,13734:13759,13807:13833,13918:13970,13986:13992,14208:14224,14250:14255,14417:14428,14453:14536,14550:14673,14693:14708,14723:14742,14866:14887,15221:15285,15299:15313,15351:15400,15423:15434,15457:15496,15522:15563,15608:15636,15672:15747,16661:16687,16717:16774,17039:17075,17101:17141,17280:17286,21577:21589)
         DTL_hrus <- c(7:42,336:363,383:431,467:492,607:614,807:820,888:944,1100:1119,1137:1180,1715:1744,1877:1904,2385:2412,2443:2552,2624:2661,2692:2715,3079:3216,3264:3288,3611:3622,3652:3673,3702:3717,3815:3879,3935:3976,4109:4163,4257:4401,4434:4537,4635:4660,4748:4772,4787:4792,5872:5899,6380:6413,6567:6583,6707:6732,6780:6824,7554:7687,7718:7745,7754:7767,8038:8051,8069:8087,9670:9682,9922:9938,9962:9975,10354:10367,10393:10404,10497:10510,10654:10667,10695:10732,10920:10941,10966:10991,11512:11560,11617:11628,11636:11658,11795:11818,12535:12571,13034:13053,13209:13222,13282:13291,13363:13372,13537:13654,13668:13703,13724:13733,13760:13806,13834:13917,13993:14101,14112:14207,14225:14249,14256:14324,14347:14352,14429:14452,14537:14549,14674:14692,14770:14809,14827:14865,14902:14952,14992:15006,15101:15135,15143:15171,15173:15201,15314:15350,15401:15422,15435:15456,15497:15521,15564:15607,15637:15671,16104:16111,16210:16214,16246:16287,16420:16430,16441:16452,16611:16660,16688:16716,16775:17038,17076:17100,17142:17238,17287:17309,17344:17367,17455:17522,17981:18028,18081:18122,18255:18291,18407:18416,18428:18434,18467:18491,18499:18513,18751:18755,18826:18895,18911:18974,19277:19314,20246:20270,20667:20681,20697:20736,20759:20763,20774:20839,21506:21576,21590:21647)
         length(IMP_hrus)+length(SIMP_hrus)+length(MET_hrus)+length(SMET_hrus)+length(CRB_hrus)+length(SCRB_hrus)+length(S2CRB_hrus)+length(DTH_hrus)+length(SDTH_hrus)+length(DTL_hrus) # 22089 ok
         
         IMP_aqus <- c(24,33,37,42,45,47,48,57,60,61,63,68,69)
         SIMP_aqus <- c(107,109,110,114,117,118)
         MET_aqus <- c(1,2,3,5,7,9,11,108,122)
         SMET_aqus <- c(113, 119)
         CRB_aqus <- c(8,25,30,38,41,43,54,56,62)
         SCRB_aqus <- c(6,10,17,19,23,27,29,32,35,36,40,50,51,79)
         S2CRB_aqus <- c(104, 120)
         DTH_aqus <- c(12,13,15,20,21,22,26,28,39,46,49,52,55,59,66,67,72,77,81,83,85,86,88,90,91,93,94,96,97,98,99,102,103,105,106,111,112,121,123,125,126)
         SDTH_aqus <- c(31,34,44,64,70,71,74,78,80)
         DTL_aqus <- c(4,14,16,18,53,58,65,73,75,76,82,84,87,89,92,95,100,101,115,116,124)
         
         length(IMP_aqus)+length(SIMP_aqus)+length(MET_aqus)+length(SMET_aqus)+length(CRB_aqus)+length(SCRB_aqus)+length(S2CRB_aqus)+length(DTH_aqus)+length(SDTH_aqus)+length(DTL_aqus) # 126 ok
         
         
                                 

#### VALIDATION ####     

     
     ##### SELECTION OF SIMULATIONS TO RUN AND SUMMARIZE TABLE FOR CALIBRATION RESULTS ####
     
     # Simulations selection for validation: Import metrics and wb variables for all the simulations for the 22 subbasins
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     subbasins <- basins_file$Basin
     region <- basins_file$region
     
     
     rounds_comp <- 4
     table_constrain_all <- c()
     
     for(r in 1:rounds_comp){
       
       metrics_table <- read_csv(paste("Data/Results/R", r, "/HC_Round", r, "_streamflow_metrics_allchanel.csv", sep = ""))
       
       wb_table <- read.csv(paste("Data/Results/R", r, "/HC_Round", r, "_basinswb.csv", sep = "")) %>% 
         select(Basin_ID, run, runoff_coeff, gw_cont) %>%  mutate(run = as.numeric(str_remove(run, "run_")))
       
       table_constrain <-   metrics_table %>% left_join(., wb_table, c("Subbasin_ID" = "Basin_ID", "run")) %>% 
         .[,c( "Subbasin_ID",    "Subbasin", "region", "run", "nse","r2","pbias", "rmse", "runoff_coeff", "gw_cont")] %>% 
         mutate(round = paste("Round_", r, sep = ""))
       
       table_constrain_all <- table_constrain_all %>% rbind(table_constrain)
     }
     
     
     # For each subbasin, arrange simulations from best to worst (higher rank is better)
     ranked_sims <- table_constrain_all %>% 
       group_by(Subbasin_ID) %>% 
       mutate(simulation_id = paste("sim_", 1:4000, sep = ""),
              rank_nse = rank(nse),
              rank_r2 = rank(r2),
              rank_pbias = rank(-abs(pbias)),
              rank_rmse = rank(-rmse), 
              rank_tot = rank_nse + rank_r2 + rank_pbias + rank_rmse) %>% 
       arrange(Subbasin_ID, -rank_tot) %>% ungroup(.)
     
     
     # Use groundwater ranges to select simulations: gw contribution must be inside the following ranges, adapted for each subbasin
     ranges_gw <- read.csv("Data/csv_files/basins_gw_ranges.csv")
     
     
     # Select the best 40 simulations from all the calibration process for each subbasin
     selected_sims <- c()
     number_sims_selected <- 40
     
     for(i in 1:length(unique(ranked_sims$Subbasin_ID))){
       
       
       selected_sim <- ranked_sims %>% filter(Subbasin_ID == unique(ranked_sims$Subbasin_ID)[i]) %>% 
         filter(gw_cont > ranges_gw[ranges_gw$Basin_ID == unique(ranked_sims$Subbasin_ID)[i], "gw_min"], 
                gw_cont < ranges_gw[ranges_gw$Basin_ID == unique(ranked_sims$Subbasin_ID)[i], "gw_max"]) %>% 
         slice_head(n = number_sims_selected) %>% 
         select(Subbasin_ID, simulation_id)
       
       
       selected_sims <- selected_sims %>%  rbind(., selected_sim)
       
       
     }
     
     sims_validation <- left_join(selected_sims, ranked_sims, c("Subbasin_ID", "simulation_id")) %>% arrange(round, Subbasin_ID)
     
     
     # Some simulations are among the 40 bests simulations in more than 1 subbasin
     table(sims_validation$simulation_id) %>% tibble(repeated = ., run= names(table(sims_validation$simulation_id))) %>% arrange(., -repeated) %>% head(20)
     
     # Most of the best simulations are of the fourth calibration round, but a significant number are from previous rounds
     table(sims_validation$round) %>% tibble(repeated = ., run= names(table(sims_validation$round))) 
     
     sims_validation %>% ggplot(., aes(x = round, fill = region))+geom_bar()+facet_wrap(facets = "Subbasin_ID")+theme_bw()+
       scale_fill_manual(values = c("steelblue", "orange", "grey", "red3", "purple3"))
     
     table_constrain_all %>% filter(Subbasin_ID == 18) %>% 
       cbind(runnum = c(1:4000)) %>% 
       pivot_longer(., c("nse", "r2", "pbias", "rmse", "gw_cont"), names_to = "variable") %>% 
       ggplot(., aes(x = runnum, color = round, y = value))+geom_point()+
       facet_wrap(facets = "variable", scales = "free")
     
     
# Reservoirs best simulations
     
     reservoirs_data <- read_csv("Data/csv_files/reservoirs_data.csv")
     
     reservoirs_obs_data <- read_rds("Data/Reservoirs/Simulation/observed_reservoir_inflow.rds") %>% names(.)
     
     reservoirs_data <- reservoirs_data %>% mutate(Lake_id = paste("lake_", Lake_id, sep = "")) %>%
       filter(., Lake_id %in% reservoirs_obs_data)
     
     
     rounds_comp <- 4
     table_constrain_all_res <- c()
     
     for(r in 1:rounds_comp){
       
       metrics_table <- read_csv(paste("Data/Reservoirs/Results/reservoir_metrics_R", r, ".csv", sep = "")) %>% 
         left_join(reservoirs_data[,c("Lake_id", "Nombre", "region_r2")], c("reservoir" = "Lake_id")) %>% 
         mutate(round = r)
       
       table_constrain_all_res <- table_constrain_all_res %>% rbind(metrics_table)
     }
     
     
     longer_constrain_res <- table_constrain_all_res %>% pivot_longer(., -c(reservoir, Nombre, region_r2, run, round))
     

     # For each subbasin, arrange simulations from best to worst (higher rank is better)
     ranked_sims_res <- table_constrain_all_res %>% 
       group_by(reservoir) %>% 
       mutate(simulation_id = paste("sim_", 1:4000, sep = ""),
              rank_nse = rank(nse),
              rank_r2 = rank(r2),
              rank_pbias = rank(-abs(pbias)),
              rank_rmse = rank(-rmse), 
              rank_tot = rank_nse + rank_r2 + 2*rank_pbias + rank_rmse) %>% 
       arrange(as.numeric(str_remove(reservoir, "lake_")), -rank_tot) %>% ungroup(.)
     

     # Select the best 40 simulations from all the calibration process for each subbasin
     selected_sims_res <- c()
     number_sims_selected <- 40
     
     for(i in 1:length(unique(ranked_sims_res$reservoir))){
       
       selected_sim <- ranked_sims_res %>% filter(reservoir == unique(ranked_sims_res$reservoir)[i]) %>% 
         slice_head(n = number_sims_selected) %>% 
         select(reservoir, simulation_id) 
       
       selected_sims_res <- selected_sims_res %>%  rbind(., selected_sim)

       
     }
     
     sims_validation_res <- left_join(selected_sims_res, ranked_sims_res, c("reservoir", "simulation_id")) %>% arrange(round, as.numeric(str_remove(reservoir, "lake_")))
         
     sims_validation_res_used <- sims_validation_res %>% filter(reservoir == "lake_12", abs(pbias) < 15) %>% 
       rename(Subbasin_ID = reservoir, Subbasin = Nombre, region = region_r2) %>% 
           # select(Subbasin_ID, simulation_id, round, run) %>%
       mutate(Subbasin_ID = 23) %>%  mutate(round = paste("Round_", round, sep = ""))
     
     
    sims_validation %>% select(Subbasin_ID, simulation_id, round, run) %>% rbind(., sims_validation_res_used) %>% 
      summarise(table(.$round))
      
    
    
     
     
     # Selected simulations are run for validation (2015-2019) 
     # Since parameters sets are different (number of parameters) its necessary to run 4 different validations (1 for each round of calibration)
     
     pars_r1 <- read_rds("Data/Simulations/Round_1/round_1_HC_Tagus.rds") %>% .[1]
     pars_r2 <- read_rds("Data/Simulations/Round_2/round_2_HC_Tagus.rds") %>% .[1]
     pars_r3 <- read_rds("Data/Simulations/Round_3/round_3_HC_Tagus.rds") %>% .[1]
     pars_r4 <- read_rds("Data/Simulations/Round_4/round_4_HC_Tagus.rds") %>% .[1]
     
     
    sims_for_val <-  sims_validation %>% select(Subbasin_ID, simulation_id, round, run) %>% 
       rbind(sims_validation_res_used) %>% arrange(as.numeric(str_remove(round, "Round_")), Subbasin_ID, as.numeric(str_remove(simulation_id, "sim_")))
     
     sims_val_r1 <- sims_for_val %>% filter(round == "Round_1") %>% mutate(run_val = c(1:106)) 
     sims_val_r2 <- sims_for_val %>% filter(round == "Round_2") %>% mutate(run_val = c(107:215)) 
     sims_val_r3 <- sims_for_val %>% filter(round == "Round_3") %>% mutate(run_val = c(216:481))
     sims_val_r4 <- sims_for_val %>% filter(round == "Round_4") %>% mutate(run_val = c(482:920)) 
     
     sims_val <- rbind(sims_val_r1, sims_val_r2, sims_val_r3, sims_val_r4) %>% 
       arrange(., as.numeric(str_remove(round, "Round_")), Subbasin_ID, as.numeric(str_remove(simulation_id, "sim_"))) %>% 
       select(round, run, run_val, simulation_id, Subbasin_ID)
     
     # Exported to extract parameters sets for validation for each of the rounds
     write.table(sims_val, "Data/Simulations/Validation/simulations_for_validation.txt", quote = F, row.names = F)
     
     
     # Creation of a table with the results of calibration and a field with the correspondence of calibration and validation simulations
     
     sims_res_val <- sims_validation_res %>% 
       filter(reservoir == "lake_12", abs(pbias) < 15) %>% 
       mutate(round = paste("Round_", round, sep = "")) %>% 
       rename(Subbasin_ID = reservoir) %>% mutate(Subbasin_ID = 23, runoff_coeff = NA, gw_cont = NA, Subbasin = "Santillana", region = "SANT") %>% 
       select(Subbasin_ID, Subbasin, region, simulation_id, nse, r2, pbias, rmse, runoff_coeff, gw_cont, rank_tot, round)
       
     
     calibration_table <- sims_validation %>% 
       select(Subbasin_ID, Subbasin, region, simulation_id, nse, r2, pbias, rmse, runoff_coeff, gw_cont, rank_tot, round) %>% 
       rbind(., sims_res_val) %>% 
       rename(., "nse_cal" = "nse", "r2_cal" = "r2", 
              "pbias_cal" = "pbias", "rmse_cal" = "rmse", 
              "runoff_coeff_cal" = "runoff_coeff", "gw_cont_cal" = "gw_cont",
              "rank_cal" = "rank_tot") %>% 
       arrange(., as.numeric(str_remove(round, "Round_")), Subbasin_ID, as.numeric(str_remove(simulation_id, "sim_"))) %>% 
       left_join(., sims_val[, c("run_val", "simulation_id", "Subbasin_ID")], c("simulation_id", "Subbasin_ID")) 

     
     write.csv(calibration_table, "Data/Results/calibration_table.csv", quote = F, row.names = F)
     
     
     
     ##### RUN VALIDATION FOR SELECTED SIMULATIONS #####

     
     sims_path <- "C:/ASG/HARDCAL_Tagus_Hydchanged/New_exe_Marzo2024/"
     
     tagus_path <- "C:/Modelos/Modelo_HC_Tagus"
     
     
     valruns <- read_table(paste(sims_path, "simulations_for_validation.txt", sep = ""))
     
     
     
     for(round in 1:4){ 
       
       ronda <- round
       
       run_sims <- valruns %>% filter(round == paste("Round_", ronda, sep = "")) %>% select(run)
       
       pardat <- read_rds(paste(sims_path, "Round_", ronda, "_HC_Tagus.rds", sep = ""))[1]
       
       parset <- pardat$parameter$values[run_sims$run,]
       colnames(parset) <- pardat$parameter$definition$full_name
       
       
       simulation <-  run_swatplus(project_path = tagus_path,
                                   output = list(
                                     ls_pcp   = define_output(file = 'lsunit_wb_yr', 
                                                              variable = 'precip', 
                                                              unit = 1:1450),
                                     # ls_et    = define_output(file = 'lsunit_wb_yr', 
                                     #                          variable = 'et', 
                                     #                          unit = used_lsus),
                                     ls_surq_gen   = define_output(file = 'lsunit_wb_yr',   # SURQ_CHA + SURQ_RES = SURQ_GEN - SURQ_LS
                                                                   variable = 'surq_gen', 
                                                                   unit = 1:1450),
                                     ls_surq_ls   = define_output(file = 'lsunit_wb_yr', 
                                                                  variable = 'surq_ls', 
                                                                  unit  = 1:1450),
                                     # ls_latqgen   = define_output(file = 'lsunit_wb_yr',  # LATQGEN - LATQLS = LATQ_CHA + LATQ_GEN
                                     #                              variable = 'latq', 
                                     #                              unit = used_lsus),
                                     # ls_latqls   = define_output(file = 'lsunit_wb_yr', 
                                     #                             variable = 'latq_ls', 
                                     #                             unit = used_lsus),
                                     ls_latqcha   = define_output(file = 'lsunit_wb_yr',  # LATQ = LATQCHA + LATQRES
                                                                  variable = 'latq_cha', 
                                                                  unit = 1:1450),
                                     ls_latqres   = define_output(file = 'lsunit_wb_yr', 
                                                                  variable = 'latq_res', 
                                                                  unit = 1:1450),
                                     #  ls_perc   = define_output(file = 'lsunit_wb_yr', 
                                     #                            variable = 'perc', 
                                     #                            unit = used_lsus),
                                     #  basin_pcp = define_output(file = 'basin_wb_yr',
                                     #                            variable = "precip",
                                     #                            unit = 1), 
                                     #  basin_et = define_output(file = 'basin_wb_yr',
                                     #                           variable = 'et',
                                     #                           unit = 1), 
                                     #  basin_perco = define_output(file = 'basin_wb_yr',
                                     #                              variable = 'perc',
                                     #                              unit = 1),
                                     #  basin_surqgen = define_output(file = 'basin_wb_yr',
                                     #                                variable = 'surq_gen',
                                     #                                unit = 1),
                                     #  basin_surqls = define_output(file = 'basin_wb_yr',
                                     #                               variable = 'surq_ls',
                                     #                               unit = 1),
                                     #  basin_surqcha = define_output(file = 'basin_wb_yr',
                                     #                                variable = 'surq_cha',
                                     #                                unit = 1),
                                     #  basin_surqres = define_output(file = 'basin_wb_yr',
                                     #                                variable = 'surq_res',
                                     #                                unit = 1),
                                     #  basin_latqcha = define_output(file = 'basin_wb_yr',
                                     #                                variable = 'latq_cha',
                                     #                                unit = 1),
                                     #  basin_latqqres = define_output(file = 'basin_wb_yr',
                                     #                                 variable = 'latq_res',
                                     #                                 unit = 1),
                                     #  basin_perco = define_output(file = 'basin_wb_yr',
                                     #                              variable = 'perc',
                                     #                              unit = 1),
                                     #  basin_gwflo = define_output(file = 'basin_aqu_yr',
                                     #                              variable = 'flo',
                                     #                              unit = 1),
                                     aqu_gwflocha = define_output(file = 'aquifer_yr',
                                                                  variable = 'flo_cha',
                                                                  unit = 1:126),
                                     aqu_gwres = define_output(file = 'aquifer_yr',
                                                               variable = 'flo_res',
                                                               unit =    1:126),
                                     #  aqu_gwtot = define_output(file = 'aquifer_yr',
                                     #                            variable = 'flo',
                                     #                            unit = used_quifers),
                                     # aqu_stor = define_output(file = 'aquifer_yr',
                                     #                          variable = 'stor',
                                     #                          unit = 1:126),
                                     # aqu_rchrg = define_output(file = 'aquifer_yr',
                                     #                           variable = 'rchrg',
                                     #                           unit = 1:126),
                                     res_in = define_output(file = 'reservoir_day',          #For round 3
                                                            variable = 'flo_in',      #For round 3        
                                                            unit = 1:31),             #For round 3 
                                     # res_stor = define_output(file = 'reservoir_yr',        #For round 3      
                                     #                          variable = 'flo_stor',    #For round 3          
                                     #                          unit = 1:31),             #For round 3 
                                     # res_out = define_output(file = 'reservoir_yr',         #For round 3     
                                     #                         variable = 'flo_out',     #For round 3         
                                     #                         unit = 1:31),             #For round 3             
                                     flow_cha = define_output(file = "channel_sd_day", 
                                                              variable = "flo_out",
                                                              unit = c(561, 750, 11, 1218, 567, 825, 564, 630, 532, 962,
                                                                       990, 541, 950, 149, 376, 535, 537, 1141, 1161, 14,
                                                                       947, 184, 525, 573, 208, 111, 949, 581, 452))),#, 444,
                                   #155, 185, 504, 161, 459, 929, 133, 176, 483, 911, 882 ,1076))), #For round 3
                                   parameter = parset,
                                   start_date = 20100101,
                                   end_date = 20191231,
                                   start_date_print = 20150101,
                                   # save_file = "hc_round_2_revap",
                                   n_thread = 60)
       
       
       write_rds(simulation, paste(sims_path, "val_rounds/sims_val_r", ronda, ".rds", sep = ""))  
       
     }
     
     
     
     
     ##### EXTRACT VALIDATION RESULTS FOR EACH ROUND AND CREATE FILES #####

     ###### Simulated streamflow     ###### 
     #Some of the gauging stations collect the water from more than one channel
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     
     for(round in 1:4){
     
     chanels <- read_rds(paste("Data/Simulations/Validation/validation_simulations/sims_val_r", round, ".rds", sep = ""))
     
     
     navaluenga <- tibble(date = chanels$simulation$flow_cha_561$date, chanels$simulation$flow_cha_561[,-1]+ chanels$simulation$flow_cha_750[,-1] )
     
     matallana <-  chanels$simulation$flow_cha_11
     
     villarejo <-  chanels$simulation$flow_cha_1218
     
     peralejo <- tibble(date = chanels$simulation$flow_cha_567$date, chanels$simulation$flow_cha_567[,-1]+ chanels$simulation$flow_cha_825[,-1] )
     
     priego_escabas <- tibble(date = chanels$simulation$flow_cha_564$date, chanels$simulation$flow_cha_564[,-1] * (1/1.05)) #  The gauging station it is not at the end of the channel
     
     santa_maria_val <- chanels$simulation$flow_cha_630
     
     javalera <- tibble(date = chanels$simulation$flow_cha_532$date, chanels$simulation$flow_cha_532[,-1]*(1/1.4)) # The gauging station it is not at the end of the channel
     
     huete <- tibble(date = chanels$simulation$flow_cha_962$date, chanels$simulation$flow_cha_962[,-1]+ chanels$simulation$flow_cha_990[,-1] )
     
     torote <- chanels$simulation$flow_cha_541
     
     puebla_nueva <-  chanels$simulation$flow_cha_950
     
     ventosa <- tibble(date = chanels$simulation$flow_cha_149$date, chanels$simulation$flow_cha_149[,-1]+ chanels$simulation$flow_cha_376[,-1] )
     
     peraleja <- tibble(date = chanels$simulation$flow_cha_535$date, chanels$simulation$flow_cha_535[,-1]+ chanels$simulation$flow_cha_537[,-1] )
     
     villasequilla <- tibble(date = chanels$simulation$flow_cha_1141$date, chanels$simulation$flow_cha_1141[,-1]+ chanels$simulation$flow_cha_1161[,-1] ) # The gauging station it is not at the end of the channel
     
     valverde <- tibble(date = chanels$simulation$flow_cha_14$date, chanels$simulation$flow_cha_14[,-1]*(1/1.05))
     
     malpica <- chanels$simulation$flow_cha_947
     
     taravillas <- tibble(date = chanels$simulation$flow_cha_184$date, chanels$simulation$flow_cha_184[,-1]*(1/1.13))
     
     romanones <- chanels$simulation$flow_cha_525
     
     priego_trabraque <- tibble(date = chanels$simulation$flow_cha_573$date, chanels$simulation$flow_cha_573[,-1]*(1/1.05) ) # The gauging station it is not at the end of the channel
     
     aragosa <- tibble(date = chanels$simulation$flow_cha_208$date, chanels$simulation$flow_cha_208[,-1]*(1/1.24) ) # The gauging station it is not at the end of the channel
     
     trillo <- chanels$simulation$flow_cha_111
     
     valdecaba <- chanels$simulation$flow_cha_949
     
     villamantilla <- chanels$simulation$flow_cha_581
     
     
     # A list is created and saved for each subbasin
     sim_cha_list <- list(navaluenga, matallana, villarejo, peralejo, priego_escabas, santa_maria_val, javalera, huete, torote, puebla_nueva,
                          ventosa, peraleja, villasequilla, valverde, malpica, taravillas, romanones,  priego_trabraque, aragosa, trillo,  valdecaba, villamantilla) 
     
     names(sim_cha_list) <- subbasins_names
     
     write_rds(sim_cha_list, paste("Data/Simulations/Validation/Val_simsr", round, "_simulated_list.rds", sep = ""))
     
     
     
     
     ###### LSUS and AQUIFERS water balance data     ###### 
     
     sim_tagus_valr4_wb <- chanels
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     lsus_subbasins_shp <- read_sf("Data/GIS/hardcal_shapes/studied_lsus/lsus_prop_final.shp")
     studied_subb <- read_sf("Data/GIS/hardcal_shapes/subbasins/hardcal_natural_basins.shp")
     
     
     
     # LSUS data extraction and agregation
     
     lsus_studied <- lsus_subbasins_shp %>%  st_drop_geometry()
     
     
     # List extraction: Precipitation
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_pcp_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_pcp <- sim_tagus_valr4_wb$simulation[grepl("ls_pcp", names(sim_tagus_valr4_wb$simulation))] #%>% .[lsus_data$namelist]
     
     
     # Calculating the average pcp for each subbasin in mm
     
     sims_num <- length(sim_tagus_valr4_wb$parameter$values$surlag)
     
     basin_pcps <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       lsus_area_sum <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_area_m")] %>% 
         sum(.)
       
       lsus_basin <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_id_rea", "area_frac")]
       
       
       basin_lsus_pcp <- lsus_pcp[lsus_basin$lsu_id_rea]
       
       
       av_pcps <- c(1:sims_num)
       
       for(f in 1:length(basin_lsus_pcp)){
         
         av_pcp <- basin_lsus_pcp[[f]][-c(1:5),-1] %>% apply(., 2, mean) %>% data.frame(pcp_mm = .) %>% mutate(pcp_mm = pcp_mm* lsus_basin$area_frac[f]) # Calculate the mm generated in each lsu taking into account the entire basin area
         
         av_pcps <- av_pcps %>% cbind(av_pcp) 
         
       }
       
       av_lsu_pcps <- tibble(av_pcp_mm = av_pcps[,-1] ) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       
       basin_pcp <- av_lsu_pcps %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_pcp <- basin_pcp %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_pcp_mm)
       
       
       basin_pcps[[i]] = basin_pcp # List with the pcp for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_pcp = paste("pcp_basin", Basin_ID, sep = ""))
     names(basin_pcps) <- namms$names_pcp
     
     
     
     # List extraction: SURQ = SURQ_GEN - SURQ_LS
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_gen_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqgen <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_gen", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_ls_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqls <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_ls", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     
     # Calculating the total surq in mm for each lsu considering their relative area regarding the subbasin
     lsu_surqtot <- list()
     for(i in 1:length(lsus_surqgen)){
       
       
       lsu_surqtot[[i]] <- ((lsus_surqgen[[i]][-c(1:5),-1] - lsus_surqls[[i]][-c(1:5),-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_surqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_surq_basin", lsus_data$Basin_ID, sep = "")
     
     
     # Calculating the total surq for each subbasin in mm
     
     basin_surqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_surqtot))
       
       selected_lsus <- lsu_surqtot[bas_select]
       
       av_surqs <- c(1:sims_num)
       
       for(f in 1:length(selected_lsus)){
         
         av_surq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_surqs <- av_surqs %>% cbind(av_surq) 
         
       }
       
       av_surqs <- tibble(av_surq_mm = av_surqs[,-1]) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_surq <- av_surqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_surq <- basin_surq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_surq_mm)
       
       
       basin_surqs[[i]] = basin_surq # List with the gwflo for all the subbasins
       
     }
     
     
     namms <- basins_file %>% mutate(names_surqtot = paste("total_surq_basin", Basin_ID, sep = ""))
     names(basin_surqs) <- namms$names_surqtot
     
     
     # List extraction: LURQ = LATQ_CHA + LATQ_RES
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqcha_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqcha <- sim_tagus_valr4_wb$simulation[grepl("ls_latqcha", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqres_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqres <- sim_tagus_valr4_wb$simulation[grepl("ls_latqres", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     # Calculating the total latq in mm for each lsu considering their relative area regarding the subbasin
     lsu_latqtot <- list()
     for(i in 1:length(lsus_latqcha)){
       
       
       lsu_latqtot[[i]] <- ((lsus_latqcha[[i]][-c(1:5),-1] + lsus_latqres[[i]][-c(1:5),-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_latqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_latq_basin", lsus_data$Basin_ID, sep = "")
     
     
     # Calculating the total latqq for each subbasin in mm
     
     basin_latqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_latqtot))
       
       selected_lsus <- lsu_latqtot[bas_select]
       
       av_latqs <- c(1:sims_num)
       
       for(f in 1:length(selected_lsus)){
         
         av_latq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_latqs <- av_latqs %>% cbind(av_latq) 
         
       }
       
       av_latqs <- tibble(av_latq_mm = av_latqs[,-1]) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_latq <- av_latqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_latq <- basin_latq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_latq_mm)
       
       
       basin_latqs[[i]] = basin_latq # List with the gwflo for all the subbasins
       
     }
     
     
     namms <- basins_file %>% mutate(names_latqtot = paste("total_latq_basin", Basin_ID, sep = ""))
     names(basin_latqs) <- namms$names_latqtot
     
     
     
     ## Aquifers data: Calculated using flo + flo_res. For some aquifers, the relative drainage area to the gagugin stations has been used (aquif_data$fact_corr, previously calculated with QGIS)
     
     aquifers_studied <- read_sf("Data/GIS/hardcal_shapes/studied_aquifers/aquifers_selected.shp") %>% arrange(., Basin_ID)
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     
     
     # List extraction
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwflocha_", Aq_id , sep = ""))
     aquifers_flocha <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwflocha", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwres_", Aq_id , sep = ""))
     aquifers_flores <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwres", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
     
     
     # Calculating the total gwflo in liters for each aquifer
     aquif_flo_tot_litres <- list()
     for(i in 1:length(aquifers_flocha)){
       
       
       aquif_flo_tot_litres[[i]] <- ((aquifers_flocha[[i]][-c(1:5),-1] + aquifers_flores[[i]][-c(1:5),-1]) * ( aquif_data$Area_km[i] * 1000000 * aquif_data$fact_corr[i])) %>% tibble(.)
       
     }
     
     names(aquif_flo_tot_litres) <- paste("aqu_", aquif_data$Aq_id, "totalflo_lit_basin", aquif_data$Basin_ID, sep = "")
     
     
     # Calculating the total flo for each subbasin in mm
     
     basin_gwflos <- list()
     for(i in 1:length(unique(aquif_data$Basin_ID))){
       
       aquifers_area_sum <- aquif_data %>% 
         filter(Basin_ID == unique(aquif_data$Basin_ID)[i]) %>% .[,c("fact_corr","Area_km")] %>% 
         mutate(real_area = fact_corr * Area_km) %>% .[, "real_area" ] %>% 
         sum(.)*1e6
       
       bas_select <- paste("basin",unique(aquif_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(aquif_flo_tot_litres))
       
       selected_aqus <- aquif_flo_tot_litres[bas_select]
       
       av_gwflos <- c(1:sims_num)
       
       for(f in 1:length(selected_aqus)){
         
         av_gwflo <- selected_aqus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_gwflos <- av_gwflos %>% cbind(av_gwflo) 
         
       }
       
       av_gwflos <- tibble(av_gwflo_mm = av_gwflos[,-1] / aquifers_area_sum) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_gwflo <- av_gwflos %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_gwflo <- basin_gwflo %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_gwflo_mm)
       
       
       basin_gwflos[[i]] = basin_gwflo # List with the gwflo for all the subbasins
       
     }
     
     
     namms <- basins_file %>% mutate(names_gwtot = paste("total_gwflo_basin", Basin_ID, sep = ""))
     names(basin_gwflos) <- namms$names_gwtot
     
     
     subb_tables <- list()
     for(i in 1:length(basin_gwflos)){
       pcp <- tibble(basin_pcps[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "pcp")
       latq <- tibble(basin_latqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "latq")
       surq <- tibble(basin_surqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "surq")
       gwflo <- tibble(basin_gwflos[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "gwflo")
       
       subb_table <- pcp %>%  left_join(., latq, "name")%>%  left_join(., surq, "name")%>%  left_join(., gwflo, "name") %>% 
         mutate(water_yield = latq + surq + gwflo) %>% 
         mutate(runoff_coeff = water_yield / pcp,
                gw_cont = gwflo / water_yield) %>% 
         mutate(Basin = basins_file$Basin[i],
                Basin_ID = basins_file$Basin_ID[i], 
                region = basins_file$region[i]) %>% 
         rename(run = name) %>% 
         .[,c("Basin_ID", "Basin", "region", "run",  "pcp",  "water_yield", "latq", "surq", "gwflo",  "runoff_coeff", "gw_cont" )]
       
       subb_tables[[i]] <- subb_table
       
     }
     
     
     namms <- paste("tab", basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     names(subb_tables) <- namms
     
     
     
     # write_rds(subb_tables, "Data/Results/Validation/Round_1_wb.rds")
     
     
     table_all <- c()
     for(m in 1:length(subb_tables)){
       
       tab <- subb_tables[[m]]
       table_all <- table_all %>% rbind(., tab)
     }
     
     write_csv(table_all, paste("Data/Results/Validation/Round_", round, "_wb.csv", sep = ""), quote = "none")
     
     

     
     ###### Calculating streamflow performance from saved data ######
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2  # Importante lo de use, ya que el NA.RM da fallo!!!
     
     observed_streamflow <- read_rds("Data/Simulations/list_observed_data.rds")
     
     simulated_streamflow  <- read_rds(paste("Data/Simulations/Validation/Val_simsr", round, "_simulated_list.rds", sep = ""))
     
     sims_num <- length(simulated_streamflow[[1]])-1
     
     
     
     
     streamflow_metrics <- c()
     streamflo_metrics_list <- list()
     
     for(i in 1:length(observed_streamflow)){
       
       obs <- observed_streamflow[[i]] %>% mutate(fecha = ymd(fecha)) %>% 
         filter(year(fecha) %in% 2015:2019)
       
       sim <- simulated_streamflow[[i]]%>% mutate(date = ymd(date)) %>% 
         filter(., date %in% ymd(min(obs$fecha)):ymd(max(obs$fecha)))
       
       nses <-  sim %>% select(-date) %>% 
         map_dbl(., ~NSE( .x, obs$caudal))
       r2s <-  sim %>% select(-date) %>% 
         map_dbl(., ~rsq_r2( .x, obs$caudal))
       pbias <-  sim %>% select(-date) %>% 
         map_dbl(., ~pbias( .x, obs$caudal))
       rmses <-  sim %>% select(-date) %>% 
         map_dbl(., ~rmse( .x, obs$caudal))
       
       tab <-  tibble(Subbasin_ID = basins_file$Basin_ID[i], Subbasin = basins_file$Basin[i] , 
                      region = basins_file$region[i], nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = c(1:sims_num))
       
       streamflow_metrics <- streamflow_metrics %>% rbind(., tab)
       streamflo_metrics_list[[i]] <- tab
     }
     
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     names(streamflo_metrics_list) <- subbasins_names
     
     
     write.csv(streamflow_metrics, paste("Data/Results/Validation/Round", round, "_streamflow_metrics_allchanel.csv", sep = ""), row.names = F, quote = F)
     #  write_rds(streamflo_metrics_list, "Data/Results/Validation/Round1_streamflow_metrics_allchanel.rds")
     
     }
     

     
     ##### ANALYSE AND MERGE VALIDATION RESULTS #####
     
     
     calibration_table <- read_csv("Data/Results/calibration_table.csv")
     
     # For each validation run, the iterations were saved as run_ and number of iteration within each validation run
     # For this reason, to match with the identifier of calibration_table, the length of the previous validation runs must be added
     identifier_corrections <- c(0,106,215,481)
     
     
     rounds_val <- 4
     table_rounds <- c()
     
     for(r in 1:rounds_val){
       
       # Validation result tables
       stream_metrics <- read_csv(paste("Data/Results/Validation/Round", r, "_streamflow_metrics_allchanel.csv", sep = "")) %>%
         mutate(run = run + identifier_corrections[r]) %>% 
         mutate(run_val = paste("run_", run, sep = "")) %>% select(-run) %>% 
         rename("nse_val" = "nse", "r2_val" = "r2", 
                "pbias_val" = "pbias", "rmse_val" = "rmse")
       
       wb_data <- read.csv(paste("Data/Results/Validation/Round_", r, "_wb.csv", sep = "")) %>% 
         mutate(run = paste("run_", as.numeric(str_remove(run, "run_"))+identifier_corrections[r], sep = "")) %>% 
         mutate(run_val = run) %>% select(-c(Basin, run, pcp, water_yield, latq, surq, gwflo)) %>% 
         rename("Subbasin_ID" = "Basin_ID", "runoff_coeff_val" = "runoff_coeff", "gw_cont_val" = "gw_cont")
       
       
       
       merged_tables <- stream_metrics %>% left_join(., wb_data, c("Subbasin_ID", "region", "run_val"))
       
       # Merging calibration and validation results
       table_round <- calibration_table %>% filter(round == paste("Round_", r, sep = "")) %>% 
         mutate(run_val = paste("run_" , run_val, sep = "")) %>% 
         left_join(., merged_tables, c("Subbasin_ID", "Subbasin", "region", "run_val"))
       
       # For each subbasin, the validation results for its selected simulations
       table_rounds <- rbind(table_rounds, table_round)
       
       
     }

     write_csv(x = table_rounds, file = "Data/Results/Validation/Calibration_validation_complete_table.csv")
     
     
     ##### Extract results for reservoir 12 inflow #####     
     
     # Best simulations in calibration
     val_sims_run_res <- read_table("Data/Simulations/Validation/simulations_for_validation.txt") %>% filter(Subbasin_ID == 23)
     
     val_sims_run_res_r1 <- val_sims_run_res %>% filter(round == "Round_1")
     val_sims_run_res_r3 <- val_sims_run_res %>% filter(round == "Round_3")
     
     
     best_sims_cal_sant <- calval_comp_table %>%  filter(Subbasin_ID == 23) %>% select(simulation_id , Subbasin_ID , nse_cal, r2_cal, pbias_cal, rmse_cal,rank_cal , run_val )
     
     # Reservoirs data
     
     reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv")
     
     
     # Observed data 
     
     observed_inflow <- read_csv("Data/Reservoirs/Simulation/CHT_obs_inflow_reservoirs.csv") %>% filter(., Lake_id == 12)
     
     # Extracting inflow for validation simulations
     identifier_corrections <- c(0,106,215,481)
     
     # Round 1
     
     sims_r1 <- read_rds("Data/Simulations/Validation/validation_simulations/sims_val_r1.rds")
     
     sant_inf_r1 <- sims_r1$simulation[grepl("res_in_12", names(sims_r1$simulation))] 
     
     sant_inf_r1 <- tibble(sant_inf_r1[[1]][,1], sant_inf_r1[[1]][,-1]/86400)
     
     colnames(sant_inf_r1)[-1] <- paste("run_", as.numeric(str_remove(colnames(sant_inf_r1)[-1], "run_")), sep = "")
     
     
     sant_inf_r1 <- sant_inf_r1 %>% select(date, paste("run_", val_sims_run_res_r1$run_val, sep = ""))
     
     
     sims_r3 <- read_rds("Data/Simulations/Validation/validation_simulations/sims_val_r3.rds")
     
     sant_inf_r3 <- sims_r3$simulation[grepl("res_in_12", names(sims_r3$simulation))] 
     
     sant_inf_r3 <- tibble(sant_inf_r3[[1]][,1], sant_inf_r3[[1]][,-1]/86400)
     
     colnames(sant_inf_r3)[-1] <- paste("run_", as.numeric(str_remove(colnames(sant_inf_r3)[-1], "run_"))+215, sep = "")
     
     
     sant_inf_r3 <- sant_inf_r3 %>% select(date, paste("run_", val_sims_run_res_r3$run_val, sep = ""))
     
     
     sant_val_sims <- sant_inf_r1 %>% left_join(., sant_inf_r3, "date")
     
     
     # Calculating performance for reservoirs inflow
     
     # Funtion to calculate coeficient of determination
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2 
     
     
     evaluated_period <- c(2015:2019)
     
     streamflow_metrics_res <- c()
     
     lake <- unique(observed_inflow$Lake_id)
     
     
     
     obsdays <- observed_inflow %>% 
       filter(year(date) %in% evaluated_period) %>% select(date)
     
     obs <- observed_inflow %>% 
       filter(year(date) %in% evaluated_period) %>% 
       group_by(year(date), month(date)) %>% 
       summarise(obsflow_m3s = mean(as.numeric(obsflow_m3s))) %>% 
       mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
       ungroup(.) %>% 
       select(., date, obsflow_m3s)
     
     sim <- sant_val_sims %>% 
      # filter(., date %in% ymd(min(obsdays$date)):ymd(max(obsdays$date))) %>% # Days without observed data does not compute
       group_by(year(date), month(date)) %>% 
       summarise(across(starts_with("run"), mean)) %>% 
       mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
       ungroup(.) %>% 
       select(., -c(`year(date)`, `month(date)`))
     
     clnms <-  str_remove(colnames(sim), "run_") %>% .[1:40]
     
     nses <-  sim %>% select(-c(date)) %>% 
       map_dbl(., ~NSE( .x, obs$obsflow_m3s))
     r2s <-  sim %>% select(-c(, date)) %>%
       map_dbl(., ~rsq_r2( .x, obs$obsflow_m3s))
     pbias <-  sim %>% select(-c(date)) %>%
       map_dbl(., ~pbias( .x, obs$obsflow_m3s))
     rmses <-  sim %>% select(-c(date)) %>%
       map_dbl(., ~rmse( .x, obs$obsflow_m3s))
     
     tab <-  tibble(reservoir = "Santillana", 
                    nse_val = nses, r2_val = r2s, pbias_val = pbias, rmse_val = rmses, run_val = clnms)
     
     
     tab_calval_res <- tab %>% mutate(run_val = paste("run_", run_val, sep = "")) %>% 
       left_join(., best_sims_cal_sant, "run_val") %>% 
       mutate(rank_nse_v = rank(nse_val),
              rank_r2_v = rank(r2_val),
              rank_pbias_v = rank(-abs(pbias_val)),
              rank_rmse_v = rank(-rmse_val), 
              rank_val = rank_nse_v + rank_r2_v + rank_pbias_v + rank_rmse_v,
              rank_val = rank(rank_val), 
              rank_cal = rank(rank_cal)) %>% 
       mutate(rank_average = (rank_cal+ rank_val)/2) %>% 
       arrange(., -rank_average) %>% slice(., 1:3)
     
     
     
     
      
     ###### SCALE 1: BEST SIMULATIONS FOR EACH SUBBASIN #####
     calval_comp_table <- read_csv("Data/Results/Validation/Calibration_validation_complete_table.csv")
     
     
     cal_val_ordered <- calval_comp_table %>% 
       group_by(Subbasin_ID) %>% 
       mutate(rank_cal = rank(rank_cal)) %>% 
       mutate(rank_nse = rank(nse_val),
              rank_r2 = rank(r2_val),
              rank_pbias = rank(-abs(pbias_val)),
              rank_rmse = rank(-rmse_val), 
              rank_val = rank_nse + rank_r2 + rank_pbias + rank_rmse,
              rank_val = rank(rank_val)) %>% 
       select(-c(rank_nse, rank_r2, rank_pbias, rank_rmse)) %>% 
       mutate(rank_average = (rank_cal+ rank_val)/2) %>% 
       select(simulation_id, region, Subbasin_ID,, Subbasin, rank_cal, rank_val, rank_average,
              nse_cal, nse_val, r2_cal, r2_val, pbias_cal, pbias_val, rmse_cal, rmse_val, gw_cont_cal, gw_cont_val) %>% 
       arrange(., Subbasin_ID, -rank_average)
     
     
     
     cal_val_ordered <- cal_val_ordered %>% 
       group_by(simulation_id, Subbasin) %>% 
       mutate(gw_cont = mean(c(gw_cont_cal, gw_cont_val)))
     
     
     # Filtering those simulations which meet the groundwater contribution requirements of each subbasin
     ranges_gw <- read.csv("Data/csv_files/basins_gw_ranges.csv")
     
     simulations_selection <- c()
     for(i in 1:length(unique(cal_val_ordered$Subbasin_ID))){
       simulation_selection <- cal_val_ordered %>% filter(Subbasin_ID == unique(cal_val_ordered$Subbasin_ID)[i]) %>%
         filter(gw_cont > ranges_gw[ranges_gw$Basin_ID == unique(cal_val_ordered$Subbasin_ID)[i], "gw_min"],
                gw_cont < ranges_gw[ranges_gw$Basin_ID == unique(cal_val_ordered$Subbasin_ID)[i], "gw_max"])
       
       simulations_selection <- simulations_selection %>%  rbind(., simulation_selection)
     }
     
     cal_val_ordered <- simulations_selection %>% select(-gw_cont)
     
     # 142 did not meet the requirement
     
     table_longer <- 
       cal_val_ordered %>% 
       pivot_longer(., c(nse_cal, nse_val, r2_cal, r2_val, pbias_cal, pbias_val, rmse_cal, rmse_val, gw_cont_cal, gw_cont_val)) %>% 
       mutate(Variable = case_when( str_sub(name, 1,3) == "nse" ~ "NSE",
                                    str_sub(name, 1,2) == "r2" ~ "R",
                                    str_sub(name, 1,5) == "pbias" ~ "PBIAS",
                                    str_sub(name, 1,4) == "rmse" ~ "RMSE", 
                                    str_sub(name, 1,2) == "gw" ~ "GWC")) %>%
       mutate(Period = case_when(   str_sub(name, -3) == "cal" ~ "Calibration",
                                    str_sub(name, -3) == "val" ~ "Validation")) 
     
     n_bests_extracted <- 5
     bests_ranked <- c()
     for(i in 1:length(unique(table_longer$Subbasin_ID))){
       
       tab_viol <-   table_longer %>% filter(Subbasin_ID == unique(table_longer$Subbasin_ID)[i])%>% 
         mutate(Variable = factor(Variable, levels = c("NSE", "R", "PBIAS", "RMSE", "GWC")))
       
       ordered_bests <- tab_viol %>% ungroup(.) %>% select(simulation_id, rank_average) %>% 
         .[!duplicated(.$simulation_id),] %>% arrange(., -rank_average) %>% 
         slice(., 1:n_bests_extracted) 
       
       best_ranked <-  table_longer %>% filter(Subbasin_ID == unique(table_longer$Subbasin_ID)[i]) %>% 
         filter(simulation_id  %in% ordered_bests$simulation_id) %>% 
         select(value, Variable, Period)%>% 
         mutate(Variable = factor(Variable, levels = c("NSE", "R", "PBIAS", "RMSE", "GWC")))
       
       bests_ranked <- rbind(bests_ranked, best_ranked)
       
    plot_comp <- tab_viol %>% 
      ggplot()+
      geom_violin(data = tab_viol, aes(y = value, x = Period, fill = Variable))+
      geom_point(data = best_ranked, aes(y = value, x = Period), color = "black", size = 3, shape = 17)+
      facet_wrap(facets = "Variable", scales = "free")+
      theme_bw()+
      ggtitle(paste("Subbasin ", unique(tab_viol$Subbasin_ID), ", ", unique(tab_viol$Subbasin), sep = ""))+
      theme(text = element_text(size = 18), legend.position = c(0.8, 0.25), 
            legend.key.size = unit(2, 'cm'), #change legend key size
            legend.key.height = unit(2, 'cm'), #change legend key height
            legend.key.width = unit(2, 'cm'), #change legend key width
            legend.title = element_text(size= 20, family = "bold"), #change legend title font size
            legend.text = element_text(size= 18), #change legend text font size,
            axis.title = element_blank())
   
    # ggsave(plot = plot_comp, filename = paste("Data/Figures/Validation/metrics_dist/best5/best5_", unique(tab_viol$Subbasin_ID), "_", 
    #                                           unique(tab_viol$Subbasin), "calval_comp.png", sep = ""),
    #        device = "png", width = 16 , height =  12, dpi = 300)
       
       
     }
    
     
     ##### Creating a list with the validation streamflows ordered #####
     
     validation_streams_r1 <- read_rds("Data/Simulations/Validation/Val_simsr1_simulated_list.rds")
     
     validation_streams_r2 <- read_rds("Data/Simulations/Validation/Val_simsr2_simulated_list.rds")
     for(l in 1:length(validation_streams_r2)){
       colnames(validation_streams_r2[[l]]) <-  c("date", paste("run_", 107:215, sep = ""))
     }
     
     validation_streams_r3 <- read_rds("Data/Simulations/Validation/Val_simsr3_simulated_list.rds")
     for(l in 1:length(validation_streams_r3)){
       colnames(validation_streams_r3[[l]]) <-  c("date", paste("run_", 216:480, sep = ""))
     }
     
     validation_streams_r4 <- read_rds("Data/Simulations/Validation/Val_simsr4_simulated_list.rds")
     for(l in 1:length(validation_streams_r4)){
       colnames(validation_streams_r4[[l]]) <-  c("date", paste("run_", 481:920, sep = ""))
     }
     
     list_channels_all <- list()
     for(l in 1:length(validation_streams_r1)){
       list_channels_all[[l]] <-  validation_streams_r1[[l]] %>% cbind(validation_streams_r2[[l]][-1], validation_streams_r3[[l]][-1], validation_streams_r4[[l]][-1])
     }
     
     names(list_channels_all) <- names(validation_streams_r1)
     write_rds(list_channels_all, "Data/Simulations/Validation/Validation_streamflows_merged.rds")
     

     
     #####  Extracting streamflow from the best simulations for each subbasin     ##### 
     
     
     # For calibration
     
     n_bests_extracted <- 5
     
     
     streamflows <- c()
     
     
     calibration_streamflow <- list()
     
    # for(i in c(1, 4, 9, 13, 20)){
     for(i in 1:length(unique(table_longer$Subbasin_ID))){
       
       table_subb <- table_longer %>% filter(Subbasin_ID == unique(table_longer$Subbasin_ID)[i])
       
       ordered_bests <- table_subb %>% ungroup(.) %>% select(simulation_id, rank_average) %>% 
         .[!duplicated(.$simulation_id),] %>% arrange(., -rank_average) %>% 
         slice(., 1:n_bests_extracted) 
       
       best_sim <-   table_subb %>% 
         filter(simulation_id  %in% ordered_bests$simulation_id) %>% 
         select(simulation_id) %>% 
         mutate(simulation_id = case_when(as.numeric(str_remove(simulation_id, "sim_")) < 1000 ~ paste("sim_0", as.numeric(str_remove(simulation_id, "sim_")), sep = ""),
                                          .default = simulation_id)) %>% 
         mutate(Round = case_when(as.numeric(str_remove(simulation_id, "sim_")) < 1001 ~ 1,
                                  as.numeric(str_remove(simulation_id, "sim_")) > 1000 & as.numeric(str_remove(simulation_id, "sim_")) < 2001 ~ 2, 
                                  as.numeric(str_remove(simulation_id, "sim_")) > 2000 & as.numeric(str_remove(simulation_id, "sim_")) < 3001 ~ 3, 
                                  as.numeric(str_remove(simulation_id, "sim_")) > 3000  ~ 4),
                simulation = str_remove(simulation_id, "sim_"),
                simulation = str_sub(simulation, 2,5)) %>% 
         mutate(simulation = case_when(simulation == "000"  ~ "1000", .default = simulation))
       
       best_sim_data <- best_sim %>% mutate(run_sim = paste(Round, simulation)) %>% 
         .[!duplicated(.$run_sim), "run_sim"] %>% 
         separate(run_sim, into = c("Round", "simulation"), sep = " ") %>% 
         mutate_all(., as.numeric)
       
       #best_sim_data <- tibble(Round = as.numeric(unique(best_sim$Round)), simulation = as.numeric(unique(best_sim$simulation)))
       
       str_dats <- tibble(date = seq(dmy("01/01/2010"), dmy("31/12/2014"), 1))
       
       for(f in 1:length(unique(best_sim_data$Round))){
         
         sims <- best_sim_data %>% filter(Round == unique(best_sim_data$Round)[f]) %>% select(simulation)
         
         str_dat <-   read_rds(paste("Data//Simulations//Round_", unique(best_sim_data$Round)[f], "/round_", unique(best_sim_data$Round)[f], "_simulated_list.rds", sep = "")) %>% .[[i]]
         
         sim_exct <- best_sim_data[best_sim_data$Round == unique(best_sim_data$Round)[f],"simulation"]
         # str_dat <- str_dat[,c(1, 1001)] For subbasin 13
         str_dat <- str_dat[,c(1, 1+sim_exct$simulation) ]
         
         
         
         
      #   str_dat <- str_dat %>% mutate(Period = "Calibration", Subbasin_ID = i)
      #   
      #  colnames(str_dat) <- c("date", "stremf", "Period", "Subbasin_ID")
      #   streamflows <-  rbind(streamflows, str_dat)
         
         
         str_dats <- str_dats %>% left_join(., str_dat, "date")
         
         
       }
       
       str_dats <- str_dats %>% mutate(Period = "Calibration", Subbasin_ID = i)
       calibration_streamflow[[i]] <- str_dats
       
     }
     
     
     # For validation
     
     runs_corresponce <- calval_comp_table %>% select(simulation_id, run_val)
     
     
     validation_streamflow <- read_rds("Data/Simulations/Validation/Validation_streamflows_merged.rds")
     validation_streamflows <- c()
     
     
     val_strs <- c()
     
    # for(i in 1:length(unique(table_longer$Subbasin_ID))){
       for(i in c(1, 4, 9, 13, 20)){
         
       
       table_subb <- table_longer %>% filter(Subbasin_ID == unique(table_longer$Subbasin_ID)[i])
       
       ordered_bests <- table_subb %>% ungroup(.) %>% select(simulation_id, rank_average) %>% 
         .[!duplicated(.$simulation_id),] %>% arrange(., -rank_average) %>% 
         slice(., 1:n_bests_extracted) 

       best_sim_data <- best_sim %>% mutate(run_sim = paste(Round, simulation)) %>% 
         .[!duplicated(.$run_sim), "run_sim"] %>% 
         separate(run_sim, into = c("Round", "simulation"), sep = " ") %>% 
         mutate_all(., as.numeric)
       

       val_sim <- tibble(simulation_id= unique(ordered_bests$simulation_id)) %>% left_join(., runs_corresponce, "simulation_id")
       val_sim <- val_sim[!duplicated(val_sim$simulation_id), "run_val"]
       
       val_streamf <- validation_streamflow[[i]]
       
       validation_streamflows[[i]] <-   val_streamf[, c(1, 1+as.numeric(str_remove(val_sim$run_val, "run_")))] %>% 
         mutate(Period = "Validation", Subbasin_ID = i)
       
       strrr <- val_streamf[, c(1, 1+as.numeric(str_remove(val_sim$run_val, "run_")))] %>% 
         mutate(Period = "Validation", Subbasin_ID = i)
       
       colnames(strrr) <- c("date", "stremf", "Period", "Subbasin_ID")
       val_strs <- rbind( val_strs, strrr)
       
     }
     
     
     # Merging streamflows with observed data
     # Creating hydrographs plots
     library(ggpmisc)
     library(patchwork)
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     
     obs_data <- read_rds("Data/Simulations/list_observed_data.rds")
     merged_streamflows_bets <- list()
     plots_hydrographs <- list()
     for(i in 1:length(unique(table_longer$Subbasin_ID))){
       
       obs_streamflow <- obs_data[[i]] %>% mutate(date = fecha, obs_flow = caudal) %>% select(date, obs_flow) 
       
       
       val_str <- validation_streamflows[[i]]%>% 
         select(date, starts_with("run"), Period, Subbasin_ID) 
       
       cal_str <- calibration_streamflow[[i]] %>% 
         select(date, starts_with("run"), Period, Subbasin_ID) 
       
       colnames(cal_str) <- colnames(val_str)
       
       merged_data <- rbind(cal_str, val_str) %>% left_join(., obs_streamflow, "date") 
       merged_streamflows_bets[[i]] <- merged_data
       
       # For including metrics
       
       table_subb <- table_longer %>% filter(Subbasin_ID == unique(table_longer$Subbasin_ID)[i])
       
       ordered_bests <- table_subb %>% ungroup(.) %>% select(simulation_id, rank_average) %>% 
         .[!duplicated(.$simulation_id),] %>% arrange(., -rank_average) %>% 
         slice(., 1:n_bests_extracted) 
       
       metrics <- table_longer %>% filter(Subbasin_ID == i) %>% 
         filter(simulation_id  %in% ordered_bests$simulation_id) 
       
       val_sim <- tibble(simulation_id = unique(metrics$simulation_id)) %>% left_join(., runs_corresponce, "simulation_id")
       val_sim <- val_sim[!duplicated(val_sim$simulation_id), ]
       
       tab_for_plot_cal <- metrics %>%  left_join(., val_sim, "simulation_id" ) %>% 
         select(Subbasin_ID, region, simulation_id, run_val, value, Variable, Period, rank_average) %>% 
         filter(Period == "Calibration") %>% pivot_wider(
           id_cols = c(Subbasin_ID, region, simulation_id, run_val, Period, rank_average),
           names_from = Variable,
           values_from = value) %>%  mutate_if(., is.numeric, round, digits = 2)
       
       
       tab_for_plot_val <- metrics %>%  left_join(., val_sim, "simulation_id" ) %>% 
         select(Subbasin_ID, region, simulation_id, run_val, value, Variable, Period, rank_average) %>% 
         filter(Period == "Validation") %>% pivot_wider(
           id_cols = c(Subbasin_ID, region, simulation_id, run_val, Period, rank_average),
           names_from = Variable,
           values_from = value) %>%  mutate_if(., is.numeric, round, digits = 2)
       
       
       
       plot_table_cal <-   ggplot()+annotate(geom = "table", x = 1, y = 1, label = list(tab_for_plot_cal))+
         theme_bw()+theme(axis.line = element_blank(), line = element_blank(),
                          text = element_blank(), panel.border   = element_blank())+
         ggtitle("Daily statistics")
       plot_table_val <-   ggplot()+annotate(geom = "table", x = 1, y = 1, label = list(tab_for_plot_val))+
         theme_bw()+theme(axis.line = element_blank(), line = element_blank(),
                          text = element_blank(), panel.border   = element_blank())+
         ggtitle("Daily statistics")
       
       
       
       plot_hydrograph <- merged_data%>% 
         pivot_longer(., starts_with("run")) %>% 
         ggplot(., aes(x = date))+
         geom_line(aes(y = obs_flow), color = "blue")+
         geom_line(aes(y = value, color = name))+
         theme_bw()+facet_wrap(facets = "Period", scales = "free_x")+
         ylab("Streamflow")+
         ggtitle(paste("Subbasin ", str_replace(subbasins_names[i], "_", ": "), sep = ""))+
         scale_color_manual(values = c("red3", "darkgreen", "orange", "darkorchid4", "yellowgreen"))+
         theme(axis.title.x = element_blank(), legend.position = c(0.9, 0.8),
               text = element_text(size = 18), 
               legend.key.size = unit(2, 'cm'), #change legend key size
               legend.key.height = unit(2, 'cm'), #change legend key height
               legend.key.width = unit(2, 'cm'), #change legend key width
               legend.title = element_text(size= 20), #change legend title font size
               legend.text = element_text(size= 18))+labs(color = "Simulation_val")
       
       
       plots_hydrographs[[i]] <- plot_hydrograph
       
       plot_merge <- plot_hydrograph / (plot_table_cal + plot_table_val) + plot_layout(heights = c(7,1))
       
       
       ggsave(plot = plot_merge, filename = paste("Data/Figures/Validation/streamflow/best5/",  
                                                       subbasins_names[i], "streamflow.png", sep = ""),
              device = "png", width = 16 , height =  12, dpi = 300)
     }

     
     
     
     ###### SCALE 2: BEST SIMULATIONS FOR GEOLOGICAL REGIONS #####
     
     
     # For each group determine its subbasins
     
     subbasin_groups <- list(IMPs = c(1, 22, 23),
                             SIMPs = c(21),
                             METs = c(2, 14, 15),
                             SMETs = c(3, 10),
                             CRBs = c(4,5,6,14,19,20),
                             SCRBs = c(11,16,17,20),
                             S2CRBs = c(13),
                             DTHs = c(9,10,13,15, 22),
                             SDTHs = c(7,8,12,18),
                             DTLs = c(8,11,12, 13, 18), 
                             SANT = c(23))
     
     
     # Create a table with the n_bests_extracted best simulations for each subbasin
     
     
     
     n_bests_extracted <- 20 # Number of simulations of each subbasin selected. They will be used to calculate the average performance in the entire region
     # cal_val_ordered has been previously filtered according to groundwater requirements
     
     
     best_sims_group <- list()
     ordered_bests <- c()
       
    
     for(g in 1:length(subbasin_groups)){
       
       
       group <- names(subbasin_groups[g])
       group_subbasins <- subbasin_groups[[g]]
       
       for(s in 1:length(group_subbasins)){

         table_subb <- cal_val_ordered %>% filter(Subbasin_ID == group_subbasins[s]) # cal_val_ordered has been already filtrated acordint to grounwater contribution
         
         ordered_best <- table_subb %>% ungroup(.) %>% select(simulation_id, rank_average) %>% 
           arrange(., -rank_average) %>% 
           slice(., 1:n_bests_extracted) %>% mutate(Subbasin_ID = group_subbasins[s], group = group)
         
         ordered_bests <- ordered_bests %>% rbind(ordered_best)
         
       }
       
     }
     
     
  ordered_bests
  
  
     ###### Extract the streamflow metrics for the best simulations for the other subbasins of a group ###### 
     
     simulations_corr <- read.csv("Data/Results/Validation/Calibration_validation_complete_table.csv") %>% 
       select(simulation_id, run_val)
     
     # Calibration metrics -->
     calibration_metrics <- read_csv("Data/Results/R1/HC_Round1_streamflow_metrics_allchanel.csv")%>% mutate(Round = 1) %>% 
       rbind(., read_csv("Data/Results/R2/HC_Round2_streamflow_metrics_allchanel.csv") %>% mutate(Round = 2),
             read_csv("Data/Results/R3/HC_Round3_streamflow_metrics_allchanel.csv")%>% mutate(Round = 3),
             read_csv("Data/Results/R4/HC_Round4_streamflow_metrics_allchanel.csv")%>% mutate(Round = 4)) %>% ungroup(.) %>% 
       mutate(simulation_id = case_when(Round == 1 ~ paste("sim_", run, sep = ""),
                                        Round == 2 ~ paste("sim_", 1000+run, sep = ""),
                                        Round == 3 ~ paste("sim_", 2000+run, sep = ""),
                                        Round == 4 ~ paste("sim_", 3000+run, sep = "")))%>% 
       rename(., "run_cal" = "run", "nse_cal" = "nse", "r2_cal" = "r2", 
              "pbias_cal" = "pbias", "rmse_cal" = "rmse") 
     
     
     calibratrion_wb <- read_csv("Data/Results/R1/HC_Round1_basinswb.csv")%>% mutate(Round = 1) %>% 
       rbind(., read_csv("Data/Results/R2/HC_Round2_basinswb.csv") %>% mutate(Round = 2),
             read_csv("Data/Results/R3/HC_Round3_basinswb.csv")%>% mutate(Round = 3),
             read_csv("Data/Results/R4/HC_Round4_basinswb.csv")%>% mutate(Round = 4)) %>% ungroup(.) %>% 
       mutate(run = as.numeric(str_remove(run, "run_"))) %>% 
       mutate(simulation_id = case_when(Round == 1 ~ paste("sim_", run, sep = ""),
                                        Round == 2 ~ paste("sim_", 1000+run, sep = ""),
                                        Round == 3 ~ paste("sim_", 2000+run, sep = ""),
                                        Round == 4 ~ paste("sim_", 3000+run, sep = ""))) %>% 
       select(Basin_ID, simulation_id, gw_cont ) %>% rename("Subbasin_ID" = "Basin_ID", "gw_cont_cal" = "gw_cont")
     
     calibration_complete_table <- calibration_metrics %>% left_join(., calibratrion_wb, c("Subbasin_ID", "simulation_id")) %>% 
       select(simulation_id, Subbasin_ID, nse_cal, r2_cal, pbias_cal, rmse_cal, gw_cont_cal) 
     
     
     # Validation metrics -->
     identifier_corrections <- c(0, 106, 215, 481)
     
     
     validation_metrics <- read_csv("Data/Results/Validation/Round1_streamflow_metrics_allchanel.csv")%>% mutate(run_val = paste("run_", run, sep = ""), Round = 1) %>% # 92 sims
       rbind(., read_csv("Data/Results/Validation/Round2_streamflow_metrics_allchanel.csv") %>% mutate(run_val = paste("run_", identifier_corrections[2]+run, sep = ""), Round = 2), # 160 sims
             read_csv("Data/Results/Validation/Round3_streamflow_metrics_allchanel.csv") %>% mutate(run_val = paste("run_", identifier_corrections[3]+run, sep = ""), Round = 3), # 117 sims
             read_csv("Data/Results/Validation/Round4_streamflow_metrics_allchanel.csv") %>% mutate(run_val = paste("run_", identifier_corrections[4]+run, sep = ""), Round = 4))%>% ungroup(.) %>% 
       rename(., "nse_val" = "nse", "r2_val" = "r2", 
              "pbias_val" = "pbias", "rmse_val" = "rmse") 
     
     
     validation_wb <- read_csv("Data/Results/Validation/Round_1_wb.csv") %>% mutate(run_val = identifier_corrections[1]+as.numeric(str_remove(run, "run_")), Round = 1) %>% # 92 sims
       rbind(., read_csv("Data/Results/Validation/Round_2_wb.csv") %>% mutate(run_val = identifier_corrections[2]+as.numeric(str_remove(run, "run_")), Round = 2),
             read_csv("Data/Results/Validation/Round_3_wb.csv") %>% mutate(run_val = identifier_corrections[3]+as.numeric(str_remove(run, "run_")), Round = 3),
             read_csv("Data/Results/Validation/Round_4_wb.csv") %>% mutate(run_val = identifier_corrections[4]+as.numeric(str_remove(run, "run_")), Round = 4)) %>% 
       select(Basin_ID, run_val, gw_cont ) %>% rename("Subbasin_ID" = "Basin_ID") %>% mutate(run_val = paste("run_", run_val, sep = ""))
     
     
     validation_complete_table <- validation_metrics %>% left_join(.,validation_wb, c("Subbasin_ID", "run_val")) %>% 
       left_join(., simulations_corr, "run_val") %>% select(simulation_id, run_val, Subbasin_ID, Subbasin, region, nse_val, r2_val, pbias_val, rmse_val, gw_cont) %>% 
       rename("gw_cont_val" = "gw_cont")
     
     
     
     merged_complete_table <- calibration_complete_table %>% left_join(., validation_complete_table, c("simulation_id", "Subbasin_ID")) %>% 
       filter(!is.na(run_val))
     
     
     merged_complete_table %>% write.csv("Data/Results/Validation/Complete_data_calibration_validation.csv", quote = F)
     
     
     
     
     ###### Use extracted data to determine the best parameters sets at geological region scale ###### 
     
     merged_complete_table <- read_csv("Data/Results/Validation/Complete_data_calibration_validation.csv")
     
     
     selected_sim_n <- 3
     
     selected_simulations <- tibble(sim_ids = c(), group = c(), Subbasins_ID = c())
     
     for(g in 1:length(subbasin_groups)){
       
       group_ <- names(subbasin_groups[g])
       group_subbasins <- subbasin_groups[[g]]
       
       
       sims_group_data <-  ordered_bests %>% filter(group == group_)
       
       metrics_best_sims <- merged_complete_table %>% filter(simulation_id %in% sims_group_data$simulation_id, 
                                                             Subbasin_ID %in% group_subbasins) %>% 
         arrange(., simulation_id, Subbasin_ID)
       
       # Loop to remove duplicated rows (rows with duplicated simulation_id and Subbasin_ID) 

       ru <- 0
       
       for(u in 2:length(metrics_best_sims$simulation_id)){ 
         
         u <- u-ru # Since some rows are being removed, u value must be updated
         
         if(metrics_best_sims[u, "Subbasin_ID"] == metrics_best_sims[u-1, "Subbasin_ID"] &  
            metrics_best_sims[u, "simulation_id"] == metrics_best_sims[u-1, "simulation_id"]){
           metrics_best_sims <- metrics_best_sims[-u,]  
           ru <- 1+ru
         } 
       }
       
       
       average_sims_values <-   metrics_best_sims %>%  mutate(simulation_id = factor(simulation_id)) %>% 
         group_by(simulation_id) %>% 
         summarise(nse_cal_m = mean(nse_cal),
                   r2_cal_m = mean(r2_cal), 
                   pbias_cal_m = mean(abs(pbias_cal)), 
                   rmse_cal_m = mean(rmse_cal),
                   nse_val_m = mean(nse_val),
                   r2_val_m = mean(r2_val), 
                   pbias_val_m = mean(abs(pbias_val)), 
                   rmse_val_m = mean(rmse_val)) %>% 
         mutate(rank_nse_c = rank(nse_cal_m),
                rank_r2_c = rank(r2_cal_m),
                rank_pbias_c = rank(-abs(pbias_cal_m)),
                rank_rmse_c = rank(-rmse_cal_m),
                rank_cal = rank_nse_c + rank_r2_c + rank_pbias_c + rank_rmse_c) %>% 
         mutate(rank_nse_v = rank(nse_val_m),
                rank_r2_v = rank(r2_val_m),
                rank_pbias_v = rank(-abs(pbias_val_m)),
                rank_rmse_v = rank(-rmse_val_m),
                rank_val = rank_nse_v + rank_r2_v + rank_pbias_v + rank_rmse_v) %>% 
         mutate(rank_average = (rank_cal + rank_val)/2) %>% 
         arrange(., -rank_average)   
       
       
       selected_sims <-  average_sims_values %>% select(simulation_id, rank_average) 
       
       selected_sims <- tibble(sim_ids = unique(selected_sims$simulation_id)) %>% slice(., 1:selected_sim_n) %>% 
         mutate(group = group_, Subbasins_ID = paste(group_subbasins, collapse = ","))
       
       selected_simulations <- selected_simulations %>% rbind(., selected_sims)
       
       
       
     }
     
     
     selected_simulations
     

     
     
     # Adding the best simulations of reservoir 12
       res12_best <- tab_calval_res[,c("simulation_id", "rank_average",  "Subbasin_ID")] %>% mutate(group = "SANT") %>% 
         rename(sim_ids = simulation_id) %>% mutate(Subbasins_ID = as.character(Subbasin_ID)) %>% 
         select(sim_ids, Subbasins_ID, group)
       
       selected_simulations <-   selected_simulations %>% rbind(res12_best)
     
     
     ###### Extracting best sets parameters sets and creating random combinations ######

     ######## Creating a file with parameters values for all the regions and iterations ########
     
     parameters_r1_values <- read_rds("Data/Simulations/Round_1/round_1_HC_Tagus.rds")[1][[1]][[1]]
     
     parameters_r2_values <- read_rds("Data/Simulations/Round_2/round_2_HC_Tagus.rds")[1][[1]][[1]]
     
     parameters_r3_values <- read_rds("Data/Simulations/Round_3/round_3_HC_Tagus.rds")[1][[1]][[1]]
     
     parameters_r4_values <- read_rds("Data/Simulations/Round_4/round_4_HC_Tagus.rds")[1][[1]][[1]]
     
     # Round 1: IMP, CRB, DTH, DTL
     # Round 2: IMP, MET, CRB, SCRB, DTH, DTL
     # Round 3 & 4: IMP, SIMP, SANT, MET, SMET, CRB, SCRB, S2CRB, DTH, SDTH, DTL

     
     
     simp_r1_pars <- parameters_r1_values %>% select(starts_with("IMP"))
     colnames(simp_r1_pars) <- str_replace(colnames(simp_r1_pars), "IMP", "SIMP")
    
     sant_r1_pars <- parameters_r1_values %>% select(IMP_awc, IMP_zso, IMP_kso)
     colnames(sant_r1_pars) <- str_replace(colnames(sant_r1_pars), "IMP", "SANT")
     
     met_r1_pars <- parameters_r1_values %>% select(starts_with("IMP"))
     colnames(met_r1_pars) <- str_replace(colnames(met_r1_pars), "IMP", "MET")
     
     smet_r1_pars <- parameters_r1_values %>% select(starts_with("IMP"))
     colnames(smet_r1_pars) <- str_replace(colnames(smet_r1_pars), "IMP", "SMET")
   
     scrb_r1_pars <- parameters_r1_values %>% select(starts_with("CRB"))
     colnames(scrb_r1_pars) <- str_replace(colnames(scrb_r1_pars), "CRB", "SCRB")
     
     s2crb_r1_pars <- parameters_r1_values %>% select(starts_with("CRB"))
     colnames(s2crb_r1_pars) <- str_replace(colnames(s2crb_r1_pars), "CRB", "S2CRB")

     sdth_r1_pars <- parameters_r1_values %>% select(starts_with("DTH"))
     colnames(sdth_r1_pars) <- str_replace(colnames(sdth_r1_pars), "DTH", "SDTH")
     
     parameters_r1_values <-  parameters_r1_values %>% cbind(simp_r1_pars, sant_r1_pars, met_r1_pars, smet_r1_pars, scrb_r1_pars, s2crb_r1_pars, sdth_r1_pars) %>% tibble(.)
     
     
     
     parameters_r2_values
     
     simp_r2_pars <- parameters_r2_values %>% select(starts_with("IMP"))
     colnames(simp_r2_pars) <- str_replace(colnames(simp_r2_pars), "IMP", "SIMP")
     
     sant_r2_pars <- parameters_r2_values %>% select(IMP_awc, IMP_zso, IMP_kso)
     colnames(sant_r2_pars) <- str_replace(colnames(sant_r2_pars), "IMP", "SANT")
     
     smet_r2_pars <- parameters_r2_values %>% select(starts_with("MET"))
     colnames(smet_r2_pars) <- str_replace(colnames(smet_r2_pars), "MET", "SMET")
     
     s2crb_r2_pars <- parameters_r2_values %>% select(starts_with("SCRB"))
     colnames(s2crb_r2_pars) <- str_replace(colnames(s2crb_r2_pars), "SCRB", "S2CRB")
     
     sdth_r2_pars <- parameters_r2_values %>% select(starts_with("DTH"))
     colnames(sdth_r2_pars) <- str_replace(colnames(sdth_r2_pars), "DTH", "SDTH")
     
     
     
     parameters_r2_values <-  parameters_r2_values %>% cbind(simp_r2_pars, sant_r2_pars, smet_r2_pars, s2crb_r2_pars, sdth_r2_pars) %>% tibble(.)
     
     
     sdth_r3_pars <- parameters_r3_values %>% select(starts_with("DTH"))
     colnames(sdth_r3_pars) <- str_replace(colnames(sdth_r3_pars), "DTH", "SDTH")
     
     parameters_r3_values <-  parameters_r3_values %>% cbind(sdth_r3_pars) %>% tibble(.)
     
     parameters_all_rounds <- rbind(parameters_r1_values, parameters_r2_values,  parameters_r3_values, parameters_r4_values) %>% 
       mutate(simulation = rep(c(1:1000),4), .before = 1) %>% mutate(simulation_id = paste("sim_", 1:4000, sep = ""), .before = 1) %>% 
       mutate(Round = c(paste("Round", rep(1, 1000), sep = "_"), paste("Round", rep(2, 1000), sep = "_"),
                        paste("Round", rep(3, 1000), sep = "_"), paste("Round", rep(4, 1000), sep = "_")), .before = 1)
     
     
     
     
     write_csv(parameters_all_rounds, "Data/Simulations/Parameters_all_rounds.csv")
     
     ###### Extracting for each group the best 3 parameters sets ######  
     
     parameters_all <- read.csv("Data/Simulations/Parameters_all_rounds.csv")


     par_values_list <- list()
     
     for(g in 1:length(subbasin_groups)){
       
       group_ <- names(subbasin_groups[g])
       group_subbasins <- subbasin_groups[[g]]

       parms_ext <-  selected_simulations %>% filter(group == group_) 
       
       par_values_list[[g]] <- parameters_all %>% select(c(simulation_id, surlag, chn, starts_with(str_sub(group_,1,3)))) %>% 
         filter(simulation_id %in% parms_ext$sim_ids)
       
     }
       

     # Parameters of regions  
     
     par_combs <-   par_values_list[[1]][,-c(1:3)] %>% 
       cbind( par_values_list[[2]][,-c(1:3)],
              par_values_list[[3]][,-c(1:3)],
              par_values_list[[4]][,-c(1:3)],
              par_values_list[[5]][,-c(1:3)],
              par_values_list[[6]][,-c(1:3)],
              par_values_list[[7]][,-c(1:3)], 
              par_values_list[[8]][,-c(1:3)],
              par_values_list[[9]][,-c(1:3)], 
              par_values_list[[10]][,-c(1:3)], 
              par_values_list[[11]][,-c(1:3)]) %>% 
       rbind(., apply(., 2, mean))
     
     
     # Common parameters
     par_comm <-   par_values_list[[1]][,c(2,3)] %>% 
       rbind( par_values_list[[2]][,c(2,3)],
              par_values_list[[3]][,c(2,3)],
              par_values_list[[4]][,c(2,3)],
              par_values_list[[5]][,c(2,3)],
              par_values_list[[6]][,c(2,3)],
              par_values_list[[7]][,c(2,3)], 
              par_values_list[[8]][,c(2,3)],
              par_values_list[[9]][,c(2,3)], 
              par_values_list[[10]][,c(2,3)], 
              par_values_list[[11]][,c(2,3)]) %>% 
       summarise(mean_surlag = mean(surlag), 
                 median_surlag = median(surlag),
                 q1_surlag = quantile(surlag, 0.25),
                 q3_surlag = quantile(surlag, 0.75),
                 mean_chn = mean(chn), 
                 median_chn = median(chn),
                 q1_chn = quantile(chn, 0.25),
                 q3_chn = quantile(chn, 0.75)) %>% 
       pivot_longer(., c(mean_surlag, median_surlag, q1_surlag, q3_surlag, mean_chn, median_chn,  q1_chn,  q3_chn), names_to = "stat", values_to = "value") %>% 
       separate(col = stat, into = c("stat", "parameter"), sep = "_") 
     
     
     tib_com_pars <- tibble(surlag = par_comm$value[par_comm$parameter == "surlag"], chn = par_comm$value[par_comm$parameter == "chn"])
     
     
     validation_parameter_sets <- par_combs %>% cbind(tib_com_pars) %>% mutate(set_id = c(1:4), .before = 1) %>% tibble(.) %>% select(-simulation)
     
     
     
     
     write_csv(validation_parameter_sets, "Data/Results/Validation/Parameters/Validation_parameters_Bestsets.csv")
 

     #### Creating random combinations of the different geological groups. 
     
     
     validation_parameter_sets <- read_csv("Data/Results/Validation/Parameters/Validation_parameters_Bestsets.csv")
     
    
       
     ###### Loops for creating random sequences for each geological group ###### 
    
    
       u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)


     # IMP Parameters
     
     u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
     while ( length(unique(table(u))) > 1) { 
       u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
       print(u)}
     
      immp <-  validation_parameter_sets %>% select(starts_with("IMP")) 
      imp_randomcomb <-    immp[c(1,2,3,4,u),]
      imp_parset_identifier <- tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "IMP")  

      
     # SIMP Parameters
     
     u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
     while ( length(unique(table(u))) > 1) { 
       u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
       print(u)}
     
      simmp <-  validation_parameter_sets %>% select(starts_with("SIMP")) 
      simp_randomcomb <-    simmp[c(1,2,3,4,u),]
      simp_parset_identifier <- tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "SIMP")  
     
      
      # SANT Parameters
     
     u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
     while ( length(unique(table(u))) > 1) { 
       u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
       print(u)}
     
      sant <-  validation_parameter_sets %>% select(starts_with("SANT")) 
      sant_randomcomb <-    sant[c(1,2,3,4,u),]
      sant_parset_identifier <- tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "SANT")  
      
     # MET Parameters
      
      u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
      while ( length(unique(table(u))) > 1) { 
        u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
        print(u)}
      
      meet <-  validation_parameter_sets %>% select(starts_with("MET")) 
      met_randomcomb <-    meet[c(1,2,3,4,u),]
      met_parset_identifier <-  tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "MET")   

     # SMET Parameters
      
      u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
      while ( length(unique(table(u))) > 1) { 
        u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
        print(u)}
      
      smeet <-  validation_parameter_sets %>% select(starts_with("SMET")) 
      smet_randomcomb <-    smeet[c(1,2,3,4,u),]
      smet_parset_identifier <-  tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "SMET")   
      
     # CRB Parameters
    
      u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
      while ( length(unique(table(u))) > 1) { 
        u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
        print(u)}
      
      crrb <-  validation_parameter_sets %>% select(starts_with("CRB")) 
      crb_randomcomb <-    crrb[c(1,2,3,4,u),]
      crb_parset_identifier <-  tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "CRB")   
      
      
     # SCRB Parameters
     
       u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
      while ( length(unique(table(u))) > 1) { 
        u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
        print(u)}
      
      scrrb <-  validation_parameter_sets %>% select(starts_with("SCRB")) 
      scrb_randomcomb <-    scrrb[c(1,2,3,4,u),]
      scrb_parset_identifier <-  tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "SCRB")   
      
      
     # S2CRB Parameters
     
       u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
      while ( length(unique(table(u))) > 1) { 
        u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
        print(u)}
      
      s2crrb <-  validation_parameter_sets %>% select(starts_with("S2CRB")) 
      s2crb_randomcomb <-    s2crrb[c(1,2,3,4,u),]
      s2crb_parset_identifier <-  tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "S2CRB")   
 
      
     # DTH Parameters
      
      u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
      while ( length(unique(table(u))) > 1) { 
        u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
        print(u)}
      
      dtth <-  validation_parameter_sets %>% select(starts_with("DTH")) 
      dth_randomcomb <-    dtth[c(1,2,3,4,u),]
      dth_parset_identifier <-  tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "DTH")   
      
      
     # SDTH Parameters
      
      u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
      while ( length(unique(table(u))) > 1) { 
        u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
        print(u)}
      
      dtth <-  validation_parameter_sets %>% select(starts_with("SDTH")) 
      sdth_randomcomb <-    dtth[c(1,2,3,4,u),]
      sdth_parset_identifier <-  tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "SDTH")   
      
      
      # DTL Parameters
     
       u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
      while ( length(unique(table(u))) > 1) { 
        u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
        print(u)}
      
      dttl <-  validation_parameter_sets %>% select(starts_with("DTL")) 
      dtl_randomcomb <-    dttl[c(1,2,3,4,u),]
      dtl_parset_identifier <-  tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "DTL")   
      
     
      # SURLAG Parameter combinations (1 mean, 2 median, 3 q1, 4 13)
      
      u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
      while ( length(unique(table(u))) > 1) { 
        u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
        print(u)}
      
      surlag <-  validation_parameter_sets %>% select(starts_with("surl")) 
      sur_randomcomb <-    surlag[c(1,2,3,4,u),]
      sur_parset_identifier <-  tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "surlag")   
      
      

      # CHN Parameter combinations (1 mean, 2 median, 3 q1, 4 13)
      
      
      u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
      while ( length(unique(table(u))) > 1) { 
        u <-   sample(c(1,2,3,4), size = 56, prob = c(0.25, 0.25, 0.25, 0.25), replace = T)
        print(u)}
      
      chn <-  validation_parameter_sets %>% select(starts_with("chn")) 
      chn_randomcomb <-    chn[c(1,2,3,4,u),]
      chn_parset_identifier <-  tibble(simulation = paste("sim_", 1:60, sep = ""), parset_id = c(1,2,3,4,u), group = "chn")   
      
      
      
      
    
      # Merging identifiers and parameter sets
      
     parsets_identifiers <- sur_parset_identifier %>% rbind(chn_parset_identifier, imp_parset_identifier, sant_parset_identifier, simp_parset_identifier, met_parset_identifier, smet_parset_identifier, 
                                      crb_parset_identifier, scrb_parset_identifier, s2crb_parset_identifier,
                                      dth_parset_identifier,  sdth_parset_identifier, dtl_parset_identifier)
      
       
     
     parsets_created <- sur_randomcomb %>% cbind(chn_randomcomb, imp_randomcomb,  sant_randomcomb, simp_randomcomb, met_randomcomb, smet_randomcomb, 
                                                 crb_randomcomb, scrb_randomcomb, s2crb_randomcomb, dth_randomcomb, sdth_randomcomb, dtl_randomcomb)
     
     
      write.csv(parsets_created, "Data/Results/Validation/Parameters/Bestsets_combs.csv", row.names = F)
      write.csv(parsets_identifiers, "Data/Results/Validation/Parameters/Bestsets_combs_identifiers.csv", row.names = F)
     
     parsets_identifiers <- read_csv("Data/Results/Validation/Parameters/Bestsets_combs_identifiers.csv")
     parsets_identifiers %>% #pivot_wider(names_from = group, values_from = parset_id) %>% 
       mutate(simulation = factor(simulation, levels = paste("sim_", 60:1, sep = ""))) %>% 
       mutate(parset_id = factor(parset_id)) %>% 
       mutate(group = factor(group, levels = c("surlag", "chn", "IMP", "SIMP", "SANT", "MET", "SMET", "CRB", "SCRB", "S2CRB", "DTH", "DTL"))) %>% 
       # filter(group %in% c("SCRB", "CRB")) %>% 
       ggplot(., aes(y = simulation, x = group))+
       geom_point(aes(color = parset_id), size = 3, shape = 15)+ 
       scale_color_manual(values = c("red", "blue", "green", "orange"))+
       labs(x = "Parameter group", color = "Parameter set")+
       theme_bw()+theme(axis.title.y = element_blank(), text = element_text(size = 12))
     
     
     
     parsets_identifiers %>% #pivot_wider(names_from = group, values_from = parset_id) %>% 
       mutate(simulation = factor(simulation, levels = paste("sim_", 60:1, sep = ""))) %>% 
       mutate(parset_id = factor(parset_id)) %>% 
       mutate(group = factor(group, levels = c("surlag", "chn", "IMP", "MET", "SMET", "CRB", "SCRB", "DTH", "SDTH", "DTL"))) %>% 
       ggplot(., aes(y = simulation, x = group))+
       geom_point(aes(color = parset_id), size = 3, shape = 15)+ 
       scale_color_manual(values = c("red", "blue", "green", "orange"))+
       labs(x = "Parameter group", color = "Parameter set")+
       theme_bw()+theme(axis.title.y = element_blank(), text = element_text(size = 12))+
       transition_states(states = rev(simulation), state_length = 0.005 )+ shadow_mark()
     
     
     
     
     #### Run random combinations of best parameters ####
     
     # Parameter values exported
     parcomb_vals <- read_csv("C:/Users/alejandro.sanchezg/Desktop/Bestsets_combs.csv")
     
     # Extracting the names from previous round
     pars_r4 <- read_rds("C:/ASG/HARDCAL_Tagus_Hydchanged/round_4_HC_Tagus.rds") %>% .[1]
     
     # Naming parameters
     colnames(parcomb_vals) <- pars_r4$parameter$definition$full_name
     
     tagus_path <- "C:/Modelos/Modelo_HC_Tagus"
     
     sim_tagus_val_bestset_combs <-  run_swatplus(project_path = tagus_path,
                                                  output = list(
                                                    ls_pcp   = define_output(file = 'lsunit_wb_yr', 
                                                                             variable = 'precip', 
                                                                             unit = 1:1450),
                                                    # ls_et    = define_output(file = 'lsunit_wb_yr', 
                                                    #                          variable = 'et', 
                                                    #                          unit = used_lsus),
                                                    ls_surq_gen   = define_output(file = 'lsunit_wb_yr',   # SURQ_CHA + SURQ_RES = SURQ_GEN - SURQ_LS
                                                                                  variable = 'surq_gen', 
                                                                                  unit = 1:1450),
                                                    ls_surq_ls   = define_output(file = 'lsunit_wb_yr', 
                                                                                 variable = 'surq_ls', 
                                                                                 unit  = 1:1450),
                                                    # ls_latqgen   = define_output(file = 'lsunit_wb_yr',  # LATQGEN - LATQLS = LATQ_CHA + LATQ_GEN
                                                    #                              variable = 'latq', 
                                                    #                              unit = used_lsus),
                                                    # ls_latqls   = define_output(file = 'lsunit_wb_yr', 
                                                    #                             variable = 'latq_ls', 
                                                    #                             unit = used_lsus),
                                                    ls_latqcha   = define_output(file = 'lsunit_wb_yr',  # LATQ = LATQCHA + LATQRES
                                                                                 variable = 'latq_cha', 
                                                                                 unit = 1:1450),
                                                    ls_latqres   = define_output(file = 'lsunit_wb_yr', 
                                                                                 variable = 'latq_res', 
                                                                                 unit = 1:1450),
                                                    #  ls_perc   = define_output(file = 'lsunit_wb_yr', 
                                                    #                            variable = 'perc', 
                                                    #                            unit = used_lsus),
                                                    #  basin_pcp = define_output(file = 'basin_wb_yr',
                                                    #                            variable = "precip",
                                                    #                            unit = 1), 
                                                    #  basin_et = define_output(file = 'basin_wb_yr',
                                                    #                           variable = 'et',
                                                    #                           unit = 1), 
                                                    #  basin_perco = define_output(file = 'basin_wb_yr',
                                                    #                              variable = 'perc',
                                                    #                              unit = 1),
                                                    #  basin_surqgen = define_output(file = 'basin_wb_yr',
                                                    #                                variable = 'surq_gen',
                                                    #                                unit = 1),
                                                    #  basin_surqls = define_output(file = 'basin_wb_yr',
                                                    #                               variable = 'surq_ls',
                                                    #                               unit = 1),
                                                    #  basin_surqcha = define_output(file = 'basin_wb_yr',
                                                    #                                variable = 'surq_cha',
                                                    #                                unit = 1),
                                                    #  basin_surqres = define_output(file = 'basin_wb_yr',
                                                    #                                variable = 'surq_res',
                                                    #                                unit = 1),
                                                    #  basin_latqcha = define_output(file = 'basin_wb_yr',
                                                    #                                variable = 'latq_cha',
                                                    #                                unit = 1),
                                                    #  basin_latqqres = define_output(file = 'basin_wb_yr',
                                                    #                                 variable = 'latq_res',
                                                    #                                 unit = 1),
                                                    #  basin_perco = define_output(file = 'basin_wb_yr',
                                                    #                              variable = 'perc',
                                                    #                              unit = 1),
                                                    #  basin_gwflo = define_output(file = 'basin_aqu_yr',
                                                    #                              variable = 'flo',
                                                    #                              unit = 1),
                                                    aqu_gwflocha = define_output(file = 'aquifer_yr',
                                                                                 variable = 'flo_cha',
                                                                                 unit = 1:126),
                                                    aqu_gwres = define_output(file = 'aquifer_yr',
                                                                              variable = 'flo_res',
                                                                              unit =    1:126),
                                                    #  aqu_gwtot = define_output(file = 'aquifer_yr',
                                                    #                            variable = 'flo',
                                                    #                            unit = used_quifers),
                                                    # aqu_stor = define_output(file = 'aquifer_yr',
                                                    #                          variable = 'stor',
                                                    #                          unit = 1:126),
                                                    # aqu_rchrg = define_output(file = 'aquifer_yr',
                                                    #                           variable = 'rchrg',
                                                    #                           unit = 1:126),
                                                    # res_in = define_output(file = 'reservoir_yr',          #For round 3
                                                    #                        variable = 'flo_in',      #For round 3        
                                                    #                        unit = 1:31),             #For round 3 
                                                    # res_stor = define_output(file = 'reservoir_yr',        #For round 3      
                                                    #                          variable = 'flo_stor',    #For round 3          
                                                    #                          unit = 1:31),             #For round 3 
                                                    # res_out = define_output(file = 'reservoir_yr',         #For round 3     
                                                    #                         variable = 'flo_out',     #For round 3         
                                                    #                         unit = 1:31),             #For round 3             
                                                    flow_cha = define_output(file = "channel_sd_day", 
                                                                             variable = "flo_out",
                                                                             unit = c(561, 750, 11, 1218, 567, 825, 564, 630, 532, 962,
                                                                                      990, 541, 950, 149, 376, 535, 537, 1141, 1161, 14,
                                                                                      947, 184, 525, 573, 208, 111, 949, 581, 452))),#, 444,
                                                  #155, 185, 504, 161, 459, 929, 133, 176, 483, 911, 882 ,1076))), #For round 3
                                                  parameter = parcomb_vals,
                                                  start_date = 20050101,
                                                  end_date = 20191231,
                                                  start_date_print = 20100101,
                                                  # save_file = "hc_round_2_revap",
                                                  n_thread = 60)
     
     
     
     write_rds(sim_tagus_val_bestset_combs, "C:/ASG/HARDCAL_Tagus_Hydchanged/validation_beststes_comb_20102019.rds")        
     
     
     #### Extract results of random combinations of best parameters sets simulations ####
     
     ###### Simulated streamflow  ###### 
     #Some of the gauging stations collect the water from more than one channel
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     
     
     chanels <- read_rds("Data/Simulations/Validation/validation_simulations/sims_val_bestcombs60.rds")
     
     
     navaluenga <- tibble(date = chanels$simulation$flow_cha_561$date, chanels$simulation$flow_cha_561[,-1]+ chanels$simulation$flow_cha_750[,-1] )
     
     matallana <-  chanels$simulation$flow_cha_11
     
     villarejo <-  chanels$simulation$flow_cha_1218
     
     peralejo <- tibble(date = chanels$simulation$flow_cha_567$date, chanels$simulation$flow_cha_567[,-1]+ chanels$simulation$flow_cha_825[,-1] )
     
     priego_escabas <- tibble(date = chanels$simulation$flow_cha_564$date, chanels$simulation$flow_cha_564[,-1] * (1/1.05)) #  The gauging station it is not at the end of the channel
     
     santa_maria_val <- chanels$simulation$flow_cha_630
     
     javalera <- tibble(date = chanels$simulation$flow_cha_532$date, chanels$simulation$flow_cha_532[,-1]*(1/1.4)) # The gauging station it is not at the end of the channel
     
     huete <- tibble(date = chanels$simulation$flow_cha_962$date, chanels$simulation$flow_cha_962[,-1]+ chanels$simulation$flow_cha_990[,-1] )
     
     torote <- chanels$simulation$flow_cha_541
     
     puebla_nueva <-  chanels$simulation$flow_cha_950
     
     ventosa <- tibble(date = chanels$simulation$flow_cha_149$date, chanels$simulation$flow_cha_149[,-1]+ chanels$simulation$flow_cha_376[,-1] )
     
     peraleja <- tibble(date = chanels$simulation$flow_cha_535$date, chanels$simulation$flow_cha_535[,-1]+ chanels$simulation$flow_cha_537[,-1] )
     
     villasequilla <- tibble(date = chanels$simulation$flow_cha_1141$date, chanels$simulation$flow_cha_1141[,-1]+ chanels$simulation$flow_cha_1161[,-1] ) # The gauging station it is not at the end of the channel
     
     valverde <- tibble(date = chanels$simulation$flow_cha_14$date, chanels$simulation$flow_cha_14[,-1]*(1/1.05))
     
     malpica <- chanels$simulation$flow_cha_947
     
     taravillas <- tibble(date = chanels$simulation$flow_cha_184$date, chanels$simulation$flow_cha_184[,-1]*(1/1.13))
     
     romanones <- chanels$simulation$flow_cha_525
     
     priego_trabraque <- tibble(date = chanels$simulation$flow_cha_573$date, chanels$simulation$flow_cha_573[,-1]*(1/1.05) ) # The gauging station it is not at the end of the channel
     
     aragosa <- tibble(date = chanels$simulation$flow_cha_208$date, chanels$simulation$flow_cha_208[,-1]*(1/1.24) ) # The gauging station it is not at the end of the channel
     
     trillo <- chanels$simulation$flow_cha_111
     
     valdecaba <- chanels$simulation$flow_cha_949
     
     villamantilla <- chanels$simulation$flow_cha_581
     
     
     # A list is created and saved for each subbasin
     sim_cha_list <- list(navaluenga, matallana, villarejo, peralejo, priego_escabas, santa_maria_val, javalera, huete, torote, puebla_nueva,
                          ventosa, peraleja, villasequilla, valverde, malpica, taravillas, romanones,  priego_trabraque, aragosa, trillo,  valdecaba, villamantilla) 
     
     names(sim_cha_list) <- subbasins_names
     
     write_rds(sim_cha_list, "Data/Simulations/Validation/Streamflow_bestsets_combinations.rds")
     
     
     
     
     ##### LSUS ANS AQUIFERS WB DATA #####
     
     library(sf)
     library(tidyverse)
     sim_tagus_valr4_wb <- chanels
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     lsus_subbasins_shp <- read_sf("Data/GIS/hardcal_shapes/studied_lsus/lsus_prop_final.shp")
     studied_subb <- read_sf("Data/GIS/hardcal_shapes/subbasins/hardcal_natural_basins.shp")
     
     
     
     # LSUS data extraction and agregation
     
     lsus_studied <- lsus_subbasins_shp %>%  st_drop_geometry()
     
     
     # List extraction: Precipitation
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_pcp_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_pcp <- sim_tagus_valr4_wb$simulation[grepl("ls_pcp", names(sim_tagus_valr4_wb$simulation))] #%>% .[lsus_data$namelist]
     
     
     # Calculating the average pcp for each subbasin in mm
     
     sims_num <- length(sim_tagus_valr4_wb$parameter$values$surlag)
     
     basin_pcps <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       lsus_area_sum <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_area_m")] %>% 
         sum(.)
       
       lsus_basin <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_id_rea", "area_frac")]
       
       
       basin_lsus_pcp <- lsus_pcp[lsus_basin$lsu_id_rea]
       
       
       av_pcps <- c(1:sims_num)
       
       for(f in 1:length(basin_lsus_pcp)){
         
         av_pcp <- basin_lsus_pcp[[f]][,-1] %>% apply(., 2, mean) %>% data.frame(pcp_mm = .) %>% mutate(pcp_mm = pcp_mm* lsus_basin$area_frac[f]) # Calculate the mm generated in each lsu taking into account the entire basin area
         
         av_pcps <- av_pcps %>% cbind(av_pcp) 
         
       }
       
       av_lsu_pcps <- tibble(av_pcp_mm = av_pcps[,-1] ) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       
       basin_pcp <- av_lsu_pcps %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_pcp <- basin_pcp %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_pcp_mm)
       
       
       basin_pcps[[i]] = basin_pcp # List with the pcp for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_pcp = paste("pcp_basin", Basin_ID, sep = ""))
     names(basin_pcps) <- namms$names_pcp
     
     
     
     # List extraction: SURQ = SURQ_GEN - SURQ_LS
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_gen_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqgen <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_gen", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_ls_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqls <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_ls", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     
     # Calculating the total surq in mm for each lsu considering their relative area regarding the subbasin
     lsu_surqtot <- list()
     for(i in 1:length(lsus_surqgen)){
       
       
       lsu_surqtot[[i]] <- ((lsus_surqgen[[i]][,-1] - lsus_surqls[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_surqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_surq_basin", lsus_data$Basin_ID, sep = "")
     
     
     # Calculating the total surq for each subbasin in mm
     
     basin_surqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_surqtot))
       
       selected_lsus <- lsu_surqtot[bas_select]
       
       av_surqs <- c(1:sims_num)
       
       for(f in 1:length(selected_lsus)){
         
         av_surq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_surqs <- av_surqs %>% cbind(av_surq) 
         
       }
       
       av_surqs <- tibble(av_surq_mm = av_surqs[,-1]) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_surq <- av_surqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_surq <- basin_surq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_surq_mm)
       
       
       basin_surqs[[i]] = basin_surq # List with the gwflo for all the subbasins
       
     }
     
     
     namms <- basins_file %>% mutate(names_surqtot = paste("total_surq_basin", Basin_ID, sep = ""))
     names(basin_surqs) <- namms$names_surqtot
     
     
     # List extraction: LURQ = LATQ_CHA + LATQ_RES
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqcha_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqcha <- sim_tagus_valr4_wb$simulation[grepl("ls_latqcha", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqres_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqres <- sim_tagus_valr4_wb$simulation[grepl("ls_latqres", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     # Calculating the total latq in mm for each lsu considering their relative area regarding the subbasin
     lsu_latqtot <- list()
     for(i in 1:length(lsus_latqcha)){
       
       
       lsu_latqtot[[i]] <- ((lsus_latqcha[[i]][,-1] + lsus_latqres[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_latqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_latq_basin", lsus_data$Basin_ID, sep = "")
     
     
     # Calculating the total latqq for each subbasin in mm
     
     basin_latqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_latqtot))
       
       selected_lsus <- lsu_latqtot[bas_select]
       
       av_latqs <- c(1:sims_num)
       
       for(f in 1:length(selected_lsus)){
         
         av_latq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_latqs <- av_latqs %>% cbind(av_latq) 
         
       }
       
       av_latqs <- tibble(av_latq_mm = av_latqs[,-1]) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_latq <- av_latqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_latq <- basin_latq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_latq_mm)
       
       
       basin_latqs[[i]] = basin_latq # List with the gwflo for all the subbasins
       
     }
     
     
     namms <- basins_file %>% mutate(names_latqtot = paste("total_latq_basin", Basin_ID, sep = ""))
     names(basin_latqs) <- namms$names_latqtot
     
     
     
     ## Aquifers data: Calculated using flo + flo_res. For some aquifers, the relative drainage area to the gagugin stations has been used (aquif_data$fact_corr, previously calculated with QGIS)
     
     aquifers_studied <- read_sf("Data/GIS/hardcal_shapes/studied_aquifers/aquifers_selected.shp") %>% arrange(., Basin_ID)
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     
     
     # List extraction
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwflocha_", Aq_id , sep = ""))
     aquifers_flocha <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwflocha", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwres_", Aq_id , sep = ""))
     aquifers_flores <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwres", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
     
     
     # Calculating the total gwflo in liters for each aquifer
     aquif_flo_tot_litres <- list()
     for(i in 1:length(aquifers_flocha)){
       
       
       aquif_flo_tot_litres[[i]] <- ((aquifers_flocha[[i]][-c(1:5),-1] + aquifers_flores[[i]][-c(1:5),-1]) * ( aquif_data$Area_km[i] * 1000000 * aquif_data$fact_corr[i])) %>% tibble(.)
       
     }
     
     names(aquif_flo_tot_litres) <- paste("aqu_", aquif_data$Aq_id, "totalflo_lit_basin", aquif_data$Basin_ID, sep = "")
     
     
     # Calculating the total flo for each subbasin in mm
     
     basin_gwflos <- list()
     for(i in 1:length(unique(aquif_data$Basin_ID))){
       
       aquifers_area_sum <- aquif_data %>% 
         filter(Basin_ID == unique(aquif_data$Basin_ID)[i]) %>% .[,c("fact_corr","Area_km")] %>% 
         mutate(real_area = fact_corr * Area_km) %>% .[, "real_area" ] %>% 
         sum(.)*1e6
       
       bas_select <- paste("basin",unique(aquif_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(aquif_flo_tot_litres))
       
       selected_aqus <- aquif_flo_tot_litres[bas_select]
       
       av_gwflos <- c(1:sims_num)
       
       for(f in 1:length(selected_aqus)){
         
         av_gwflo <- selected_aqus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_gwflos <- av_gwflos %>% cbind(av_gwflo) 
         
       }
       
       av_gwflos <- tibble(av_gwflo_mm = av_gwflos[,-1] / aquifers_area_sum) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_gwflo <- av_gwflos %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_gwflo <- basin_gwflo %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_gwflo_mm)
       
       
       basin_gwflos[[i]] = basin_gwflo # List with the gwflo for all the subbasins
       
     }
     
     
     namms <- basins_file %>% mutate(names_gwtot = paste("total_gwflo_basin", Basin_ID, sep = ""))
     names(basin_gwflos) <- namms$names_gwtot
     
     
     subb_tables <- list()
     for(i in 1:length(basin_gwflos)){
       pcp <- tibble(basin_pcps[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "pcp")
       latq <- tibble(basin_latqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "latq")
       surq <- tibble(basin_surqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "surq")
       gwflo <- tibble(basin_gwflos[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "gwflo")
       
       subb_table <- pcp %>%  left_join(., latq, "name")%>%  left_join(., surq, "name")%>%  left_join(., gwflo, "name") %>% 
         mutate(water_yield = latq + surq + gwflo) %>% 
         mutate(runoff_coeff = water_yield / pcp,
                gw_cont = gwflo / water_yield) %>% 
         mutate(Basin = basins_file$Basin[i],
                Basin_ID = basins_file$Basin_ID[i], 
                region = basins_file$region[i]) %>% 
         rename(run = name) %>% 
         .[,c("Basin_ID", "Basin", "region", "run",  "pcp",  "water_yield", "latq", "surq", "gwflo",  "runoff_coeff", "gw_cont" )]
       
       subb_tables[[i]] <- subb_table
       
     }
     
     
     namms <- paste("tab", basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     names(subb_tables) <- namms
     
     
     
     # write_rds(subb_tables, "Data/Results/Validation/Validation_bestsets_comb_WB.rds")
     
     
     table_all <- c()
     for(m in 1:length(subb_tables)){
       
       tab <- subb_tables[[m]]
       table_all <- table_all %>% rbind(., tab)
     }
     
     write_csv(table_all, "Data/Results/Validation/Validation_bestsets_combinations_WB.csv", quote = "none")
     

     ##### CALCULATING METRICS WITH SAVED DATA #####
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     
     observed_streamflow <- read_rds("Data/Simulations/list_observed_data.rds")
     
     simulated_streamflow  <- read_rds("Data/Simulations/Validation/Streamflow_bestsets_combinations.rds")
     
     
     
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2  # Importante lo de use, ya que el NA.RM da fallo!!!
     
     
     streamflow_metrics <- c()
     streamflo_metrics_list <- list()
     
     for(i in 1:length(observed_streamflow)){
       
       obs <- observed_streamflow[[i]] %>% mutate(fecha = ymd(fecha)) %>% 
         filter(year(fecha) %in% 2010:2019)
       
       sim <- simulated_streamflow[[i]]%>% mutate(date = ymd(date)) %>% 
         filter(., date %in% ymd(min(obs$fecha)):ymd(max(obs$fecha)))
       
       nses <-  sim %>% select(-date) %>% 
         map_dbl(., ~NSE( .x, obs$caudal))
       r2s <-  sim %>% select(-date) %>% 
         map_dbl(., ~rsq_r2( .x, obs$caudal))
       pbias <-  sim %>% select(-date) %>% 
         map_dbl(., ~pbias( .x, obs$caudal))
       rmses <-  sim %>% select(-date) %>% 
         map_dbl(., ~rmse( .x, obs$caudal))
       
       tab <-  tibble(Subbasin_ID = basins_file$Basin_ID[i], Subbasin = basins_file$Basin[i] , 
                      region = basins_file$region[i], nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = c(1:sims_num))
       
       streamflow_metrics <- streamflow_metrics %>% rbind(., tab)
       streamflo_metrics_list[[i]] <- tab
     }
     
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     names(streamflo_metrics_list) <- subbasins_names
     
     
     write.csv(streamflow_metrics, "Data/Results/Validation/Validationbestsets_combinations_streamflow_metrics_allchanel.csv", row.names = F, quote = F)
     #write_rds(streamflo_metrics_list, "Data/Results/Validation/Validationbestsets_comb_streamflow_metrics_allchanel.rds")
     
     
     ##### BEST SETS ANALYSIS #####
     
     # Merge tables
     
     
     metrics_validation_finalsets <- read.csv("Data/Results/Validation/Validationbestsets_combinations_streamflow_metrics_allchanel.csv") %>% 
       mutate(run = paste("run_", run, sep = ""))
     
     wb_validation_finalsets <- read.csv("Data/Results/Validation/Validation_bestsets_combinations_WB.csv") %>% rename("Subbasin_ID" = "Basin_ID") %>% 
       select(., -c(region, Basin, pcp, water_yield, latq, surq, gwflo, runoff_coeff))
     
     best_sets_comp_table <- metrics_validation_finalsets %>% left_join(., wb_validation_finalsets, c("Subbasin_ID", "run")) 
     
     
     
     # Best parameter set for reservoir inflow
     
     res12_inf <- tibble(chanels$simulation$res_in_12[,1], chanels$simulation$res_in_12[,-1]/86400)
     
     observed_inflow <- read_csv("Data/Reservoirs/Simulation/CHT_obs_inflow_reservoirs.csv") %>% filter(., Lake_id == 12)
     

     # Calculating performance for reservoirs inflow
     
     # Funtion to calculate coeficient of determination
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2 
     
     
     evaluated_period <- c(2010:2019)
     
     streamflow_metrics_res <- c()
     
     lake <- unique(observed_inflow$Lake_id)
     
     obs <- observed_inflow %>% 
       filter(year(date) %in% evaluated_period) %>% 
       group_by(year(date), month(date)) %>% 
       summarise(obsflow_m3s = mean(as.numeric(obsflow_m3s))) %>% 
       mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
       ungroup(.) %>% 
       select(., date, obsflow_m3s)
     
     sim <- res12_inf %>% 
       #filter(., date %in% ymd(min(obs$date)):ymd(max(obs$date))) %>% # Days without observed data does not compute
       group_by(year(date), month(date)) %>% 
       summarise(across(starts_with("run"), mean)) %>% 
       mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
       ungroup(.) %>% 
       select(., -c(`year(date)`, `month(date)`))
     

     nses <-  sim %>% select(-c(date)) %>% 
       map_dbl(., ~NSE( .x, obs$obsflow_m3s))
     r2s <-  sim %>% select(-c(, date)) %>%
       map_dbl(., ~rsq_r2( .x, obs$obsflow_m3s))
     pbias <-  sim %>% select(-c(date)) %>%
       map_dbl(., ~pbias( .x, obs$obsflow_m3s))
     rmses <-  sim %>% select(-c(date)) %>%
       map_dbl(., ~rmse( .x, obs$obsflow_m3s))
     
     tab_res <-  tibble(Subbasin_ID = 23, Subbasin = "Santillana", region = "SANT", 
                    nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = paste("run_", 1:60, sep = ""),
                    gw_cont = NA)
     
  
     # Selecting simulations that comply with groundwater restrictions
     
     
     best_sets_comp_table_selection <- c()
     
     
     # Use groundwater ranges to select simulations: gw contribution must be inside the following ranges, adapted for each subbasin
     ranges_gw <- read.csv("Data/csv_files/basins_gw_ranges.csv")
     
     # Select the best 40 simulations from all the calibration process for each subbasin
     best_sets_comp_table_selection <- c()
     
     for(i in 1:length(unique(best_sets_comp_table$Subbasin_ID))){
       
       selected_sim <- best_sets_comp_table %>% filter(Subbasin_ID == unique(best_sets_comp_table$Subbasin_ID)[i]) %>% 
         filter(gw_cont > ranges_gw[ranges_gw$Basin_ID == unique(best_sets_comp_table$Subbasin_ID)[i], "gw_min"], 
                gw_cont < ranges_gw[ranges_gw$Basin_ID == unique(best_sets_comp_table$Subbasin_ID)[i], "gw_max"]) 
       
       best_sets_comp_table_selection <- best_sets_comp_table_selection %>%  rbind(., selected_sim)
       
     }
     
     # 320 removed
     
     # Including the reservoirs simulation in the table
     best_sets_comp_table_selection <- best_sets_comp_table_selection %>% rbind(tab_res)
     
     
     
     subbasin_groups <- list(IMP = c(1, 22, 23),
                             SANT = c(23),
                             SIMP = c(21),
                             MET = c(2, 14, 15),
                             SMET = c(3, 10),
                             CRB = c(4,5,6,14,19,20),
                             SCRB = c(11,13,16,17,20),
                             S2CRB = c(13),
                             DTH = c(9,10,13, 15, 22),
                             SDTH = c(7,8, 12),
                             DTL = c(8,11,12, 13, 18),
                             surlag = c(1:22),
                             chn = c(1:22))
     
     
     
     parsets_identif <- read.csv("Data/Results/Validation/Parameters/Bestsets_combs_identifiers.csv")
     
     selected_sim_n <- 10
     count_reps <- c()
     metrics_best_simss <- c()
     


     for(g in 1:length(subbasin_groups)){
       
       group_ <- names(subbasin_groups[g])
       group_subbasins <- subbasin_groups[[g]]
       
       
       parsets_id <- parsets_identif %>% filter(group == group_) %>% mutate(run = str_replace(simulation, "sim", "run")) 
       
       
       sims_group_data <-  best_sets_comp_table_selection %>% filter(Subbasin_ID %in% group_subbasins) 
       

       metrics_best_sims <-  sims_group_data %>%  group_by(run) %>% 
         summarise(nse_m = mean(nse),
                   r2_m = mean(r2), 
                   pbias_m = mean(pbias), 
                   rmse_m = mean(rmse)) %>% 
         mutate(rank_nse = rank(nse_m),
                rank_r2 = rank(r2_m),
                rank_pbias = rank(-abs(pbias_m)),
                rank_rmse = rank(-rmse_m),
                rank_tot = rank_nse + rank_r2 + rank_pbias + rank_rmse) %>% 
         arrange(., -rank_tot) %>% slice(., 1:selected_sim_n) %>% left_join(., parsets_id, "run")
       

       metrics_best_simss <- metrics_best_simss %>% rbind(., metrics_best_sims)
       
       count_rep <-  table(metrics_best_sims$parset_id ) %>% tibble(rep_parset = ., par_set = names(.), group = group_)
       
       count_reps <- count_reps %>% rbind(., count_rep) 
       
       
     }
     
     ordered_count_reps <- count_reps%>% arrange(., group, -rep_parset)
     
     bestsets_choosing <- ordered_count_reps %>%  
       mutate(group = factor(group, levels = c("surlag", "chn", "IMP", "SANT", "SIMP", "MET", "SMET", "CRB", "SCRB", "S2CRB", "DTH","SDTH", "DTL"))) %>% 
       arrange(., group) %>% 
       group_by(group) %>%# filter(rep_parset == max(rep_parset))
       slice(.,1) 

    
     
     # CREATING THE FINAL PARAMETERS SETS WITH THE PARAMETERS SETS FOR EACH SUBBASIN MOST REPEATED
     
     validation_parameter_sets <- read_csv("Data/Results/Validation/Parameters/Validation_parameters_Bestsets.csv")
     
     
       surlag_bests <- validation_parameter_sets %>% select(starts_with("surlag")) %>% .[as.numeric(bestsets_choosing$par_set[1]),]
       chn_bests <- validation_parameter_sets %>% select(starts_with("chn")) %>% .[as.numeric(bestsets_choosing$par_set[2]),]
       imp_bests <- validation_parameter_sets %>% select(starts_with("IMP")) %>% .[as.numeric(bestsets_choosing$par_set[3]),] 
       sant_bests <- validation_parameter_sets %>% select(starts_with("SANT")) %>% .[as.numeric(bestsets_choosing$par_set[4]),] 
       simp_bests <- validation_parameter_sets %>% select(starts_with("SIMP")) %>% .[as.numeric(bestsets_choosing$par_set[5]),] 
       met_bests <- validation_parameter_sets %>% select(starts_with("MET")) %>% .[as.numeric(bestsets_choosing$par_set[6]),]
       smet_bests <- validation_parameter_sets %>% select(starts_with("SMET")) %>% .[as.numeric(bestsets_choosing$par_set[7]),]
       crb_bests <- validation_parameter_sets %>% select(starts_with("CRB"))%>% .[as.numeric(bestsets_choosing$par_set[8]),] 
       scrb_bests<- validation_parameter_sets %>% select(starts_with("SCRB")) %>% .[as.numeric(bestsets_choosing$par_set[9]),]
       s2crb_bests<- validation_parameter_sets %>% select(starts_with("S2CRB")) %>% .[as.numeric(bestsets_choosing$par_set[10]),]
       dth_bests <- validation_parameter_sets %>% select(starts_with("DTH"))%>% .[as.numeric(bestsets_choosing$par_set[11]),] 
       sdth_bests <- validation_parameter_sets %>% select(starts_with("SDTH"))%>% .[as.numeric(bestsets_choosing$par_set[12]),] 
       dtl_bests <- validation_parameter_sets %>% select(starts_with("DTL")) %>% .[as.numeric(bestsets_choosing$par_set[13]),]
     
       parset_best <- tibble(surlag_bests, chn_bests, imp_bests, sant_bests, simp_bests, met_bests, 
                             smet_bests, crb_bests, scrb_bests, s2crb_bests, dth_bests, sdth_bests, dtl_bests)
     

       write_csv(parset_best, "Data/Results/Validation/Parameters/bst_set_parameters.csv")
     
     
read_csv("Data/Results/Validation/Parameters/bst_set_parameters.csv") == parset_best
  

     #### Run and Analyzing BEST PARAMETER COMBINATION ####
     



      ##### BEST SET  Simulated data extraction #####
     #Some of the gauging stations collect the water from more than one channel
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     
     
     chanels <- read_rds("Data/Simulations/Validation/validation_simulations/bestset_simulation.rds")
     
     
     navaluenga <- tibble(date = chanels$simulation$flow_cha_561$date, chanels$simulation$flow_cha_561[,-1]+ chanels$simulation$flow_cha_750[,-1] )
     
     matallana <-  chanels$simulation$flow_cha_11
     
     villarejo <-  chanels$simulation$flow_cha_1218
     
     peralejo <- tibble(date = chanels$simulation$flow_cha_567$date, chanels$simulation$flow_cha_567[,-1]+ chanels$simulation$flow_cha_825[,-1] )
     
     priego_escabas <- tibble(date = chanels$simulation$flow_cha_564$date, chanels$simulation$flow_cha_564[,-1] * (1/1.05)) #  The gauging station it is not at the end of the channel
     
     santa_maria_val <- chanels$simulation$flow_cha_630
     
     javalera <- tibble(date = chanels$simulation$flow_cha_532$date, chanels$simulation$flow_cha_532[,-1]*(1/1.4)) # The gauging station it is not at the end of the channel
     
     huete <- tibble(date = chanels$simulation$flow_cha_962$date, chanels$simulation$flow_cha_962[,-1]+ chanels$simulation$flow_cha_990[,-1] )
     
     torote <- chanels$simulation$flow_cha_541
     
     puebla_nueva <-  chanels$simulation$flow_cha_950
     
     ventosa <- tibble(date = chanels$simulation$flow_cha_149$date, chanels$simulation$flow_cha_149[,-1]+ chanels$simulation$flow_cha_376[,-1] )
     
     peraleja <- tibble(date = chanels$simulation$flow_cha_535$date, chanels$simulation$flow_cha_535[,-1]+ chanels$simulation$flow_cha_537[,-1] )
     
     villasequilla <- tibble(date = chanels$simulation$flow_cha_1141$date, chanels$simulation$flow_cha_1141[,-1]+ chanels$simulation$flow_cha_1161[,-1] ) # The gauging station it is not at the end of the channel
     
     valverde <- tibble(date = chanels$simulation$flow_cha_14$date, chanels$simulation$flow_cha_14[,-1]*(1/1.05))
     
     malpica <- chanels$simulation$flow_cha_947
     
     taravillas <- tibble(date = chanels$simulation$flow_cha_184$date, chanels$simulation$flow_cha_184[,-1]*(1/1.13))
     
     romanones <- chanels$simulation$flow_cha_525
     
     priego_trabraque <- tibble(date = chanels$simulation$flow_cha_573$date, chanels$simulation$flow_cha_573[,-1]*(1/1.05) ) # The gauging station it is not at the end of the channel
     
     aragosa <- tibble(date = chanels$simulation$flow_cha_208$date, chanels$simulation$flow_cha_208[,-1]*(1/1.24) ) # The gauging station it is not at the end of the channel
     
     trillo <- chanels$simulation$flow_cha_111
     
     valdecaba <- chanels$simulation$flow_cha_949
     
     villamantilla <- chanels$simulation$flow_cha_581
     
     
     # A list is created and saved for each subbasin
     sim_cha_list <- list(navaluenga, matallana, villarejo, peralejo, priego_escabas, santa_maria_val, javalera, huete, torote, puebla_nueva,
                          ventosa, peraleja, villasequilla, valverde, malpica, taravillas, romanones,  priego_trabraque, aragosa, trillo,  valdecaba, villamantilla) 
     
     names(sim_cha_list) <- subbasins_names
     
   #  write_rds(sim_cha_list, "Data/Simulations/Validation/streamflow_best_simulation_strcomp5.rds")
     
     
     
     
     ##### LSUS ANS AQUIFERS WB DATA #####
     
     library(sf)
     library(tidyverse)
     sim_tagus_valr4_wb <- chanels
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     lsus_subbasins_shp <- read_sf("Data/GIS/hardcal_shapes/studied_lsus/lsus_prop_final.shp")
     studied_subb <- read_sf("Data/GIS/hardcal_shapes/subbasins/hardcal_natural_basins.shp")
     
     
     
     # LSUS data extraction and agregation
     
     lsus_studied <- lsus_subbasins_shp %>%  st_drop_geometry()
     
     
     # List extraction: Precipitation
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_pcp_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_pcp <- sim_tagus_valr4_wb$simulation[grepl("ls_pcp", names(sim_tagus_valr4_wb$simulation))] #%>% .[lsus_data$namelist]
     
     
     # Calculating the average pcp for each subbasin in mm
     
     sims_num <- length(sim_tagus_valr4_wb$parameter$values$surlag)
     
     basin_pcps <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       lsus_area_sum <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_area_m")] %>% 
         sum(.)
       
       lsus_basin <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_id_rea", "area_frac")]
       
       
       basin_lsus_pcp <- lsus_pcp[lsus_basin$lsu_id_rea]
       
       
       av_pcps <- c(1:sims_num)
       
       for(f in 1:length(basin_lsus_pcp)){
         
         av_pcp <- basin_lsus_pcp[[f]][-c(1:5),-1] %>% apply(., 2, mean) %>% data.frame(pcp_mm = .) %>% mutate(pcp_mm = pcp_mm* lsus_basin$area_frac[f]) # Calculate the mm generated in each lsu taking into account the entire basin area
         
         av_pcps <- av_pcps %>% cbind(av_pcp) 
         
       }
       
       av_lsu_pcps <- tibble(av_pcp_mm = av_pcps[,-1] ) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       
       basin_pcp <- av_lsu_pcps %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_pcp <- basin_pcp %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_pcp_mm)
       
       
       basin_pcps[[i]] = basin_pcp # List with the pcp for all the subbasins
       
     }
     
     namms <- basins_file %>% mutate(names_pcp = paste("pcp_basin", Basin_ID, sep = ""))
     names(basin_pcps) <- namms$names_pcp
     
     
     
     # List extraction: SURQ = SURQ_GEN - SURQ_LS
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_gen_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqgen <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_gen", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_ls_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqls <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_ls", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     
     # Calculating the total surq in mm for each lsu considering their relative area regarding the subbasin
     lsu_surqtot <- list()
     for(i in 1:length(lsus_surqgen)){
       
       
       lsu_surqtot[[i]] <- ((lsus_surqgen[[i]][-c(1:5),-1] - lsus_surqls[[i]][-c(1:5),-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_surqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_surq_basin", lsus_data$Basin_ID, sep = "")
     
     
     # Calculating the total surq for each subbasin in mm
     
     basin_surqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_surqtot))
       
       selected_lsus <- lsu_surqtot[bas_select]
       
       av_surqs <- c(1:sims_num)
       
       for(f in 1:length(selected_lsus)){
         
         av_surq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_surqs <- av_surqs %>% cbind(av_surq) 
         
       }
       
       av_surqs <- tibble(av_surq_mm = av_surqs[,-1]) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_surq <- av_surqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_surq <- basin_surq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_surq_mm)
       
       
       basin_surqs[[i]] = basin_surq # List with the gwflo for all the subbasins
       
     }
     
     
     namms <- basins_file %>% mutate(names_surqtot = paste("total_surq_basin", Basin_ID, sep = ""))
     names(basin_surqs) <- namms$names_surqtot
     
     
     # List extraction: LURQ = LATQ_CHA + LATQ_RES
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqcha_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqcha <- sim_tagus_valr4_wb$simulation[grepl("ls_latqcha", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqres_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqres <- sim_tagus_valr4_wb$simulation[grepl("ls_latqres", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     # Calculating the total latq in mm for each lsu considering their relative area regarding the subbasin
     lsu_latqtot <- list()
     for(i in 1:length(lsus_latqcha)){
       
       
       lsu_latqtot[[i]] <- ((lsus_latqcha[[i]][-c(1:5),-1] + lsus_latqres[[i]][-c(1:5),-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_latqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_latq_basin", lsus_data$Basin_ID, sep = "")
     
     
     # Calculating the total latqq for each subbasin in mm
     
     basin_latqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_latqtot))
       
       selected_lsus <- lsu_latqtot[bas_select]
       
       av_latqs <- c(1:sims_num)
       
       for(f in 1:length(selected_lsus)){
         
         av_latq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_latqs <- av_latqs %>% cbind(av_latq) 
         
       }
       
       av_latqs <- tibble(av_latq_mm = av_latqs[,-1]) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_latq <- av_latqs %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_latq <- basin_latq %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_latq_mm)
       
       
       basin_latqs[[i]] = basin_latq # List with the gwflo for all the subbasins
       
     }
     
     
     namms <- basins_file %>% mutate(names_latqtot = paste("total_latq_basin", Basin_ID, sep = ""))
     names(basin_latqs) <- namms$names_latqtot
     
     
     
     ## Aquifers data: Calculated using flo + flo_res. For some aquifers, the relative drainage area to the gagugin stations has been used (aquif_data$fact_corr, previously calculated with QGIS)
     
     aquifers_studied <- read_sf("Data/GIS/hardcal_shapes/studied_aquifers/aquifers_selected.shp") %>% arrange(., Basin_ID)
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     
     
     # List extraction
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwflocha_", Aq_id , sep = ""))
     aquifers_flocha <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwflocha", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwres_", Aq_id , sep = ""))
     aquifers_flores <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwres", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
     
     
     # Calculating the total gwflo in liters for each aquifer
     aquif_flo_tot_litres <- list()
     for(i in 1:length(aquifers_flocha)){
       
       
       aquif_flo_tot_litres[[i]] <- ((aquifers_flocha[[i]][-c(1:5),-1] + aquifers_flores[[i]][-c(1:5),-1]) * ( aquif_data$Area_km[i] * 1000000 * aquif_data$fact_corr[i])) %>% tibble(.)
       
     }
     
     names(aquif_flo_tot_litres) <- paste("aqu_", aquif_data$Aq_id, "totalflo_lit_basin", aquif_data$Basin_ID, sep = "")
     
     
     # Calculating the total flo for each subbasin in mm
     
     basin_gwflos <- list()
     for(i in 1:length(unique(aquif_data$Basin_ID))){
       
       aquifers_area_sum <- aquif_data %>% 
         filter(Basin_ID == unique(aquif_data$Basin_ID)[i]) %>% .[,c("fact_corr","Area_km")] %>% 
         mutate(real_area = fact_corr * Area_km) %>% .[, "real_area" ] %>% 
         sum(.)*1e6
       
       bas_select <- paste("basin",unique(aquif_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(aquif_flo_tot_litres))
       
       selected_aqus <- aquif_flo_tot_litres[bas_select]
       
       av_gwflos <- c(1:sims_num)
       
       for(f in 1:length(selected_aqus)){
         
         av_gwflo <- selected_aqus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_gwflos <- av_gwflos %>% cbind(av_gwflo) 
         
       }
       
       av_gwflos <- tibble(av_gwflo_mm = av_gwflos[,-1] / aquifers_area_sum) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_gwflo <- av_gwflos %>% group_by(run) %>% summarise_all(.funs =  sum)
       
       basin_gwflo <- basin_gwflo %>% mutate(run = paste("run_", run, sep = "")) %>% 
         pivot_wider(., names_from = run, values_from = av_gwflo_mm)
       
       
       basin_gwflos[[i]] = basin_gwflo # List with the gwflo for all the subbasins
       
     }
     
     
     namms <- basins_file %>% mutate(names_gwtot = paste("total_gwflo_basin", Basin_ID, sep = ""))
     names(basin_gwflos) <- namms$names_gwtot
     
     
     subb_tables <- list()
     for(i in 1:length(basin_gwflos)){
       pcp <- tibble(basin_pcps[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "pcp")
       latq <- tibble(basin_latqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "latq")
       surq <- tibble(basin_surqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "surq")
       gwflo <- tibble(basin_gwflos[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "gwflo")
       
       subb_table <- pcp %>%  left_join(., latq, "name")%>%  left_join(., surq, "name")%>%  left_join(., gwflo, "name") %>% 
         mutate(water_yield = latq + surq + gwflo) %>% 
         mutate(runoff_coeff = water_yield / pcp,
                gw_cont = gwflo / water_yield) %>% 
         mutate(Basin = basins_file$Basin[i],
                Basin_ID = basins_file$Basin_ID[i], 
                region = basins_file$region[i]) %>% 
         rename(run = name) %>% 
         .[,c("Basin_ID", "Basin", "region", "run",  "pcp",  "water_yield", "latq", "surq", "gwflo",  "runoff_coeff", "gw_cont" )]
       
       subb_tables[[i]] <- subb_table
       
     }
     
     
     namms <- paste("tab", basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     names(subb_tables) <- namms
     
     
     
     # write_rds(subb_tables, "Data/Results/Validation/Validation_BEST_scrdtlbadapt_set_combination_WBHYD2.rds")
     
     
     table_all <- c()
     for(m in 1:length(subb_tables)){
       
       tab <- subb_tables[[m]]
       table_all <- table_all %>% rbind(., tab)
     }
     
     # write_csv(table_all, "Data/Results/Validation/Validation_bestset_strcomp_WB5.csv", quote = "none")
     
     
     
     
     
     ##### CALCULATING METRICS WITH SAVED DATA #####
     library(ggpmisc)
     library(patchwork)
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     
     observed_streamflow <- read_rds("Data/Simulations/list_observed_data.rds")
     
     simulated_streamflow  <-  sim_cha_list #read_rds("Data/Simulations/Validation/streamflow_best_simulation_strcomp5.rds")
     
     table_all <- table_all #read.csv("Data/Results/Validation/Validation_bestset_strcomp_WB5.csv")
     
     
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2  # Importante lo de use, ya que el NA.RM da fallo!!!
     
     
     streamflow_metrics <- tibble(Subbasin_ID = c(), NSE = c(), R = c(), PBIAS = c(), RMSE = c(), GWC = c()) 
     streamflo_metrics_plots <- list()
     
     for(i in 1:length(observed_streamflow)){
       
       obs <- observed_streamflow[[i]] %>% mutate(fecha = ymd(fecha)) %>% 
         filter(year(fecha) %in% 2010:2019)
       
       sim <- simulated_streamflow[[i]]%>% mutate(date = ymd(date)) %>% 
         filter(., date %in% ymd(min(obs$fecha)):ymd(max(obs$fecha)))
       
       nses <-  sim %>% select(-date) %>% 
         map_dbl(., ~NSE( .x, obs$caudal))
       r2s <-  sim %>% select(-date) %>% 
         map_dbl(., ~rsq_r2( .x, obs$caudal))
       pbias <-  sim %>% select(-date) %>% 
         map_dbl(., ~pbias( .x, obs$caudal))
       rmses <-  sim %>% select(-date) %>% 
         map_dbl(., ~rmse( .x, obs$caudal))
       
       
       strm_plot <- obs %>% left_join(., sim, c("fecha" = "date")) %>% 
         pivot_longer(., c(caudal, run_1), names_to = "Streamflow", values_to = "flow_m3s") %>% 
         mutate(Streamflow = case_when(Streamflow == "caudal" ~ "Observed",
                                       Streamflow == "run_1" ~ "Simulated")) %>% 
         ggplot(., aes(x = fecha, y = flow_m3s, color = Streamflow, linetype =  Streamflow))+geom_line(size = 1.1)+
         scale_colour_manual(values = c("black", "steelblue"))+
         scale_linetype_manual(values = c(2,1))+
         theme_bw()+labs(y = "Streamflow (m/s)")+
         theme(legend.position = c(0.8, 0.8), legend.title = element_blank(), axis.title.x = element_blank(),
               text = element_text(size = 18), legend.text = element_text(size = 21))+
         ggtitle(paste("Subbasin ", i, ": ", basins_file[i, "Basin"], sep = ""))
       
       
       #streamflo_metrics_plots[[i]] <- ggplotly(strm_plot)
       
       GWC <- table_all %>% filter(Basin_ID == i) %>% select(gw_cont)
       
       table_metrics <- tibble(Subbasin_ID = i, NSE = nses, R = r2s, PBIAS = pbias, RMSE = rmses, GWC = GWC$gw_cont) %>% mutate_all(., round, digits = 2)
       
       streamflow_metrics <- rbind(streamflow_metrics, table_metrics)
       
       table_plot <- ggplot()+annotate(geom = "table", x = 1, y = 1, label = list(table_metrics))+
         theme_bw()+theme(axis.line = element_blank(), line = element_blank(),
                          text = element_blank(), panel.border   = element_blank())
       
       
       
       plot_merge <- strm_plot / table_plot + plot_layout(heights = c(7,1))
       
       
       
       
       ggsave(plot = plot_merge, filename =  paste("Data/Figures/Validation/Bestsim/", i, "_", basins_file[i, "Basin"], ".png", sep = ""),
              device = "png", dpi = 600, width = 12, height = 10)
       
       
     }
     
     
     
     #  htmlwidgets::saveWidget( streamflo_metrics_plots[[i]], 
     #                           "Data/Figures/Validation/streamflow/1_Best_selected_set/ggplotlys/index.html")
     
     
     
     # write.csv(streamflow_metrics, "Data/Results/Validation/metrics_bestsets_combination.csv", row.names = F, quote = F)
     # write_rds(streamflo_metrics_list, "Data/Results/Validation/metrics_bestsets_combination5.rds")
     
     
     ##### Extract results and generate plots for reservoirs inflow #####     
     
     # Reservoirs data
     
     reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv")
     
     
     # Observed data 
     
     obs_inflow <- read_csv("Data/Reservoirs/Simulation/CHT_obs_inflow_reservoirs.csv")
     
     # Simulated data
     
     simulation <- read_rds("Data/Simulations/Validation/validation_simulations/bestset_simulation.rds")
     
     # Parameters
     
     
     
     # Creating and exporting lists with observed-simulated data 
     
     evaluated_period <- c(2010:2019)
     
     
     res_studied <- reservoirs_data %>% mutate(namelist = paste("res_in_", Lake_id , sep = "")) %>% arrange(., Lake_id)
     res_sim_inflow <- simulation$simulation[grepl("res_in_", names(simulation$simulation))] 
     
     
     res_inflows <- list()
     
     for(i in 1: length(res_sim_inflow)){
       
       res_inflow <- res_sim_inflow[[i]]
       
       res_inflow <- tibble(res_inflow[,1], reservoir = paste("lake_", i, sep = ""), res_inflow[,-1]/86400)
       
       res_inflows[[i]] <- res_inflow
       
     }
     names(res_inflows) <- str_replace(unique(names(res_sim_inflow)), "res_in_", "lake_")
     
     write_rds(res_inflows, "Data/Reservoirs/Simulation/Bestset_simulation.rds")
     
     

     # Loading saved data
     
     observed_inflow <- read_rds("Data/Reservoirs/Simulation/observed_reservoir_inflow.rds") 
     res_inflows <- read_rds("Data/Reservoirs/Simulation/Bestset_simulation.rds")
     
     
     # Calculating performance for reservoirs inflow
     
     # Funtion to calculate coeficient of determination
     rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2 
     
     
     evaluated_period <- c(2010:2019)
     number_simulations <- 1
     
     
     streamflow_metrics_res <- c()
     
     for(i in 1:length(observed_inflow)){
       
       lake <- names(observed_inflow[i])
       
       obs <- observed_inflow[[lake]] %>% 
         filter(year(date) %in% evaluated_period) %>% 
         group_by(year(date), month(date)) %>% 
         summarise(obsflow_m3s = mean(obsflow_m3s)) %>% 
         mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
         ungroup(.) %>% 
         select(., date, obsflow_m3s)
       
       sim <- res_inflows[[lake]] %>% 
         filter(., date %in% ymd(min(obs$date)):ymd(max(obs$date))) %>% # Days without observed data does not compute
         group_by(year(date), month(date)) %>% 
         summarise(across(starts_with("run"), mean)) %>% 
         mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
         ungroup(.) %>% 
         select(., -c(`year(date)`, `month(date)`))
       
       nses <-  sim %>% select(-c(date)) %>% 
         map_dbl(., ~NSE( .x, obs$obsflow_m3s))
       r2s <-  sim %>% select(-c(, date)) %>%
         map_dbl(., ~rsq_r2( .x, obs$obsflow_m3s))
       pbias <-  sim %>% select(-c(date)) %>%
         map_dbl(., ~pbias( .x, obs$obsflow_m3s))
       rmses <-  sim %>% select(-c(date)) %>%
         map_dbl(., ~rmse( .x, obs$obsflow_m3s))
       
       tab <-  tibble(reservoir = unique(observed_inflow[[i]][[2]]), 
                      nse = nses, r2 = r2s, pbias = pbias, rmse = rmses, run = c(1:number_simulations))
       
       streamflow_metrics_res <- streamflow_metrics_res %>% rbind(., tab)
       
     }
     
     
     write_csv(streamflow_metrics_res, "Data/Reservoirs/Results/reservoir_metrics_bestsim.csv")
     
     
     reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv") %>%
       mutate(Lake_id = paste("lake_", Lake_id, sep = "")) %>% 
       mutate(region = region_r1)
     
     
     
     
     evaluated_period <- c(2010:2019)
     number_simulations <- 1
     
     
     streamflow_metrics_res <- c()
     
     for(i in 1:length(observed_inflow)){
       
       lake <- names(observed_inflow[i])
       
       obs <- observed_inflow[[lake]] %>% 
         filter(year(date) %in% evaluated_period) %>% 
         group_by(year(date), month(date)) %>% 
         summarise(obsflow_m3s = mean(obsflow_m3s)) %>% 
         mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
         ungroup(.) %>% 
         select(., date, obsflow_m3s)
       
       sim <- res_inflows[[lake]] %>% 
         filter(., date %in% ymd(min(obs$date)):ymd(max(obs$date))) %>% # Days without observed data does not compute
         group_by(year(date), month(date)) %>% 
         summarise(across(starts_with("run"), mean)) %>% 
         mutate(date = ym(paste( `year(date)`, `month(date)`, sep = "/"))) %>% 
         ungroup(.) %>% 
         select(., -c(`year(date)`, `month(date)`))
       
       nses <-  sim %>% select(-c(date)) %>% 
         map_dbl(., ~NSE( .x, obs$obsflow_m3s))
       r2s <-  sim %>% select(-c(, date)) %>%
         map_dbl(., ~rsq_r2( .x, obs$obsflow_m3s))
       pbias <-  sim %>% select(-c(date)) %>%
         map_dbl(., ~pbias( .x, obs$obsflow_m3s))
       rmses <-  sim %>% select(-c(date)) %>%
         map_dbl(., ~rmse( .x, obs$obsflow_m3s))
       
       tab <-  tibble(reservoir = unique(observed_inflow[[i]][[2]]), 
                      nse = nses, r2 = r2s, pbias = pbias, rmse = rmses) %>% 
         mutate_if(is.numeric, round, digits = 2)
       
        
       lake_dat <- reservoirs_data %>% filter(Lake_id == lake)

     str_plot <-  obs %>% left_join(., sim, "date") %>%
         pivot_longer(., -date) %>% 
         mutate(name = case_when(name == "run_1" ~ "Simulated", .default = "Observed")) %>% 
         ggplot(., aes(x = date, color = name, linetype = name,  y = value))+
         geom_line(linewidth = 1)+
         scale_color_manual(values = c("black", "steelblue"))+
         scale_linetype_manual(values = c(2, 1))+
         theme_bw()+
         guides(color = guide_legend(title.position = "top"))+
         labs(x = "Date", y = "Streamflow (m/s)")+
         theme(legend.position = c(0.1, 0.8), legend.title = element_blank())+
       
         ggtitle(paste(lake, ", ", lake_dat$Nombre, sep = ""))
              
     
     table_plot <- ggplot()+annotate(geom = "table", x = 1, y = 1, label = list(tab))+
       theme_bw()+theme(axis.line = element_blank(), line = element_blank(),
                        text = element_blank(), panel.border   = element_blank())
     
     
     
     plot_merge <- str_plot / table_plot + plot_layout(heights = c(7,1))
     
     
     
     
     ggsave(plot = plot_merge, filename =  paste("Data/Figures/Validation/Bestsim/Reservoirs/", i, "_", lake, ".png", sep = ""),
            device = "png", dpi = 600, width = 12, height = 10)
     
     
     
     
     }
     
     
     
     
     
     
     
     
    
     ###### STREAMFLOW COMPONENTS DAILY SCALE  ###### 
     
     
     ##### Run to extract streamflow components #####     
     
     
      parbest <- read_csv("Data/Results/Validation/Parameters/bst_set_parameters.csv")
      
      parnames <- read_rds("Data/Simulations/Round_4/round_4_HC_Tagus.rds")[1]
      
      colnames(parbest) <- parnames$parameter$definition$full_name
      
      tagus_path <- "D:/Modelos/Modelo_HC_Tagus/"
      
      
      
      
     val_fin <-  run_swatplus(project_path = tagus_path,
                              output = list(
                                ls_pcp   = define_output(file = 'lsunit_wb_yr', 
                                                         variable = 'precip', 
                                                         unit = 1:1450),
                                # ls_et    = define_output(file = 'lsunit_wb_yr', 
                                #                          variable = 'et', 
                                #                          unit = used_lsus),
                                ls_surq_gen   = define_output(file = 'lsunit_wb_day',   # SURQ_CHA + SURQ_RES = SURQ_GEN - SURQ_LS
                                                              variable = 'surq_gen', 
                                                              unit = 1:1450),
                                ls_surq_res   = define_output(file = 'lsunit_wb_day',   # SURQ_CHA + SURQ_RES = SURQ_GEN - SURQ_LS
                                                              variable = 'surq_res', 
                                                              unit = 1:1450),
                                ls_surq_ls   = define_output(file = 'lsunit_wb_day', 
                                                             variable = 'surq_ls', 
                                                             unit  = 1:1450),
                                # ls_latqgen   = define_output(file = 'lsunit_wb_yr',  # LATQGEN - LATQLS = LATQ_CHA + LATQ_GEN
                                #                              variable = 'latq', 
                                #                              unit = used_lsus),
                                # ls_latqls   = define_output(file = 'lsunit_wb_yr', 
                                #                             variable = 'latq_ls', 
                                #                             unit = used_lsus),
                                ls_latqcha   = define_output(file = 'lsunit_wb_day',  # LATQ = LATQCHA + LATQRES
                                                             variable = 'latq_cha', 
                                                             unit = 1:1450),
                                ls_latqres   = define_output(file = 'lsunit_wb_day', 
                                                             variable = 'latq_res', 
                                                             unit = 1:1450),
                                #  ls_perc   = define_output(file = 'lsunit_wb_yr', 
                                #                            variable = 'perc', 
                                #                            unit = used_lsus),
                                #  basin_pcp = define_output(file = 'basin_wb_yr',
                                #                            variable = "precip",
                                #                            unit = 1), 
                                #  basin_et = define_output(file = 'basin_wb_yr',
                                #                           variable = 'et',
                                #                           unit = 1), 
                                #  basin_perco = define_output(file = 'basin_wb_yr',
                                #                              variable = 'perc',
                                #                              unit = 1),
                                #  basin_surqgen = define_output(file = 'basin_wb_yr',
                                #                                variable = 'surq_gen',
                                #                                unit = 1),
                                #  basin_surqls = define_output(file = 'basin_wb_yr',
                                #                               variable = 'surq_ls',
                                #                               unit = 1),
                                #  basin_surqcha = define_output(file = 'basin_wb_yr',
                                #                                variable = 'surq_cha',
                                #                                unit = 1),
                                #  basin_surqres = define_output(file = 'basin_wb_yr',
                                #                                variable = 'surq_res',
                                #                                unit = 1),
                                #  basin_latqcha = define_output(file = 'basin_wb_yr',
                                #                                variable = 'latq_cha',
                                #                                unit = 1),
                                #  basin_latqqres = define_output(file = 'basin_wb_yr',
                                #                                 variable = 'latq_res',
                                #                                 unit = 1),
                                #  basin_perco = define_output(file = 'basin_wb_yr',
                                #                              variable = 'perc',
                                #                              unit = 1),
                                #  basin_gwflo = define_output(file = 'basin_aqu_yr',
                                #                              variable = 'flo',
                                #                              unit = 1),
                                aqu_gwflocha = define_output(file = 'aquifer_day',
                                                             variable = 'flo_cha',
                                                             unit = 1:126),
                                aqu_gwres = define_output(file = 'aquifer_day',
                                                          variable = 'flo_res',
                                                          unit =    1:126),
                                #  aqu_gwtot = define_output(file = 'aquifer_yr',
                                #                            variable = 'flo',
                                #                            unit = used_quifers),
                                # aqu_stor = define_output(file = 'aquifer_yr',
                                #                          variable = 'stor',
                                #                          unit = 1:126),
                                # aqu_rchrg = define_output(file = 'aquifer_yr',
                                #                           variable = 'rchrg',
                                #                           unit = 1:126),
                                res_in = define_output(file = 'reservoir_day',          #For round 3
                                                       variable = 'flo_in',      #For round 3        
                                                       unit = 1:31),             #For round 3 
                                # res_stor = define_output(file = 'reservoir_yr',        #For round 3      
                                #                          variable = 'flo_stor',    #For round 3          
                                #                          unit = 1:31),             #For round 3 
                                # res_out = define_output(file = 'reservoir_yr',         #For round 3     
                                #                         variable = 'flo_out',     #For round 3         
                                #                         unit = 1:31),             #For round 3             
                                flow_cha = define_output(file = "channel_sd_day", 
                                                         variable = "flo_out",
                                                         unit = c(561, 750, 11, 1218, 567, 825, 564, 630, 532, 962,
                                                                  990, 541, 950, 149, 376, 535, 537, 1141, 1161, 14,
                                                                  947, 184, 525, 573, 208, 111, 949, 581, 452))),#, 444,
                              #155, 185, 504, 161, 459, 929, 133, 176, 483, 911, 882 ,1076))), #For round 3
                              parameter = parbest,
                              start_date = 20050101,
                              end_date = 20191231,
                              start_date_print = 20100101,
                              n_thread = 1)
     
     write_rds(val_fin, "Data/Simulations/Validation/validation_simulations/bestset_simulation_strmcomp_nf.rds")
     
     
     
     ##### Daily streamflow components simulation analysis #####
     
     
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
     
     
     
     
     navaluenga <- tibble(date = chanels$simulation$flow_cha_561$date, chanels$simulation$flow_cha_561[,-1]+ chanels$simulation$flow_cha_750[,-1] )
     
     matallana <-  chanels$simulation$flow_cha_11
     
     villarejo <-  chanels$simulation$flow_cha_1218
     
     peralejo <- tibble(date = chanels$simulation$flow_cha_567$date, chanels$simulation$flow_cha_567[,-1]+ chanels$simulation$flow_cha_825[,-1] )
     
     priego_escabas <- tibble(date = chanels$simulation$flow_cha_564$date, chanels$simulation$flow_cha_564[,-1] * (1/1.05)) #  The gauging station it is not at the end of the channel
     
     santa_maria_val <- chanels$simulation$flow_cha_630
     
     javalera <- tibble(date = chanels$simulation$flow_cha_532$date, chanels$simulation$flow_cha_532[,-1]*(1/1.4)) # The gauging station it is not at the end of the channel
     
     huete <- tibble(date = chanels$simulation$flow_cha_962$date, chanels$simulation$flow_cha_962[,-1]+ chanels$simulation$flow_cha_990[,-1] )
     
     torote <- chanels$simulation$flow_cha_541
     
     puebla_nueva <-  chanels$simulation$flow_cha_950
     
     ventosa <- tibble(date = chanels$simulation$flow_cha_149$date, chanels$simulation$flow_cha_149[,-1]+ chanels$simulation$flow_cha_376[,-1] )
     
     peraleja <- tibble(date = chanels$simulation$flow_cha_535$date, chanels$simulation$flow_cha_535[,-1]+ chanels$simulation$flow_cha_537[,-1] )
     
     villasequilla <- tibble(date = chanels$simulation$flow_cha_1141$date, chanels$simulation$flow_cha_1141[,-1]+ chanels$simulation$flow_cha_1161[,-1] ) # The gauging station it is not at the end of the channel
     
     valverde <- tibble(date = chanels$simulation$flow_cha_14$date, chanels$simulation$flow_cha_14[,-1]*(1/1.05))
     
     malpica <- chanels$simulation$flow_cha_947
     
     taravillas <- tibble(date = chanels$simulation$flow_cha_184$date, chanels$simulation$flow_cha_184[,-1]*(1/1.13))
     
     romanones <- chanels$simulation$flow_cha_525
     
     priego_trabraque <- tibble(date = chanels$simulation$flow_cha_573$date, chanels$simulation$flow_cha_573[,-1]*(1/1.05) ) # The gauging station it is not at the end of the channel
     
     aragosa <- tibble(date = chanels$simulation$flow_cha_208$date, chanels$simulation$flow_cha_208[,-1]*(1/1.24) ) # The gauging station it is not at the end of the channel
     
     trillo <- chanels$simulation$flow_cha_111
     
     valdecaba <- chanels$simulation$flow_cha_949
     
     villamantilla <- chanels$simulation$flow_cha_581
     
     
     # A list is created and saved for each subbasin
     sim_cha_list <- list(navaluenga, matallana, villarejo, peralejo, priego_escabas, santa_maria_val, javalera, huete, torote, puebla_nueva,
                          ventosa, peraleja, villasequilla, valverde, malpica, taravillas, romanones,  priego_trabraque, aragosa, trillo,  valdecaba, villamantilla) 
     
     names(sim_cha_list) <- subbasins_names
     
     write_rds(sim_cha_list, "Data/Simulations/Validation/streamflow_best_stcomp.rds")
     
     
     
     
     chanels <- read_rds("Data/Simulations/Validation/validation_simulations/bestset_simulation_strmcomp.rds")
     
     library(sf)
     library(tidyverse)
     sim_tagus_valr4_wb <- chanels
     basins_file <- read.csv("Data/csv_files/basins_file.csv")   
     lsus_subbasins_shp <- read_sf("Data/GIS/hardcal_shapes/studied_lsus/lsus_prop_final.shp")
     studied_subb <- read_sf("Data/GIS/hardcal_shapes/subbasins/hardcal_natural_basins.shp")
     
     ####### LSUS and aquifers data extraction and aggregation    ####### 
     
     lsus_studied <- lsus_subbasins_shp %>%  st_drop_geometry()
     
     # List extraction: Precipitation
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_pcp_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_pcp <- sim_tagus_valr4_wb$simulation[grepl("ls_pcp", names(sim_tagus_valr4_wb$simulation))] #%>% .[lsus_data$namelist]
     
     # Calculating the average pcp for each subbasin in mm
     
     sims_num <- length(sim_tagus_valr4_wb$parameter$values$surlag)
     basins_annual_pcps <- c()
     
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       lsus_area_sum <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_area_m")] %>% 
         sum(.)
       
       lsus_basin <- lsus_data %>% 
         filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_id_rea", "area_frac")]
       
       
       basin_lsus_pcp <- lsus_pcp[lsus_basin$lsu_id_rea]
       
       
       av_pcps <- tibble(year = c(2010:2019))
       
       for(f in 1:length(basin_lsus_pcp)){
         
         lsu_frac <- lsus_basin[f, "area_frac"]
         
         ann_pcp <- basin_lsus_pcp[[f]] %>% 
           mutate(year = year(date)) %>% select(-date) %>% 
           filter(year > 2009) %>% 
           mutate(pcp = run_1 * lsu_frac$area_frac) %>% select(-run_1)
         
         av_pcps <- av_pcps %>% left_join(., ann_pcp, "year") 
         
       }
       
       basin_annual_pcps <- apply(av_pcps[,-1], 1, sum) %>% 
         tibble( annual_pcp = .) %>% mutate(Subbasin_ID = i) # Calculate the average annual gwflo for each aquifer in milimiters
       
       basins_annual_pcps <- basins_annual_pcps %>% rbind(., basin_annual_pcps)
       
     }
     
     basins_annual_pcps
     
     
     # List extraction: SURQ_CHA = SURQ_GEN - SURQ_LS - SURQ_RES
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_gen_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqgen <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_gen", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_ls_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqls <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_ls", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_res_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_surqres <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_res", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     # Calculating the total surq in mm for each lsu considering their relative area regarding the subbasin
     lsu_surqtot <- list()
     for(i in 1:length(lsus_surqgen)){
       
       
       lsu_surqtot[[i]] <- ((lsus_surqgen[[i]][,-1] - lsus_surqls[[i]][,-1] - lsus_surqres[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_surqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_surq_basin", lsus_data$Basin_ID, sep = "")
     
     
     # Calculating the total surq for each subbasin in mm
     
     basin_surqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_surqtot))
       
       selected_lsus <- lsu_surqtot[bas_select]
       
       av_surqs <- c(1:sims_num)
       
       for(f in 1:length(selected_lsus)){
         
         av_surq <- selected_lsus[[f]] #%>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres --> Calculate the daily flow
         
         av_surqs <- av_surqs %>% cbind(av_surq) 
         
       }
       
       av_surqs <- tibble(av_surq_mm = av_surqs[,-1]) 
       
       basin_surq <- apply(av_surqs, 1, sum) %>% tibble(av_surq_mm = ., run = 1) 
       
       basin_surq <- basin_surq %>% mutate(run = paste("run_", run, sep = "")) 
       
       
       basin_surqs[[i]] = basin_surq 
       
     }
     
     
     namms <- basins_file %>% mutate(names_surqtot = paste("total_surq_basin", Basin_ID, sep = ""))
     names(basin_surqs) <- namms$names_surqtot
     
     
     # List extraction: LATQ_CHA = LATQ_CHA
     lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqcha_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
     lsus_latqcha <- sim_tagus_valr4_wb$simulation[grepl("ls_latqcha", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
     
     
     
     # Calculating the total latq in mm for each lsu considering their relative area regarding the subbasin
     lsu_latqtot <- list()
     for(i in 1:length(lsus_latqcha)){
       
       
       lsu_latqtot[[i]] <- (lsus_latqcha[[i]][,-1] * (lsus_data$area_frac[i])) %>% tibble(.)
       
     }
     
     names(lsu_latqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_latq_basin", lsus_data$Basin_ID, sep = "")
     
     
     # Calculating the total latqq for each subbasin in mm
     
     basin_latqs <- list()
     for(i in 1:length(unique(lsus_data$Basin_ID))){
       
       
       bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(lsu_latqtot))
       
       selected_lsus <- lsu_latqtot[bas_select]
       
       av_latqs <- c(1:sims_num)
       
       for(f in 1:length(selected_lsus)){
         
         av_latq <- selected_lsus[[f]] #%>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
         
         av_latqs <- av_latqs %>% cbind(av_latq) 
         
       }
       
       av_latqs <- tibble(av_latq_mm = av_latqs[,-1])  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_latq <- apply(av_latqs, 1, sum)   %>% tibble(av_latq_mm = ., run = 1)
       
       basin_latq <- basin_latq %>% mutate(run = paste("run_", run, sep = "")) 
       
       basin_latqs[[i]] = basin_latq # List with the gwflo for all the subbasins
       
     }
     
     
     namms <- basins_file %>% mutate(names_latqtot = paste("total_latq_basin", Basin_ID, sep = ""))
     names(basin_latqs) <- namms$names_latqtot
     
     
     
     ## Aquifers data: Calculated using flo + flo_res. For some aquifers, the relative drainage area to the gagugin stations has been used (aquif_data$fact_corr, previously calculated with QGIS)
     
     aquifers_studied <- read_sf("Data/GIS/hardcal_shapes/studied_aquifers/aquifers_selected.shp") %>% arrange(., Basin_ID)
     basins_file <- read.csv("Data/csv_files/basins_file.csv")
     
     
     # List extraction
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwflocha_", Aq_id , sep = ""))
     aquifers_flocha <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwflocha", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
     
     aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwres_", Aq_id , sep = ""))
     aquifers_flores <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwres", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
     
     
     # Calculating the total gwflo in liters for each aquifer --> ONLY FLO_CHA
     aquif_flo_tot_litres <- list()
     for(i in 1:length(aquifers_flocha)){
       
       
       aquif_flo_tot_litres[[i]] <- (aquifers_flocha[[i]][,-1] * ( aquif_data$Area_km[i] * 1000000 * aquif_data$fact_corr[i])) %>% tibble(.)
       
     }
     
     names(aquif_flo_tot_litres) <- paste("aqu_", aquif_data$Aq_id, "totalflo_lit_basin", aquif_data$Basin_ID, sep = "")
     
     
     # Calculating the total flo for each subbasin in mm
     
     basin_gwflos <- list()
     for(i in 1:length(unique(aquif_data$Basin_ID))){
       
       aquifers_area_sum <- aquif_data %>% 
         filter(Basin_ID == unique(aquif_data$Basin_ID)[i]) %>% .[,c("fact_corr","Area_km")] %>% 
         mutate(real_area = fact_corr * Area_km) %>% .[, "real_area" ] %>% 
         sum(.)*1e6
       
       bas_select <- paste("basin",unique(aquif_data$Basin_ID)[i], sep = "")
       
       bas_select <- grepl(paste0(bas_select, "$"), names(aquif_flo_tot_litres))
       
       selected_aqus <- aquif_flo_tot_litres[bas_select]
       
       av_gwflos <- c(1:sims_num)
       
       for(f in 1:length(selected_aqus)){
         
         av_gwflo <- selected_aqus[[f]] 
         
         av_gwflos <- av_gwflos %>% cbind(av_gwflo) 
         
       }
       
       av_gwflos <- tibble(av_gwflo_mm = av_gwflos[,-1] / aquifers_area_sum)  # Calculate the average annual gwflo for each aquifer in milimiters
       
       basin_gwflo <- apply(av_gwflos, 1, sum) %>% tibble(av_gwflo_mm = ., run = 1)
       
       basin_gwflo <- basin_gwflo %>% mutate(run = paste("run_", run, sep = "")) 
       
       
       basin_gwflos[[i]] = basin_gwflo # List with the gwflo for all the subbasins
       
     }
     
     
     namms <- basins_file %>% mutate(names_gwtot = paste("total_gwflo_basin", Basin_ID, sep = ""))
     names(basin_gwflos) <- namms$names_gwtot
     
     
     ##### creating complete tables #####
     
     
     # Observed flow
     
     observed_streamflow_list <- read_rds("Data/Simulations/list_observed_data.rds")
     
     # Simulated
     
     sim_flow_list <- sim_cha_list #read_rds("Data/Simulations/Validation/streamflow_best_simulation_strcomp5.rds")
     
     
     subb_tables_fluxes <- c()
     subb_tables_anual <- c()
     
     
     for(i in 1:length(observed_streamflow_list)){ 
       
       obs <- observed_streamflow_list[[i]] %>% mutate(date = ymd(fecha)) %>% 
         filter(year(fecha) %in% 2010:2019) %>% rename("obs_flow" = "caudal")
       
       sim <- sim_flow_list[[i]]%>% mutate(date = ymd(date)) %>% rename("sim_flow_m3s" = "run_1")
       
       
       # pcp <- tibble(basin_pcps[[i]])
       latq <- tibble(basin_latqs[[i]]) 
       surq <- tibble(basin_surqs[[i]]) 
       gwflo <- tibble(basin_gwflos[[i]])
       
       subb_table_fluxes <-  tibble(surq_mm = surq$av_surq_mm, latq_mm = latq$av_latq_mm, gw_flow_mm = gwflo$av_gwflo_mm) %>%  
         mutate(daily_cont = surq_mm + latq_mm + gw_flow_mm) %>% 
         mutate(date = seq(dmy("01/01/2010"), dmy("31/12/2019"), 1)) %>% 
         mutate(Subbasin_ID = i) %>% left_join(., sim,  "date") %>% left_join(., obs[,c("date", "obs_flow")], "date")
       
       
       subb_tables_fluxes <-  subb_tables_fluxes %>% rbind(., subb_table_fluxes)
       
       subb_table_anual <-  subb_table_fluxes %>% mutate(date = seq(dmy("01/01/2010"), dmy("31/12/2019"), 1)) %>% 
         group_by(year = year(date)) %>% 
         summarise(annual_wyld = sum(daily_cont), 
                   annual_surq = sum(surq_mm),
                   annual_latq = sum(latq_mm),
                   annual_gwf = sum(gw_flow_mm)) %>% 
         mutate(annual_gwc = annual_gwf/annual_wyld) %>%   
         mutate(Subbasin_ID = i)
       
       subb_tables_anual <- rbind(subb_tables_anual, subb_table_anual)
       
       
     }
     
     
     
     
     ####### Converting fluxes to M3S and creating plots ######
     
     calc_mm <- function(x, y){x*y/86400000} 
     
     basins_area <- basins_file[,c("Basin_ID", "area")]
     
     plots_comps <- list()
     
     for(i in 1:length(basins_area$Basin_ID)){
       
       
       tab_comps <-  subb_tables_fluxes %>% filter(Subbasin_ID == i) %>% 
         mutate(surq_m3s = calc_mm(surq_mm, basins_area[i,"area"]),
                latq_m3s = calc_mm(latq_mm, basins_area[i,"area"]),
                gwflow_m3s = calc_mm(gw_flow_mm, basins_area[i,"area"]),
                wyld_m3s = calc_mm(daily_cont, basins_area[i,"area"]))
       
       
       plot_comps <-  tab_comps %>% select(Subbasin_ID, date, obs_flow, sim_flow_m3s, surq_m3s, latq_m3s, gwflow_m3s, wyld_m3s) %>% 
         pivot_longer(., c(surq_m3s, latq_m3s, gwflow_m3s), names_to = "component", values_to = "contrib_m3s") %>% 
         mutate(component = factor(component, levels = c("surq_m3s", "latq_m3s", "gwflow_m3s"), labels = c("Surface runoff", "Lateral flow", "Groundwater"))) %>% 
         ggplot(aes(x = date))+
         geom_area(aes(y = contrib_m3s, fill = component))+
         scale_fill_manual(values = c("turquoise", "darkorange2", "chocolate4"))+
         geom_line(aes(y = obs_flow, color = "Observed"), colour = "black", linetype = 2)+
         geom_line(aes(y = sim_flow_m3s, color = "Simulated"), color = "blue")+
         geom_line(aes(y = wyld_m3s, color = "Water yield"), color = "steelblue")+
         theme_bw()+theme(axis.title.x = element_blank(), text = element_text(size = 15))+
         labs(y = "Streamflow (mm)", fill = "Streamflow component", color = "Streamflow")+
         ggtitle(paste(basins_file[i, "Basin_ID"], basins_file[i, "Basin"]))
       
       
       ggsave(plot = plot_comps, filename =  paste("Data/Figures/Validation/Bestsim/components/", i, "_", basins_file[i, "Basin"], "_str_comp", ".png", sep = ""),
              device = "png", dpi = 600, width = 12, height = 10) 
       
       
     #    plotly_p <- ggplotly(plot_comps)
     #  
     #  htmlwidgets::saveWidget( plotly_p, 
     #                          paste("Data/Figures/Validation/streamflow_bestcomb5/components/ggplotlys/", i, basins_file[i, "Basin"], "index.html", sep = ""))
     #  
       
     }
     
     
     
     simulated_m3d <- tibble(date = sim_cha_list[[1]][[1]])
     observed_m3d <-  tibble(date = sim_cha_list[[1]][[1]])
     

     for(i in 1:length(sim_cha_list)){
     
    simulated_m3d[,i+1] <-  sim_cha_list[[i]] %>% mutate(sim_m3d = run_1* 86400) %>% select(sim_m3d)
     
    observed_m3d[,i+1] <- tibble(date = sim_cha_list[[1]][[1]]) %>% left_join(., observed_streamflow_list[[i]], c("date" = "fecha")) %>%
      mutate(obs_m3d  = caudal * 86400) %>% select(obs_m3d)
    
    simulated_m3d[is.na(observed_m3d[,i+1]),i+1] <- 0
    observed_m3d[is.na(observed_m3d[,i+1]),i+1] <- 0
    
     }
     
     
   sim_tot <-   simulated_m3d[,-1] %>% apply(., 1, sum)
   obs_tot <-   observed_m3d[,-1] %>% apply(., 1, sum)
     
     
   
   
            # Not counting 2 times subbasins 4, 11 and 16 (inside 20)
             basins_ids <- c(1:3, 5:10, 12:15, 17:22)
             
             
             simulated_m3d <- tibble(date = sim_cha_list[[1]][[1]])
             observed_m3d <-  tibble(date = sim_cha_list[[1]][[1]])
             
             for(i in 1:length(basins_ids)){
               
               simulated_m3d[,i+1] <-  sim_cha_list[[basins_ids[i]]] %>% mutate(sim_m3d = run_1* 86400) %>% select(sim_m3d)
               
               observed_m3d[,i+1] <- tibble(date = sim_cha_list[[1]][[1]]) %>% left_join(., observed_streamflow_list[[basins_ids[i]]], c("date" = "fecha")) %>%
                 mutate(obs_m3d  = caudal * 86400) %>% select(obs_m3d)
               
               simulated_m3d[is.na(observed_m3d[,i+1]),i+1] <- 0
               observed_m3d[is.na(observed_m3d[,i+1]),i+1] <- 0
               
             }
   
   
   
   
  aggregated_simobs <-  tibble(simulated_m3d[,1], simulated_m3d = sim_tot, observed_m3d = obs_tot)
   
  
  aggregated_simobs_month <- aggregated_simobs %>% group_by(year(date), month(date)) %>% 
    summarise(month_hm_obs = sum(observed_m3d),
              month_hm_sim = sum(simulated_m3d ))
  
    tab_metr_day <- tibble(Scale = "Daily", NSE = NSE(aggregated_simobs$simulated_m3d, aggregated_simobs$observed_m3d), 
                           R2 =  rsq_r2(aggregated_simobs$simulated_m3d, aggregated_simobs$observed_m3d), 
                           PBIAS = pbias(aggregated_simobs$simulated_m3d, aggregated_simobs$observed_m3d), 
                           RMSE = rmse(aggregated_simobs$simulated_m3d, aggregated_simobs$observed_m3d)/1e6) %>% 
      mutate_if(is.numeric, round, digits = 2)
    
    tab_metr_month <- tibble(Scale = "Monthly", NSE = NSE(aggregated_simobs_month$month_hm_sim, aggregated_simobs_month$month_hm_obs), 
                             R2 =  rsq_r2(aggregated_simobs_month$month_hm_sim, aggregated_simobs_month$month_hm_obs), 
                             PBIAS = pbias(aggregated_simobs_month$month_hm_sim, aggregated_simobs_month$month_hm_obs), 
                             RMSE = rmse(aggregated_simobs_month$month_hm_sim, aggregated_simobs_month$month_hm_obs)/1e6) %>% 
      mutate_if(is.numeric, round, digits = 2)
    
    
    
    str_plot_d <- aggregated_simobs %>% pivot_longer(., -date, names_to = "Type", values_to = "Streamflow (hm/d)") %>% 
      mutate(Type = factor(Type, labels = c("Observed", "Simulated"))) %>% 
    ggplot(., aes(x = date))+
    geom_line(aes(y = `Streamflow (hm/d)`/1e6, color = Type),  size = 1)+
    scale_color_manual(values = c("blue", "red"))+theme_bw()+labs(x = "Date", y = "Streamflow (hm/d)")+
      theme(text = element_text(size = 12), legend.position = "nop")
    
    str_plot_m <- aggregated_simobs_month %>% mutate(monyear = ym(paste(`year(date)`, `month(date)`, "/"))) %>% ungroup(.) %>% 
      select(-c(`year(date)`, `month(date)`)) %>% 
      pivot_longer(., -monyear, names_to = "Type", values_to = "Streamflow (hm/month)") %>% 
      mutate(Type = factor(Type, labels = c("Observed", "Simulated"))) %>% 
    ggplot(., aes(x = monyear))+
    geom_line(aes(y = `Streamflow (hm/month)`/1e6, color = Type),  size = 1)+
    scale_color_manual(values = c("blue", "red"))+theme_bw()+labs(x = "Date", y = "Streamflow (hm/month)")+
      theme(text = element_text(size = 12), legend.position = c(0.6, 0.8), legend.key.size = unit(2, 'cm'), 
            legend.text = element_text(size = 18), legend.title =  element_blank())
    
     
    
    table_plotD <- ggplot()+annotate(geom = "table", x = 1, y = 1, label = list(tab_metr_day))+
      theme_bw()+theme(axis.line = element_blank(), line = element_blank(),
                       text = element_blank(), panel.border   = element_blank())
    table_plotM <- ggplot()+annotate(geom = "table", x = 1, y = 1, label = list(tab_metr_month))+
      theme_bw()+theme(axis.line = element_blank(), line = element_blank(),
                       text = element_blank(), panel.border   = element_blank())
    
    
    
    plot_merge <- (str_plot_d + str_plot_m) / (table_plotD + table_plotM) + plot_layout(heights = c(9,1))
    
    
     
     
     

     
     
     
    
    
    
    
    
    #### FINE TUNNING SIMULATION ####
    
    # Fine tunning process
     ft <- 8
    
    basins_file <- read.csv("Data/csv_files/basins_file.csv")
    subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
    
    
    
    chanels <- read_rds(paste("Data/Simulations/Validation/validation_simulations/FineTunning/bestset_simulation_ft", ft, ".rds", sep = ""))
    
    
    navaluenga <- tibble(date = chanels$simulation$flow_cha_561$date, chanels$simulation$flow_cha_561[,-1]+ chanels$simulation$flow_cha_750[,-1] )
    
    matallana <-  chanels$simulation$flow_cha_11
    
    villarejo <-  chanels$simulation$flow_cha_1218
    
    peralejo <- tibble(date = chanels$simulation$flow_cha_567$date, chanels$simulation$flow_cha_567[,-1]+ chanels$simulation$flow_cha_825[,-1] )
    
    priego_escabas <- tibble(date = chanels$simulation$flow_cha_564$date, chanels$simulation$flow_cha_564[,-1] * (1/1.05)) #  The gauging station it is not at the end of the channel
    
    santa_maria_val <- chanels$simulation$flow_cha_630
    
    javalera <- tibble(date = chanels$simulation$flow_cha_532$date, chanels$simulation$flow_cha_532[,-1]*(1/1.4)) # The gauging station it is not at the end of the channel
    
    huete <- tibble(date = chanels$simulation$flow_cha_962$date, chanels$simulation$flow_cha_962[,-1]+ chanels$simulation$flow_cha_990[,-1] )
    
    torote <- chanels$simulation$flow_cha_541
    
    puebla_nueva <-  chanels$simulation$flow_cha_950
    
    ventosa <- tibble(date = chanels$simulation$flow_cha_149$date, chanels$simulation$flow_cha_149[,-1]+ chanels$simulation$flow_cha_376[,-1] )
    
    peraleja <- tibble(date = chanels$simulation$flow_cha_535$date, chanels$simulation$flow_cha_535[,-1]+ chanels$simulation$flow_cha_537[,-1] )
    
    villasequilla <- tibble(date = chanels$simulation$flow_cha_1141$date, chanels$simulation$flow_cha_1141[,-1]+ chanels$simulation$flow_cha_1161[,-1] ) # The gauging station it is not at the end of the channel
    
    valverde <- tibble(date = chanels$simulation$flow_cha_14$date, chanels$simulation$flow_cha_14[,-1]*(1/1.05))
    
    malpica <- chanels$simulation$flow_cha_947
    
    taravillas <- tibble(date = chanels$simulation$flow_cha_184$date, chanels$simulation$flow_cha_184[,-1]*(1/1.13))
    
    romanones <- chanels$simulation$flow_cha_525
    
    priego_trabraque <- tibble(date = chanels$simulation$flow_cha_573$date, chanels$simulation$flow_cha_573[,-1]*(1/1.05) ) # The gauging station it is not at the end of the channel
    
    aragosa <- tibble(date = chanels$simulation$flow_cha_208$date, chanels$simulation$flow_cha_208[,-1]*(1/1.24) ) # The gauging station it is not at the end of the channel
    
    trillo <- chanels$simulation$flow_cha_111
    
    valdecaba <- chanels$simulation$flow_cha_949
    
    villamantilla <- chanels$simulation$flow_cha_581
    
    
    # A list is created and saved for each subbasin
    sim_cha_list <- list(navaluenga, matallana, villarejo, peralejo, priego_escabas, santa_maria_val, javalera, huete, torote, puebla_nueva,
                         ventosa, peraleja, villasequilla, valverde, malpica, taravillas, romanones,  priego_trabraque, aragosa, trillo,  valdecaba, villamantilla) 
    
    names(sim_cha_list) <- subbasins_names
    
    #  write_rds(sim_cha_list, "Data/Simulations/Validation/streamflow_best_simulation_strcomp5.rds")
    
    
    
    
    ##### LSUS ANS AQUIFERS WB DATA #####
    
    library(sf)
    library(tidyverse)
    sim_tagus_valr4_wb <- chanels
    basins_file <- read.csv("Data/csv_files/basins_file.csv")   
    lsus_subbasins_shp <- read_sf("Data/GIS/hardcal_shapes/studied_lsus/lsus_prop_final.shp")
    studied_subb <- read_sf("Data/GIS/hardcal_shapes/subbasins/hardcal_natural_basins.shp")
    
    
    
    # LSUS data extraction and agregation
    
    lsus_studied <- lsus_subbasins_shp %>%  st_drop_geometry()
    
    
    # List extraction: Precipitation
    lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_pcp_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
    lsus_pcp <- sim_tagus_valr4_wb$simulation[grepl("ls_pcp", names(sim_tagus_valr4_wb$simulation))] #%>% .[lsus_data$namelist]
    
    
    # Calculating the average pcp for each subbasin in mm
    
    sims_num <- length(sim_tagus_valr4_wb$parameter$values$surlag)
    
    basin_pcps <- list()
    for(i in 1:length(unique(lsus_data$Basin_ID))){
      
      lsus_area_sum <- lsus_data %>% 
        filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_area_m")] %>% 
        sum(.)
      
      lsus_basin <- lsus_data %>% 
        filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_id_rea", "area_frac")]
      
      
      basin_lsus_pcp <- lsus_pcp[lsus_basin$lsu_id_rea]
      
      
      av_pcps <- c(1:sims_num)
      
      for(f in 1:length(basin_lsus_pcp)){
        
        av_pcp <- basin_lsus_pcp[[f]][-c(1:5),-1] %>% apply(., 2, mean) %>% data.frame(pcp_mm = .) %>% mutate(pcp_mm = pcp_mm* lsus_basin$area_frac[f]) # Calculate the mm generated in each lsu taking into account the entire basin area
        
        av_pcps <- av_pcps %>% cbind(av_pcp) 
        
      }
      
      av_lsu_pcps <- tibble(av_pcp_mm = av_pcps[,-1] ) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
      
      
      basin_pcp <- av_lsu_pcps %>% group_by(run) %>% summarise_all(.funs =  sum)
      
      basin_pcp <- basin_pcp %>% mutate(run = paste("run_", run, sep = "")) %>% 
        pivot_wider(., names_from = run, values_from = av_pcp_mm)
      
      
      basin_pcps[[i]] = basin_pcp # List with the pcp for all the subbasins
      
    }
    
    namms <- basins_file %>% mutate(names_pcp = paste("pcp_basin", Basin_ID, sep = ""))
    names(basin_pcps) <- namms$names_pcp
    
    
    
    # List extraction: SURQ = SURQ_GEN - SURQ_LS
    lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_gen_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
    lsus_surqgen <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_gen", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
    
    lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_ls_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
    lsus_surqls <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_ls", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
    
    
    
    # Calculating the total surq in mm for each lsu considering their relative area regarding the subbasin
    lsu_surqtot <- list()
    for(i in 1:length(lsus_surqgen)){
      
      
      lsu_surqtot[[i]] <- ((lsus_surqgen[[i]][-c(1:5),-1] - lsus_surqls[[i]][-c(1:5),-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
      
    }
    
    names(lsu_surqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_surq_basin", lsus_data$Basin_ID, sep = "")
    
    
    # Calculating the total surq for each subbasin in mm
    
    basin_surqs <- list()
    for(i in 1:length(unique(lsus_data$Basin_ID))){
      
      
      bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
      
      bas_select <- grepl(paste0(bas_select, "$"), names(lsu_surqtot))
      
      selected_lsus <- lsu_surqtot[bas_select]
      
      av_surqs <- c(1:sims_num)
      
      for(f in 1:length(selected_lsus)){
        
        av_surq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
        
        av_surqs <- av_surqs %>% cbind(av_surq) 
        
      }
      
      av_surqs <- tibble(av_surq_mm = av_surqs[,-1]) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
      
      basin_surq <- av_surqs %>% group_by(run) %>% summarise_all(.funs =  sum)
      
      basin_surq <- basin_surq %>% mutate(run = paste("run_", run, sep = "")) %>% 
        pivot_wider(., names_from = run, values_from = av_surq_mm)
      
      
      basin_surqs[[i]] = basin_surq # List with the gwflo for all the subbasins
      
    }
    
    
    namms <- basins_file %>% mutate(names_surqtot = paste("total_surq_basin", Basin_ID, sep = ""))
    names(basin_surqs) <- namms$names_surqtot
    
    
    # List extraction: LURQ = LATQ_CHA + LATQ_RES
    lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqcha_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
    lsus_latqcha <- sim_tagus_valr4_wb$simulation[grepl("ls_latqcha", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
    
    lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqres_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
    lsus_latqres <- sim_tagus_valr4_wb$simulation[grepl("ls_latqres", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
    
    
    # Calculating the total latq in mm for each lsu considering their relative area regarding the subbasin
    lsu_latqtot <- list()
    for(i in 1:length(lsus_latqcha)){
      
      
      lsu_latqtot[[i]] <- ((lsus_latqcha[[i]][-c(1:5),-1] + lsus_latqres[[i]][-c(1:5),-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
      
    }
    
    names(lsu_latqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_latq_basin", lsus_data$Basin_ID, sep = "")
    
    
    # Calculating the total latqq for each subbasin in mm
    
    basin_latqs <- list()
    for(i in 1:length(unique(lsus_data$Basin_ID))){
      
      
      bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
      
      bas_select <- grepl(paste0(bas_select, "$"), names(lsu_latqtot))
      
      selected_lsus <- lsu_latqtot[bas_select]
      
      av_latqs <- c(1:sims_num)
      
      for(f in 1:length(selected_lsus)){
        
        av_latq <- selected_lsus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
        
        av_latqs <- av_latqs %>% cbind(av_latq) 
        
      }
      
      av_latqs <- tibble(av_latq_mm = av_latqs[,-1]) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
      
      basin_latq <- av_latqs %>% group_by(run) %>% summarise_all(.funs =  sum)
      
      basin_latq <- basin_latq %>% mutate(run = paste("run_", run, sep = "")) %>% 
        pivot_wider(., names_from = run, values_from = av_latq_mm)
      
      
      basin_latqs[[i]] = basin_latq # List with the gwflo for all the subbasins
      
    }
    
    
    namms <- basins_file %>% mutate(names_latqtot = paste("total_latq_basin", Basin_ID, sep = ""))
    names(basin_latqs) <- namms$names_latqtot
    
    
    
    ## Aquifers data: Calculated using flo + flo_res. For some aquifers, the relative drainage area to the gagugin stations has been used (aquif_data$fact_corr, previously calculated with QGIS)
    
    aquifers_studied <- read_sf("Data/GIS/hardcal_shapes/studied_aquifers/aquifers_selected.shp") %>% arrange(., Basin_ID)
    basins_file <- read.csv("Data/csv_files/basins_file.csv")
    
    
    # List extraction
    aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwflocha_", Aq_id , sep = ""))
    aquifers_flocha <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwflocha", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
    
    aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwres_", Aq_id , sep = ""))
    aquifers_flores <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwres", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
    
    
    # Calculating the total gwflo in liters for each aquifer
    aquif_flo_tot_litres <- list()
    for(i in 1:length(aquifers_flocha)){
      
      
      aquif_flo_tot_litres[[i]] <- ((aquifers_flocha[[i]][-c(1:5),-1] + aquifers_flores[[i]][-c(1:5),-1]) * ( aquif_data$Area_km[i] * 1000000 * aquif_data$fact_corr[i])) %>% tibble(.)
      
    }
    
    names(aquif_flo_tot_litres) <- paste("aqu_", aquif_data$Aq_id, "totalflo_lit_basin", aquif_data$Basin_ID, sep = "")
    
    
    # Calculating the total flo for each subbasin in mm
    
    basin_gwflos <- list()
    for(i in 1:length(unique(aquif_data$Basin_ID))){
      
      aquifers_area_sum <- aquif_data %>% 
        filter(Basin_ID == unique(aquif_data$Basin_ID)[i]) %>% .[,c("fact_corr","Area_km")] %>% 
        mutate(real_area = fact_corr * Area_km) %>% .[, "real_area" ] %>% 
        sum(.)*1e6
      
      bas_select <- paste("basin",unique(aquif_data$Basin_ID)[i], sep = "")
      
      bas_select <- grepl(paste0(bas_select, "$"), names(aquif_flo_tot_litres))
      
      selected_aqus <- aquif_flo_tot_litres[bas_select]
      
      av_gwflos <- c(1:sims_num)
      
      for(f in 1:length(selected_aqus)){
        
        av_gwflo <- selected_aqus[[f]] %>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
        
        av_gwflos <- av_gwflos %>% cbind(av_gwflo) 
        
      }
      
      av_gwflos <- tibble(av_gwflo_mm = av_gwflos[,-1] / aquifers_area_sum) %>% cbind(run = c(1:sims_num))  # Calculate the average annual gwflo for each aquifer in milimiters
      
      basin_gwflo <- av_gwflos %>% group_by(run) %>% summarise_all(.funs =  sum)
      
      basin_gwflo <- basin_gwflo %>% mutate(run = paste("run_", run, sep = "")) %>% 
        pivot_wider(., names_from = run, values_from = av_gwflo_mm)
      
      
      basin_gwflos[[i]] = basin_gwflo # List with the gwflo for all the subbasins
      
    }
    
    
    namms <- basins_file %>% mutate(names_gwtot = paste("total_gwflo_basin", Basin_ID, sep = ""))
    names(basin_gwflos) <- namms$names_gwtot
    
    
    subb_tables <- list()
    for(i in 1:length(basin_gwflos)){
      pcp <- tibble(basin_pcps[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "pcp")
      latq <- tibble(basin_latqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "latq")
      surq <- tibble(basin_surqs[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "surq")
      gwflo <- tibble(basin_gwflos[[i]]) %>% pivot_longer(., starts_with("run"), values_to = "gwflo")
      
      subb_table <- pcp %>%  left_join(., latq, "name")%>%  left_join(., surq, "name")%>%  left_join(., gwflo, "name") %>% 
        mutate(water_yield = latq + surq + gwflo) %>% 
        mutate(runoff_coeff = water_yield / pcp,
               gw_cont = gwflo / water_yield) %>% 
        mutate(Basin = basins_file$Basin[i],
               Basin_ID = basins_file$Basin_ID[i], 
               region = basins_file$region[i]) %>% 
        rename(run = name) %>% 
        .[,c("Basin_ID", "Basin", "region", "run",  "pcp",  "water_yield", "latq", "surq", "gwflo",  "runoff_coeff", "gw_cont" )]
      
      subb_tables[[i]] <- subb_table
      
    }
    
    
    namms <- paste("tab", basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
    names(subb_tables) <- namms
    
    
    
    # write_rds(subb_tables, "Data/Results/Validation/Validation_BEST_scrdtlbadapt_set_combination_WBHYD2.rds")
    
    
    table_all <- c()
    for(m in 1:length(subb_tables)){
      
      tab <- subb_tables[[m]]
      table_all <- table_all %>% rbind(., tab)
    }
    
    # write_csv(table_all, "Data/Results/Validation/Validation_bestset_strcomp_WB5.csv", quote = "none")
    
    
    
    
    
    ##### CALCULATING METRICS WITH SAVED DATA #####
    library(ggpmisc)
    library(patchwork)
    
    basins_file <- read.csv("Data/csv_files/basins_file.csv")   
    
    observed_streamflow <- read_rds("Data/Simulations/list_observed_data.rds")
    
    simulated_streamflow  <-  sim_cha_list #read_rds("Data/Simulations/Validation/streamflow_best_simulation_strcomp5.rds")
    
    table_all <- table_all #read.csv("Data/Results/Validation/Validation_bestset_strcomp_WB5.csv")
    
    
    rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2  # Importante lo de use, ya que el NA.RM da fallo!!!
    
    
    streamflow_metrics <- tibble(Subbasin_ID = c(), NSE = c(), `R` = c(), PBIAS = c(), RMSE = c(), GWC = c()) 
    streamflo_metrics_plots <- list()
    
    for(i in 1:length(observed_streamflow)){
      
      obs <- observed_streamflow[[i]] %>% mutate(fecha = ymd(fecha)) %>% 
        filter(year(fecha) %in% 2010:2019)
      
      sim <- simulated_streamflow[[i]]%>% mutate(date = ymd(date)) %>% 
        filter(., date %in% obs$fecha)
      
      nses <-  sim %>% select(-date) %>% 
        map_dbl(., ~NSE( .x, obs$caudal))
      r2s <-  sim %>% select(-date) %>% 
        map_dbl(., ~rsq_r2( .x, obs$caudal))
      pbias <-  sim %>% select(-date) %>% 
        map_dbl(., ~pbias( .x, obs$caudal))
      rmses <-  sim %>% select(-date) %>% 
        map_dbl(., ~rmse( .x, obs$caudal))
      
      
      strm_plot <- obs %>% left_join(., sim, c("fecha" = "date")) %>% 
        pivot_longer(., c(caudal, run_1), names_to = "Streamflow", values_to = "flow_m3s") %>% 
        mutate(Streamflow = case_when(Streamflow == "caudal" ~ "Observed",
                                      Streamflow == "run_1" ~ "Simulated")) %>% 
        ggplot(., aes(x = fecha, y = flow_m3s, color = Streamflow, linetype =  Streamflow))+geom_line(size = 1.1)+
        scale_colour_manual(values = c("black", "steelblue"))+
        scale_linetype_manual(values = c(2,1))+
        theme_bw()+labs(y = "Streamflow (m/s)")+
        theme(legend.position = c(0.8, 0.8), legend.title = element_blank(), axis.title.x = element_blank(),
              text = element_text(size = 18), legend.text = element_text(size = 21))+
        ggtitle(paste("Subbasin ", i, ": ", basins_file[i, "Basin"], sep = ""))
      
      
      #streamflo_metrics_plots[[i]] <- ggplotly(strm_plot)
      
      GWC <- table_all %>% filter(Basin_ID == i) %>% select(gw_cont)
      
      table_metrics <- tibble(Subbasin_ID = i, NSE = nses, `R` = r2s, PBIAS = pbias, RMSE = rmses, GWC = GWC$gw_cont) %>% mutate_all(., round, digits = 2)
      
      streamflow_metrics <- rbind(streamflow_metrics, table_metrics)
      
      table_plot <- ggplot()+annotate(geom = "table", x = 1, y = 1, label = list(table_metrics))+
        theme_bw()+theme(axis.line = element_blank(), line = element_blank(),
                         text = element_blank(), panel.border   = element_blank())
      
      
      
   #   plot_merge <- strm_plot / table_plot + plot_layout(heights = c(7,1))
   #   
   #   
   #   
   #   
   #   ggsave(plot = plot_merge, filename =  paste("Data/Figures/Validation/Fine_tunning/Ft", ft, "/", i, "_", basins_file[i, "Basin"], ".png", sep = ""),
   #          device = "png", dpi = 600, width = 12, height = 10)
   #   
      
    }
    
    
    
    #  htmlwidgets::saveWidget( streamflo_metrics_plots[[i]], 
    #                           "Data/Figures/Validation/streamflow/1_Best_selected_set/ggplotlys/index.html")
    
    
    
    # write.csv(streamflow_metrics, "Data/Results/Validation/metrics_bestsets_combination.csv", row.names = F, quote = F)
    # write_rds(streamflo_metrics_list, "Data/Results/Validation/metrics_bestsets_combination5.rds")
    
    
    ##### Extract results and generate plots for reservoirs inflow #####     
    
    # Reservoirs data
    
    reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv")
    
    # Simulated data
    
    simulation <-  chanels
    
    
    # Creating and exporting lists with observed-simulated data 
    
    evaluated_period <- c(2010:2019)
    
    
    res_studied <- reservoirs_data %>% mutate(namelist = paste("res_in_", Lake_id , sep = "")) %>% arrange(., Lake_id)
    res_sim_inflow <- simulation$simulation[grepl("res_in_", names(simulation$simulation))] 
    
    res_inflows_tibs <- c()
    res_inflows <- list()
    
    for(i in 1: length(res_sim_inflow)){
      
      res_inflow <- res_sim_inflow[[i]]
      
      res_inflow <- tibble(res_inflow[,1], reservoir = paste("lake_", i, sep = ""), res_inflow[,-1]/86400)
      
      res_inflows[[i]] <- res_inflow
      
      
      res_inflows_tib <-  res_sim_inflow[[i]] %>% 
        mutate(flo_in = run_1/86400, 
               Lake_id = paste0("Lake_", str_remove(names(res_sim_inflow[i]), "res_in_"))) %>% 
        select(Lake_id, date, flo_in)
      
      
      res_inflows_tibs <- res_inflows_tibs %>% rbind(., res_inflows_tib)
      
      
      
    }
    names(res_inflows) <- str_replace(unique(names(res_sim_inflow)), "res_in_", "lake_")
    


    # Loading saved data
    
    observed_inflow <- read_rds("Data/Reservoirs/Simulation/observed_reservoir_inflow.rds") 
    res_inflows <- res_inflows
    
    
    # Calculating performance for reservoirs inflow
    
    # Funtion to calculate coeficient of determination
    rsq_r2 <-  function(x, y , na.rm = TRUE) cor(x, y, use="complete.obs")^2 
    
    
    evaluated_period <- c(2010:2019)
    number_simulations <- 1
    
    
  tabs <- c()
    
    for(i in 1:length(observed_inflow)){
      
    
    
    obs <- observed_inflow[[i]] %>% 
      filter(year(date) %in% evaluated_period) 
    
    
    sim <- res_inflows[[names(observed_inflow[i])]] %>% 
      filter(date %in% obs$date) %>% 
      group_by(month(date), year(date)) %>% 
      summarise(run_1  = mean(run_1 ))
    
    obs <- obs%>% 
      group_by(month(date), year(date)) %>% 
      summarise(obsflow_m3s = mean(obsflow_m3s))
    
    
    tab <-  tibble(reservoir = names(observed_inflow[i]), 
                   nse = NSE(sim$run_1, obs$obsflow_m3s), 
                   r2 = rsq_r2(sim$run_1, obs$obsflow_m3s), 
                   pbias = pbias(sim$run_1, obs$obsflow_m3s), 
                   rmse = rmse(sim$run_1, obs$obsflow_m3s))
    tabs <- rbind(tabs, tab)
    
    }
    
    
    reservoirs_data <- read.csv("Data/csv_files/reservoirs_data.csv") %>%
      mutate(Lake_id = paste("lake_", Lake_id, sep = "")) %>% 
      mutate(region = region_r1)
    
    
    
    
    evaluated_period <- c(2010:2019)
    number_simulations <- 1
    
    
    streamflow_metrics_res <- c()
    tabs <- c()
    
    for(i in 1:length(observed_inflow)){
      
      lake <- names(observed_inflow[i])
      
      
      
      obs <- observed_inflow[[i]] %>% 
        filter(year(date) %in% evaluated_period) 
      
      
      sim <- res_inflows[[names(observed_inflow[i])]] %>% 
        filter(date %in% obs$date) 
      
            
      str_plot <-  obs %>% left_join(., sim, "date") %>%
        rename(Reservoir = name) %>% 
        pivot_longer(., c("obsflow_m3s" , "run_1")) %>% 
        mutate(name = case_when(name == "run_1" ~ "Simulated", .default = "Observed")) %>% 
        ggplot(., aes(x = date, color = name, linetype = name,  y = value))+
        geom_line(linewidth = 1)+
        scale_color_manual(values = c("black", "steelblue"))+
        scale_linetype_manual(values = c(2, 1))+
        theme_bw()+
        guides(color = guide_legend(title.position = "top"))+
        labs(x = "Date", y = "Streamflow (m/s)")+
        theme(legend.position = c(0.1, 0.8), legend.title = element_blank())+
        ggtitle(paste(lake, ", ", unique(obs$name), sep = ""))
      
      
      sim <- sim%>% 
        group_by(month(date), year(date)) %>% 
        summarise(run_1  = mean(run_1 ))
      
      obs <- obs%>% 
        group_by(month(date), year(date)) %>% 
        summarise(obsflow_m3s = mean(obsflow_m3s))
      
      
      tab <-  tibble(reservoir = names(observed_inflow[i]), 
                     nse = NSE(sim$run_1, obs$obsflow_m3s), 
                     r2 = rsq_r2(sim$run_1, obs$obsflow_m3s), 
                     pbias = pbias(sim$run_1, obs$obsflow_m3s), 
                     rmse = rmse(sim$run_1, obs$obsflow_m3s)) %>% 
        mutate_if(., is.numeric, round, 2)
      tabs <- rbind(tabs, tab)
      
      
      lake_dat <- reservoirs_data %>% filter(Lake_id == lake)

      
      table_plot <- ggplot()+annotate(geom = "table", x = 1, y = 1, label = list(tab))+
        theme_bw()+theme(axis.line = element_blank(), line = element_blank(),
                         text = element_blank(), panel.border   = element_blank())
      
      
      
      plot_merge <- str_plot / table_plot + plot_layout(heights = c(7,1))
      
      
      
      
      ggsave(plot = plot_merge, filename =  paste("Data/Figures/Validation/Fine_tunning/Ft", ft, "/Reservoirs/", i, "_", lake, ".png", sep = ""),
             device = "png", dpi = 600, width = 12, height = 10)
      
      
      
      
    }
    
    
    
    
    ###### STREAMFLOW COMPONENTS DAILY SCALE  ###### 
    
    
    
    ##### Daily streamflow components simulation analysis #####
    
    
    basins_file <- read.csv("Data/csv_files/basins_file.csv")
    subbasins_names <- paste(basins_file$Basin_ID, str_replace_all(basins_file$Basin, " ", "_"), sep = "_")
    
    
    library(sf)
    library(tidyverse)
    sim_tagus_valr4_wb <- chanels
    basins_file <- read.csv("Data/csv_files/basins_file.csv")   
    lsus_subbasins_shp <- read_sf("Data/GIS/hardcal_shapes/studied_lsus/lsus_prop_final.shp")
    studied_subb <- read_sf("Data/GIS/hardcal_shapes/subbasins/hardcal_natural_basins.shp")
    
    ####### LSUS and aquifers data extraction and aggregation    ####### 
    
    lsus_studied <- lsus_subbasins_shp %>%  st_drop_geometry()
    
    # List extraction: Precipitation
    lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_pcp_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
    lsus_pcp <- sim_tagus_valr4_wb$simulation[grepl("ls_pcp", names(sim_tagus_valr4_wb$simulation))] #%>% .[lsus_data$namelist]
    
    # Calculating the average pcp for each subbasin in mm
    
    sims_num <- length(sim_tagus_valr4_wb$parameter$values$surlag)
    basins_annual_pcps <- c()
    
    for(i in 1:length(unique(lsus_data$Basin_ID))){
      
      lsus_area_sum <- lsus_data %>% 
        filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_area_m")] %>% 
        sum(.)
      
      lsus_basin <- lsus_data %>% 
        filter(Basin_ID == unique(lsus_data$Basin_ID)[i]) %>% .[,c("lsu_id_rea", "area_frac")]
      
      
      basin_lsus_pcp <- lsus_pcp[lsus_basin$lsu_id_rea]
      
      
      av_pcps <- tibble(year = c(2010:2019))
      
      for(f in 1:length(basin_lsus_pcp)){
        
        lsu_frac <- lsus_basin[f, "area_frac"]
        
        ann_pcp <- basin_lsus_pcp[[f]] %>% 
          mutate(year = year(date)) %>% select(-date) %>% 
          filter(year > 2009) %>% 
          mutate(pcp = run_1 * lsu_frac$area_frac) %>% select(-run_1)
        
        av_pcps <- av_pcps %>% left_join(., ann_pcp, "year") 
        
      }
      
      basin_annual_pcps <- apply(av_pcps[,-1], 1, sum) %>% 
        tibble( annual_pcp = .) %>% mutate(Subbasin_ID = i) # Calculate the average annual gwflo for each aquifer in milimiters
      
      basins_annual_pcps <- basins_annual_pcps %>% rbind(., basin_annual_pcps)
      
    }
    
    basins_annual_pcps
    
    
    # List extraction: SURQ_CHA = SURQ_GEN - SURQ_LS - SURQ_RES
    lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_gen_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
    lsus_surqgen <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_gen", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
    
    lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_ls_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
    lsus_surqls <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_ls", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
    
    lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_surq_res_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
    lsus_surqres <- sim_tagus_valr4_wb$simulation[grepl("ls_surq_res", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
    
    
    # Calculating the total surq in mm for each lsu considering their relative area regarding the subbasin
    lsu_surqtot <- list()
    for(i in 1:length(lsus_surqgen)){
      
      
      lsu_surqtot[[i]] <- ((lsus_surqgen[[i]][,-1] - lsus_surqls[[i]][,-1] - lsus_surqres[[i]][,-1]) * (lsus_data$area_frac[i])) %>% tibble(.)
      
    }
    
    names(lsu_surqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_surq_basin", lsus_data$Basin_ID, sep = "")
    
    
    # Calculating the total surq for each subbasin in mm
    
    basin_surqs <- list()
    for(i in 1:length(unique(lsus_data$Basin_ID))){
      
      
      bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
      
      bas_select <- grepl(paste0(bas_select, "$"), names(lsu_surqtot))
      
      selected_lsus <- lsu_surqtot[bas_select]
      
      av_surqs <- c(1:sims_num)
      
      for(f in 1:length(selected_lsus)){
        
        av_surq <- selected_lsus[[f]] #%>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres --> Calculate the daily flow
        
        av_surqs <- av_surqs %>% cbind(av_surq) 
        
      }
      
      av_surqs <- tibble(av_surq_mm = av_surqs[,-1]) 
      
      basin_surq <- apply(av_surqs, 1, sum) %>% tibble(av_surq_mm = ., run = 1) 
      
      basin_surq <- basin_surq %>% mutate(run = paste("run_", run, sep = "")) 
      
      
      basin_surqs[[i]] = basin_surq 
      
    }
    
    
    namms <- basins_file %>% mutate(names_surqtot = paste("total_surq_basin", Basin_ID, sep = ""))
    names(basin_surqs) <- namms$names_surqtot
    
    
    # List extraction: LATQ_CHA = LATQ_CHA
    lsus_data <- lsus_studied  %>% mutate(namelist = paste("ls_latqcha_", lsu_id_rea , sep = "")) %>% arrange(., Basin_ID, lsu_id_rea)
    lsus_latqcha <- sim_tagus_valr4_wb$simulation[grepl("ls_latqcha", names(sim_tagus_valr4_wb$simulation))] %>% .[lsus_data$namelist]
    
    
    
    # Calculating the total latq in mm for each lsu considering their relative area regarding the subbasin
    lsu_latqtot <- list()
    for(i in 1:length(lsus_latqcha)){
      
      
      lsu_latqtot[[i]] <- (lsus_latqcha[[i]][,-1] * (lsus_data$area_frac[i])) %>% tibble(.)
      
    }
    
    names(lsu_latqtot) <- paste("lsu_", lsus_data$lsu_id_rea, "total_latq_basin", lsus_data$Basin_ID, sep = "")
    
    
    # Calculating the total latqq for each subbasin in mm
    
    basin_latqs <- list()
    for(i in 1:length(unique(lsus_data$Basin_ID))){
      
      
      bas_select <- paste("basin",unique(lsus_data$Basin_ID)[i], sep = "")
      
      bas_select <- grepl(paste0(bas_select, "$"), names(lsu_latqtot))
      
      selected_lsus <- lsu_latqtot[bas_select]
      
      av_latqs <- c(1:sims_num)
      
      for(f in 1:length(selected_lsus)){
        
        av_latq <- selected_lsus[[f]] #%>% apply(., 2, mean) %>% data.frame(.) # Calculate the average annual gwflo for each aquifer in litres
        
        av_latqs <- av_latqs %>% cbind(av_latq) 
        
      }
      
      av_latqs <- tibble(av_latq_mm = av_latqs[,-1])  # Calculate the average annual gwflo for each aquifer in milimiters
      
      basin_latq <- apply(av_latqs, 1, sum)   %>% tibble(av_latq_mm = ., run = 1)
      
      basin_latq <- basin_latq %>% mutate(run = paste("run_", run, sep = "")) 
      
      basin_latqs[[i]] = basin_latq # List with the gwflo for all the subbasins
      
    }
    
    
    namms <- basins_file %>% mutate(names_latqtot = paste("total_latq_basin", Basin_ID, sep = ""))
    names(basin_latqs) <- namms$names_latqtot
    
    
    
    ## Aquifers data: Calculated using flo + flo_res. For some aquifers, the relative drainage area to the gagugin stations has been used (aquif_data$fact_corr, previously calculated with QGIS)
    
    aquifers_studied <- read_sf("Data/GIS/hardcal_shapes/studied_aquifers/aquifers_selected.shp") %>% arrange(., Basin_ID)
    basins_file <- read.csv("Data/csv_files/basins_file.csv")
    
    
    # List extraction
    aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwflocha_", Aq_id , sep = ""))
    aquifers_flocha <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwflocha", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
    
    aquif_data <- aquifers_studied %>% st_drop_geometry() %>% mutate(namelist = paste("aqu_gwres_", Aq_id , sep = ""))
    aquifers_flores <- sim_tagus_valr4_wb$simulation[grepl("aqu_gwres", names(sim_tagus_valr4_wb$simulation))] %>% .[aquif_data$namelist]
    
    
    # Calculating the total gwflo in liters for each aquifer --> ONLY FLO_CHA
    aquif_flo_tot_litres <- list()
    for(i in 1:length(aquifers_flocha)){
      
      
      aquif_flo_tot_litres[[i]] <- (aquifers_flocha[[i]][,-1] * ( aquif_data$Area_km[i] * 1000000 * aquif_data$fact_corr[i])) %>% tibble(.)
      
    }
    
    names(aquif_flo_tot_litres) <- paste("aqu_", aquif_data$Aq_id, "totalflo_lit_basin", aquif_data$Basin_ID, sep = "")
    
    
    # Calculating the total flo for each subbasin in mm
    
    basin_gwflos <- list()
    for(i in 1:length(unique(aquif_data$Basin_ID))){
      
      aquifers_area_sum <- aquif_data %>% 
        filter(Basin_ID == unique(aquif_data$Basin_ID)[i]) %>% .[,c("fact_corr","Area_km")] %>% 
        mutate(real_area = fact_corr * Area_km) %>% .[, "real_area" ] %>% 
        sum(.)*1e6
      
      bas_select <- paste("basin",unique(aquif_data$Basin_ID)[i], sep = "")
      
      bas_select <- grepl(paste0(bas_select, "$"), names(aquif_flo_tot_litres))
      
      selected_aqus <- aquif_flo_tot_litres[bas_select]
      
      av_gwflos <- c(1:sims_num)
      
      for(f in 1:length(selected_aqus)){
        
        av_gwflo <- selected_aqus[[f]] 
        
        av_gwflos <- av_gwflos %>% cbind(av_gwflo) 
        
      }
      
      av_gwflos <- tibble(av_gwflo_mm = av_gwflos[,-1] / aquifers_area_sum)  # Calculate the average annual gwflo for each aquifer in milimiters
      
      basin_gwflo <- apply(av_gwflos, 1, sum) %>% tibble(av_gwflo_mm = ., run = 1)
      
      basin_gwflo <- basin_gwflo %>% mutate(run = paste("run_", run, sep = "")) 
      
      
      basin_gwflos[[i]] = basin_gwflo # List with the gwflo for all the subbasins
      
    }
    
    
    namms <- basins_file %>% mutate(names_gwtot = paste("total_gwflo_basin", Basin_ID, sep = ""))
    names(basin_gwflos) <- namms$names_gwtot
    
    
    ##### creating complete tables #####
    
    
    # Observed flow
    
    observed_streamflow_list <- read_rds("Data/Simulations/list_observed_data.rds")
    
    # Simulated
    
    sim_flow_list <- sim_cha_list #read_rds("Data/Simulations/Validation/streamflow_best_simulation_strcomp5.rds")
    
    
    subb_tables_fluxes <- c()
    subb_tables_anual <- c()
    
    
    for(i in 1:length(observed_streamflow_list)){ 
      
      obs <- observed_streamflow_list[[i]] %>% mutate(date = ymd(fecha)) %>% 
        filter(year(fecha) %in% 2010:2019) %>% rename("obs_flow" = "caudal")
      
      sim <- sim_flow_list[[i]]%>% mutate(date = ymd(date)) %>% rename("sim_flow_m3s" = "run_1")
      
      
      # pcp <- tibble(basin_pcps[[i]])
      latq <- tibble(basin_latqs[[i]]) 
      surq <- tibble(basin_surqs[[i]]) 
      gwflo <- tibble(basin_gwflos[[i]])
      
      subb_table_fluxes <-  tibble(surq_mm = surq$av_surq_mm, latq_mm = latq$av_latq_mm, gw_flow_mm = gwflo$av_gwflo_mm) %>%  
        mutate(daily_cont = surq_mm + latq_mm + gw_flow_mm) %>% 
        mutate(date = seq(dmy("01/01/2010"), dmy("31/12/2019"), 1)) %>% 
        mutate(Subbasin_ID = i) %>% left_join(., sim,  "date") %>% left_join(., obs[,c("date", "obs_flow")], "date")
      
      
      subb_tables_fluxes <-  subb_tables_fluxes %>% rbind(., subb_table_fluxes)
      
      subb_table_anual <-  subb_table_fluxes %>% mutate(date = seq(dmy("01/01/2010"), dmy("31/12/2019"), 1)) %>% 
        group_by(year = year(date)) %>% 
        summarise(annual_wyld = sum(daily_cont), 
                  annual_surq = sum(surq_mm),
                  annual_latq = sum(latq_mm),
                  annual_gwf = sum(gw_flow_mm)) %>% 
        mutate(annual_gwc = annual_gwf/annual_wyld) %>%   
        mutate(Subbasin_ID = i)
      
      subb_tables_anual <- rbind(subb_tables_anual, subb_table_anual)
      
      
    }
    
    
    
    
    ####### Converting fluxes to M3S and creating plots ######
    
    calc_mm <- function(x, y){x*y/86400000} 
    
    basins_area <- basins_file[,c("Basin_ID", "area")]
    
    plots_comps <- list()
    
    for(i in 1:length(basins_area$Basin_ID)){
      
      
      tab_comps <-  subb_tables_fluxes %>% filter(Subbasin_ID == i) %>% 
        mutate(surq_m3s = calc_mm(surq_mm, basins_area[i,"area"]),
               latq_m3s = calc_mm(latq_mm, basins_area[i,"area"]),
               gwflow_m3s = calc_mm(gw_flow_mm, basins_area[i,"area"]),
               wyld_m3s = calc_mm(daily_cont, basins_area[i,"area"]))
      
      
     plot_comps <-  tab_comps %>% select(Subbasin_ID, date, obs_flow, sim_flow_m3s, surq_m3s, latq_m3s, gwflow_m3s, wyld_m3s) %>% 
       pivot_longer(., c(surq_m3s, latq_m3s, gwflow_m3s), names_to = "component", values_to = "contrib_m3s") %>% 
       mutate(component = factor(component, levels = c("surq_m3s", "latq_m3s", "gwflow_m3s"), labels = c("Surface runoff", "Lateral flow", "Groundwater"))) %>% 
       ggplot(aes(x = date))+
       geom_area(aes(y = contrib_m3s, fill = component))+
       scale_fill_manual(values = c("turquoise", "darkorange2", "chocolate4"))+
       geom_line(aes(y = obs_flow, color = "Observed"), colour = "black", linetype = 2)+
       geom_line(aes(y = sim_flow_m3s, color = "Simulated"), color = "blue")+
       geom_line(aes(y = wyld_m3s, color = "Water yield"), color = "steelblue")+
       theme_bw()+theme(axis.title.x = element_blank(), text = element_text(size = 15))+
       labs(y = "Streamflow (mm)", fill = "Streamflow component", color = "Streamflow")+
       ggtitle(paste(basins_file[i, "Basin_ID"], basins_file[i, "Basin"]))
      
      
     # ggsave(plot = plot_comps, filename =  paste("Data/Figures/Validation/Fine_tunning/Ft", ft,  "/components/", i, "_", basins_file[i, "Basin"], "_str_comp", ".png", sep = ""),
     #        device = "png", dpi = 600, width = 12, height = 10) 
     # 
      
      #    plotly_p <- ggplotly(plot_comps)
      #  
      #  htmlwidgets::saveWidget( plotly_p, 
      #                          paste("Data/Figures/Validation/streamflow_bestcomb5/components/ggplotlys/", i, basins_file[i, "Basin"], "index.html", sep = ""))
      #  
      
    }
    
    
    
    
    
    
     
     